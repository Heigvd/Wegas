<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets">

    <ui:composition template="/wegas-app/view/template/app-default.xhtml">

        <ui:define name="title">Editor lobby</ui:define>

        <ui:define name="head">
            <link rel="stylesheet" type="text/css" href="/Wegas/wegas-editor/css/wegas-editor.css" />
        </ui:define>

        <ui:define name="body">
            <script type="text/javascript">
                var Y = YUI().use("wegas-app", "wegas-editor", function (Y) {
                    var cfg = {
                        layoutSrc: 'wegas-editor/db/wegas-lobby-layout.json',
                        debug : true,
                        currentUser: #{requestController.getCurrentUser().toJson()},
                        dataSources: {
                            "GameModel": {
                                source: "rest/Index/GameModel",
                                initialRequest: "",
                                plugins: [
                                    {
                                        fn: "DataSourceJSONSchema",
                                        cfg: {
                                            schema: {
                                                resultListLocator: "."
                                                // resultFields: ["name", "id", "@class", "errors"]
                                            }
                                        }
                                    }, {
                                        fn: "GameModelDataSourceREST"
                                    }
                                ]
                            },
                            "Game": {
                                source: "rest/GameModel/",
                                plugins: [
                                    {
                                        fn: "DataSourceJSONSchema",
                                        cfg: {
                                            schema: {
                                                resultListLocator: "."
                                                // resultFields: ["name", "id", "@class", "errors"]
                                            }
                                        }
                                    }, {
                                        fn: "GameDataSourceREST"
                                    }
                                ]
                            },
                        }
                    };

                    Y.on('domready', function() {                               // When dom is ready,

//                        Y.Wegas.persistence.Game.EDITMENU.splice(0, 0, {
//                            type: "Button",
//                            label: "Open in editor",
//                            plugins: [{
//                                    fn: "OpenGameAction"
//                                }]
//                        });

                        //Y.Wegas.persistence.Player.EDITMENU.splice(0, 0, {
                        //    type: "Button",
                        //    label: "Open in editor",
                        //    plugins: [{
                        //            fn: "OpenGameAction"
                        //        }]
                        //});

                        var editor = new Y.Wegas.Editor(cfg);                   // Launch the editor as soon as Dom is ready
                        editor.render();
                    });
                });
            </script>
        </ui:define>
    </ui:composition>
</html>
