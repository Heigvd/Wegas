{
    "@class": "GameModel",
    "name": "Project Management Game",
    "properties": {
        "cssUri": "wegas-pmg/css/wegas-pmg.css",
        "pagesUri": "wegas-pmg/db/wegas-pmg-pages.json?"
    },
    "childVariableDescriptors": [
        {
            "@class": "InboxDescriptor",
            "name": "inbox",
            "defaultInstance": {
                "@class": "InboxInstance",
                "messages": [
                ]
            },
            "scope": {
                "@class": "TeamScope"
            }
        }, {
            "@class": "NumberDescriptor",
            "name": "currentPhase",
            "editorLabel": "currentPhase",
            "label": "Current phase",
            "minValue": 0,
            "maxValue": 4,
            "defaultInstance": {
                "@class": "NumberInstance",
                "value": 0
            },
            "scope": {
                "@class": "TeamScope"
            }
        }, {
            "@class": "NumberDescriptor",
            "name": "actualCost",
            "editorLabel": "actualCost",
            "label": "actualCost",
            "minValue": 0,
            "defaultInstance": {
                "@class": "NumberInstance",
                "value": 0
            },
            "scope": {
                "@class": "TeamScope"
            }
        }, {
            "@class": "NumberDescriptor",
            "name": "planedValue",
            "editorLabel": "planedValue",
            "label": "planedValue",
            "minValue": 0,
            "defaultInstance": {
                "@class": "NumberInstance",
                "value": 0
            },
            "scope": {
                "@class": "TeamScope"
            }
        }, {
            "@class": "NumberDescriptor",
            "name": "earnedValue",
            "editorLabel": "earnedValue",
            "label": "earnedValue",
            "minValue": 0,
            "defaultInstance": {
                "@class": "NumberInstance",
                "value": 0
            },
            "scope": {
                "@class": "TeamScope"
            }
        }, {
            "@class": "NumberDescriptor",
            "name": "managementApprovalImpacts",
            "editorLabel": "managementApproval impacts",
            "label": "managementApproval impacts",
            "defaultInstance": {
                "@class": "NumberInstance",
                "value": 0
            },
            "scope": {
                "@class": "TeamScope"
            }
        }, {
            "@class": "NumberDescriptor",
            "name": "userApprovalImpacts",
            "editorLabel": "userApproval impacts",
            "label": "userApproval impacts",
            "defaultInstance": {
                "@class": "NumberInstance",
                "value": 0
            },
            "scope": {
                "@class": "TeamScope"
            }
        }, {
            "@class": "NumberDescriptor",
            "name": "costsImpacts",
            "editorLabel": "costs impacts",
            "label": "costs impacts",
            "defaultInstance": {
                "@class": "NumberInstance",
                "value": 0
            },
            "scope": {
                "@class": "TeamScope"
            }
        }, {
            "@class": "NumberDescriptor",
            "name": "qualityImpacts",
            "editorLabel": "quality impacts",
            "label": "quality impacts",
            "defaultInstance": {
                "@class": "NumberInstance",
                "value": 0
            },
            "scope": {
                "@class": "TeamScope"
            }
        }, {
            "@class": "NumberDescriptor",
            "name": "delayImpacts",
            "editorLabel": "delay impacts",
            "label": "delay impacts",
            "defaultInstance": {
                "@class": "NumberInstance",
                "value": 0
            },
            "scope": {
                "@class": "TeamScope"
            }
        }, {
            "@class": "ListDescriptor",
            "name": "timeCards",
            "editorLabel": "time cards",
            "label": "time cards",
            "defaultInstance": {
                "@class": "ListInstance"
            },
            "scope": {
                "@class": "TeamScope"
            },
            "items": [
                {
                    "@class": "NumberDescriptor",
                    "name": "cardsPhase1",
                    "editorLabel": "Cards phase 1",
                    "label": "Cards phase 1",
                    "minValue": 0,
                    "maxValue": 15,
                    "defaultInstance": {
                        "@class": "NumberInstance",
                        "value": 15
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                }, {
                    "@class": "NumberDescriptor",
                    "name": "cardsPhase2",
                    "editorLabel": "Cards phase 2",
                    "label": "Cards phase 2",
                    "minValue": 0,
                    "maxValue": 7,
                    "defaultInstance": {
                        "@class": "NumberInstance",
                        "value": 7
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                }, {
                    "@class": "NumberDescriptor",
                    "name": "cardsPhase3",
                    "editorLabel": "Cards phase 3",
                    "label": "Cards phase 3",
                    "minValue": 0,
                    "maxValue": 10,
                    "defaultInstance": {
                        "@class": "NumberInstance",
                        "value": 10
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                }, {
                    "@class": "NumberDescriptor",
                    "name": "cardsPhase4",
                    "editorLabel": "Cards phase 4",
                    "label": "Cards phase 4",
                    "minValue": 0,
                    "maxValue": 5,
                    "defaultInstance": {
                        "@class": "NumberInstance",
                        "value": 5
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                }
            ]
        }, {
            "@class": "ListDescriptor",
            "name": "pageUtilities",
            "label": "page utilities",
            "editorLabel": "page utilities",
            "defaultInstance": {
                "@class": "ListInstance"
            },
            "scope": {
                "@class": "TeamScope"
            },
            "items": [{
                    "@class": "NumberDescriptor",
                    "name": "managementApproval",
                    "editorLabel": "managementApproval",
                    "label": "managementApproval",
                    "minValue": 0,
                    "maxValue": 200,
                    "defaultInstance": {
                        "@class": "NumberInstance",
                        "value": 100
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                }, {
                    "@class": "NumberDescriptor",
                    "name": "userApproval",
                    "editorLabel": "userApproval",
                    "label": "userApproval",
                    "minValue": 0,
                    "maxValue": 200,
                    "defaultInstance": {
                        "@class": "NumberInstance",
                        "value": 100
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                }, {
                    "@class": "NumberDescriptor",
                    "name": "costs",
                    "editorLabel": "costs",
                    "label": "costs",
                    "minValue": 0,
                    "maxValue": 200,
                    "defaultInstance": {
                        "@class": "NumberInstance",
                        "value": 100
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                }, {
                    "@class": "NumberDescriptor",
                    "name": "quality",
                    "editorLabel": "quality",
                    "label": "quality",
                    "minValue": 0,
                    "maxValue": 200,
                    "defaultInstance": {
                        "@class": "NumberInstance",
                        "value": 100
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                }, {
                    "@class": "NumberDescriptor",
                    "name": "delay",
                    "editorLabel": "delay",
                    "label": "delay",
                    "minValue": 0,
                    "maxValue": 200,
                    "defaultInstance": {
                        "@class": "NumberInstance",
                        "value": 100
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                }, {
                    "@class": "NumberDescriptor",
                    "name": "ganttPage",
                    "label": "ganttPage",
                    "defaultInstance": {
                        "@class": "NumberInstance",
                        "value": 0
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }

                }, {
                    "@class": "NumberDescriptor",
                    "name": "taskPage",
                    "label": "taskPage",
                    "defaultInstance": {
                        "@class": "NumberInstance",
                        "value": 0
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                }]
        }, {
            "@class": "ListDescriptor",
            "name": "currentPeriod",
            "editorLabel": "currentPeriod",
            "label": "Current period",
            "defaultInstance": {
                "@class": "ListInstance"
            },
            "scope": {
                "@class": "TeamScope"
            },
            "items": [
                {
                    "@class": "NumberDescriptor",
                    "name": "periodPhase1",
                    "editorLabel": "periodPhase1",
                    "label": "periodPhase1",
                    "minValue": 1,
                    "maxValue": 1,
                    "defaultInstance": {
                        "@class": "NumberInstance",
                        "value": 1
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                }, {
                    "@class": "NumberDescriptor",
                    "name": "periodPhase2",
                    "editorLabel": "periodPhase2",
                    "label": "periodPhase2",
                    "minValue": 1,
                    "maxValue": 1,
                    "defaultInstance": {
                        "@class": "NumberInstance",
                        "value": 1
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                }, {
                    "@class": "NumberDescriptor",
                    "name": "periodPhase3",
                    "editorLabel": "periodPhase3",
                    "label": "periodPhase3",
                    "minValue": 1,
                    "maxValue": 10,
                    "defaultInstance": {
                        "@class": "NumberInstance",
                        "value": 1
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                }, {
                    "@class": "NumberDescriptor",
                    "name": "periodPhase1_4",
                    "editorLabel": "periodPhase1_4",
                    "label": "periodPhase1_4",
                    "minValue": 1,
                    "maxValue": 1,
                    "defaultInstance": {
                        "@class": "NumberInstance",
                        "value": 1
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                }
            ]
        }, {
            "@class": "ListDescriptor",
            "name": "employees",
            "editorLabel": "employees",
            "label": "employees",
            "defaultInstance": {
                "@class": "ListInstance"
            },
            "scope": {
                "@class": "TeamScope"
            },
            "items": [
                {
                    "@class": "ListDescriptor",
                    "name": "businessSpecialist",
                    "editorLabel": "businessSpecialist",
                    "label": "businessSpecialist",
                    "defaultInstance": {
                        "@class": "ListInstance"
                    },
                    "scope": {
                        "@class": "TeamScope"
                    },
                    "items": [
                        {
                            "@class": "ResourceDescriptor",
                            "name": "Marcel",
                            "editorLabel": "Marcel",
                            "label": "Marcel",
                            "description": "Description de Marcel",
                            "properties": {
                                "coef_activity": 1,
                                "coef_moral": 1,
                                "engagementDelay": 0,
                                "maxBilledUnworkedHours": 0,
                                "planningAvailability": true
                            },
                            "defaultInstance": {
                                "@class": "ResourceInstance",
                                "moral": 8,
                                "properties": {
                                    "activityRate": 100,
                                    "wage": 7800
                                },
                                "skillsets": {
                                    "Business specialist": 9
                                }
                            },
                            "scope": {
                                "@class": "TeamScope"
                            }
                        }, {
                            "@class": "ResourceDescriptor",
                            "name": "Beatrice",
                            "editorLabel": "Beatrice",
                            "label": "Beatrice",
                            "description": "Description de Béatrice",
                            "properties": {
                                "coef_activity": 1,
                                "coef_moral": 1,
                                "engagementDelay": 0,
                                "maxBilledUnworkedHours": 0,
                                "planningAvailability": true
                            },
                            "defaultInstance": {
                                "@class": "ResourceInstance",
                                "moral": 9,
                                "confidence": 0,
                                "properties": {
                                    "activityRate": 80,
                                    "wage": 5400
                                },
                                "skillsets": {
                                    "Business specialist": 5
                                }
                            },
                            "scope": {
                                "@class": "TeamScope"
                            }
                        }
                    ]
                }, {
                    "@class": "ListDescriptor",
                    "name": "webDesigner",
                    "editorLabel": "webDesigner",
                    "label": "webDesigner",
                    "defaultInstance": {
                        "@class": "ListInstance"
                    },
                    "scope": {
                        "@class": "TeamScope"
                    },
                    "items": [
                        {
                            "@class": "ResourceDescriptor",
                            "name": "Claude",
                            "editorLabel": "Claude",
                            "label": "Claude",
                            "description": "Description de Claude",
                            "properties": {
                                "coef_activity": 1,
                                "coef_moral": 1,
                                "engagementDelay": 0,
                                "maxBilledUnworkedHours": 0,
                                "planningAvailability": true
                            },
                            "defaultInstance": {
                                "@class": "ResourceInstance",
                                "moral": 8,
                                "confidence": 0,
                                "properties": {
                                    "activityRate": 80,
                                    "wage": 4200
                                },
                                "skillsets": {
                                    "Web designer": 2
                                }
                            },
                            "scope": {
                                "@class": "TeamScope"
                            }
                        }, {
                            "@class": "ResourceDescriptor",
                            "name": "Michael",
                            "editorLabel": "Michael",
                            "label": "Michael",
                            "description": "Description de Michael",
                            "properties": {
                                "coef_activity": 1,
                                "coef_moral": 1,
                                "engagementDelay": 0,
                                "maxBilledUnworkedHours": 0,
                                "planningAvailability": true
                            },
                            "defaultInstance": {
                                "@class": "ResourceInstance",
                                "moral": 6,
                                "confidence": 0,
                                "properties": {
                                    "activityRate": 100,
                                    "wage": 6000
                                },
                                "skillsets": {
                                    "Web designer": 5
                                }
                            },
                            "scope": {
                                "@class": "TeamScope"
                            }
                        }, {
                            "@class": "ResourceDescriptor",
                            "name": "Lucie",
                            "editorLabel": "Lucie",
                            "label": "Lucie",
                            "description": "Description de Lucie",
                            "properties": {
                                "coef_activity": 1,
                                "coef_moral": 1,
                                "engagementDelay": 0,
                                "maxBilledUnworkedHours": 0,
                                "planningAvailability": true
                            },
                            "defaultInstance": {
                                "@class": "ResourceInstance",
                                "moral": 7,
                                "confidence": 0,
                                "properties": {
                                    "activityRate": 100,
                                    "wage": 5800
                                },
                                "skillsets": {
                                    "Web designer": 7
                                }
                            },
                            "scope": {
                                "@class": "TeamScope"
                            }
                        }
                    ]
                }
            ]
        }, {
            "@class": "ListDescriptor",
            "name": "tasks",
            "editorLabel": "tasks",
            "label": "tasks",
            "defaultInstance": {
                "@class": "ListInstance"
            },
            "scope": {
                "@class": "TeamScope"
            },
            "items": [{
                    "@class": "TaskDescriptor",
                    "name": "User-Interface Modeling",
                    "editorLabel": "User-Interface Modeling",
                    "label": "User-Interface Modeling",
                    "index": 1,
                    "description": "description tâche 1",
                    "properties": {
                        "bonusRatio": 1,
                        "competenceRatioInf": 0,
                        "competenceRatioSup": 0,
                        "coordinationRatioInf": 0,
                        "coordinationRatioSup": 0,
                        "progressionOfNeeds": 0,
                        "takeInHandDuration": 0,
                        "randomDurationInf": 0.17,
                        "randomDurationSup": 0.26
                    },
                    "defaultInstance": {
                        "@class": "TaskInstance",
                        "active": true,
                        "duration": 2,
                        "plannification": [1, 2],
                        "properties": {
                            "fixedCosts": 1200,
                            "predecessorsDependances": 1000,
                            "completeness": 0,
                            "unworkedHoursCosts": 0,
                            "wages": 0,
                            "quality": 0,
                            "bac": 1200
                        },
                        "requirements": [{
                                "@class": "WRequirement",
                                "work": "Web designer",
                                "level": "1",
                                "limit": "100",
                                "quantity": "1",
                                "completeness": "0"
                            }, {
                                "@class": "WRequirement",
                                "work": "Business specialist",
                                "level": "3",
                                "limit": "100",
                                "quantity": "1",
                                "completeness": "0",
                                "quality": "0"
                            }]
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                }, {
                    "@class": "TaskDescriptor",
                    "name": "Web design",
                    "editorLabel": "Web design",
                    "label": "Web design",
                    "index": 2,
                    "description": "description tâche 2",
                    "properties": {
                        "bonusRatio": 1,
                        "competenceRatioInf": 0,
                        "competenceRatioSup": 0,
                        "coordinationRatioInf": 0,
                        "coordinationRatioSup": 0,
                        "progressionOfNeeds": 0,
                        "takeInHandDuration": 0,
                        "randomDurationInf": 0,
                        "randomDurationSup": 0
                    },
                    "defaultInstance": {
                        "@class": "TaskInstance",
                        "active": true,
                        "duration": 1,
                        "plannification": [1],
                        "properties": {
                            "fixedCosts": 1500,
                            "predecessorsDependances": 1000,
                            "completeness": 0,
                            "unworkedHoursCosts": 0,
                            "wages": 0,
                            "quality": 0,
                            "bac": 0
                        },
                        "requirements": [{
                                "@class": "WRequirement",
                                "work": "Web designer",
                                "level": "12",
                                "limit": "100",
                                "quantity": "2",
                                "completeness": "0",
                                "quality": "0"
                            }]
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                }, {
                    "@class": "TaskDescriptor",
                    "name": "Developpement",
                    "editorLabel": "Developper",
                    "label": "Developper",
                    "index": 3,
                    "description": "description tâche 3",
                    "properties": {
                        "bonusRatio": 1,
                        "competenceRatioInf": 0,
                        "competenceRatioSup": 0,
                        "coordinationRatioInf": 0,
                        "coordinationRatioSup": 0,
                        "progressionOfNeeds": 0,
                        "takeInHandDuration": 0,
                        "randomDurationInf": 0,
                        "randomDurationSup": 0
                    },
                    "defaultInstance": {
                        "@class": "TaskInstance",
                        "active": true,
                        "duration": 3,
                        "plannification": [1, 2, 3],
                        "properties": {
                            "fixedCosts": 1500,
                            "predecessorsDependances": 1000,
                            "completeness": 0,
                            "unworkedHoursCosts": 0,
                            "wages": 0,
                            "quality": 0,
                            "bac": 1500
                        },
                        "requirements": [{
                                "@class": "WRequirement",
                                "work": "Web designer",
                                "level": "12",
                                "limit": "100",
                                "quantity": "2",
                                "completeness": "0",
                                "quality": "0"
                            }]
                    },
                    "scope": {
                        "@class": "TeamScope"
                    }
                }
            ]
        }, {
            "@class": "ListDescriptor",
            "name": "questions",
            "editorLabel": "questions",
            "label": "questions",
            "defaultInstance": {
                "@class": "NumberInstance",
                "value": 0.0
            },
            "scope": {
                "@class": "GameScope"
            },
            "items": [{
                    "@class": "ListDescriptor",
                    "name": "questionPhase1",
                    "label": "Question phase 1",
                    "defaultInstance": {
                        "@class": "NumberInstance",
                        "value": 0.0
                    },
                    "scope": {
                        "@class": "GameScope"
                    },
                    "items": [
                        {
                            "@class": "ListDescriptor",
                            "name": "Questions period 1",
                            "editorLabel": "Questions period 1",
                            "label": "Questions period 1",
                            "defaultInstance": {
                                "@class": "NumberInstance"
                            },
                            "scope": {
                                "@class": "GameScope"
                            },
                            "items": [
                                {
                                    "@class": "QuestionDescriptor",
                                    "name": "Comment faire cela?",
                                    "editorLabel": "Comment faire cela?",
                                    "label": "Comment faire cela?",
                                    "defaultInstance": {
                                        "@class": "QuestionInstance"
                                    },
                                    "scope": {
                                        "@class": "TeamScope"
                                    },
                                    "items": [
                                        {
                                            "@class": "ChoiceDescriptor",
                                            "name": "Phase1Reponse1",
                                            "editorLabel": "a) Reponse 1",
                                            "label": "a) Reponse 1",
                                            "defaultInstance": {
                                                "@class": "ChoiceInstance"
                                            },
                                            "scope": {
                                                "@class": "TeamScope"
                                            },
                                            "results": [
                                                {
                                                    "@class": "Result",
                                                    "name": "Normal",
                                                    "answer": "Faux c'est pas lui."
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }, {
                            "@class": "ListDescriptor",
                            "name": "Questions period 2",
                            "editorLabel": "Questions period 2",
                            "label": "Questions period 2",
                            "defaultInstance": {
                                "@class": "NumberInstance"
                            },
                            "scope": {
                                "@class": "GameScope"
                            },
                            "items": [
                                {
                                    "@class": "QuestionDescriptor",
                                    "name": "Sample question phase 2?",
                                    "editorLabel": "Sample question phase 2?",
                                    "label": "Sample question phase 2?",
                                    "defaultInstance": {
                                        "@class": "QuestionInstance"
                                    },
                                    "scope": {
                                        "@class": "TeamScope"
                                    },
                                    "items": [
                                        {
                                            "@class": "ChoiceDescriptor",
                                            "name": "Phase2Reponse1",
                                            "editorLabel": "a) Reponse 1",
                                            "label": "a) Reponse 1",
                                            "defaultInstance": {
                                                "@class": "ChoiceInstance"
                                            },
                                            "scope": {
                                                "@class": "TeamScope"
                                            },
                                            "results": [
                                                {
                                                    "@class": "Result",
                                                    "name": "Normal",
                                                    "answer": "Faux c'est pas lui."
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        }, {
            "@class": "ListDescriptor",
            "name": "actions",
            "editorLabel": "actions",
            "label": "actions",
            "defaultInstance": {
                "@class": "NumberInstance",
                "value": 0.0
            },
            "scope": {
                "@class": "GameScope"
            },
            "items": [
                {
                    "@class": "ListDescriptor",
                    "name": "Actions phase 1",
                    "editorLabel": "Actions phase 1",
                    "label": "Actions phase 1",
                    "defaultInstance": {
                        "@class": "NumberInstance"
                    },
                    "scope": {
                        "@class": "GameScope"
                    },
                    "items": [
                        {
                            "@class": "QuestionDescriptor",
                            "name": "Effectuer action 1 phase 1",
                            "editorLabel": "Effectuer action 1 phase 1",
                            "label": "Effectuer action 1 phase 1",
                            "allowMultipleReplies": true,
                            "defaultInstance": {
                                "@class": "QuestionInstance"
                            },
                            "scope": {
                                "@class": "TeamScope"
                            },
                            "items": [
                                {
                                    "@class": "ChoiceDescriptor",
                                    "name": "Action1Reponse1",
                                    "editorLabel": "reponse 1)",
                                    "label": "reponse 1)",
                                    "defaultInstance": {
                                        "@class": "ChoiceInstance"
                                    },
                                    "scope": {
                                        "@class": "TeamScope"
                                    },
                                    "results": [
                                        {
                                            "@class": "Result",
                                            "name": "Normal",
                                            "answer": "Tout c'est bien passé.",
                                            "impact": {
                                                "@class": "Script",
                                                "language": "JavaScript",
                                                "content": "humanResources.value -= 1;"
                                            }
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }, {
                    "@class": "ListDescriptor",
                    "name": "Actions phase 2",
                    "editorLabel": "Actions phase 2",
                    "label": "Actions phase 2",
                    "defaultInstance": {
                        "@class": "NumberInstance"
                    },
                    "scope": {
                        "@class": "GameScope"
                    },
                    "items": [
                        {
                            "@class": "QuestionDescriptor",
                            "name": "Effectuer action 1 phase 2",
                            "editorLabel": "Effectuer action 1 phase 2",
                            "label": "Effectuer action 1 phase 2",
                            "allowMultipleReplies": true,
                            "defaultInstance": {
                                "@class": "QuestionInstance"
                            },
                            "scope": {
                                "@class": "TeamScope"
                            },
                            "items": [
                                {
                                    "@class": "ChoiceDescriptor",
                                    "name": "reponse 1)",
                                    "editorLabel": "reponse 1)",
                                    "label": "reponse 1)",
                                    "defaultInstance": {
                                        "@class": "ChoiceInstance"
                                    },
                                    "scope": {
                                        "@class": "TeamScope"
                                    },
                                    "results": [
                                        {
                                            "@class": "Result",
                                            "name": "Normal",
                                            "answer": "Tout c'est bien passé.",
                                            "impact": {
                                                "@class": "Script",
                                                "language": "JavaScript",
                                                "content": "humanResources.value -= 1;"
                                            }
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ],
    "scriptLibrary": {
        "default": {
            "@class": "GameModelContent",
            "contentType": null,
            "content": "importPackage(javax.naming);\r\nvar gm = self.getGameModel(), testMode = false;\r\nsteps = 10, minTaskDuration = 0.1;\r\n\r\nfunction nextPeriod() {\r\n    var time = getCurrentInGameTime(), phase = VariableDescriptorFacade.findByName(gm, 'currentPhase');\r\n    phases = VariableDescriptorFacade.findByName(gm, 'currentPeriod');\r\n    if (time.period === parseInt(phases.items.get(time.phase).getMaxValue())) { // if end of phase\r\n        phases.items.get(time.phase).getInstance(self).setValue(1);\r\n        phase.getInstance(self).setValue(time.phase + 1);\r\n    } else if (time.phase === 2) { //if current phase is the 'realisation' phase\r\n        completeRealizationPeriod();\r\n        if (checkEndOfProject()) { //if the project ended\r\n            phases.items.get(time.phase).getInstance(self).setValue(1);\r\n            phase.getInstance(self).setValue(time.phase + 1);\r\n        } else {\r\n            phases.items.get(time.phase).getInstance(self).setValue(time.period + 1);\r\n        }\r\n    } else {\r\n        phases.items.get(time.phase).getInstance(self).setValue(time.period + 1);\r\n    }\r\n}\r\n\r\nfunction checkEndOfProject() {\r\n    var i, taskInst, tasks = VariableDescriptorFacade.findByName(gm, 'tasks'), isTheEnd = true;\r\n    for (i = 0; i < tasks.items.size(); i++) {\r\n        taskInst = tasks.items.get(0).getInstance(self);\r\n        if (isTrue(taskInst.getActive()) && parseInt(taskInst.getProperty('completeness')) < 100) {\r\n            isTheEnd = false;\r\n            break;\r\n        }\r\n    }\r\n    return isTheEnd;\r\n}\r\n\r\nfunction completeRealizationPeriod() {\r\n    var i;\r\n    if (testMode) {\r\n        println('==============================');\r\n        println('==============================');\r\n    }\r\n    for (i = 0; i < steps; i++) {\r\n        calculTasksProgress(i);\r\n        if (testMode) {\r\n            println('---');\r\n        }\r\n    }\r\n    AddNewFixedCosts();\r\n    setWeekliesVariables();\r\n}\r\n\r\nfunction setWeekliesVariables() {\r\n    var i, taskInst, ev = 0, pv = 0, tasks = VariableDescriptorFacade.findByName(gm, 'tasks'),\r\n            costs = VariableDescriptorFacade.findByName(self.getGameModel(), 'costs'),\r\n            delay = VariableDescriptorFacade.findByName(self.getGameModel(), 'delay'),\r\n            quality = VariableDescriptorFacade.findByName(self.getGameModel(), 'quality');\r\n    for (i = 0; i < tasks.items.size(); i++) {\r\n        taskInst = tasks.items.get(i).getInstance(self);\r\n        if (isTrue(taskInst.getActive())) {\r\n            ev += parseInt(taskInst.getProperty('fixedCosts')) * parseInt(taskInst.getProperty('completeness')) / 100;\r\n            pv += parseInt(taskInst.getProperty('bac')) * parseInt(taskInst.getProperty('completeness')) / 100;\r\n        }\r\n    }\r\n\r\n    planedValue.setValue(pv);\r\n    earnedValue.setValue(ev);\r\n\r\n    updateGauges();\r\n\r\n    costs.getInstance(self).saveHistory();\r\n    delay.getInstance(self).saveHistory();\r\n    quality.getInstance(self).saveHistory();\r\n    planedValue.saveHistory();\r\n    earnedValue.saveHistory();\r\n    actualCost.saveHistory();\r\n}\r\n\r\nfunction updateGauges() {\r\n    var i, taskInst, tasks = VariableDescriptorFacade.findByName(gm, 'tasks'),\r\n            costs = VariableDescriptorFacade.findByName(self.getGameModel(), 'costs'),\r\n            delay = VariableDescriptorFacade.findByName(self.getGameModel(), 'delay'),\r\n            quality = VariableDescriptorFacade.findByName(self.getGameModel(), 'quality'),\r\n            management = VariableDescriptorFacade.findByName(self.getGameModel(), 'managementApproval'),\r\n            customers = VariableDescriptorFacade.findByName(self.getGameModel(), 'userApproval'),\r\n            tasksQuality = 0, nomberOfTasks = 0, nomberOfBeganTasks = 0, tasksDelay = 0,\r\n            costsJaugeValue, qualityJaugeValue, delayJaugeValue, managementJaugeValue, customerJaugeValue;\r\n    \r\n    for (i = 0; i < tasks.items.size(); i++) {\r\n        taskInst = tasks.items.get(i).getInstance(self);\r\n        if (isTrue(taskInst.getActive())) {//if task is active\r\n            tasksDelay += getCurrentTaskDelay(tasks.items.get(i));\r\n            nomberOfTasks += 1;\r\n            if (parseInt(taskInst.getProperty('completeness')) > 0) { //...and started\r\n                tasksQuality += parseInt(taskInst.getProperty('quality'));\r\n                nomberOfBeganTasks += 1;\r\n            }\r\n        }\r\n    }\r\n\r\n    //costs\r\n    if (parseInt(planedValue.value) > 0) {\r\n        costsJaugeValue = Math.round((100 /  parseInt(earnedValue.value)) *parseInt(planedValue.value));\r\n    }\r\n    costsJaugeValue = (costsJaugeValue > parseInt(costs.getMinValue())) ? costsJaugeValue : parseInt(costs.getMinValue());\r\n    costsJaugeValue = (costsJaugeValue < parseInt(costs.getMaxValue())) ? costsJaugeValue : parseInt(costs.getMaxValue());\r\n    costs.getInstance(self).setValue(costsJaugeValue);\r\n\r\n    //delay\r\n    if (nomberOfTasks > 0) {\r\n        delayJaugeValue = Math.round(tasksDelay / nomberOfTasks);\r\n    }\r\n    delayJaugeValue = (delayJaugeValue > parseInt(delay.getMinValue())) ? delayJaugeValue : parseInt(delay.getMinValue());\r\n    delayJaugeValue = (delayJaugeValue < parseInt(delay.getMaxValue())) ? delayJaugeValue : parseInt(delay.getMaxValue());\r\n    delay.getInstance(self).setValue(delayJaugeValue);\r\n\r\n    //quality\r\n    if (nomberOfBeganTasks > 0) {\r\n        qualityJaugeValue = tasksQuality / nomberOfBeganTasks + parseInt(qualityImpacts.value);\r\n    }\r\n    qualityJaugeValue = (qualityJaugeValue > parseInt(quality.getMinValue())) ? qualityJaugeValue : parseInt(quality.getMinValue());\r\n    qualityJaugeValue = (qualityJaugeValue < parseInt(quality.getMaxValue())) ? qualityJaugeValue : parseInt(quality.getMaxValue());\r\n    quality.getInstance(self).setValue(qualityJaugeValue);\r\n\r\n    //management approval\r\n    managementJaugeValue = parseInt(management.getInstance(self).getValue()) + parseInt(managementApprovalImpacts.value);\r\n    managementJaugeValue = (managementJaugeValue > parseInt(management.getMinValue())) ? managementJaugeValue : parseInt(management.getMinValue());\r\n    managementJaugeValue = (managementJaugeValue < parseInt(management.getMaxValue())) ? managementJaugeValue : parseInt(management.getMaxValue());\r\n    management.getInstance(self).setValue(managementJaugeValue);\r\n    management.getInstance(self).saveHistory();\r\n\r\n    //customer approval\r\n    customerJaugeValue = parseInt(customers.getInstance(self).getValue()) + parseInt(userApprovalImpacts.value);\r\n    customerJaugeValue = (customerJaugeValue > parseInt(customers.getMinValue())) ? customerJaugeValue : parseInt(customers.getMinValue());\r\n    customerJaugeValue = (customerJaugeValue < parseInt(customers.getMaxValue())) ? customerJaugeValue : parseInt(customers.getMaxValue());\r\n    customers.getInstance(self).setValue(customerJaugeValue);\r\n    customers.getInstance(self).saveHistory();\r\n\r\n}\r\n\r\nfunction getCurrentTaskDelay(taskDesc) {\r\n    var i, planif, pastPeriods = [], delay = 0, time = getCurrentInGameTime(),\r\n            completeness = parseInt(taskDesc.getInstance(self).getProperty('completeness')),\r\n            planif = taskDesc.getInstance(self).getPlannification(), planifArray = [];\r\n    for (i = 0; i < planif.size(); i++) {\r\n        planifArray.push(parseInt(planif.get(i)));\r\n    }\r\n    planif = planifArray;\r\n    for (i = 0; i <= time.period; i++) {\r\n        if (planif.indexOf(i) > -1) {\r\n            pastPeriods.push(i);\r\n        }\r\n    }\r\n    if (completeness > 0 && planif.length > 0) {\r\n        if (pastPeriods.length <= 0) {\r\n            delay = completeness + 100;\r\n        }\r\n        else {\r\n            delay = (100 / ((pastPeriods.length / planif.length) * 100)) * completeness;\r\n        }\r\n    }\r\n    return delay;\r\n}\r\n\r\nfunction AddNewFixedCosts() {\r\n    var i, j, listEmployees = flattenList(VariableDescriptorFacade.findByName(gm, 'employees')),\r\n            activities, pastActivities = [], currentActivities = [], time = getCurrentInGameTime(),\r\n            exist = true;\r\n    for (i = 0; i < listEmployees.length; i++) {\r\n        activities = listEmployees[i].getInstance(self).getActivities();\r\n        for (j = 0; j < activities.size(); j++) {\r\n            if (parseInt(activities.get(j).getTime()) === time.period) { //parseInt = parseFloat() + Math.floor()\r\n                currentActivities.push(activities.get(j));\r\n            } else {\r\n                pastActivities.push(activities.get(j));\r\n            }\r\n        }\r\n    }\r\n    currentActivities = getUniqueTasksInActivities(currentActivities);\r\n    pastActivities = getUniqueTasksInActivities(pastActivities);\r\n    for (i = 0; i < currentActivities.length; i++) {\r\n        exist = (pastActivities.length > 0) ? true : false;\r\n        for (j = 0; j < pastActivities.length; j++) {\r\n            if (currentActivities[i].getTaskDescriptor() === pastActivities[j].getTaskDescriptor()) {\r\n                exist = true;\r\n                break;\r\n            }\r\n        }\r\n        if (!exist) {\r\n            actualCost.setValue(parseInt(actualCost.getValue()) + parseInt(currentActivities[i].getTaskDescriptor().getInstance(self).getProperty('fixedCosts')));\r\n        }\r\n    }\r\n}\r\n\r\nfunction calculTasksProgress(currentStep) {\r\n    var i, work, activitiesAsNeeds, oneTaskPerActivity, allCurrentActivities,\r\n            taskProgress, allCurrentActivities,\r\n            requirementsByWork, taskInst;\r\n    allCurrentActivities = createActivities(currentStep);\r\n    activitiesAsNeeds = getActivitiesWithEmployeeOnDifferentNeeds(allCurrentActivities);\r\n    for (i = 0; i < activitiesAsNeeds.length; i++) { //for each need\r\n        calculateProgressOfNeed(activitiesAsNeeds[i], allCurrentActivities);\r\n    }\r\n    oneTaskPerActivity = getUniqueTasksInActivities(activitiesAsNeeds);\r\n    for (i = 0; i < oneTaskPerActivity.length; i++) {\r\n        taskProgress = 0;\r\n        taskInst = oneTaskPerActivity[i].getTaskDescriptor().getInstance(self);\r\n        requirementsByWork = getRequirementsByWork(taskInst.getRequirements());\r\n        for (work in requirementsByWork) {\r\n            taskProgress += requirementsByWork[work].completeness;\r\n        }\r\n        taskProgress = (taskProgress > 97) ? 100 : taskProgress; //>97 yes, don t frustrate the players please.\r\n        taskInst.setProperty('completeness', Math.round(taskProgress));\r\n        taskInst.setProperty('quality', calculateTaskQuality(oneTaskPerActivity[i].getTaskDescriptor()));\r\n    }\r\n    checkEnd(allCurrentActivities, currentStep);\r\n}\r\n\r\nfunction getUniqueTasksInActivities(activities) {\r\n    var i, j, oneTaskPerActivity = [], wasAdded;\r\n    if (activities.length > 0) {\r\n        oneTaskPerActivity.push(activities[0]);\r\n    }\r\n    for (i = 0; i < activities.length; i++) {\r\n        wasAdded = false;\r\n        for (j = 0; j < oneTaskPerActivity.length; j++) {\r\n            if (oneTaskPerActivity[j].getTaskDescriptor() === activities[i].getTaskDescriptor()) {\r\n                wasAdded = true;\r\n                break;\r\n            }\r\n        }\r\n        if (!wasAdded) {\r\n            oneTaskPerActivity.push(activities[i]);\r\n        }\r\n    }\r\n    return oneTaskPerActivity;\r\n}\r\n\r\nfunction getActivitiesWithEmployeeOnDifferentNeeds(activities) {\r\n    var i, j, activitiesAsNeeds = [], wasAdded;\r\n    if (activities.length > 0) {\r\n        activitiesAsNeeds.push(activities[0]);\r\n    }\r\n    for (i = 1; i < activities.length; i++) { //for each need\r\n        wasAdded = false;\r\n        if (getActivitiesWithEmployeeOnSameNeed(activities, activities[i]).length > 1) {\r\n            for (j = 1; j < activitiesAsNeeds.length; j++) {\r\n                if (activities[i] === activitiesAsNeeds[j]) {\r\n                    wasAdded = true;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        if (!wasAdded) {\r\n            activitiesAsNeeds.push(activities[i]);\r\n        }\r\n    }\r\n    return activitiesAsNeeds;\r\n}\r\n\r\nfunction getActivitiesWithEmployeeOnSameNeed(activities, activity) {\r\n    var i, employeeInst, selectedReq, sortedActivities = [], selectedReqI;\r\n    employeeInst = activity.getResourceInstance();\r\n    selectedReq = activity.getRequirement();\r\n    for (i = 0; i < activities.length; i++) {\r\n        if (parseFloat(activity.getTime()) === parseFloat(activities[i].getTime()) && activity.getTaskDescriptor() === activities[i].getTaskDescriptor()) {\r\n            selectedReqI = activities[i].getRequirement();\r\n            if (selectedReq === selectedReqI) {\r\n                sortedActivities.push(activities[i]);\r\n            }\r\n        }\r\n    }\r\n    return sortedActivities;\r\n}\r\n\r\nfunction createActivities(currentStep) {\r\n    var i, listEmployees = flattenList(VariableDescriptorFacade.findByName(gm, 'employees')),\r\n            employeeDesc, employeeInst, activity, activities = [], assignables,\r\n            existanteActivity, time = getCurrentInGameTime().period + currentStep / 10;\r\n    if (!listEmployees) {\r\n        return activities;\r\n    }\r\n    for (i = 0; i < listEmployees.length; i++) {\r\n        employeeDesc = listEmployees[i];\r\n        employeeInst = employeeDesc.getInstance(self);\r\n        if (isReservedToWork(employeeInst)) { //have a 'player created' occupation\r\n            assignables = checkAssignments(employeeInst.getAssignments(), currentStep);\r\n            if (assignables.length > 0) { //have assignable tasks\r\n                existanteActivity = findLastStepCorrespondingActivity(employeeInst, assignables[0].getTaskDescriptor(), time);\r\n                if (existanteActivity) { //set corresponding past activity if it existe. Else create it.\r\n                    activity = existanteActivity;\r\n                } else {\r\n                    activity = employeeInst.createActivity(assignables[0].getTaskDescriptor());\r\n                }\r\n                activity.setRequirement(selectRequirementFromActivity(activity));\r\n                activity.setTime(time);\r\n                activities.push(activity);\r\n            }\r\n        }\r\n    }\r\n    return activities;\r\n}\r\n\r\nfunction selectRequirementFromActivity(activity) {\r\n    var selectedReq, workAs, taskInst, reqByWorks;\r\n    taskInst = activity.getTaskDescriptor().getInstance(self);\r\n    reqByWorks = getRequirementsByWork(taskInst.getRequirements());\r\n    workAs = selectFirstUncompletedWork(taskInst.getRequirements(), reqByWorks);\r\n    selectedReq = selectRequirement(taskInst, activity.getResourceInstance(), workAs, reqByWorks);\r\n    return selectedReq;\r\n}\r\n\r\nfunction findLastStepCorrespondingActivity(employeeInst, taskDesc, currentPeriod) {\r\n    var i, activity, occurence = null;\r\n    for (i = 0; i < employeeInst.getActivities().size(); i++) {\r\n        activity = employeeInst.getActivities().get(i);\r\n        if (activity.getTaskDescriptor() === taskDesc   //if the task of activity match with the given task (same task and same employee == same activity) \r\n                && currentPeriod - Math.floor(currentPeriod) !== 0 //if it s not a new period (current step !== 0) \r\n                && parseFloat(activity.getTime()) === getFloat(currentPeriod - 0.1)) { //if activity was used the last step\r\n            occurence = activity;\r\n            break;\r\n        }\r\n    }\r\n    return occurence;\r\n}\r\n\r\nfunction haveCorrespondingActivityInPast(employeeInst, taskDesc, currentPeriod) {\r\n    var i, activity, occurence = false;\r\n    for (i = 0; i < employeeInst.getActivities().size(); i++) {\r\n        activity = employeeInst.getActivities().get(i);\r\n        if (activity.getTaskDescriptor() === taskDesc   //if the task of activity match with the given task (same task and same employee == same activity)\r\n                && currentPeriod > parseFloat(activity.getTime())) {\r\n            occurence = true;\r\n            break;\r\n        }\r\n    }\r\n    return occurence;\r\n}\r\n\r\nfunction isReservedToWork(employeeInst) {\r\n    var i, occupations = employeeInst.getOccupations(),\r\n            time = getCurrentInGameTime(), reservedToWork = false;\r\n    for (i = 0; i < occupations.size(); i++) {\r\n        if (parseInt(occupations.get(i).getTime()) === time.period && isTrue(occupations.get(i).getEditable())) {\r\n            reservedToWork = true;\r\n        }\r\n    }\r\n    return reservedToWork;\r\n}\r\n\r\nfunction getAssignables(assignments) {\r\n    var i, taskDesc, assignables = [], work;\r\n    for (i = 0; i < assignments.size(); i++) {\r\n        work = null;\r\n        taskDesc = assignments.get(i).getTaskDescriptor();\r\n        if (parseInt(taskDesc.getInstance(self).getProperty('completeness')) < 100 && getPredecessorFactor(taskDesc) >= 0.2) { //if the task isn t terminated and average of predecessors advancement is upper than 20% \r\n            assignables.push(assignments.get(i));\r\n        }\r\n    }\r\n    return assignables;\r\n}\r\n\r\nfunction checkAssignments(assignments, currentStep) {\r\n    var i, taskDesc, employeeInst, employeeName,\r\n            employeeJob, taskInst, nextTasks;\r\n    if (assignments.size() <= 0) {\r\n        return [];\r\n    }\r\n    employeeInst = assignments.get(0).getResourceInstance();\r\n    employeeName = employeeInst.getDescriptor().getLabel();\r\n    employeeJob = employeeInst.getSkillsets().keySet().toArray()[0];\r\n    nextTasks = getAssignables(employeeInst.getAssignments());\r\n    for (i = 0; i < assignments.size(); i++) {\r\n        taskDesc = assignments.get(i).getTaskDescriptor();\r\n        taskInst = taskDesc.getInstance();\r\n        if (parseFloat(taskInst.getProperty('completeness')) >= 100) {\r\n            if (nextTasks[0]) {\r\n                sendMessage(getStepName(currentStep) + ') Fin de la tâche : ' + taskDesc.getLabel(),\r\n                        'La tâche ' + taskDesc.getLabel() + ' est terminée, je passe à la tâche ' + nextTasks[0].getTaskDescriptor().getLabel() + ' <br/> Salutations <br/>' + employeeName + '<br/> ' + employeeJob,\r\n                        employeeName);\r\n            } else {\r\n                sendMessage(getStepName(currentStep) + ') Fin de la tâche : ' + taskDesc.getLabel(),\r\n                        'La tâche ' + taskDesc.getLabel() + ' est terminée, je retourne à mon activitié traditionnelle. <br/> Salutations <br/>' + employeeName + '<br/> ' + employeeJob,\r\n                        employeeName);\r\n            }\r\n            assignments.remove(i);\r\n            break;\r\n        } else if (getPredecessorFactor(taskDesc) <= 0.2) {\r\n            sendMessage(getStepName(currentStep) + ') Impossible de progresser sur la tâche : ' + taskDesc.getLabel(),\r\n                    'Je suis sensé travailler sur la tâche ' + taskDesc.getLabel() + ' mais les tâches précedentes ne sont pas assez avancées. <br/> Je retourne donc à mes occupations habituel. <br/> Salutations <br/>' + employeeName + '<br/> ' + employeeJob,\r\n                    employeeName);\r\n            assignments.remove(i);\r\n            break;\r\n        }\r\n    }\r\n    return nextTasks;\r\n}\r\n\r\nfunction getPredecessorFactor(taskDesc) {\r\n    var i, predecessorsAdvancements, predecessors, average, numberOfPredecessors;\r\n    predecessorsAdvancements = 0;\r\n    numberOfPredecessors = 0;\r\n    predecessors = taskDesc.getPredecessors();\r\n    for (i = 0; i < predecessors.size(); i++) {\r\n        if (isTrue(predecessors.get(i).getInstance(self).getActive())) {\r\n            predecessorsAdvancements += parseInt(predecessors.get(i).getInstance(self).getProperty('completeness'));\r\n            numberOfPredecessors += 1;\r\n        }\r\n    }\r\n    if (numberOfPredecessors > 0) {\r\n        average = predecessorsAdvancements / numberOfPredecessors;\r\n    } else {\r\n        average = 100;\r\n    }\r\n    return Math.pow(average / 100, parseInt(taskDesc.getInstance(self).getProperty('predecessorsDependances')));\r\n}\r\n\r\nfunction selectFirstUncompletedWork(requirements, reqByWorks) {\r\n    var work, firstUncompletedWork;\r\n    if (!reqByWorks) {\r\n        reqByWorks = getRequirementsByWork(requirements); // get requirements merged by kind of work. \r\n    }\r\n    for (work in reqByWorks) {\r\n        if (reqByWorks[work].completeness < reqByWorks[work].maxLimit) { //check if the maximum limite from all requirements of the current kind of work is smaller than the completeness of the current kind of work\r\n            firstUncompletedWork = work;\r\n            break;\r\n        }\r\n    }\r\n    return firstUncompletedWork;\r\n}\r\n\r\nfunction selectRequirement(taskInst, employeeInst, workAs, reqByWorks) {\r\n    var i, requirements = taskInst.getRequirements(), req, selectedReq = null,\r\n            totalOfPersonneInTask = 0, deltaLevel = 1000,\r\n            level = parseInt(employeeInst.getSkillsets().get(employeeInst.getSkillsets().keySet().toArray()[0]));\r\n    for (i = 0; i < requirements.size(); i++) {\r\n        totalOfPersonneInTask += parseInt(requirements.get(i).getQuantity());\r\n    }\r\n    for (i = 0; i < requirements.size(); i++) {\r\n        req = requirements.get(i);\r\n        if (req.getWork() == workAs && req.getCompleteness() < (reqByWorks[workAs].maxLimit * totalOfPersonneInTask / reqByWorks[workAs].totalOfEmployees)) {\r\n            if (Math.abs(deltaLevel) > level - parseInt(req.getLevel())) {\r\n                deltaLevel = level - parseInt(req.getLevel());\r\n                selectedReq = req;\r\n            }\r\n        }\r\n    }\r\n    return selectedReq;\r\n}\r\n\r\nfunction getRequirementsByWork(requirements) {\r\n    var i, req, works = {}, work, needsCompletion = 0, totalOfEmployees = 0;\r\n    for (i = 0; i < requirements.size(); i++) {\r\n        req = requirements.get(i);\r\n        //keep an occurance of each kind of work needed\r\n        if (works[req.getWork()]) {\r\n            work = works[req.getWork()];\r\n        } else {\r\n            work = works[req.getWork()] = {\r\n                maxLimit: 0,\r\n                typesOfLevels: [],\r\n                totalOfEmployees: 0,\r\n                completeness: 0\r\n            };\r\n        }\r\n        //keep the highest limit of all limits from each kind of work needed\r\n        if (work.maxLimit < parseInt(req.getLimit())) {\r\n            work.maxLimit = parseInt(req.getLimit());\r\n        }\r\n        //keep all kind of levels for each kind of work needed\r\n        if (work.typesOfLevels.indexOf(req.getLevel()) <= -1) {\r\n            work.typesOfLevels.push(req.getLevel());\r\n        }\r\n        //keep the summe of personns needed for each kind of work needed\r\n        totalOfEmployees += parseInt(req.getQuantity());\r\n        //is needed for next calcul\r\n        needsCompletion += (parseInt(req.getCompleteness()) * parseInt(req.getQuantity()));\r\n    }\r\n    for (work in works) {\r\n        //keep the summe of personns needed for each kind of work needed\r\n        works[work].totalOfEmployees = totalOfEmployees;\r\n        //keep the work completion for each kind of work needed\r\n        works[work].completeness = (needsCompletion / totalOfEmployees);\r\n    }\r\n    return works;\r\n}\r\n\r\nfunction calculateProgressOfNeed(activityAsNeeds, allCurrentActivities) {\r\n    var i, taskDesc, taskInst, employeeDesc, employeeInst, activityRate, sameNeedActivity,\r\n            affectedEmployeesDesc = [], requirements, stepAdvance = 1, sumActivityRate = 0,\r\n            employeesMotivationXActivityRate = 0, deltaLevel, workAs, selectedReq,\r\n            employeesMotivationFactor, employeesSkillsetXActivityRate = 0, predecessorsAdvance = 1,\r\n            employeeSkillsetFactor, activityCoefficientXActivityRate = 0, otherWorkFactor = 1,\r\n            correctedRessources, reqByWorks, numberOfEmployeeOnNeedOnNewTask = 0,\r\n            needProgress, motivationXActivityRate = 0, skillsetXActivityRate = 0, level,\r\n            averageSkillsetQuality, stepQuality;\r\n\r\n    taskDesc = activityAsNeeds.getTaskDescriptor();\r\n    taskInst = taskDesc.getInstance(self);\r\n    requirements = taskInst.getRequirements();\r\n    reqByWorks = getRequirementsByWork(requirements);\r\n    selectedReq = activityAsNeeds.getRequirement();\r\n    workAs = selectedReq.getWork();\r\n    sameNeedActivity = getActivitiesWithEmployeeOnSameNeed(allCurrentActivities, activityAsNeeds);\r\n    level = parseInt(activityAsNeeds.getResourceInstance().getSkillsets().get(activityAsNeeds.getResourceInstance().getSkillsets().keySet().toArray()[0]));\r\n    deltaLevel = parseInt(selectedReq.getLevel()) - level;\r\n\r\n    //For each need\r\n    for (i = 0; i < sameNeedActivity.length; i++) {\r\n        employeeInst = sameNeedActivity[i].getResourceInstance();\r\n        employeeDesc = employeeInst.getDescriptor();\r\n        affectedEmployeesDesc.push(employeeDesc);\r\n        activityRate = parseFloat(employeeDesc.getInstance(self).getProperty('activityRate'));\r\n        sumActivityRate += activityRate;\r\n        //Calculate ressource motivation factor\r\n        employeesMotivationFactor = 1 + 0.05 * parseFloat(employeeDesc.getProperty('coef_moral')) * (parseInt(employeeDesc.getInstance(self).getMoral()) - 7);\r\n        //Calcul variables for needMotivationFactor\r\n        employeesMotivationXActivityRate += employeesMotivationFactor * activityRate;\r\n        //Calcul variables for needSkillsetFactor\r\n        if (deltaLevel > 0) {\r\n            employeeSkillsetFactor = 1 + 0.05 * parseFloat(taskDesc.getProperty('competenceRatioSup')) * deltaLevel;\r\n            if (employeeSkillsetFactor < 0) {\r\n                employeeSkillsetFactor = 0;\r\n            }\r\n        } else {\r\n            employeeSkillsetFactor = 1 + 0.05 * parseFloat(taskDesc.getProperty('competenceRatioInf')) * deltaLevel;\r\n        }\r\n        employeesSkillsetXActivityRate += employeeSkillsetFactor * activityRate;\r\n        //Calcul variable for needSkillsetFactor\r\n        activityCoefficientXActivityRate += parseFloat(employeeDesc.getProperty('coef_activity')) * activityRate;\r\n        //Calcul variable for learnFactor\r\n        if (!haveCorrespondingActivityInPast(employeeInst, taskDesc, getCurrentInGameTime().period)) {\r\n            numberOfEmployeeOnNeedOnNewTask++;\r\n        }\r\n        //Calculate variable for quality\r\n        motivationXActivityRate += parseInt(employeeInst.getMoral()) * activityRate;\r\n        skillsetXActivityRate += parseInt(employeeInst.getSkillsets().get(employeeInst.getSkillsets().keySet().toArray()[0])) * activityRate; //level * activityRate\r\n    }\r\n\r\n    //calculate needMotivationFactor, needSkillsetFactor and activityNeedRateFactor\r\n    if (sumActivityRate !== 0) {\r\n        stepAdvance *= employeesMotivationXActivityRate / sumActivityRate; //needMotivationFactor\r\n        stepAdvance *= employeesMotivationXActivityRate / sumActivityRate; //needSkillsetFactor\r\n        stepAdvance *= activityCoefficientXActivityRate / sumActivityRate; //activityNeedRateFactor\r\n    }\r\n\r\n    // calculate baseAdvance\r\n    stepAdvance *= 1 / (steps * (parseInt(taskDesc.getInstance(self).getDuration()))); //baseAdvance\r\n\r\n    // calculate numberOfRessourcesFactor\r\n    if (reqByWorks[workAs].totalOfEmployees !== 0) {\r\n        if (affectedEmployeesDesc.length <= reqByWorks[workAs].totalOfEmployees) {\r\n            correctedRessources = reqByWorks[workAs].totalOfEmployees + parseFloat(taskDesc.getProperty('coordinationRatioInf')) * (affectedEmployeesDesc.length - reqByWorks[workAs].totalOfEmployees);\r\n            if (correctedRessources / affectedEmployeesDesc.length < 0.2) {\r\n                correctedRessources = 0.2 * affectedEmployeesDesc.length;\r\n            }\r\n        } else {\r\n            correctedRessources = reqByWorks[workAs].totalOfEmployees + parseFloat(taskDesc.getProperty('coordinationRatioSup')) * (affectedEmployeesDesc.length - reqByWorks[workAs].totalOfEmployees);\r\n        }\r\n        stepAdvance *= correctedRessources / reqByWorks[workAs].totalOfEmployees; //numberOfRessourcesFactor\r\n    }\r\n\r\n    //calculate otherWorkFactor\r\n    if (activityAsNeeds.getResourceInstance().getSkillsets().keySet().toArray()[0] != workAs) {\r\n        otherWorkFactor = 0.8;\r\n    }\r\n    stepAdvance *= otherWorkFactor;\r\n\r\n    //calculate randomFactor\r\n    stepAdvance *= getRandomFactorFromTask(taskDesc);\r\n\r\n    //calculate learnFactor\r\n    if (parseInt(taskInst.getProperty('completeness')) > 15) {\r\n        stepAdvance *= 1 - ((numberOfEmployeeOnNeedOnNewTask * (parseFloat(taskInst.getProperty('takeInHandDuration') / 100))) / affectedEmployeesDesc.length);//learnFactor \r\n    }\r\n\r\n    //calculate bonusRatio\r\n    stepAdvance *= (parseFloat(taskDesc.getProperty('bonusRatio')));\r\n\r\n    //calculate predecessorFactor\r\n    stepAdvance *= getPredecessorFactor(taskDesc); //predecessor factor\r\n\r\n    stepAdvance *= 100;\r\n\r\n    //calculate new needCompleteness\r\n    needProgress = Math.round(parseInt(selectedReq.getCompleteness()) + stepAdvance);\r\n\r\n    //calculate stepQuality\r\n    if (sumActivityRate !== 0) {\r\n        stepQuality = 1 + 0.03 * ((motivationXActivityRate / sumActivityRate) - 7); //Motivation quality\r\n        averageSkillsetQuality = (skillsetXActivityRate / sumActivityRate);\r\n        if (averageSkillsetQuality >= selectedReq.getLevel()) {\r\n            stepQuality += 1 + 0.02 * (averageSkillsetQuality - selectedReq.getLevel()); //skillset (level) quality\r\n        } else {\r\n            stepQuality += 1 + 0.03 * (averageSkillsetQuality - selectedReq.getLevel()); //skillset (level) quality\r\n        }\r\n    }\r\n    stepQuality = (stepQuality / 2) * 100; //step Quality\r\n    if (needProgress > 0) {\r\n        selectedReq.setQuality((parseInt(selectedReq.getQuality()) * parseInt(selectedReq.getCompleteness()) + stepQuality * stepAdvance) / needProgress);\r\n    }\r\n\r\n    if (testMode) {\r\n        println('sameNeedActivity.length : ' + sameNeedActivity.length);\r\n        println('employeesMotivationFactor : ' + employeesMotivationFactor);\r\n        println('employeesMotivationXActivityRate : ' + employeesMotivationXActivityRate);\r\n        println('sumActivityRate : ' + sumActivityRate);\r\n        println('deltaLevel : ' + deltaLevel);\r\n        println('employeeSkillsetFactor : ' + employeeSkillsetFactor);\r\n        println('employeesSkillsetXActivityRate : ' + employeesSkillsetXActivityRate);\r\n        println('activityCoefficientXActivityRate : ' + activityCoefficientXActivityRate);\r\n        println('numberOfEmployeeOnNeedOnNewTask : ' + numberOfEmployeeOnNeedOnNewTask);\r\n        println('motivationXActivityRate: ' + motivationXActivityRate);\r\n        println('skillsetXActivityRate: ' + skillsetXActivityRate);\r\n        println('NeedMotivationFactor : ' + employeesMotivationXActivityRate / sumActivityRate);\r\n        println('NeedSkillsetFactor : ' + employeesMotivationXActivityRate / sumActivityRate);\r\n        println('ActivityNeedRateFactor : ' + activityCoefficientXActivityRate / sumActivityRate);\r\n        println('baseAdvance : ' + 1 / (steps * (parseInt(taskDesc.getInstance(self).getDuration()))));\r\n        println('numberOfRessourcesFactor : ' + correctedRessources / reqByWorks[workAs].totalOfEmployees);\r\n        println('otherWorkFactor : ' + otherWorkFactor);\r\n        println('randomFactor (not same value as used !) : ' + getRandomFactorFromTask(taskDesc));\r\n        println('learnFactor : ' + (1 - ((numberOfEmployeeOnNeedOnNewTask * (parseFloat(taskInst.getProperty('takeInHandDuration') / 100))) / affectedEmployeesDesc.length)));\r\n        println('bonusRatio : ' + parseFloat(taskDesc.getProperty('bonusRatio')));\r\n        println('predecessorFactor : ' + Math.pow((predecessorsAdvance / taskDesc.getPredecessors().size()) / 100, parseInt(taskInst.getProperty('predecessorsDependances')))); //predecessor factor);\r\n        println('stepAdvance : ' + stepAdvance);\r\n        println('need completeness : ' + parseInt(selectedReq.getCompleteness()));\r\n        println('needProgress : ' + needProgress);\r\n        println('StepQuality : ' + ((parseInt(selectedReq.getQuality()) * parseInt(selectedReq.getCompleteness()) + stepQuality * stepAdvance) / needProgress));\r\n    }\r\n\r\n    //set need progress (after calcuateQuality) and return it\r\n    selectedReq.setCompleteness(needProgress);\r\n    return  needProgress;\r\n}\r\n\r\nfunction getRandomFactorFromTask(taskDesc) {\r\n    var rn = Math.floor(Math.random() * 100), //number 0 to 100 (0 inclusive, 100 exclusive);\r\n            randomDurationSup = parseFloat(taskDesc.getProperty('randomDurationSup')),\r\n            randomDurationInf = parseFloat(taskDesc.getProperty('randomDurationInf')),\r\n            duration = parseInt(taskDesc.getInstance(self).getDuration()), delta,\r\n            randomFactor, x = Math.random();\r\n\r\n    switch (rn) {\r\n        case (rn < 3) :\r\n            delta = -(0.25 * x + 0.75) * randomDurationInf;\r\n            break;\r\n        case (rn < 10) :\r\n            delta = -(0.25 * x + 0.50) * randomDurationInf;\r\n            break;\r\n        case (rn < 25) :\r\n            delta = -(0.25 * x + 0.25) * randomDurationInf;\r\n            break;\r\n        case (rn < 50) :\r\n            delta = -0.25 * x * randomDurationInf;\r\n            break;\r\n        case (rn < 75) :\r\n            delta = 0.25 * x * randomDurationSup;\r\n            break;\r\n        case (rn < 90) :\r\n            delta = (0.25 * x + 0.25) * randomDurationSup;\r\n            break;\r\n        case (rn < 97) :\r\n            delta = (0.25 * x + 0.50) * randomDurationSup;\r\n            break;\r\n        default :\r\n            delta = (0.25 * x + 0.75) * randomDurationSup;\r\n            break;\r\n    }\r\n\r\n    randomFactor = duration + delta;\r\n\r\n    if (randomFactor < minTaskDuration) {\r\n        randomFactor = minTaskDuration;\r\n    }\r\n\r\n    return getFloat((duration / randomFactor), 2);\r\n}\r\n\r\nfunction calculateTaskQuality(taskDesc) {\r\n    var i, req, needQualityXNeedProgress = 0, needProgress = 0;\r\n    for (i = 0; i < taskDesc.getInstance(self).getRequirements().size(); i++) {\r\n        req = taskDesc.getInstance(self).getRequirements().get(i);\r\n        needQualityXNeedProgress += (parseInt(req.getQuality()) * parseInt(req.getCompleteness()));\r\n        needProgress += parseInt(req.getCompleteness());\r\n    }\r\n    return Math.round((needQualityXNeedProgress / needProgress));\r\n}\r\n\r\n\r\nfunction tempInit() {\r\n    var occupation, listEmployees = flattenList(VariableDescriptorFacade.findByName(gm, 'employees')),\r\n            listTasks = VariableDescriptorFacade.findByName(gm, 'tasks');\r\n\r\n    occupation = listEmployees[0].getInstance(self).addOccupation();\r\n    occupation.setTime(1.0);\r\n    occupation = listEmployees[0].getInstance(self).addOccupation();\r\n    occupation.setTime(2.0);\r\n    occupation = listEmployees[1].getInstance(self).addOccupation();\r\n    occupation.setTime(1.0);\r\n    occupation = listEmployees[2].getInstance(self).addOccupation();\r\n    occupation.setTime(2.0);\r\n    occupation = listEmployees[2].getInstance(self).addOccupation();\r\n    occupation.setTime(3.0);\r\n    occupation.setEditable(false);\r\n\r\n    //listTasks.items.get(0).getPredecessors().add(listTasks.items.get(1));\r\n\r\n    listEmployees[1].getInstance(self).assign(listTasks.items.get(0));\r\n    listEmployees[0].getInstance(self).assign(listTasks.items.get(1));\r\n\r\n    return 'is initialized';\r\n}\r\n\r\nfunction getCurrentInGameTime() {\r\n    var inGameTime = {phase: null, period: null},\r\n    phases = VariableDescriptorFacade.findByName(gm, 'currentPeriod');\r\n    inGameTime.phase = parseInt(currentPhase.value);\r\n    if (phases !== null && inGameTime.phase !== null) {\r\n        inGameTime.period = parseInt(phases.items.get(inGameTime.phase).getInstance(self).value);\r\n    }\r\n    return inGameTime;\r\n}\r\n\r\nfunction isTrue(arg) {\r\n    return (arg == true || arg == 'true') ? true : false;\r\n}\r\n\r\nfunction getFloat(number, numberOfDigit) {\r\n    numberOfDigit = Math.pow(10, (numberOfDigit > 1) ? numberOfDigit : 1);\r\n    return Math.round(number * numberOfDigit) / numberOfDigit;\r\n}\r\n\r\nfunction flattenList(list, finalList) {\r\n    var i, el;\r\n    finalList = (finalList) ? finalList : [];\r\n    for (i = 0; i < list.items.size(); i++) {\r\n        el = list.items.get(i);\r\n        if (el.getClass() && el.getClass().toString() == 'class com.wegas.core.persistence.variable.ListDescriptor') {\r\n            finalList = this.flattenList(el, finalList);\r\n        } else {\r\n            finalList.push(el);\r\n        }\r\n    }\r\n    return finalList;\r\n}\r\nfunction checkEnd(allCurrentActivities, currentStep) {\r\n    var i, employeeInst, taskInst, taskDesc, employeeName, employeeJob,\r\n            nextWork, reqByWorks;\r\n    for (i = 0; i < allCurrentActivities.length; i++) {\r\n        taskDesc = allCurrentActivities[i].getTaskDescriptor();\r\n        taskInst = taskDesc.getInstance(self);\r\n        employeeInst = allCurrentActivities[i].getResourceInstance();\r\n        employeeName = employeeInst.getDescriptor().getLabel();\r\n        employeeJob = employeeInst.getSkillsets().keySet().toArray()[0];\r\n        if (currentStep === steps - 1) {\r\n            checkAssignments(employeeInst.getAssignments(), currentStep);\r\n        } else if (parseFloat(taskInst.getProperty('completeness')) < 100) {\r\n            reqByWorks = getRequirementsByWork(taskInst.getRequirements());\r\n            nextWork = selectFirstUncompletedWork(taskInst.getRequirements(), reqByWorks);\r\n            if (allCurrentActivities[i].getRequirement().getWork() != nextWork) {\r\n                sendMessage(getStepName(currentStep) + ') Tâche : ' + taskDesc.getLabel() + ' en partie terminée',\r\n                        'Nous avons terminé la partie ' + allCurrentActivities[i].getRequirement().getWork() + ' de la tâche ' + taskDesc.getLabel() + '. Je passe à ' + nextWork + '. <br/> Salutations <br/>' + employeeName + '<br/> ' + employeeJob,\r\n                        employeeName);\r\n            }\r\n        }\r\n\r\n    }\r\n}\r\n\r\nfunction getStepName(step) {\r\n    var name;\r\n    switch (step) {\r\n        case 0 :\r\n            name = 'Lundi matin';\r\n            break;\r\n        case 1 :\r\n            name = 'Lundi après-midi';\r\n            break;\r\n        case 2 :\r\n            name = 'Mardi matin';\r\n            break;\r\n        case 3 :\r\n            name = 'Mardi après-midi';\r\n            break;\r\n        case 4 :\r\n            name = 'Mercredi matin';\r\n            break;\r\n        case 5 :\r\n            name = 'Mercredi après-midi';\r\n            break;\r\n        case 6 :\r\n            name = 'Jeudi matin';\r\n            break;\r\n        case 7 :\r\n            name = 'Jeudi après-midi';\r\n            break;\r\n        case 8 :\r\n            name = 'Vendredi matin';\r\n            break;\r\n        case 9 :\r\n            name = 'Vendredi après-midi';\r\n            break;\r\n        default :\r\n            name = 'samedi matin';\r\n    }\r\n    return name;\r\n}\r\n\r\n/**\r\n * get the specified wegas bean.\r\n * @param String name, the name of the bean\r\n * @return the wanted bean or null\r\n */\r\nfunction lookupBean(name) {\r\n    var ctx = new InitialContext();\r\n    return ctx.lookup('java:module/' + name);\r\n}\r\n\r\n/**\r\n * Send a message to the current player.\r\n * @param String subject, the subject of the message.\r\n * @param String message, the content of the message.\r\n * @param String from, the sender of the message.\r\n */\r\nfunction sendMessage(subject, content, from) {\r\n    var EF = lookupBean('MessageFacade');\r\n    if (EF) {\r\n        EF.send(self, subject, content, from);\r\n    }\r\n    else {\r\n        println('Bean InGameMailFacade does not exist, unable to send in-game message: ' + subject);\r\n    }\r\n}\r\n\r\n"
        }
    }

}