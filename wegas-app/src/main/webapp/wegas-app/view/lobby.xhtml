<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets">

    <ui:composition template="/wegas-app/view/template/app-default.xhtml">

        <ui:define name="head">
            <link rel="stylesheet" type="text/css" href="#{request.contextPath}/wegas-editor/css/wegas-editor.css" />
            <style type="text/css">
                .wegas-toolbar {
                    box-shadow: none;
                    border: none;
                }
                .wegas-joingamewidget {
                    padding: 20px;
                }
                .wegas-joingamewidget button {
                    margin: 5px 0 25px 206px;
                }
                .wegas-joingamewidget .inputEx-label {
                    width: 200px;
                }
            </style>
        </ui:define>

        <ui:define name="body">
            <script type="text/javascript">
                var Y = YUI().use("wegas-app", "wegas-editor", function (Y) {
                    var cfg = {
                        layoutSrc: 'wegas-app/db/wegas-lobby-layout.json',
                        debug : true,
                        currentUser: #{requestController.getCurrentUser().toJson()},
                        dataSources: {
                            "GameModel": {
                                source: "rest/Index/GameModel",
                                initialRequest: "",
                                plugins: [{
                                        fn: "GameModelDataSourceREST"
                                    }]
                            },
                            "Game": {
                                source: "rest/GameModel/1/Game",
                                plugins: [{
                                        fn: "GameDataSourceREST"
                                    }]
                            },
                            "RegisteredGames": {
                                source: "rest/RegisteredGames",
                                initialRequest: "/#{requestController.currentUser.id}",
                                plugins: [{
                                        fn: "GameDataSourceREST"
                                    }]
                            },
                            "PublicGames": {
                                source: "rest/PublicGames",
                                plugins: [{
                                        fn: "GameDataSourceREST"
                                    }]
                            },
                            "User": {
                                source: "rest/User",
                                plugins: [{
                                        fn: "UserDataSourceREST"
                                    }]
                            }
                        }
                    };

                    Y.Wegas.persistence.Game.EDITMENU.splice(0, 0, {            // We allow the player to open its pages with the widget
                        type: "Button",
                        label: "Open in editor",
                        plugins: [{
                                fn: "OpenGameAction",
                                cfg: {
                                    editorUrl: "wegas-app/view/play.html?"
                                }
                            }]
                    });

                    Y.on('domready', function() {                               // When dom is ready,
                        var editor = new Y.Wegas.Editor(cfg);                   // Launch the editor as soon as Dom is ready
                        editor.render();
                    });
                });
            </script>
        </ui:define>
    </ui:composition>
</html>
