<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets" >

    <ui:composition template="editor.xhtml">

        <ui:define name="editorHeader">
            <link rel="stylesheet" type="text/css" href="#{request.contextPath}/wegas-editor/css/wegas-host.css" />
        </ui:define>

        <ui:define name="editorFooter">
            Y.Wegas.app.on("render", function(e) {
                var cfg = {                                                     // Add player selection tab
                        "type": "Tab",
                        "label": "Players",
                        "cssClass": "editor-players",
                        "children": [{
                                "type": "TeamTreeViewEditor",
                                "dataSource": "Game",
                                "plugins": [{
                                        "fn": "WidgetToolbar",
                                        "cfg": {
                                            "children": []
                                        }
                                    }]
                            }]
                    };
                Y.Wegas.use(cfg, function (Y) {
                    var tab = Y.Widget.getByNode("#leftTabView").add(cfg).item(0);
                    tab.set("selected", 2);
                    tab.witem(0).on("*:click", function(e) {                    // Listen to click events on the first child (treeview)
                        var entity = e.target.get("data.entity"),
                                player = (entity instanceof Y.Wegas.persistence.Team) ? entity.get("players")[0] : entity;

                        if (!player) {
                            this.showMessageBis("error", "This team is empty", 4000);
                            return;
                        }

                        Y.Wegas.app.set('currentPlayer', player.get("id"));
                    });
                });
            });
        </ui:define>
    </ui:composition>
</html>
