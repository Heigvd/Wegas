<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets">

    <ui:composition template="template/app-default.xhtml">

        <ui:define name="title">Team login for #{singleLobbyController.currentGame.name}</ui:define>

        <ui:define name="head">

        </ui:define>

        <ui:define name="body">
            <script type="text/javascript">
                YUI().use("wegas-app", "wegas-logincss", function(Y) {
                    var app = new Y.Wegas.App({
                        currentUser: #{requestController.getCurrentUser().toJson()},
                        layoutSrc: 'wegas-app/db/wegas-lobby-singlegame-layout.json',
                        dataSources: {
                            GameModel: {
                                source: "rest/Public/GameModel",
                                initialRequest: "/" +#{singleLobbyController.currentGame.gameModelId},
                                plugins: [{
                                        fn: "GameModelCache"
                                    }]
                            },
                            User: {
                                source: "rest/Extended/User",
                                plugins: [{
                                        fn: "WegasCache"
                                    }]
                            },
                            PublicGames: {
                                source: "rest/PublicGames",
                                plugins: [{
                                        fn: "GameCache"
                                    }]
                            },
                            Game: {
                                source: "rest/GameModel/1/Game",
                                plugins: [{
                                        fn: "GameCache"
                                    }]
                            }
                        }
                    });
                    app.after("render", function() {                            // If there player is registered to a game
                        Y.one(".title").setContent("Joining game: #{singleLobbyController.currentGame.name}");
                    }, this);
                    app.render();                                               // Launch app

                    Y.on("gameJoined", function(e) {                            // As soon as a game is joined
                        window.location = app.get("base") + "wegas-app/view/play.html?gameId=" + e.gameId;// open the game in a new tab
                    });
                });
            </script>
        </ui:define>
    </ui:composition>
</html>
