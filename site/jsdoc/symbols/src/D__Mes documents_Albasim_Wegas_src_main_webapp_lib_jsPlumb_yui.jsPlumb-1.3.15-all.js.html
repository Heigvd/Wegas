<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">/*
<span class='line'>  2</span>  * jsPlumb
<span class='line'>  3</span>  * 
<span class='line'>  4</span>  * Title:jsPlumb 1.3.15
<span class='line'>  5</span>  * 
<span class='line'>  6</span>  * Provides a way to visually connect elements on an HTML page, using either SVG, Canvas
<span class='line'>  7</span>  * elements, or VML.  
<span class='line'>  8</span>  * 
<span class='line'>  9</span>  * This file contains the util functions
<span class='line'> 10</span>  *
<span class='line'> 11</span>  * Copyright (c) 2010 - 2012 Simon Porritt (http://jsplumb.org)
<span class='line'> 12</span>  * 
<span class='line'> 13</span>  * http://jsplumb.org
<span class='line'> 14</span>  * http://github.com/sporritt/jsplumb
<span class='line'> 15</span>  * http://code.google.com/p/jsplumb
<span class='line'> 16</span>  * 
<span class='line'> 17</span>  * Dual licensed under the MIT and GPL2 licenses.
<span class='line'> 18</span>  */</span><span class="WHIT">
<span class='line'> 19</span> </span><span class="NAME">jsPlumbUtil</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 20</span> </span><span class="WHIT">	</span><span class="NAME">isArray</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 21</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Object.prototype.toString.call</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"[object Array]"</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'> 22</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 23</span> </span><span class="WHIT">	</span><span class="NAME">isString</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 24</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"string"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 25</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 26</span> </span><span class="WHIT">	</span><span class="NAME">isBoolean</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 27</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"boolean"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 28</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 29</span> </span><span class="WHIT">	</span><span class="NAME">isObject</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 30</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Object.prototype.toString.call</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"[object Object]"</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'> 31</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 32</span> </span><span class="WHIT">	</span><span class="NAME">isDate</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 33</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Object.prototype.toString.call</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"[object Date]"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 34</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 35</span> </span><span class="WHIT">	</span><span class="NAME">isFunction</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 36</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Object.prototype.toString.call</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"[object Function]"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 37</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 38</span> </span><span class="WHIT">	</span><span class="NAME">clone</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 39</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isString</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 40</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isBoolean</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Boolean</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 41</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isDate</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="NAME">a.getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 42</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isFunction</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 43</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isArray</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 44</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 45</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">a.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 46</span> </span><span class="WHIT">				</span><span class="NAME">b.push</span><span class="PUNC">(</span><span class="NAME">this.clone</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 47</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 48</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 49</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isObject</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 50</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 51</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 52</span> </span><span class="WHIT">				</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.clone</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 53</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'> 54</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 55</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 56</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 57</span> </span><span class="WHIT">	</span><span class="NAME">merge</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'> 58</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.clone</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'> 59</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 60</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.isString</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.isBoolean</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 61</span> </span><span class="WHIT">				</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 62</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 63</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isArray</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.isArray</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 64</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 65</span> </span><span class="WHIT">					</span><span class="NAME">ar.push.apply</span><span class="PUNC">(</span><span class="NAME">ar</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 66</span> </span><span class="WHIT">					</span><span class="NAME">ar.push.apply</span><span class="PUNC">(</span><span class="NAME">ar</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 67</span> </span><span class="WHIT">					</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ar</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 68</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 69</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.isObject</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.isObject</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">												</span><span class="WHIT">
<span class='line'> 70</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 71</span> </span><span class="WHIT">						</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 72</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 73</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 74</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 75</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 76</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 77</span> </span><span class="WHIT">	</span><span class="NAME">convertStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ignoreAlpha</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 78</span> </span><span class="WHIT">		</span><span class="COMM">// TODO: jsPlumb should support a separate 'opacity' style member.</span><span class="WHIT">
<span class='line'> 79</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"transparent"</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 80</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 81</span> </span><span class="WHIT">		    </span><span class="NAME">pad</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">n.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"0"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 82</span> </span><span class="WHIT">		    </span><span class="NAME">hex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">pad</span><span class="PUNC">(</span><span class="NAME">Number</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toString</span><span class="PUNC">(</span><span class="NUMB">16</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 83</span> </span><span class="WHIT">		    </span><span class="NAME">pattern</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="REGX">/(rgb[a]?\()(.*)(\))/</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 84</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s.match</span><span class="PUNC">(</span><span class="NAME">pattern</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 85</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s.match</span><span class="PUNC">(</span><span class="NAME">pattern</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 86</span> </span><span class="WHIT">			</span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"#"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">hex</span><span class="PUNC">(</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">hex</span><span class="PUNC">(</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">hex</span><span class="PUNC">(</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 87</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ignoreAlpha</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">parts.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'> 88</span> </span><span class="WHIT">				</span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">hex</span><span class="PUNC">(</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 89</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 90</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 91</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 92</span> </span><span class="WHIT">	</span><span class="NAME">gradient</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 93</span> </span><span class="WHIT">		</span><span class="NAME">p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.isArray</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">p1.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p1.y</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 94</span> </span><span class="WHIT">		</span><span class="NAME">p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.isArray</span><span class="PUNC">(</span><span class="NAME">p2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">p2.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2.y</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'> 95</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'> 96</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 97</span> </span><span class="WHIT">	</span><span class="NAME">normal</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 98</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.gradient</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="NAME">p2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 99</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>100</span> </span><span class="WHIT">	</span><span class="NAME">lineLength</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>101</span> </span><span class="WHIT">		</span><span class="NAME">p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.isArray</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">p1.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p1.y</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>102</span> </span><span class="WHIT">		</span><span class="NAME">p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.isArray</span><span class="PUNC">(</span><span class="NAME">p2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">p2.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2.y</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>103</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>104</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>105</span> </span><span class="WHIT">    </span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>106</span> </span><span class="WHIT">        </span><span class="NAME">p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.isArray</span><span class="PUNC">(</span><span class="NAME">p1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">p1.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p1.y</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>107</span> </span><span class="WHIT">        </span><span class="NAME">p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.isArray</span><span class="PUNC">(</span><span class="NAME">p2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">p2</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">p2.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p2.y</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>108</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>109</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>110</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>111</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>112</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">p1</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>113</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>114</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>115</span> </span><span class="WHIT">    </span><span class="NAME">intersects</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">r1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>116</span> </span><span class="WHIT">    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r1.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r1.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">r1.w</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r1.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r1.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">r1.h</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>117</span> </span><span class="WHIT">    		</span><span class="NAME">a1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r2.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r2.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">r2.w</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r2.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r2.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">r2.h</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>118</span> </span><span class="WHIT">    		</span><span class="WHIT">
<span class='line'>119</span> </span><span class="WHIT">    	</span><span class="KEYW">return</span><span class="WHIT">  </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">a1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">a1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">b1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">b1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>120</span> </span><span class="WHIT">    			</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">a2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">a2</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">b1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">b1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>121</span> </span><span class="WHIT">    			</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">a1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">a1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">b2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">b2</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>122</span> </span><span class="WHIT">    			</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">a2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">a1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">b2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">b2</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>123</span> </span><span class="WHIT">    			</span><span class="WHIT">
<span class='line'>124</span> </span><span class="WHIT">    			</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">a2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">b1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">b2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>125</span> </span><span class="WHIT">    			</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">a2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">b1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">b2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>126</span> </span><span class="WHIT">    			</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">a2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">b1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">b2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>127</span> </span><span class="WHIT">    			</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">a2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">b1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">b2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>128</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>129</span> </span><span class="WHIT">    </span><span class="NAME">segmentMultipliers</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>130</span> </span><span class="WHIT">    </span><span class="NAME">inverseSegmentMultipliers</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>131</span> </span><span class="WHIT">	</span><span class="NAME">pointOnLine</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fromPoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">toPoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">distance</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>132</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.gradient</span><span class="PUNC">(</span><span class="NAME">fromPoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">toPoint</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>133</span> </span><span class="WHIT">            </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.segment</span><span class="PUNC">(</span><span class="NAME">fromPoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">toPoint</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>134</span> </span><span class="WHIT">		    </span><span class="NAME">segmentMultiplier</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">distance</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.segmentMultipliers</span><span class="PUNC">[</span><span class="NAME">s</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.inverseSegmentMultipliers</span><span class="PUNC">[</span><span class="NAME">s</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>135</span> </span><span class="WHIT">			</span><span class="NAME">theta</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.atan</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>136</span> </span><span class="WHIT">    		</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">distance</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">theta</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">segmentMultiplier</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>137</span> </span><span class="WHIT">			</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">distance</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">theta</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">segmentMultiplier</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>138</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">fromPoint.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">fromPoint.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>139</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>140</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>141</span>      * calculates a perpendicular to the line fromPoint->toPoint, that passes through toPoint and is 'length' long.
<span class='line'>142</span>      * @param fromPoint
<span class='line'>143</span>      * @param toPoint
<span class='line'>144</span>      * @param length
<span class='line'>145</span>      */</span><span class="WHIT">
<span class='line'>146</span> </span><span class="WHIT">	</span><span class="NAME">perpendicularLineTo</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fromPoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">toPoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>147</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.gradient</span><span class="PUNC">(</span><span class="NAME">fromPoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">toPoint</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>148</span> </span><span class="WHIT">            </span><span class="NAME">theta2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.atan</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>149</span> </span><span class="WHIT">    		</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">theta2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>150</span> </span><span class="WHIT">			</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">theta2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>151</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">toPoint.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">toPoint.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">toPoint.x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">toPoint.y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>152</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>153</span> </span><span class="WHIT">	</span><span class="NAME">findWithFunction</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>154</span> </span><span class="WHIT">    	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>155</span> </span><span class="WHIT">  			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">a.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>156</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>157</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>158</span> </span><span class="WHIT">	</span><span class="NAME">indexOf</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>159</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.findWithFunction</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_v</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>160</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>161</span> </span><span class="WHIT">    </span><span class="NAME">removeWithFunction</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>162</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.findWithFunction</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>163</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">a.splice</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>164</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>165</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>166</span> </span><span class="WHIT">    </span><span class="NAME">remove</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>167</span> </span><span class="WHIT">    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.indexOf</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>168</span> </span><span class="WHIT">    	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">l.splice</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>169</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>170</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>171</span> </span><span class="WHIT">    </span><span class="COMM">// TODO support insert index</span><span class="WHIT">
<span class='line'>172</span> </span><span class="WHIT">    </span><span class="NAME">addWithFunction</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">item</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hashFunction</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>173</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jsPlumbUtil.findWithFunction</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hashFunction</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">list.push</span><span class="PUNC">(</span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>174</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>175</span> </span><span class="WHIT">	</span><span class="NAME">addToList</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>176</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">map</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>177</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>178</span> </span><span class="WHIT">			</span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">map</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>179</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>180</span> </span><span class="WHIT">		</span><span class="NAME">l.push</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>181</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>182</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>183</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>184</span> 	 * EventGenerator
<span class='line'>185</span> 	 * Superclass for objects that generate events - jsPlumb extends this, as does jsPlumbUIComponent, which all the UI elements extend.
<span class='line'>186</span> 	 */</span><span class="WHIT">
<span class='line'>187</span> </span><span class="WHIT">	</span><span class="NAME">EventGenerator</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>188</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_listeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>189</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>190</span> </span><span class="WHIT">		</span><span class="COMM">// this is a list of events that should re-throw any errors that occur during their dispatch. as of 1.3.0 this is private to</span><span class="WHIT">
<span class='line'>191</span> </span><span class="WHIT">		</span><span class="COMM">// jsPlumb, but it seems feasible that people might want to manipulate this list.  the thinking is that we don't want event</span><span class="WHIT">
<span class='line'>192</span> </span><span class="WHIT">		</span><span class="COMM">// listeners to bring down jsPlumb - or do we.  i can't make up my mind about this, but i know i want to hear about it if the "ready"</span><span class="WHIT">
<span class='line'>193</span> </span><span class="WHIT">		</span><span class="COMM">// event fails, because then my page has most likely not initialised.  so i have this halfway-house solution.  it will be interesting</span><span class="WHIT">
<span class='line'>194</span> </span><span class="WHIT">		</span><span class="COMM">// to hear what other people think.</span><span class="WHIT">
<span class='line'>195</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">eventsToDieOn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="STRN">"ready"</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>196</span> </span><span class="WHIT">							    </span><span class="WHIT">
<span class='line'>197</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>198</span> 		 * Binds a listener to an event.  
<span class='line'>199</span> 		 * 
<span class='line'>200</span> 		 * Parameters:
<span class='line'>201</span> 		 * 	event		-	name of the event to bind to.
<span class='line'>202</span> 		 * 	listener	-	function to execute.
<span class='line'>203</span> 		 */</span><span class="WHIT">
<span class='line'>204</span> </span><span class="WHIT">		</span><span class="NAME">this.bind</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>205</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumbUtil.addToList</span><span class="PUNC">(</span><span class="NAME">_listeners</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>206</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>207</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>208</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>209</span> 		 * Fires an update for the given event.
<span class='line'>210</span> 		 * 
<span class='line'>211</span> 		 * Parameters:
<span class='line'>212</span> 		 * 	event				-	event to fire
<span class='line'>213</span> 		 * 	value				-	value to pass to the event listener(s).
<span class='line'>214</span> 		 *  originalEvent	 	- 	the original event from the browser
<span class='line'>215</span> 		 */</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>216</span> </span><span class="WHIT">		</span><span class="NAME">this.fire</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>217</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_listeners</span><span class="PUNC">[</span><span class="NAME">event</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>218</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">_listeners</span><span class="PUNC">[</span><span class="NAME">event</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>219</span> </span><span class="WHIT">					</span><span class="COMM">// doing it this way rather than catching and then possibly re-throwing means that an error propagated by this</span><span class="WHIT">
<span class='line'>220</span> </span><span class="WHIT">					</span><span class="COMM">// method will have the whole call stack available in the debugger.</span><span class="WHIT">
<span class='line'>221</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jsPlumbUtil.findWithFunction</span><span class="PUNC">(</span><span class="NAME">eventsToDieOn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">event</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>222</span> </span><span class="WHIT">						</span><span class="NAME">_listeners</span><span class="PUNC">[</span><span class="NAME">event</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>223</span> </span><span class="WHIT">					</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>224</span> </span><span class="WHIT">						</span><span class="COMM">// for events we don't want to die on, catch and log.</span><span class="WHIT">
<span class='line'>225</span> </span><span class="WHIT">						</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>226</span> </span><span class="WHIT">							</span><span class="NAME">_listeners</span><span class="PUNC">[</span><span class="NAME">event</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>227</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>228</span> </span><span class="WHIT">							</span><span class="NAME">jsPlumbUtil.log</span><span class="PUNC">(</span><span class="STRN">"jsPlumb: fire failed for event "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">event</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" : "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>229</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>230</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>231</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>232</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>233</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>234</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>235</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>236</span> 		 * Clears either all listeners, or listeners for some specific event.
<span class='line'>237</span> 		 * 
<span class='line'>238</span> 		 * Parameters:
<span class='line'>239</span> 		 * 	event	-	optional. constrains the clear to just listeners for this event.
<span class='line'>240</span> 		 */</span><span class="WHIT">
<span class='line'>241</span> </span><span class="WHIT">		</span><span class="NAME">this.unbind</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>242</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>243</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_listeners</span><span class="PUNC">[</span><span class="NAME">event</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>244</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>245</span> </span><span class="WHIT">				</span><span class="NAME">_listeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>246</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>247</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>248</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>249</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>250</span> </span><span class="WHIT">		</span><span class="NAME">this.getListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">forEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>251</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_listeners</span><span class="PUNC">[</span><span class="NAME">forEvent</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>252</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>253</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>254</span> </span><span class="WHIT">	</span><span class="NAME">logEnabled</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>255</span> </span><span class="WHIT">	</span><span class="NAME">log</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>256</span> </span><span class="WHIT">	    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jsPlumbUtil.logEnabled</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">console</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>257</span> </span><span class="WHIT">            </span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>258</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">msg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>259</span> </span><span class="WHIT">			    </span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="NAME">msg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>260</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>261</span> </span><span class="WHIT">            </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>262</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>263</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>264</span> </span><span class="WHIT">	</span><span class="NAME">group</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jsPlumbUtil.logEnabled</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">console</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">console.group</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>265</span> </span><span class="WHIT">	</span><span class="NAME">groupEnd</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jsPlumbUtil.logEnabled</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">console</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">console.groupEnd</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>266</span> </span><span class="WHIT">	</span><span class="NAME">time</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jsPlumbUtil.logEnabled</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">console</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">console.time</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>267</span> </span><span class="WHIT">	</span><span class="NAME">timeEnd</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jsPlumbUtil.logEnabled</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">console</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">console.timeEnd</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>268</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="COMM">/*
<span class='line'>269</span>  * jsPlumb
<span class='line'>270</span>  * 
<span class='line'>271</span>  * Title:jsPlumb 1.3.15
<span class='line'>272</span>  * 
<span class='line'>273</span>  * Provides a way to visually connect elements on an HTML page, using either SVG, Canvas
<span class='line'>274</span>  * elements, or VML.  
<span class='line'>275</span>  * 
<span class='line'>276</span>  * This file contains the base functionality for DOM type adapters. 
<span class='line'>277</span>  *
<span class='line'>278</span>  * Copyright (c) 2010 - 2012 Simon Porritt (http://jsplumb.org)
<span class='line'>279</span>  * 
<span class='line'>280</span>  * http://jsplumb.org
<span class='line'>281</span>  * http://github.com/sporritt/jsplumb
<span class='line'>282</span>  * http://code.google.com/p/jsplumb
<span class='line'>283</span>  * 
<span class='line'>284</span>  * Dual licensed under the MIT and GPL2 licenses.
<span class='line'>285</span>  */</span><span class="WHIT">
<span class='line'>286</span> </span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>287</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>288</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">canvasAvailable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'canvas'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getContext</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>289</span> </span><span class="WHIT">		</span><span class="NAME">svgAvailable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">window.SVGAngle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">document.implementation.hasFeature</span><span class="PUNC">(</span><span class="STRN">"http://www.w3.org/TR/SVG11/feature#BasicStructure"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"1.1"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>290</span> </span><span class="WHIT">		</span><span class="COMM">// http://stackoverflow.com/questions/654112/how-do-you-detect-support-for-vml-or-svg-in-a-browser</span><span class="WHIT">
<span class='line'>291</span> </span><span class="WHIT">		</span><span class="NAME">vmlAvailable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">		    </span><span class="WHIT">
<span class='line'>292</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vmlAvailable.vml</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>293</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.body.appendChild</span><span class="PUNC">(</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'div'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>294</span> </span><span class="WHIT">		        </span><span class="NAME">a.innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'&lt;v:shape id="vml_flag1" adj="1" />'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>295</span> </span><span class="WHIT">		        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">a.firstChild</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>296</span> </span><span class="WHIT">		        </span><span class="NAME">b.style.behavior</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"url(#default#VML)"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>297</span> </span><span class="WHIT">		        </span><span class="NAME">vmlAvailable.vml</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">b.adj</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"object"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>298</span> </span><span class="WHIT">		        </span><span class="NAME">a.parentNode.removeChild</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>299</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>300</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vmlAvailable.vml</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>301</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>302</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>303</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>304</span> 		Manages dragging for some instance of jsPlumb.
<span class='line'>305</span> 	*/</span><span class="WHIT">
<span class='line'>306</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">DragManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_currentInstance</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>307</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_draggables</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_dlist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_delements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_elementsWithEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>308</span> 
<span class='line'>309</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>310</span>             register some element as draggable.  right now the drag init stuff is done elsewhere, and it is
<span class='line'>311</span>             possible that will continue to be the case.
<span class='line'>312</span>         */</span><span class="WHIT">
<span class='line'>313</span> </span><span class="WHIT">		</span><span class="NAME">this.register</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>314</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jpcl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>315</span> </span><span class="WHIT">            </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>316</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>317</span> </span><span class="WHIT">                </span><span class="NAME">domEl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getDOMElement</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>318</span> </span><span class="WHIT">                </span><span class="NAME">parentOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getOffset</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>319</span> </span><span class="WHIT">                    </span><span class="WHIT">
<span class='line'>320</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_draggables</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>321</span> </span><span class="WHIT">                </span><span class="NAME">_draggables</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>322</span> </span><span class="WHIT">                </span><span class="NAME">_dlist.push</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>323</span> </span><span class="WHIT">                </span><span class="NAME">_delements</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>324</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>325</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>326</span> </span><span class="WHIT">			</span><span class="COMM">// look for child elements that have endpoints and register them against this draggable.</span><span class="WHIT">
<span class='line'>327</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_oneLevel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startOffset</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>328</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">											</span><span class="WHIT">
<span class='line'>329</span> </span><span class="WHIT">                    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">p.childNodes.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>330</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p.childNodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nodeType</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>331</span> </span><span class="WHIT">                            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cEl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getElementObject</span><span class="PUNC">(</span><span class="NAME">p.childNodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>332</span> </span><span class="WHIT">                                </span><span class="NAME">cid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getId</span><span class="PUNC">(</span><span class="NAME">cEl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>333</span> </span><span class="WHIT">                            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cid</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_elementsWithEndpoints</span><span class="PUNC">[</span><span class="NAME">cid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_elementsWithEndpoints</span><span class="PUNC">[</span><span class="NAME">cid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>334</span> </span><span class="WHIT">                                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cOff</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getOffset</span><span class="PUNC">(</span><span class="NAME">cEl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>335</span> </span><span class="WHIT">                                </span><span class="NAME">_delements</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">cid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>336</span> </span><span class="WHIT">                                    </span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">cid</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>337</span> </span><span class="WHIT">                                    </span><span class="NAME">offset</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>338</span> </span><span class="WHIT">                                        </span><span class="NAME">left</span><span class="PUNC">:</span><span class="NAME">cOff.left</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">parentOffset.left</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>339</span> </span><span class="WHIT">                                        </span><span class="NAME">top</span><span class="PUNC">:</span><span class="NAME">cOff.top</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">parentOffset.top</span><span class="WHIT">
<span class='line'>340</span> </span><span class="WHIT">                                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>341</span> </span><span class="WHIT">                                </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>342</span> </span><span class="WHIT">                            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>343</span> </span><span class="WHIT">                            </span><span class="NAME">_oneLevel</span><span class="PUNC">(</span><span class="NAME">p.childNodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>344</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>345</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>346</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>347</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>348</span> 
<span class='line'>349</span> </span><span class="WHIT">			</span><span class="NAME">_oneLevel</span><span class="PUNC">(</span><span class="NAME">domEl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>350</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>351</span> 
<span class='line'>352</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>353</span> 			notification that an endpoint was added to the given el.  we go up from that el's parent
<span class='line'>354</span> 			node, looking for a parent that has been registered as a draggable. if we find one, we add this
<span class='line'>355</span> 			el to that parent's list of elements to update on drag (if it is not there already)
<span class='line'>356</span> 		*/</span><span class="WHIT">
<span class='line'>357</span> </span><span class="WHIT">		</span><span class="NAME">this.endpointAdded</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>358</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jpcl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.body</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getDOMElement</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>359</span> </span><span class="WHIT">				</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c.parentNode</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">done</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>360</span> 
<span class='line'>361</span> </span><span class="WHIT">			</span><span class="NAME">_elementsWithEndpoints</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_elementsWithEndpoints</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_elementsWithEndpoints</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>362</span> 
<span class='line'>363</span> </span><span class="WHIT">			</span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>364</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getId</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>365</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">pid</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_draggables</span><span class="PUNC">[</span><span class="NAME">pid</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>366</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pEl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getElementObject</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pLoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getOffset</span><span class="PUNC">(</span><span class="NAME">pEl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>367</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>368</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_delements</span><span class="PUNC">[</span><span class="NAME">pid</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>369</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cLoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getOffset</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>370</span> </span><span class="WHIT">						</span><span class="NAME">_delements</span><span class="PUNC">[</span><span class="NAME">pid</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>371</span> </span><span class="WHIT">							</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>372</span> </span><span class="WHIT">							</span><span class="NAME">offset</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>373</span> </span><span class="WHIT">								</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NAME">cLoc.left</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">pLoc.left</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>374</span> </span><span class="WHIT">								</span><span class="NAME">top</span><span class="PUNC">:</span><span class="NAME">cLoc.top</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">pLoc.top</span><span class="WHIT">
<span class='line'>375</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>376</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>377</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>378</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>379</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>380</span> </span><span class="WHIT">				</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.parentNode</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>381</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>382</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>383</span> 
<span class='line'>384</span> </span><span class="WHIT">		</span><span class="NAME">this.endpointDeleted</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>385</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_elementsWithEndpoints</span><span class="PUNC">[</span><span class="NAME">endpoint.elementId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>386</span> </span><span class="WHIT">				</span><span class="NAME">_elementsWithEndpoints</span><span class="PUNC">[</span><span class="NAME">endpoint.elementId</span><span class="PUNC">]</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>387</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_elementsWithEndpoints</span><span class="PUNC">[</span><span class="NAME">endpoint.elementId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>388</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">_delements</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>389</span> </span><span class="WHIT">						</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_delements</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">endpoint.elementId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>390</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>391</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>392</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>393</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>394</span> 
<span class='line'>395</span> </span><span class="WHIT">		</span><span class="NAME">this.getElementsForDraggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>396</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_delements</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>397</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>398</span> 
<span class='line'>399</span> </span><span class="WHIT">		</span><span class="NAME">this.reset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>400</span> </span><span class="WHIT">			</span><span class="NAME">_draggables</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>401</span> </span><span class="WHIT">			</span><span class="NAME">_dlist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>402</span> </span><span class="WHIT">			</span><span class="NAME">_delements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>403</span> </span><span class="WHIT">			</span><span class="NAME">_elementsWithEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>404</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>405</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>406</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>407</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>408</span> </span><span class="WHIT">    </span><span class="COMM">// for those browsers that dont have it.  they still don't have it! but at least they won't crash.</span><span class="WHIT">
<span class='line'>409</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">window.console</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>410</span> </span><span class="WHIT">		</span><span class="NAME">window.console</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">time</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timeEnd</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">group</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">groupEnd</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">log</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>411</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>412</span> </span><span class="WHIT">    </span><span class="NAME">window.jsPlumbAdapter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>413</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>414</span> </span><span class="WHIT">        </span><span class="NAME">headless</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>415</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>416</span> </span><span class="WHIT">        </span><span class="NAME">appendToRoot</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>417</span> </span><span class="WHIT">            </span><span class="NAME">document.body.appendChild</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>418</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>419</span> </span><span class="WHIT">        </span><span class="NAME">getRenderModes</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>420</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="STRN">"canvas"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"svg"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"vml"</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>421</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>422</span> </span><span class="WHIT">        </span><span class="NAME">isRenderModeAvailable</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>423</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>424</span> </span><span class="WHIT">                </span><span class="STRN">"canvas"</span><span class="PUNC">:</span><span class="NAME">canvasAvailable</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>425</span> </span><span class="WHIT">                </span><span class="STRN">"svg"</span><span class="PUNC">:</span><span class="NAME">svgAvailable</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>426</span> </span><span class="WHIT">                </span><span class="STRN">"vml"</span><span class="PUNC">:</span><span class="NAME">vmlAvailable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>427</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">[</span><span class="NAME">m</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>428</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>429</span> </span><span class="WHIT">        </span><span class="NAME">getDragManager</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_jsPlumb</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>430</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DragManager</span><span class="PUNC">(</span><span class="NAME">_jsPlumb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>431</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>432</span> </span><span class="WHIT">        </span><span class="NAME">setRenderMode</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">mode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>433</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">renderMode</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>434</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>435</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>436</span> </span><span class="WHIT">				</span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mode.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>437</span> </span><span class="WHIT">			            </span><span class="WHIT">
<span class='line'>438</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">canvasAvailable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.isRenderModeAvailable</span><span class="PUNC">(</span><span class="STRN">"canvas"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>439</span> </span><span class="WHIT">                    </span><span class="NAME">svgAvailable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.isRenderModeAvailable</span><span class="PUNC">(</span><span class="STRN">"svg"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>440</span> </span><span class="WHIT">                    </span><span class="NAME">vmlAvailable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.isRenderModeAvailable</span><span class="PUNC">(</span><span class="STRN">"vml"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>441</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>442</span> </span><span class="WHIT">                </span><span class="COMM">//if (mode !== jsPlumb.CANVAS && mode !== jsPlumb.SVG && mode !== jsPlumb.VML) throw new Error("render mode must be one of jsPlumb.CANVAS, jsPlumb.SVG or jsPlumb.VML");</span><span class="WHIT">
<span class='line'>443</span> </span><span class="WHIT">                </span><span class="COMM">// now test we actually have the capability to do this.						</span><span class="WHIT">
<span class='line'>444</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"svg"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>445</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">svgAvailable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">renderMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"svg"</span><span class="WHIT">
<span class='line'>446</span> </span><span class="WHIT">                    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">canvasAvailable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">renderMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"canvas"</span><span class="WHIT">
<span class='line'>447</span> </span><span class="WHIT">                    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vmlAvailable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">renderMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"vml"</span><span class="WHIT">
<span class='line'>448</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>449</span> </span><span class="WHIT">                </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"canvas"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">canvasAvailable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">renderMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"canvas"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>450</span> </span><span class="WHIT">                </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vmlAvailable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">renderMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"vml"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>451</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>452</span> 
<span class='line'>453</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">renderMode</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>454</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>455</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>456</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>457</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">/*
<span class='line'>458</span>  * jsPlumb
<span class='line'>459</span>  * 
<span class='line'>460</span>  * Title:jsPlumb 1.3.15
<span class='line'>461</span>  * 
<span class='line'>462</span>  * Provides a way to visually connect elements on an HTML page, using either SVG, Canvas
<span class='line'>463</span>  * elements, or VML.  
<span class='line'>464</span>  * 
<span class='line'>465</span>  * This file contains the jsPlumb core code.
<span class='line'>466</span>  *
<span class='line'>467</span>  * Copyright (c) 2010 - 2012 Simon Porritt (simon.porritt@gmail.com)
<span class='line'>468</span>  * 
<span class='line'>469</span>  * http://jsplumb.org
<span class='line'>470</span>  * http://github.com/sporritt/jsplumb
<span class='line'>471</span>  * http://code.google.com/p/jsplumb
<span class='line'>472</span>  * 
<span class='line'>473</span>  * Dual licensed under the MIT and GPL2 licenses.
<span class='line'>474</span>  */</span><span class="WHIT">
<span class='line'>475</span> 
<span class='line'>476</span> </span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>477</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>478</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>479</span> 	 * Class:jsPlumb
<span class='line'>480</span> 	 * The jsPlumb engine, registered as a static object in the window.  This object contains all of the methods you will use to
<span class='line'>481</span> 	 * create and maintain Connections and Endpoints.
<span class='line'>482</span> 	 */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>483</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>484</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_findWithFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.findWithFunction</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>485</span> </span><span class="WHIT">	</span><span class="NAME">_indexOf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.indexOf</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>486</span> </span><span class="WHIT">    </span><span class="NAME">_removeWithFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.removeWithFunction</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>487</span> </span><span class="WHIT">    </span><span class="NAME">_remove</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.remove</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>488</span> </span><span class="WHIT">    </span><span class="COMM">// TODO support insert index</span><span class="WHIT">
<span class='line'>489</span> </span><span class="WHIT">    </span><span class="NAME">_addWithFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.addWithFunction</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>490</span> </span><span class="WHIT">    </span><span class="NAME">_addToList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.addToList</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>491</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>492</span> 		an isArray function that even works across iframes...see here:
<span class='line'>493</span> 		
<span class='line'>494</span> 		http://tobyho.com/2011/01/28/checking-types-in-javascript/
<span class='line'>495</span> 
<span class='line'>496</span> 		i was originally using "a.constructor == Array" as a test.
<span class='line'>497</span> 	*/</span><span class="WHIT">
<span class='line'>498</span> </span><span class="WHIT">	</span><span class="NAME">_isArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.isArray</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>499</span> </span><span class="WHIT">	</span><span class="NAME">_isString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.isString</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>500</span> </span><span class="WHIT">	</span><span class="NAME">_isObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.isObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>501</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>502</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_connectionBeingDragged</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>503</span> </span><span class="WHIT">		</span><span class="NAME">_getAttribute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getAttribute</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>504</span> </span><span class="WHIT">		</span><span class="NAME">_setAttribute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attValue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.setAttribute</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attValue</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>505</span> </span><span class="WHIT">		</span><span class="NAME">_addClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.addClass</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>506</span> </span><span class="WHIT">		</span><span class="NAME">_hasClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.hasClass</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>507</span> </span><span class="WHIT">		</span><span class="NAME">_removeClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.removeClass</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>508</span> </span><span class="WHIT">		</span><span class="NAME">_getElementObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>509</span> </span><span class="WHIT">		</span><span class="NAME">_getOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_instance</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>510</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getOffset</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>511</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_instance</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>512</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">z</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_instance.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>513</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NAME">o.left</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">z</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">:</span><span class="NAME">o.top</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">z</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>514</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>515</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>516</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>517</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>518</span> </span><span class="WHIT">		</span><span class="NAME">_getSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>519</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getSize</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>520</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>521</span> </span><span class="WHIT">		</span><span class="NAME">_log</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.log</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>522</span> </span><span class="WHIT">		</span><span class="NAME">_group</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.group</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>523</span> </span><span class="WHIT">		</span><span class="NAME">_groupEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.groupEnd</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>524</span> </span><span class="WHIT">		</span><span class="NAME">_time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.time</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>525</span> </span><span class="WHIT">		</span><span class="NAME">_timeEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.timeEnd</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>526</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>527</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>528</span> 		 * creates a timestamp, using milliseconds since 1970, but as a string.
<span class='line'>529</span> 		 */</span><span class="WHIT">
<span class='line'>530</span> </span><span class="WHIT">		</span><span class="NAME">_timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>531</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>532</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>533</span> 		 * Class:jsPlumbUIComponent
<span class='line'>534</span> 		 * Abstract superclass for UI components Endpoint and Connection.  Provides the abstraction of paintStyle/hoverPaintStyle,
<span class='line'>535</span> 		 * and also extends jsPlumbUtil.EventGenerator to provide the bind and fire methods.
<span class='line'>536</span> 		 */</span><span class="WHIT">
<span class='line'>537</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumbUIComponent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>538</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>539</span> </span><span class="WHIT">				</span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>540</span> </span><span class="WHIT">				</span><span class="NAME">_hover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>541</span> </span><span class="WHIT">				</span><span class="NAME">parameters</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.parameters</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>542</span> </span><span class="WHIT">				</span><span class="NAME">idPrefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.idPrefix</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>543</span> </span><span class="WHIT">				</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">idPrefix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>544</span> </span><span class="WHIT">				</span><span class="NAME">paintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>545</span> </span><span class="WHIT">				</span><span class="NAME">hoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>546</span> 
<span class='line'>547</span> </span><span class="WHIT">			</span><span class="NAME">self._jsPlumb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"_jsPlumb"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>548</span> </span><span class="WHIT">			</span><span class="NAME">self.getId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>549</span> </span><span class="WHIT">			</span><span class="NAME">self.tooltip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.tooltip</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>550</span> </span><span class="WHIT">			</span><span class="NAME">self.hoverClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.hoverClass</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb.Defaults.HoverClass</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.HoverClass</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>551</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>552</span> </span><span class="WHIT">			</span><span class="COMM">// all components can generate events</span><span class="WHIT">
<span class='line'>553</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumbUtil.EventGenerator.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>554</span> </span><span class="WHIT">			</span><span class="COMM">// all components get this clone function.</span><span class="WHIT">
<span class='line'>555</span> </span><span class="WHIT">			</span><span class="COMM">// TODO issue 116 showed a problem with this - it seems 'a' that is in</span><span class="WHIT">
<span class='line'>556</span> </span><span class="WHIT">			</span><span class="COMM">// the clone function's scope is shared by all invocations of it, the classic</span><span class="WHIT">
<span class='line'>557</span> </span><span class="WHIT">			</span><span class="COMM">// JS closure problem.  for now, jsPlumb does a version of this inline where </span><span class="WHIT">
<span class='line'>558</span> </span><span class="WHIT">			</span><span class="COMM">// it used to call clone.  but it would be nice to find some time to look</span><span class="WHIT">
<span class='line'>559</span> </span><span class="WHIT">			</span><span class="COMM">// further at this.</span><span class="WHIT">
<span class='line'>560</span> </span><span class="WHIT">			</span><span class="NAME">this.clone</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>561</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>562</span> </span><span class="WHIT">				</span><span class="NAME">self.constructor.apply</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>563</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>564</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>565</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>566</span> </span><span class="WHIT">			</span><span class="NAME">this.getParameter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">parameters</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>567</span> </span><span class="WHIT">			</span><span class="NAME">this.getParameters</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>568</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">parameters</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>569</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>570</span> </span><span class="WHIT">			</span><span class="NAME">this.setParameter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">parameters</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>571</span> </span><span class="WHIT">			</span><span class="NAME">this.setParameters</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">parameters</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>572</span> </span><span class="WHIT">			</span><span class="NAME">this.overlayPlacements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>573</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>574</span> </span><span class="WHIT">			</span><span class="COMM">// user can supply a beforeDetach callback, which will be executed before a detach</span><span class="WHIT">
<span class='line'>575</span> </span><span class="WHIT">			</span><span class="COMM">// is performed; returning false prevents the detach.</span><span class="WHIT">
<span class='line'>576</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">beforeDetach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.beforeDetach</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>577</span> </span><span class="WHIT">			</span><span class="NAME">this.isDetachAllowed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>578</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb.checkCondition</span><span class="PUNC">(</span><span class="STRN">"beforeDetach"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connection</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>579</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">beforeDetach</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>580</span> </span><span class="WHIT">					</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>581</span> </span><span class="WHIT">						</span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">beforeDetach</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>582</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>583</span> </span><span class="WHIT">					</span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">"jsPlumb: beforeDetach callback failed"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>584</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>585</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>586</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>587</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>588</span> </span><span class="WHIT">			</span><span class="COMM">// user can supply a beforeDrop callback, which will be executed before a dropped</span><span class="WHIT">
<span class='line'>589</span> </span><span class="WHIT">			</span><span class="COMM">// connection is confirmed. user can return false to reject connection.</span><span class="WHIT">
<span class='line'>590</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">beforeDrop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.beforeDrop</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>591</span> </span><span class="WHIT">			</span><span class="NAME">this.isDropAllowed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connection</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>592</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb.checkCondition</span><span class="PUNC">(</span><span class="STRN">"beforeDrop"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>593</span> </span><span class="WHIT">					</span><span class="NAME">sourceId</span><span class="PUNC">:</span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>594</span> </span><span class="WHIT">					</span><span class="NAME">targetId</span><span class="PUNC">:</span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>595</span> </span><span class="WHIT">					</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="NAME">scope</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>596</span> </span><span class="WHIT">					</span><span class="NAME">connection</span><span class="PUNC">:</span><span class="NAME">connection</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>597</span> </span><span class="WHIT">					</span><span class="NAME">dropEndpoint</span><span class="PUNC">:</span><span class="NAME">dropEndpoint</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>598</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>599</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">beforeDrop</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>600</span> </span><span class="WHIT">					</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>601</span> </span><span class="WHIT">						</span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">beforeDrop</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>602</span> </span><span class="WHIT">							</span><span class="NAME">sourceId</span><span class="PUNC">:</span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>603</span> </span><span class="WHIT">							</span><span class="NAME">targetId</span><span class="PUNC">:</span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>604</span> </span><span class="WHIT">							</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="NAME">scope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>605</span> </span><span class="WHIT">							</span><span class="NAME">connection</span><span class="PUNC">:</span><span class="NAME">connection</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>606</span> </span><span class="WHIT">							</span><span class="NAME">dropEndpoint</span><span class="PUNC">:</span><span class="NAME">dropEndpoint</span><span class="WHIT">
<span class='line'>607</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>608</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>609</span> </span><span class="WHIT">					</span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">"jsPlumb: beforeDrop callback failed"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>610</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>611</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>612</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>613</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>614</span> </span><span class="WHIT">			</span><span class="COMM">// helper method to update the hover style whenever it, or paintStyle, changes.</span><span class="WHIT">
<span class='line'>615</span> </span><span class="WHIT">			</span><span class="COMM">// we use paintStyle as the foundation and merge hoverPaintStyle over the</span><span class="WHIT">
<span class='line'>616</span> </span><span class="WHIT">			</span><span class="COMM">// top.</span><span class="WHIT">
<span class='line'>617</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_updateHoverStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>618</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">paintStyle</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">hoverPaintStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>619</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mergedHoverStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>620</span> </span><span class="WHIT">					</span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">mergedHoverStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">paintStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>621</span> </span><span class="WHIT">					</span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">mergedHoverStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hoverPaintStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>622</span> </span><span class="WHIT">					</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">[</span><span class="STRN">"hoverPaintStyle"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>623</span> </span><span class="WHIT">					</span><span class="COMM">// we want the fillStyle of paintStyle to override a gradient, if possible.</span><span class="WHIT">
<span class='line'>624</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mergedHoverStyle.gradient</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">paintStyle.fillStyle</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>625</span> </span><span class="WHIT">						</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">mergedHoverStyle</span><span class="PUNC">[</span><span class="STRN">"gradient"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>626</span> </span><span class="WHIT">					</span><span class="NAME">hoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mergedHoverStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>627</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>628</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>629</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>630</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>631</span> 		     * Sets the paint style and then repaints the element.
<span class='line'>632</span> 		     * 
<span class='line'>633</span> 		     * Parameters:
<span class='line'>634</span> 		     * 	style - Style to use.
<span class='line'>635</span> 		     */</span><span class="WHIT">
<span class='line'>636</span> </span><span class="WHIT">		    </span><span class="NAME">this.setPaintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>637</span> </span><span class="WHIT">		    	</span><span class="NAME">paintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>638</span> </span><span class="WHIT">		    	</span><span class="NAME">self.paintStyleInUse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">paintStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>639</span> </span><span class="WHIT">		    	</span><span class="NAME">_updateHoverStyle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>640</span> </span><span class="WHIT">		    	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>641</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>642</span> 
<span class='line'>643</span> </span><span class="WHIT">		    </span><span class="COMM">/**
<span class='line'>644</span> 		    * Gets the component's paint style.
<span class='line'>645</span> 		    *
<span class='line'>646</span> 		    * Returns:
<span class='line'>647</span> 		    * the component's paint style. if there is no hoverPaintStyle set then this will be the paint style used all the time, otherwise this is the style used when the mouse is not hovering.
<span class='line'>648</span> 		    */</span><span class="WHIT">
<span class='line'>649</span> </span><span class="WHIT">		    </span><span class="NAME">this.getPaintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>650</span> </span><span class="WHIT">		    	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">paintStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>651</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>652</span> </span><span class="WHIT">		    </span><span class="WHIT">
<span class='line'>653</span> </span><span class="WHIT">		    </span><span class="COMM">/*
<span class='line'>654</span> 		     * Sets the paint style to use when the mouse is hovering over the element. This is null by default.
<span class='line'>655</span> 		     * The hover paint style is applied as extensions to the paintStyle; it does not entirely replace
<span class='line'>656</span> 		     * it.  This is because people will most likely want to change just one thing when hovering, say the
<span class='line'>657</span> 		     * color for example, but leave the rest of the appearance the same.
<span class='line'>658</span> 		     * 
<span class='line'>659</span> 		     * Parameters:
<span class='line'>660</span> 		     * 	style - Style to use when the mouse is hovering.
<span class='line'>661</span> 		     *  doNotRepaint - if true, the component will not be repainted.  useful when setting things up initially.
<span class='line'>662</span> 		     */</span><span class="WHIT">
<span class='line'>663</span> </span><span class="WHIT">		    </span><span class="NAME">this.setHoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">		    	</span><span class="WHIT">
<span class='line'>664</span> </span><span class="WHIT">		    	</span><span class="NAME">hoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>665</span> </span><span class="WHIT">		    	</span><span class="NAME">_updateHoverStyle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>666</span> </span><span class="WHIT">		    	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>667</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>668</span> 
<span class='line'>669</span> </span><span class="WHIT">		    </span><span class="COMM">/**
<span class='line'>670</span> 		    * Gets the component's hover paint style.
<span class='line'>671</span> 		    *
<span class='line'>672</span> 		    * Returns:
<span class='line'>673</span> 		    * the component's hover paint style. may be null.
<span class='line'>674</span> 		    */</span><span class="WHIT">
<span class='line'>675</span> </span><span class="WHIT">		    </span><span class="NAME">this.getHoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>676</span> </span><span class="WHIT">		    	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">hoverPaintStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>677</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>678</span> </span><span class="WHIT">		    </span><span class="WHIT">
<span class='line'>679</span> </span><span class="WHIT">		    </span><span class="COMM">/*
<span class='line'>680</span> 		     * sets/unsets the hover state of this element.
<span class='line'>681</span> 		     * 
<span class='line'>682</span> 		     * Parameters:
<span class='line'>683</span> 		     * 	hover - hover state boolean
<span class='line'>684</span> 		     * 	ignoreAttachedElements - if true, does not notify any attached elements of the change in hover state.  used mostly to avoid infinite loops.
<span class='line'>685</span> 		     */</span><span class="WHIT">
<span class='line'>686</span> </span><span class="WHIT">		    </span><span class="NAME">this.setHover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">hover</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ignoreAttachedElements</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>687</span> </span><span class="WHIT">		    	</span><span class="COMM">// while dragging, we ignore these events.  this keeps the UI from flashing and</span><span class="WHIT">
<span class='line'>688</span> </span><span class="WHIT">		    	</span><span class="COMM">// swishing and whatevering.</span><span class="WHIT">
<span class='line'>689</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">self._jsPlumb.currentlyDragging</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">self._jsPlumb.isHoverSuspended</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>690</span> </span><span class="WHIT">		    </span><span class="WHIT">
<span class='line'>691</span> </span><span class="WHIT">			    	</span><span class="NAME">_hover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">hover</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>692</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.hoverClass</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>693</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">hover</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>694</span> </span><span class="WHIT">							</span><span class="NAME">jpcl.addClass</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.hoverClass</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>695</span> </span><span class="WHIT">						</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>696</span> </span><span class="WHIT">							</span><span class="NAME">jpcl.removeClass</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.hoverClass</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>697</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>698</span> </span><span class="WHIT">		   		 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">hoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>699</span> </span><span class="WHIT">						</span><span class="NAME">self.paintStyleInUse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">hover</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">hoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">paintStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>700</span> </span><span class="WHIT">						</span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_timestamp</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>701</span> </span><span class="WHIT">						</span><span class="NAME">self.repaint</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>702</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>703</span> </span><span class="WHIT">					</span><span class="COMM">// get the list of other affected elements, if supported by this component.</span><span class="WHIT">
<span class='line'>704</span> </span><span class="WHIT">					</span><span class="COMM">// for a connection, its the endpoints.  for an endpoint, its the connections! surprise.</span><span class="WHIT">
<span class='line'>705</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.getAttachedElements</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">ignoreAttachedElements</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>706</span> </span><span class="WHIT">						</span><span class="NAME">_updateAttachedElements</span><span class="PUNC">(</span><span class="NAME">hover</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_timestamp</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>707</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>708</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>709</span> </span><span class="WHIT">		    </span><span class="WHIT">
<span class='line'>710</span> </span><span class="WHIT">		    </span><span class="NAME">this.isHover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_hover</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>711</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>712</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">zIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>713</span> </span><span class="WHIT">			</span><span class="NAME">this.setZIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">zIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>714</span> </span><span class="WHIT">			</span><span class="NAME">this.getZIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">zIndex</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>715</span> 
<span class='line'>716</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jpcl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>717</span> </span><span class="WHIT">				</span><span class="NAME">events</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"dblclick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mouseenter"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mouseout"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mousemove"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mousedown"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mouseup"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"contextmenu"</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>718</span> </span><span class="WHIT">				</span><span class="NAME">eventFilters</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="STRN">"mouseout"</span><span class="PUNC">:</span><span class="STRN">"mouseexit"</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>719</span> </span><span class="WHIT">				</span><span class="NAME">bindOne</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>720</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">filteredEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">eventFilters</span><span class="PUNC">[</span><span class="NAME">evt</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>721</span> </span><span class="WHIT">					</span><span class="NAME">jpcl.bind</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ee</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>722</span> </span><span class="WHIT">						</span><span class="NAME">c.fire</span><span class="PUNC">(</span><span class="NAME">filteredEvent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ee</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>723</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>724</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>725</span> </span><span class="WHIT">				</span><span class="NAME">unbindOne</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>726</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">filteredEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">eventFilters</span><span class="PUNC">[</span><span class="NAME">evt</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>727</span> </span><span class="WHIT">					</span><span class="NAME">jpcl.unbind</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>728</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>729</span> </span><span class="WHIT">		    </span><span class="WHIT">
<span class='line'>730</span> </span><span class="WHIT">		    </span><span class="NAME">this.attachListeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>731</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">events.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>732</span> </span><span class="WHIT">					</span><span class="NAME">bindOne</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">events</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 			</span><span class="WHIT">
<span class='line'>733</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>734</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>735</span> </span><span class="WHIT">		    </span><span class="WHIT">
<span class='line'>736</span> </span><span class="WHIT">		    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_updateAttachedElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>737</span> </span><span class="WHIT">		    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">affectedElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.getAttachedElements</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="COMM">// implemented in subclasses</span><span class="WHIT">
<span class='line'>738</span> </span><span class="WHIT">		    	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">affectedElements</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>739</span> </span><span class="WHIT">		    		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">affectedElements.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>740</span> </span><span class="WHIT">		    			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">sourceElement</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">sourceElement</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">affectedElements</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>741</span> </span><span class="WHIT">		    				</span><span class="NAME">affectedElements</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setHover</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="COMM">// tell the attached elements not to inform their own attached elements.</span><span class="WHIT">
<span class='line'>742</span> </span><span class="WHIT">		    		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>743</span> </span><span class="WHIT">		    	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>744</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>745</span> </span><span class="WHIT">		    </span><span class="WHIT">
<span class='line'>746</span> </span><span class="WHIT">		    </span><span class="NAME">this.reattachListenersForElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>747</span> </span><span class="WHIT">			    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>748</span> </span><span class="WHIT">		    		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">events.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>749</span> </span><span class="WHIT">		    			</span><span class="NAME">unbindOne</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">events</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>750</span> </span><span class="WHIT">			    	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arguments.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>751</span> </span><span class="WHIT">		    			</span><span class="NAME">self.attachListeners</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>752</span> </span><span class="WHIT">		    	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>753</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>754</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>755</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>756</span> 			 * TYPES
<span class='line'>757</span> 			 */</span><span class="WHIT">
<span class='line'>758</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_types</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>759</span> </span><span class="WHIT">				</span><span class="NAME">_splitType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">t.split</span><span class="PUNC">(</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>760</span> </span><span class="WHIT">				</span><span class="NAME">_applyTypes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>761</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.getDefaultType</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>762</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">td</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.getTypeDescriptor</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>763</span> </span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>764</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.merge</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.getDefaultType</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>765</span> </span><span class="WHIT">						</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">_types.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>766</span> </span><span class="WHIT">							</span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.merge</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb.getType</span><span class="PUNC">(</span><span class="NAME">_types</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">td</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>767</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>768</span> </span><span class="WHIT">						</span><span class="NAME">self.applyType</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>769</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>770</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>771</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>772</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>773</span> </span><span class="WHIT">			</span><span class="NAME">self.setType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">typeId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>774</span> </span><span class="WHIT">				</span><span class="NAME">_types</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_splitType</span><span class="PUNC">(</span><span class="NAME">typeId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>775</span> </span><span class="WHIT">				</span><span class="NAME">_applyTypes</span><span class="PUNC">(</span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">									</span><span class="WHIT">
<span class='line'>776</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>777</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>778</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>779</span> 			 * Function : getType
<span class='line'>780</span> 			 * Gets the 'types' of this component.
<span class='line'>781</span> 			 */</span><span class="WHIT">
<span class='line'>782</span> </span><span class="WHIT">			</span><span class="NAME">self.getType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>783</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_types</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>784</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>785</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>786</span> </span><span class="WHIT">			</span><span class="NAME">self.hasType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">typeId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>787</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.indexOf</span><span class="PUNC">(</span><span class="NAME">_types</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">typeId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>788</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>789</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>790</span> </span><span class="WHIT">			</span><span class="NAME">self.addType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">typeId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>791</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_splitType</span><span class="PUNC">(</span><span class="NAME">typeId</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_cont</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>792</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>793</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">t.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>794</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">self.hasType</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>795</span> </span><span class="WHIT">							</span><span class="NAME">_types.push</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>796</span> </span><span class="WHIT">							</span><span class="NAME">_cont</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>797</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>798</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>799</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_cont</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_applyTypes</span><span class="PUNC">(</span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>800</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>801</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>802</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>803</span> </span><span class="WHIT">			</span><span class="NAME">self.removeType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">typeId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>804</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_splitType</span><span class="PUNC">(</span><span class="NAME">typeId</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_cont</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_one</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">tt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>805</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.indexOf</span><span class="PUNC">(</span><span class="NAME">_types</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>806</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>807</span> </span><span class="WHIT">						</span><span class="NAME">_types.splice</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>808</span> </span><span class="WHIT">						</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>809</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>810</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>811</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>812</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>813</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>814</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">t.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>815</span> </span><span class="WHIT">						</span><span class="NAME">_cont</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_one</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_cont</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>816</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>817</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_cont</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_applyTypes</span><span class="PUNC">(</span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>818</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>819</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>820</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>821</span> </span><span class="WHIT">			</span><span class="NAME">self.toggleType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">typeId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>822</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_splitType</span><span class="PUNC">(</span><span class="NAME">typeId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>823</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>824</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">t.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>825</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.indexOf</span><span class="PUNC">(</span><span class="NAME">_types</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">t</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>826</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>827</span> </span><span class="WHIT">							</span><span class="NAME">_types.splice</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>828</span> </span><span class="WHIT">						</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>829</span> </span><span class="WHIT">							</span><span class="NAME">_types.push</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>830</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>831</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>832</span> </span><span class="WHIT">					</span><span class="NAME">_applyTypes</span><span class="PUNC">(</span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>833</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>834</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>835</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>836</span> </span><span class="WHIT">			</span><span class="NAME">this.applyType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>837</span> </span><span class="WHIT">				</span><span class="NAME">self.setPaintStyle</span><span class="PUNC">(</span><span class="NAME">t.paintStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>838</span> </span><span class="WHIT">				</span><span class="NAME">self.setHoverPaintStyle</span><span class="PUNC">(</span><span class="NAME">t.hoverPaintStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>839</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">t.parameters</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>840</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">t.parameters</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>841</span> </span><span class="WHIT">						</span><span class="NAME">self.setParameter</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">t.parameters</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>842</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>843</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>844</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>845</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>846</span> 
<span class='line'>847</span> </span><span class="WHIT">		</span><span class="NAME">overlayCapableJsPlumbUIComponent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>848</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumbUIComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>849</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>850</span> </span><span class="WHIT">			</span><span class="NAME">this.overlays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>851</span> 
<span class='line'>852</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">processOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>853</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_newOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>854</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isArray</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	</span><span class="COMM">// this is for the shorthand ["Arrow", { width:50 }] syntax</span><span class="WHIT">
<span class='line'>855</span> </span><span class="WHIT">					</span><span class="COMM">// there's also a three arg version:</span><span class="WHIT">
<span class='line'>856</span> </span><span class="WHIT">					</span><span class="COMM">// ["Arrow", { width:50 }, {location:0.7}] </span><span class="WHIT">
<span class='line'>857</span> </span><span class="WHIT">					</span><span class="COMM">// which merges the 3rd arg into the 2nd.</span><span class="WHIT">
<span class='line'>858</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>859</span> </span><span class="WHIT">						</span><span class="COMM">// make a copy of the object so as not to mess up anyone else's reference...</span><span class="WHIT">
<span class='line'>860</span> </span><span class="WHIT">						</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">component</span><span class="PUNC">:</span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_jsPlumb</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>861</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>862</span> </span><span class="WHIT">					</span><span class="NAME">_newOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Overlays</span><span class="PUNC">[</span><span class="NAME">self._jsPlumb.getRenderMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>863</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p.events</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>864</span> </span><span class="WHIT">						</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">p.events</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>865</span> </span><span class="WHIT">							</span><span class="NAME">_newOverlay.bind</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p.events</span><span class="PUNC">[</span><span class="NAME">evt</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>866</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>867</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>868</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>869</span> </span><span class="WHIT">					</span><span class="NAME">_newOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Overlays</span><span class="PUNC">[</span><span class="NAME">self._jsPlumb.getRenderMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">o</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">component</span><span class="PUNC">:</span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_jsPlumb</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>870</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>871</span> </span><span class="WHIT">					</span><span class="NAME">_newOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>872</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">										</span><span class="WHIT">
<span class='line'>873</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>874</span> </span><span class="WHIT">				</span><span class="NAME">self.overlays.push</span><span class="PUNC">(</span><span class="NAME">_newOverlay</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>875</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>876</span> </span><span class="WHIT">			</span><span class="NAME">calculateOverlaysToAdd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>877</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">defaultKeys</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.defaultOverlayKeys</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>878</span> </span><span class="WHIT">					</span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.overlays</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>879</span> </span><span class="WHIT">					</span><span class="NAME">checkKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>880</span> </span><span class="WHIT">						</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb.Defaults</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>881</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>882</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>883</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>884</span> 
<span class='line'>885</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">defaultKeys.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>886</span> </span><span class="WHIT">					</span><span class="NAME">o.unshift.apply</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">checkKey</span><span class="PUNC">(</span><span class="NAME">defaultKeys</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>887</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>888</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>889</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>890</span> 
<span class='line'>891</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_overlays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateOverlaysToAdd</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//params.overlays || self._jsPlumb.Defaults.Overlays;</span><span class="WHIT">
<span class='line'>892</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_overlays</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>893</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">_overlays.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>894</span> </span><span class="WHIT">					</span><span class="NAME">processOverlay</span><span class="PUNC">(</span><span class="NAME">_overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>895</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>896</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>897</span> 
<span class='line'>898</span> </span><span class="WHIT">		    </span><span class="COMM">// overlay finder helper method</span><span class="WHIT">
<span class='line'>899</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_getOverlayIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>900</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>901</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.overlays.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>902</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>903</span> </span><span class="WHIT">						</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>904</span> </span><span class="WHIT">						</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>905</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>906</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>907</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>908</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>909</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>910</span> </span><span class="WHIT">			</span><span class="NAME">this.addOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">overlay</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>911</span> </span><span class="WHIT">				</span><span class="NAME">processOverlay</span><span class="PUNC">(</span><span class="NAME">overlay</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>912</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>913</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>914</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>915</span> </span><span class="WHIT">			</span><span class="NAME">this.getOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>916</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getOverlayIndex</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>917</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>918</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>919</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>920</span> </span><span class="WHIT">			</span><span class="NAME">this.getOverlays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>921</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self.overlays</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>922</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>923</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>924</span> </span><span class="WHIT">			</span><span class="NAME">this.hideOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>925</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.getOverlay</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>926</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">o.hide</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>927</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>928</span> 
<span class='line'>929</span> </span><span class="WHIT">			</span><span class="NAME">this.hideOverlays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>930</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.overlays.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>931</span> </span><span class="WHIT">					</span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">hide</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>932</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>933</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>934</span> </span><span class="WHIT">			</span><span class="NAME">this.showOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>935</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.getOverlay</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>936</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">o.show</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>937</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>938</span> 
<span class='line'>939</span> </span><span class="WHIT">			</span><span class="NAME">this.showOverlays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>940</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.overlays.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>941</span> </span><span class="WHIT">					</span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">show</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>942</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>943</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>944</span> </span><span class="WHIT">			</span><span class="NAME">this.removeAllOverlays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>945</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.overlays.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>946</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cleanup</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cleanup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>947</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>948</span> 
<span class='line'>949</span> </span><span class="WHIT">				</span><span class="NAME">self.overlays.splice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.overlays.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>950</span> </span><span class="WHIT">				</span><span class="NAME">self.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>951</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>952</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>953</span> </span><span class="WHIT">			</span><span class="NAME">this.removeOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">overlayId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>954</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getOverlayIndex</span><span class="PUNC">(</span><span class="NAME">overlayId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>955</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>956</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>957</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o.cleanup</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">o.cleanup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>958</span> </span><span class="WHIT">					</span><span class="NAME">self.overlays.splice</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>959</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>960</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>961</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>962</span> </span><span class="WHIT">			</span><span class="NAME">this.removeOverlays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>963</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arguments.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>964</span> </span><span class="WHIT">					</span><span class="NAME">self.removeOverlay</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>965</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>966</span> 
<span class='line'>967</span> </span><span class="WHIT">			</span><span class="COMM">// this is a shortcut helper method to let people add a label as</span><span class="WHIT">
<span class='line'>968</span> </span><span class="WHIT">			</span><span class="COMM">// overlay.			</span><span class="WHIT">
<span class='line'>969</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_internalLabelOverlayId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"__label"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>970</span> </span><span class="WHIT">			</span><span class="NAME">_makeLabelOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>971</span> 
<span class='line'>972</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>973</span> </span><span class="WHIT">					</span><span class="NAME">cssClass</span><span class="PUNC">:</span><span class="NAME">params.cssClass</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>974</span> </span><span class="WHIT">					</span><span class="NAME">labelStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.labelStyle</span><span class="PUNC">,</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>975</span> </span><span class="WHIT">					</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">_internalLabelOverlayId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>976</span> </span><span class="WHIT">					</span><span class="NAME">component</span><span class="PUNC">:</span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>977</span> </span><span class="WHIT">					</span><span class="NAME">_jsPlumb</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb</span><span class="WHIT">
<span class='line'>978</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>979</span> </span><span class="WHIT">				</span><span class="NAME">mergedParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">_params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>980</span> 
<span class='line'>981</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Overlays</span><span class="PUNC">[</span><span class="NAME">self._jsPlumb.getRenderMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">Label</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">mergedParams</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>982</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>983</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.label</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>984</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">loc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.labelLocation</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.defaultLabelLocation</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>985</span> </span><span class="WHIT">					</span><span class="NAME">labelStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.labelStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb.Defaults.LabelStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.LabelStyle</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>986</span> </span><span class="WHIT">				</span><span class="NAME">this.overlays.push</span><span class="PUNC">(</span><span class="NAME">_makeLabelOverlay</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>987</span> </span><span class="WHIT">					</span><span class="NAME">label</span><span class="PUNC">:</span><span class="NAME">params.label</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>988</span> </span><span class="WHIT">					</span><span class="NAME">location</span><span class="PUNC">:</span><span class="NAME">loc</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>989</span> </span><span class="WHIT">					</span><span class="NAME">labelStyle</span><span class="PUNC">:</span><span class="NAME">labelStyle</span><span class="WHIT">
<span class='line'>990</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>991</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>992</span> 
<span class='line'>993</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>994</span> </span><span class="WHIT">			</span><span class="NAME">this.setLabel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>995</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.getOverlay</span><span class="PUNC">(</span><span class="NAME">_internalLabelOverlayId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>996</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">lo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>997</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">String</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">l.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Function</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">label</span><span class="PUNC">:</span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>998</span> </span><span class="WHIT">					</span><span class="NAME">lo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_makeLabelOverlay</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>999</span> </span><span class="WHIT">					</span><span class="NAME">this.overlays.push</span><span class="PUNC">(</span><span class="NAME">lo</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1000</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1001</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1002</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">String</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">l.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Function</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">lo.setLabel</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1003</span> </span><span class="WHIT">					</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1004</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l.label</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">lo.setLabel</span><span class="PUNC">(</span><span class="NAME">l.label</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1005</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l.location</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">lo.setLocation</span><span class="PUNC">(</span><span class="NAME">l.location</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1006</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1007</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1008</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>1009</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">self._jsPlumb.isSuspendDrawing</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1010</span> </span><span class="WHIT">					</span><span class="NAME">self.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1011</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1012</span> 
<span class='line'>1013</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1014</span> </span><span class="WHIT">			</span><span class="NAME">this.getLabel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1015</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.getOverlay</span><span class="PUNC">(</span><span class="NAME">_internalLabelOverlayId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1016</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">lo</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">lo.getLabel</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1017</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1018</span> 
<span class='line'>1019</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1020</span> </span><span class="WHIT">			</span><span class="NAME">this.getLabelOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1021</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self.getOverlay</span><span class="PUNC">(</span><span class="NAME">_internalLabelOverlayId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1022</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1023</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1024</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">superAt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.applyType</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1025</span> </span><span class="WHIT">			</span><span class="NAME">this.applyType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1026</span> </span><span class="WHIT">				</span><span class="NAME">superAt</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1027</span> </span><span class="WHIT">				</span><span class="NAME">self.removeAllOverlays</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1028</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">t.overlays</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1029</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">t.overlays.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1030</span> </span><span class="WHIT">						</span><span class="NAME">self.addOverlay</span><span class="PUNC">(</span><span class="NAME">t.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1031</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1032</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1033</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1034</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1035</span> </span><span class="WHIT">		</span><span class="NAME">_bindListeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_hoverFunction</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1036</span> </span><span class="WHIT">        	</span><span class="NAME">obj.bind</span><span class="PUNC">(</span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">_self.fire</span><span class="PUNC">(</span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1037</span> </span><span class="WHIT">			</span><span class="NAME">obj.bind</span><span class="PUNC">(</span><span class="STRN">"dblclick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">_self.fire</span><span class="PUNC">(</span><span class="STRN">"dblclick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1038</span> </span><span class="WHIT">	        </span><span class="NAME">obj.bind</span><span class="PUNC">(</span><span class="STRN">"contextmenu"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">_self.fire</span><span class="PUNC">(</span><span class="STRN">"contextmenu"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1039</span> </span><span class="WHIT">			</span><span class="NAME">obj.bind</span><span class="PUNC">(</span><span class="STRN">"mouseenter"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1040</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_self.isHover</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1041</span> </span><span class="WHIT">	                </span><span class="NAME">_hoverFunction</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1042</span> </span><span class="WHIT">					</span><span class="NAME">_self.fire</span><span class="PUNC">(</span><span class="STRN">"mouseenter"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1043</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1044</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1045</span> </span><span class="WHIT">			</span><span class="NAME">obj.bind</span><span class="PUNC">(</span><span class="STRN">"mouseexit"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1046</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_self.isHover</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1047</span> </span><span class="WHIT">	                </span><span class="NAME">_hoverFunction</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1048</span> </span><span class="WHIT">					</span><span class="NAME">_self.fire</span><span class="PUNC">(</span><span class="STRN">"mouseexit"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1049</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1050</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1051</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1052</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1053</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_jsPlumbInstanceIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1054</span> </span><span class="WHIT">			</span><span class="NAME">getInstanceIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1055</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_jsPlumbInstanceIndex</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1056</span> </span><span class="WHIT">				</span><span class="NAME">_jsPlumbInstanceIndex</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1057</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1058</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1059</span> 
<span class='line'>1060</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jsPlumbInstance</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_defaults</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1061</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1062</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1063</span> 		 * Property: Defaults 
<span class='line'>1064</span> 		 * 
<span class='line'>1065</span> 		 * These are the default settings for jsPlumb.  They are what will be used if you do not supply specific pieces of information 
<span class='line'>1066</span> 		 * to the various API calls. A convenient way to implement your own look and feel can be to override these defaults 
<span class='line'>1067</span> 		 * by including a script somewhere after the jsPlumb include, but before you make any calls to jsPlumb.
<span class='line'>1068</span> 		 * 
<span class='line'>1069</span> 		 * Properties:
<span class='line'>1070</span> 		 * 	-	*Anchor*				    The default anchor to use for all connections (both source and target). Default is "BottomCenter".
<span class='line'>1071</span> 		 * 	-	*Anchors*				    The default anchors to use ([source, target]) for all connections. Defaults are ["BottomCenter", "BottomCenter"].
<span class='line'>1072</span> 		 *  -   *ConnectionsDetachable*		Whether or not connections are detachable by default (using the mouse). Defaults to true.
<span class='line'>1073</span> 		 *  -   *ConnectionOverlays*		The default overlay definitions for Connections. Defaults to an empty list.
<span class='line'>1074</span> 		 * 	-	*Connector*				The default connector definition to use for all connections.  Default is "Bezier".
<span class='line'>1075</span> 		 * 	-   *ConnectorZIndex*       Optional value for the z-index of Connections that are not in the hover state. If you set this, jsPlumb will set the z-index of all created Connections to be this value, and the z-index of any Connections in the hover state to be this value plus one. This brings hovered connections up on top of others, which is a nice effect in busy UIs.
<span class='line'>1076</span> 		 *  -   *Container*				Optional selector or element id that instructs jsPlumb to append elements it creates to a specific element.
<span class='line'>1077</span> 		 * 	-	*DragOptions*			The default drag options to pass in to connect, makeTarget and addEndpoint calls. Default is empty.
<span class='line'>1078</span> 		 * 	-	*DropOptions*			The default drop options to pass in to connect, makeTarget and addEndpoint calls. Default is empty.
<span class='line'>1079</span> 		 * 	-	*Endpoint*				The default endpoint definition to use for all connections (both source and target).  Default is "Dot".
<span class='line'>1080</span> 		 *  -   *EndpointOverlays*		The default overlay definitions for Endpoints. Defaults to an empty list.
<span class='line'>1081</span> 		 * 	-	*Endpoints*				The default endpoint definitions ([ source, target ]) to use for all connections.  Defaults are ["Dot", "Dot"].
<span class='line'>1082</span> 		 * 	-	*EndpointStyle*			The default style definition to use for all endpoints. Default is fillStyle:"#456".
<span class='line'>1083</span> 		 * 	-	*EndpointStyles*		The default style definitions ([ source, target ]) to use for all endpoints.  Defaults are empty.
<span class='line'>1084</span> 		 * 	-	*EndpointHoverStyle*	The default hover style definition to use for all endpoints. Default is null.
<span class='line'>1085</span> 		 * 	-	*EndpointHoverStyles*	The default hover style definitions ([ source, target ]) to use for all endpoints. Defaults are null.
<span class='line'>1086</span> 		 * 	-	*HoverPaintStyle*		The default hover style definition to use for all connections. Defaults are null.
<span class='line'>1087</span> 		 * 	-	*LabelStyle*			The default style to use for label overlays on connections.
<span class='line'>1088</span> 		 * 	-	*LogEnabled*			Whether or not the jsPlumb log is enabled. defaults to false.
<span class='line'>1089</span> 		 * 	-	*Overlays*				The default overlay definitions (for both Connections and Endpoint). Defaults to an empty list.
<span class='line'>1090</span> 		 * 	-	*MaxConnections*		The default maximum number of connections for an Endpoint.  Defaults to 1.		 
<span class='line'>1091</span> 		 * 	-	*PaintStyle*			The default paint style for a connection. Default is line width of 8 pixels, with color "#456".
<span class='line'>1092</span> 		 * 	-	*ReattachConnections*	Whether or not to reattach Connections that a user has detached with the mouse and then dropped. Default is false.
<span class='line'>1093</span> 		 * 	-	*RenderMode*			What mode to use to paint with.  If you're on IE&lt;9, you don't really get to choose this.  You'll just get VML.  Otherwise, the jsPlumb default is to use SVG.
<span class='line'>1094</span> 		 * 	-	*Scope*				The default "scope" to use for connections. Scope lets you assign connections to different categories. 
<span class='line'>1095</span> 		 */</span><span class="WHIT">
<span class='line'>1096</span> </span><span class="WHIT">		</span><span class="NAME">this.Defaults</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1097</span> </span><span class="WHIT">			</span><span class="NAME">Anchor</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"BottomCenter"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1098</span> </span><span class="WHIT">			</span><span class="NAME">Anchors</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1099</span> </span><span class="WHIT">            </span><span class="NAME">ConnectionsDetachable</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1100</span> </span><span class="WHIT">            </span><span class="NAME">ConnectionOverlays</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1101</span> </span><span class="WHIT">            </span><span class="NAME">Connector</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"Bezier"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1102</span> </span><span class="WHIT">			</span><span class="NAME">ConnectorZIndex</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1103</span> </span><span class="WHIT">			</span><span class="NAME">Container</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1104</span> </span><span class="WHIT">			</span><span class="NAME">DragOptions</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1105</span> </span><span class="WHIT">			</span><span class="NAME">DropOptions</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1106</span> </span><span class="WHIT">			</span><span class="NAME">Endpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"Dot"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1107</span> </span><span class="WHIT">			</span><span class="NAME">EndpointOverlays</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1108</span> </span><span class="WHIT">			</span><span class="NAME">Endpoints</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1109</span> </span><span class="WHIT">			</span><span class="NAME">EndpointStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">fillStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"#456"</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1110</span> </span><span class="WHIT">			</span><span class="NAME">EndpointStyles</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1111</span> </span><span class="WHIT">			</span><span class="NAME">EndpointHoverStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1112</span> </span><span class="WHIT">			</span><span class="NAME">EndpointHoverStyles</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1113</span> </span><span class="WHIT">			</span><span class="NAME">HoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1114</span> </span><span class="WHIT">			</span><span class="NAME">LabelStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">color</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"black"</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1115</span> </span><span class="WHIT">			</span><span class="NAME">LogEnabled</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1116</span> </span><span class="WHIT">			</span><span class="NAME">Overlays</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1117</span> </span><span class="WHIT">			</span><span class="NAME">MaxConnections</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1118</span> </span><span class="WHIT">			</span><span class="NAME">PaintStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">strokeStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"#456"</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>1119</span> </span><span class="WHIT">			</span><span class="NAME">ReattachConnections</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1120</span> </span><span class="WHIT">			</span><span class="NAME">RenderMode</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"svg"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1121</span> </span><span class="WHIT">			</span><span class="NAME">Scope</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"jsPlumb_DefaultScope"</span><span class="WHIT">
<span class='line'>1122</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1123</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_defaults</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">this.Defaults</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_defaults</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1124</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1125</span> </span><span class="WHIT">		</span><span class="NAME">this.logEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Defaults.LogEnabled</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1126</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1127</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_connectionTypes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_endpointTypes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1128</span> </span><span class="WHIT">		</span><span class="NAME">this.registerConnectionType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1129</span> </span><span class="WHIT">			</span><span class="NAME">_connectionTypes</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1130</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1131</span> </span><span class="WHIT">		</span><span class="NAME">this.registerConnectionTypes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">types</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1132</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">types</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1133</span> </span><span class="WHIT">				</span><span class="NAME">_connectionTypes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">types</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1134</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1135</span> </span><span class="WHIT">		</span><span class="NAME">this.registerEndpointType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1136</span> </span><span class="WHIT">			</span><span class="NAME">_endpointTypes</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1137</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1138</span> </span><span class="WHIT">		</span><span class="NAME">this.registerEndpointTypes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">types</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1139</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">types</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1140</span> </span><span class="WHIT">				</span><span class="NAME">_endpointTypes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">types</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1141</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1142</span> </span><span class="WHIT">		</span><span class="NAME">this.getType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">typeDescriptor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1143</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">typeDescriptor</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT">  </span><span class="STRN">"connection"</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_connectionTypes</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_endpointTypes</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1144</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1145</span> 
<span class='line'>1146</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumbUtil.EventGenerator.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1147</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1148</span> </span><span class="WHIT">			</span><span class="NAME">_instanceIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getInstanceIndex</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1149</span> </span><span class="WHIT">			</span><span class="NAME">_bb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.bind</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1150</span> </span><span class="WHIT">			</span><span class="NAME">_initialDefaults</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1151</span> </span><span class="WHIT">            </span><span class="NAME">_zoom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1152</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>1153</span> </span><span class="WHIT">        </span><span class="NAME">this.setZoom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">z</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">repaintEverything</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1154</span> </span><span class="WHIT">            </span><span class="NAME">_zoom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">z</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1155</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">repaintEverything</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_currentInstance.repaintEverything</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1156</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1157</span> </span><span class="WHIT">        </span><span class="NAME">this.getZoom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_zoom</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1158</span> 
<span class='line'>1159</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.Defaults</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1160</span> </span><span class="WHIT">			</span><span class="NAME">_initialDefaults</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Defaults</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1161</span> 
<span class='line'>1162</span> </span><span class="WHIT">		</span><span class="NAME">this.bind</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1163</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"ready"</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">event</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">initialized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1164</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">_bb.apply</span><span class="PUNC">(</span><span class="NAME">_currentInstance</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1165</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1166</span> </span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1167</span> </span><span class="WHIT">		</span><span class="NAME">_currentInstance.importDefaults</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1168</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1169</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.Defaults</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1170</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1171</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1172</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1173</span> </span><span class="WHIT">		</span><span class="NAME">_currentInstance.restoreDefaults</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1174</span> </span><span class="WHIT">			</span><span class="NAME">_currentInstance.Defaults</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_initialDefaults</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1175</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1176</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1177</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">log</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1178</span> </span><span class="WHIT">        </span><span class="NAME">resizeTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1179</span> </span><span class="WHIT">        </span><span class="NAME">initialized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1180</span> </span><span class="WHIT">        </span><span class="NAME">connectionsByScope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1181</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>1182</span>          * map of element id -> endpoint lists. an element can have an arbitrary
<span class='line'>1183</span>          * number of endpoints on it, and not all of them have to be connected
<span class='line'>1184</span>          * to anything.
<span class='line'>1185</span>          */</span><span class="WHIT">
<span class='line'>1186</span> </span><span class="WHIT">        </span><span class="NAME">endpointsByElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1187</span> </span><span class="WHIT">        </span><span class="NAME">endpointsByUUID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1188</span> </span><span class="WHIT">        </span><span class="NAME">offsets</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1189</span> </span><span class="WHIT">        </span><span class="NAME">offsetTimestamps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1190</span> </span><span class="WHIT">        </span><span class="NAME">floatingConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1191</span> </span><span class="WHIT">        </span><span class="NAME">draggableStates</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1192</span> </span><span class="WHIT">        </span><span class="NAME">canvasList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1193</span> </span><span class="WHIT">        </span><span class="NAME">sizes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1194</span> </span><span class="WHIT">        </span><span class="COMM">//listeners = {}, // a map: keys are event types, values are lists of listeners.</span><span class="WHIT">
<span class='line'>1195</span> </span><span class="WHIT">        </span><span class="NAME">DEFAULT_SCOPE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Defaults.Scope</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1196</span> </span><span class="WHIT">        </span><span class="NAME">renderMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="COMM">// will be set in init()							</span><span class="WHIT">
<span class='line'>1197</span> 
<span class='line'>1198</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1199</span> 		 * helper method to add an item to a list, creating the list if it does
<span class='line'>1200</span> 		 * not yet exist.
<span class='line'>1201</span> 		 */</span><span class="WHIT">
<span class='line'>1202</span> </span><span class="WHIT">		</span><span class="NAME">_addToList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1203</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">map</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1204</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1205</span> </span><span class="WHIT">				</span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1206</span> </span><span class="WHIT">				</span><span class="NAME">map</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1207</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1208</span> </span><span class="WHIT">			</span><span class="NAME">l.push</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1209</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1210</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1211</span> 
<span class='line'>1212</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1213</span> 		 * appends an element to some other element, which is calculated as follows:
<span class='line'>1214</span> 		 * 
<span class='line'>1215</span> 		 * 1. if _currentInstance.Defaults.Container exists, use that element.
<span class='line'>1216</span> 		 * 2. if the 'parent' parameter exists, use that.
<span class='line'>1217</span> 		 * 3. otherwise just use the root element (for DOM usage, the document body).
<span class='line'>1218</span> 		 * 
<span class='line'>1219</span> 		 */</span><span class="WHIT">
<span class='line'>1220</span> </span><span class="WHIT">		</span><span class="NAME">_appendElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1221</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_currentInstance.Defaults.Container</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1222</span> </span><span class="WHIT">				</span><span class="NAME">jsPlumb.CurrentLibrary.appendElement</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.Container</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1223</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">parent</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1224</span> </span><span class="WHIT">				</span><span class="COMM">//document.body.appendChild(el);</span><span class="WHIT">
<span class='line'>1225</span> </span><span class="WHIT">				</span><span class="NAME">jsPlumbAdapter.appendToRoot</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1226</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1227</span> </span><span class="WHIT">				</span><span class="NAME">jsPlumb.CurrentLibrary.appendElement</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1228</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1229</span> 
<span class='line'>1230</span> </span><span class="WHIT">		</span><span class="NAME">_curIdStamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1231</span> </span><span class="WHIT">		</span><span class="NAME">_idstamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_curIdStamp</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1232</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1233</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1234</span> 		 * YUI, for some reason, put the result of a Y.all call into an object that contains
<span class='line'>1235</span> 		 * a '_nodes' array, instead of handing back an array-like object like the other
<span class='line'>1236</span> 		 * libraries do.
<span class='line'>1237</span> 		 */</span><span class="WHIT">
<span class='line'>1238</span> </span><span class="WHIT">		</span><span class="NAME">_convertYUICollection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1239</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c._nodes</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">c._nodes</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1240</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>1241</span> 
<span class='line'>1242</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1243</span> 		 * Draws an endpoint and its connections. this is the main entry point into drawing connections as well
<span class='line'>1244</span> 		 * as endpoints, since jsPlumb is endpoint-centric under the hood.
<span class='line'>1245</span> 		 * 
<span class='line'>1246</span> 		 * @param element element to draw (of type library specific element object)
<span class='line'>1247</span> 		 * @param ui UI object from current library's event system. optional.
<span class='line'>1248</span> 		 * @param timestamp timestamp for this paint cycle. used to speed things up a little by cutting down the amount of offset calculations we do.
<span class='line'>1249</span> 		 */</span><span class="WHIT">
<span class='line'>1250</span> </span><span class="WHIT">		</span><span class="NAME">_draw</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1251</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1252</span> </span><span class="WHIT">			</span><span class="COMM">// TOD is it correct to filter by headless at this top level? how would a headless adapter ever repaint?</span><span class="WHIT">
<span class='line'>1253</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">jsPlumbAdapter.headless</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_suspendDrawing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1254</span> </span><span class="WHIT">			    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1255</span> </span><span class="WHIT">			    	</span><span class="NAME">repaintEls</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.dragManager.getElementsForDraggable</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			    </span><span class="WHIT">
<span class='line'>1256</span> 
<span class='line'>1257</span> </span><span class="WHIT">			    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_timestamp</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1258</span> 
<span class='line'>1259</span> </span><span class="WHIT">			    </span><span class="NAME">_currentInstance.anchorManager.redraw</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1260</span> 
<span class='line'>1261</span> </span><span class="WHIT">			    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">repaintEls</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1262</span> </span><span class="WHIT">				    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">repaintEls</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1263</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.anchorManager.redraw</span><span class="PUNC">(</span><span class="NAME">repaintEls</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">repaintEls</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">offset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			    	</span><span class="WHIT">
<span class='line'>1264</span> </span><span class="WHIT">				    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1265</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1266</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1267</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1268</span> 
<span class='line'>1269</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1270</span> 		 * executes the given function against the given element if the first
<span class='line'>1271</span> 		 * argument is an object, or the list of elements, if the first argument
<span class='line'>1272</span> 		 * is a list. the function passed in takes (element, elementId) as
<span class='line'>1273</span> 		 * arguments.
<span class='line'>1274</span> 		 */</span><span class="WHIT">
<span class='line'>1275</span> </span><span class="WHIT">		</span><span class="NAME">_elementProxy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1276</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">retVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1277</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isArray</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1278</span> </span><span class="WHIT">				</span><span class="NAME">retVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1279</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">element.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1280</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1281</span> </span><span class="WHIT">					</span><span class="NAME">retVal.push</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// append return values to what we will return</span><span class="WHIT">
<span class='line'>1282</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1283</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1284</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1285</span> </span><span class="WHIT">				</span><span class="NAME">retVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1286</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1287</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">retVal</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1288</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>1289</span> 
<span class='line'>1290</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1291</span> 		 * gets an Endpoint by uuid.
<span class='line'>1292</span> 		 */</span><span class="WHIT">
<span class='line'>1293</span> </span><span class="WHIT">		</span><span class="NAME">_getEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">uuid</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">endpointsByUUID</span><span class="PUNC">[</span><span class="NAME">uuid</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1294</span> 
<span class='line'>1295</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1296</span> 		 * inits a draggable if it's not already initialised.
<span class='line'>1297</span> 		 */</span><span class="WHIT">
<span class='line'>1298</span> </span><span class="WHIT">		</span><span class="NAME">_initDraggableIfNecessary</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isDraggable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragOptions</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1299</span> </span><span class="WHIT">			</span><span class="COMM">// TODO move to DragManager?</span><span class="WHIT">
<span class='line'>1300</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">jsPlumbAdapter.headless</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1301</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">draggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isDraggable</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">isDraggable</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1302</span> </span><span class="WHIT">					</span><span class="NAME">jpcl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1303</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1304</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpcl.isDragSupported</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">jpcl.isAlreadyDraggable</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1305</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dragOptions</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.DragOptions</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.DragOptions</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1306</span> </span><span class="WHIT">						</span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// make a copy.</span><span class="WHIT">
<span class='line'>1307</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dragEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.dragEvents</span><span class="PUNC">[</span><span class="STRN">"drag"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1308</span> </span><span class="WHIT">							</span><span class="NAME">stopEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.dragEvents</span><span class="PUNC">[</span><span class="STRN">"stop"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1309</span> </span><span class="WHIT">							</span><span class="NAME">startEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.dragEvents</span><span class="PUNC">[</span><span class="STRN">"start"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1310</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1311</span> </span><span class="WHIT">						</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">startEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">startEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1312</span> </span><span class="WHIT">							</span><span class="NAME">_currentInstance.setHoverSuspended</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1313</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1314</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1315</span> </span><span class="WHIT">						</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">dragEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">dragEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">                            </span><span class="WHIT">
<span class='line'>1316</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getUIPosition</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1317</span> </span><span class="WHIT">							</span><span class="NAME">_draw</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1318</span> </span><span class="WHIT">							</span><span class="NAME">_addClass</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"jsPlumb_dragged"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1319</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1320</span> </span><span class="WHIT">						</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">stopEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">stopEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1321</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getUIPosition</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1322</span> </span><span class="WHIT">							</span><span class="NAME">_draw</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1323</span> </span><span class="WHIT">							</span><span class="NAME">_removeClass</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"jsPlumb_dragged"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1324</span> </span><span class="WHIT">							</span><span class="NAME">_currentInstance.setHoverSuspended</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1325</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1326</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// need ID</span><span class="WHIT">
<span class='line'>1327</span> </span><span class="WHIT">						</span><span class="NAME">draggableStates</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>1328</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">draggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">draggableStates</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1329</span> </span><span class="WHIT">						</span><span class="NAME">options.disabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">draggable</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">draggable</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1330</span> </span><span class="WHIT">						</span><span class="NAME">jpcl.initDraggable</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1331</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.dragManager.register</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1332</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1333</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1334</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1335</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1336</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1337</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1338</span> 		* prepares a final params object that can be passed to _newConnection, taking into account defaults, events, etc.
<span class='line'>1339</span> 		*/</span><span class="WHIT">
<span class='line'>1340</span> </span><span class="WHIT">		</span><span class="NAME">_prepareConnectionParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1341</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1342</span> </span><span class="WHIT">				</span><span class="NAME">sourceIsNew</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1343</span> </span><span class="WHIT">				</span><span class="NAME">targetIsNew</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="WHIT">
<span class='line'>1344</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1345</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">_p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1346</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1347</span> </span><span class="WHIT">			</span><span class="COMM">// hotwire endpoints passed as source or target to sourceEndpoint/targetEndpoint, respectively.</span><span class="WHIT">
<span class='line'>1348</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.source</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_p.source.endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_p.sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_p.source</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1349</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.source</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_p.target.endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_p.targetEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_p.target</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1350</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1351</span> </span><span class="WHIT">			</span><span class="COMM">// test for endpoint uuids to connect</span><span class="WHIT">
<span class='line'>1352</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.uuids</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1353</span> </span><span class="WHIT">				</span><span class="NAME">_p.sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getEndpoint</span><span class="PUNC">(</span><span class="NAME">params.uuids</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1354</span> </span><span class="WHIT">				</span><span class="NAME">_p.targetEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getEndpoint</span><span class="PUNC">(</span><span class="NAME">params.uuids</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1355</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>1356</span> 
<span class='line'>1357</span> </span><span class="WHIT">			</span><span class="COMM">// now ensure that if we do have Endpoints already, they're not full.</span><span class="WHIT">
<span class='line'>1358</span> </span><span class="WHIT">			</span><span class="COMM">// source:</span><span class="WHIT">
<span class='line'>1359</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_p.sourceEndpoint.isFull</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1360</span> </span><span class="WHIT">				</span><span class="NAME">_log</span><span class="PUNC">(</span><span class="NAME">_currentInstance</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"could not add connection; source endpoint is full"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1361</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1362</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1363</span> 
<span class='line'>1364</span> </span><span class="WHIT">			</span><span class="COMM">// target:</span><span class="WHIT">
<span class='line'>1365</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.targetEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_p.targetEndpoint.isFull</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1366</span> </span><span class="WHIT">				</span><span class="NAME">_log</span><span class="PUNC">(</span><span class="NAME">_currentInstance</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"could not add connection; target endpoint is full"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1367</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1368</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1369</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1370</span> </span><span class="WHIT">			</span><span class="COMM">// at this point, if we have source or target Endpoints, they were not new and we should mark the</span><span class="WHIT">
<span class='line'>1371</span> </span><span class="WHIT">			</span><span class="COMM">// flag to reflect that.  this is for use later with the deleteEndpointsOnDetach flag.</span><span class="WHIT">
<span class='line'>1372</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.sourceEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_p.sourceIsNew</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1373</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.targetEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_p.targetIsNew</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1374</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1375</span> </span><span class="WHIT">			</span><span class="COMM">// if source endpoint mandates connection type and nothing specified in our params, use it.</span><span class="WHIT">
<span class='line'>1376</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_p.type</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_p.sourceEndpoint</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1377</span> </span><span class="WHIT">				</span><span class="NAME">_p.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_p.sourceEndpoint.connectionType</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1378</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1379</span> </span><span class="WHIT">			</span><span class="COMM">// copy in any connectorOverlays that were specified on the source endpoint.</span><span class="WHIT">
<span class='line'>1380</span> </span><span class="WHIT">			</span><span class="COMM">// it doesnt copy target endpoint overlays.  i'm not sure if we want it to or not.</span><span class="WHIT">
<span class='line'>1381</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_p.sourceEndpoint.connectorOverlays</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1382</span> </span><span class="WHIT">				</span><span class="NAME">_p.overlays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_p.overlays</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1383</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">_p.sourceEndpoint.connectorOverlays.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1384</span> </span><span class="WHIT">					</span><span class="NAME">_p.overlays.push</span><span class="PUNC">(</span><span class="NAME">_p.sourceEndpoint.connectorOverlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1385</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1386</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1387</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1388</span> </span><span class="WHIT">			</span><span class="COMM">// tooltip.  params.tooltip takes precedence, then sourceEndpoint.connectorTooltip.</span><span class="WHIT">
<span class='line'>1389</span> </span><span class="WHIT">			</span><span class="NAME">_p.tooltip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.tooltip</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1390</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_p.tooltip</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_p.sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_p.sourceEndpoint.connectorTooltip</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1391</span> </span><span class="WHIT">				</span><span class="NAME">_p.tooltip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_p.sourceEndpoint.connectorTooltip</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1392</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1393</span> </span><span class="WHIT">			</span><span class="COMM">// if there's a target specified (which of course there should be), and there is no</span><span class="WHIT">
<span class='line'>1394</span> </span><span class="WHIT">			</span><span class="COMM">// target endpoint specified, and 'newConnection' was not set to true, then we check to</span><span class="WHIT">
<span class='line'>1395</span> </span><span class="WHIT">			</span><span class="COMM">// see if a prior call to makeTarget has provided us with the specs for the target endpoint, and</span><span class="WHIT">
<span class='line'>1396</span> </span><span class="WHIT">			</span><span class="COMM">// we use those if so.  additionally, if the makeTarget call was specified with 'uniqueEndpoint' set</span><span class="WHIT">
<span class='line'>1397</span> </span><span class="WHIT">			</span><span class="COMM">// to true, then if that target endpoint has already been created, we re-use it.</span><span class="WHIT">
<span class='line'>1398</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.target</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_p.target.endpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_p.targetEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_p.newConnection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>1399</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">_p.target</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1400</span> </span><span class="WHIT">					</span><span class="NAME">tep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="NAME">_targetEndpointDefinitions</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1401</span> </span><span class="WHIT">					</span><span class="NAME">existingUniqueEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_targetEndpoints</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>1402</span> 
<span class='line'>1403</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1404</span> </span><span class="WHIT">					</span><span class="COMM">// if target not enabled, return.</span><span class="WHIT">
<span class='line'>1405</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_targetsEnabled</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1406</span> 
<span class='line'>1407</span> </span><span class="WHIT">					</span><span class="COMM">// check for max connections??						</span><span class="WHIT">
<span class='line'>1408</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">existingUniqueEndpoint</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">existingUniqueEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_currentInstance.addEndpoint</span><span class="PUNC">(</span><span class="NAME">_p.target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1409</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_targetEndpointsUnique</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_targetEndpoints</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1410</span> </span><span class="WHIT">					 </span><span class="NAME">_p.targetEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1411</span> </span><span class="WHIT">					 </span><span class="NAME">newEndpoint._makeTargetCreator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1412</span> </span><span class="WHIT">					 </span><span class="NAME">_p.targetIsNew</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1413</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1414</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1415</span> 
<span class='line'>1416</span> </span><span class="WHIT">			</span><span class="COMM">// same thing, but for source.</span><span class="WHIT">
<span class='line'>1417</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.source</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_p.source.endpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_p.sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_p.newConnection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1418</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">_p.source</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1419</span> </span><span class="WHIT">					</span><span class="NAME">tep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_sourceEndpointDefinitions</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1420</span> </span><span class="WHIT">					</span><span class="NAME">existingUniqueEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_sourceEndpoints</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>1421</span> 
<span class='line'>1422</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1423</span> </span><span class="WHIT">					</span><span class="COMM">// if source not enabled, return.					</span><span class="WHIT">
<span class='line'>1424</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_sourcesEnabled</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1425</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>1426</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">existingUniqueEndpoint</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">existingUniqueEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_currentInstance.addEndpoint</span><span class="PUNC">(</span><span class="NAME">_p.source</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1427</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_sourceEndpointsUnique</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_sourceEndpoints</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1428</span> </span><span class="WHIT">					 </span><span class="NAME">_p.sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1429</span> </span><span class="WHIT">					 </span><span class="NAME">_p.sourceIsNew</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1430</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1431</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1432</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1433</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_p</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1434</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1435</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1436</span> </span><span class="WHIT">		</span><span class="NAME">_newConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1437</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">connectionFunc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.ConnectionType</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getDefaultConnectionType</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1438</span> </span><span class="WHIT">			    </span><span class="NAME">endpointFunc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.EndpointType</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">Endpoint</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1439</span> </span><span class="WHIT">			    </span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getParent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1440</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1441</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.container</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1442</span> </span><span class="WHIT">				</span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"parent"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.container</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1443</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1444</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.sourceEndpoint</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1445</span> </span><span class="WHIT">					</span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"parent"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.sourceEndpoint.parent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1446</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.source.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1447</span> </span><span class="WHIT">					</span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"parent"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.source.parent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1448</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"parent"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">(</span><span class="NAME">params.source</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1449</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1450</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1451</span> </span><span class="WHIT">			</span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"_jsPlumb"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1452</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">con</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">connectionFunc</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1453</span> </span><span class="WHIT">			</span><span class="NAME">con.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"con_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_idstamp</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1454</span> </span><span class="WHIT">			</span><span class="NAME">_eventFireProxy</span><span class="PUNC">(</span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">con</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1455</span> </span><span class="WHIT">			</span><span class="NAME">_eventFireProxy</span><span class="PUNC">(</span><span class="STRN">"dblclick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"dblclick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">con</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1456</span> </span><span class="WHIT">            </span><span class="NAME">_eventFireProxy</span><span class="PUNC">(</span><span class="STRN">"contextmenu"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"contextmenu"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">con</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1457</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">con</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1458</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1459</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1460</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1461</span> 		* adds the connection to the backing model, fires an event if necessary and then redraws
<span class='line'>1462</span> 		*/</span><span class="WHIT">
<span class='line'>1463</span> </span><span class="WHIT">		</span><span class="NAME">_finaliseConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1464</span> </span><span class="WHIT">            </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1465</span> </span><span class="WHIT">			</span><span class="COMM">// add to list of connections (by scope).</span><span class="WHIT">
<span class='line'>1466</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">jpc.suspendedEndpoint</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1467</span> </span><span class="WHIT">			    </span><span class="NAME">_addToList</span><span class="PUNC">(</span><span class="NAME">connectionsByScope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc.scope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1468</span> </span><span class="WHIT">			</span><span class="COMM">// fire an event</span><span class="WHIT">
<span class='line'>1469</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">params.doNotFireConnectionEvent</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">params.fireEvent</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1470</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1471</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">eventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1472</span> </span><span class="WHIT">					</span><span class="NAME">connection</span><span class="PUNC">:</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1473</span> </span><span class="WHIT">					</span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.source</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">target</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.target</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1474</span> </span><span class="WHIT">					</span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.targetId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1475</span> </span><span class="WHIT">					</span><span class="NAME">sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>1476</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1477</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1478</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.fire</span><span class="PUNC">(</span><span class="STRN">"jsPlumbConnection"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eventArgs</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1479</span> </span><span class="WHIT">				</span><span class="COMM">// this is from 1.3.11 onwards. "jsPlumbConnection" always felt so unnecessary, so</span><span class="WHIT">
<span class='line'>1480</span> </span><span class="WHIT">				</span><span class="COMM">// I've added this alias in 1.3.11, with a view to removing "jsPlumbConnection" completely in a future version. be aware, of course, you should only register listeners for one or the other of these events.</span><span class="WHIT">
<span class='line'>1481</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.fire</span><span class="PUNC">(</span><span class="STRN">"connection"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eventArgs</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1482</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1483</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1484</span> </span><span class="WHIT">            </span><span class="COMM">// always inform the anchor manager</span><span class="WHIT">
<span class='line'>1485</span> </span><span class="WHIT">            </span><span class="COMM">// except that if jpc has a suspended endpoint it's not true to say the</span><span class="WHIT">
<span class='line'>1486</span> </span><span class="WHIT">            </span><span class="COMM">// connection is new; it has just (possibly) moved. the question is whether</span><span class="WHIT">
<span class='line'>1487</span> </span><span class="WHIT">            </span><span class="COMM">// to make that call here or in the anchor manager.  i think perhaps here.</span><span class="WHIT">
<span class='line'>1488</span> </span><span class="WHIT">            </span><span class="NAME">_currentInstance.anchorManager.newConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1489</span> </span><span class="WHIT">			</span><span class="COMM">// force a paint</span><span class="WHIT">
<span class='line'>1490</span> </span><span class="WHIT">			</span><span class="NAME">_draw</span><span class="PUNC">(</span><span class="NAME">jpc.source</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1491</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1492</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1493</span> </span><span class="WHIT">		</span><span class="NAME">_eventFireProxy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">proxyEvent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1494</span> </span><span class="WHIT">			</span><span class="NAME">obj.bind</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">originalObject</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1495</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.fire</span><span class="PUNC">(</span><span class="NAME">proxyEvent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1496</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1497</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1498</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1499</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1500</span> 		 * for the given endpoint params, returns an appropriate parent element for the UI elements that will be added.
<span class='line'>1501</span> 		 * this function is used by _newEndpoint (directly below), and also in the makeSource function in jsPlumb.
<span class='line'>1502</span> 		 * 
<span class='line'>1503</span> 		 *   the logic is to first look for a "container" member of params, and pass that back if found.  otherwise we
<span class='line'>1504</span> 		 *   handoff to the 'getParent' function in the current library.
<span class='line'>1505</span> 		 */</span><span class="WHIT">
<span class='line'>1506</span> </span><span class="WHIT">		</span><span class="NAME">_getParentFromParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1507</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.container</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1508</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">params.container</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1509</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1510</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getTagName</span><span class="PUNC">(</span><span class="NAME">params.source</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1511</span> </span><span class="WHIT">                    </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getParent</span><span class="PUNC">(</span><span class="NAME">params.source</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1512</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tag</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">tag.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"td"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1513</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getParent</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1514</span> </span><span class="WHIT">                </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1515</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1516</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1517</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1518</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1519</span> 			factory method to prepare a new endpoint.  this should always be used instead of creating Endpoints
<span class='line'>1520</span> 			manually, since this method attaches event listeners and an id.
<span class='line'>1521</span> 		*/</span><span class="WHIT">
<span class='line'>1522</span> </span><span class="WHIT">		</span><span class="NAME">_newEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1523</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.EndpointType</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">Endpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1524</span> </span><span class="WHIT">				</span><span class="NAME">params.parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getParentFromParams</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1525</span> </span><span class="WHIT">				</span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"_jsPlumb"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1526</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1527</span> </span><span class="WHIT">				</span><span class="NAME">ep.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"ep_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_idstamp</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1528</span> </span><span class="WHIT">				</span><span class="NAME">_eventFireProxy</span><span class="PUNC">(</span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"endpointClick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1529</span> </span><span class="WHIT">				</span><span class="NAME">_eventFireProxy</span><span class="PUNC">(</span><span class="STRN">"dblclick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"endpointDblClick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1530</span> </span><span class="WHIT">				</span><span class="NAME">_eventFireProxy</span><span class="PUNC">(</span><span class="STRN">"contextmenu"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"contextmenu"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1531</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">jsPlumbAdapter.headless</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1532</span> </span><span class="WHIT">					</span><span class="NAME">_currentInstance.dragManager.endpointAdded</span><span class="PUNC">(</span><span class="NAME">params.source</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1533</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1534</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1535</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1536</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1537</span> 		 * performs the given function operation on all the connections found
<span class='line'>1538</span> 		 * for the given element id; this means we find all the endpoints for
<span class='line'>1539</span> 		 * the given element, and then for each endpoint find the connectors
<span class='line'>1540</span> 		 * connected to it. then we pass each connection in to the given
<span class='line'>1541</span> 		 * function.
<span class='line'>1542</span> 		 */</span><span class="WHIT">
<span class='line'>1543</span> </span><span class="WHIT">		</span><span class="NAME">_operation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1544</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1545</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endpoints</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">endpoints.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1546</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpoints.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1547</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1548</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">retVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">(</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connections</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1549</span> </span><span class="WHIT">						</span><span class="COMM">// if the function passed in returns true, we exit.</span><span class="WHIT">
<span class='line'>1550</span> </span><span class="WHIT">						</span><span class="COMM">// most functions return false.</span><span class="WHIT">
<span class='line'>1551</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">retVal</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1552</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1553</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endpointFunc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="PUNC">(</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1554</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1555</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1556</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1557</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1558</span> 		 * perform an operation on all elements.
<span class='line'>1559</span> 		 */</span><span class="WHIT">
<span class='line'>1560</span> </span><span class="WHIT">		</span><span class="NAME">_operationOnAll</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">func</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1561</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1562</span> </span><span class="WHIT">				</span><span class="NAME">_operation</span><span class="PUNC">(</span><span class="NAME">elId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1563</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1564</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1565</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1566</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1567</span> 		 * helper to remove an element from the DOM.
<span class='line'>1568</span> 		 */</span><span class="WHIT">
<span class='line'>1569</span> </span><span class="WHIT">		</span><span class="NAME">_removeElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1570</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">element.parentNode</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1571</span> </span><span class="WHIT">				</span><span class="NAME">element.parentNode.removeChild</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1572</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1573</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1574</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1575</span> 		 * helper to remove a list of elements from the DOM.
<span class='line'>1576</span> 		 */</span><span class="WHIT">
<span class='line'>1577</span> </span><span class="WHIT">		</span><span class="NAME">_removeElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elements</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1578</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">elements.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1579</span> </span><span class="WHIT">				</span><span class="NAME">_removeElement</span><span class="PUNC">(</span><span class="NAME">elements</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1580</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1581</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1582</span> 		 * Sets whether or not the given element(s) should be draggable,
<span class='line'>1583</span> 		 * regardless of what a particular plumb command may request.
<span class='line'>1584</span> 		 * 
<span class='line'>1585</span> 		 * @param element
<span class='line'>1586</span> 		 *            May be a string, a element objects, or a list of
<span class='line'>1587</span> 		 *            strings/elements.
<span class='line'>1588</span> 		 * @param draggable
<span class='line'>1589</span> 		 *            Whether or not the given element(s) should be draggable.
<span class='line'>1590</span> 		 */</span><span class="WHIT">
<span class='line'>1591</span> </span><span class="WHIT">		</span><span class="NAME">_setDraggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">draggable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1592</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_elementProxy</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1593</span> </span><span class="WHIT">				</span><span class="NAME">draggableStates</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">draggable</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1594</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jsPlumb.CurrentLibrary.isDragSupported</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1595</span> </span><span class="WHIT">					</span><span class="NAME">jsPlumb.CurrentLibrary.setDraggable</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">draggable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1596</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1597</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1598</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1599</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1600</span> 		 * private method to do the business of hiding/showing.
<span class='line'>1601</span> 		 * 
<span class='line'>1602</span> 		 * @param el
<span class='line'>1603</span> 		 *            either Id of the element in question or a library specific
<span class='line'>1604</span> 		 *            object for the element.
<span class='line'>1605</span> 		 * @param state
<span class='line'>1606</span> 		 *            String specifying a value for the css 'display' property
<span class='line'>1607</span> 		 *            ('block' or 'none').
<span class='line'>1608</span> 		 */</span><span class="WHIT">
<span class='line'>1609</span> </span><span class="WHIT">		</span><span class="NAME">_setVisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">alsoChangeEndpoints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1610</span> </span><span class="WHIT">			</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1611</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1612</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">alsoChangeEndpoints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1613</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1614</span> </span><span class="WHIT">					</span><span class="NAME">ep.setVisible</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1615</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1616</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1617</span> </span><span class="WHIT">					</span><span class="NAME">ep.setVisible</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1618</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1619</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1620</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1621</span> </span><span class="WHIT">			</span><span class="NAME">_operation</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1622</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">alsoChangeEndpoints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1623</span> </span><span class="WHIT">					</span><span class="COMM">// this test is necessary because this functionality is new, and i wanted to maintain backwards compatibility.</span><span class="WHIT">
<span class='line'>1624</span> </span><span class="WHIT">					</span><span class="COMM">// this block will only set a connection to be visible if the other endpoint in the connection is also visible.</span><span class="WHIT">
<span class='line'>1625</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oidx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.sourceId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1626</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">oidx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isVisible</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">jpc.setVisible</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1627</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1628</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT">  </span><span class="COMM">// the default behaviour for show, and what always happens for hide, is to just set the visibility without getting clever.</span><span class="WHIT">
<span class='line'>1629</span> </span><span class="WHIT">					</span><span class="NAME">jpc.setVisible</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1630</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1631</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1632</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1633</span> 		 * toggles the draggable state of the given element(s).
<span class='line'>1634</span> 		 * 
<span class='line'>1635</span> 		 * @param el
<span class='line'>1636</span> 		 *            either an id, or an element object, or a list of
<span class='line'>1637</span> 		 *            ids/element objects.
<span class='line'>1638</span> 		 */</span><span class="WHIT">
<span class='line'>1639</span> </span><span class="WHIT">		</span><span class="NAME">_toggleDraggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1640</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_elementProxy</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1641</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">draggableStates</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">draggableStates</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1642</span> </span><span class="WHIT">				</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">state</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1643</span> </span><span class="WHIT">				</span><span class="NAME">draggableStates</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1644</span> </span><span class="WHIT">				</span><span class="NAME">jsPlumb.CurrentLibrary.setDraggable</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1645</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1646</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1647</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1648</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1649</span> 		 * private method to do the business of toggling hiding/showing.
<span class='line'>1650</span> 		 * 
<span class='line'>1651</span> 		 * @param elId
<span class='line'>1652</span> 		 *            Id of the element in question
<span class='line'>1653</span> 		 */</span><span class="WHIT">
<span class='line'>1654</span> </span><span class="WHIT">		</span><span class="NAME">_toggleVisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">changeEndpoints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1655</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1656</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">changeEndpoints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1657</span> </span><span class="WHIT">				</span><span class="NAME">endpointFunc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1658</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ep.isVisible</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1659</span> </span><span class="WHIT">					</span><span class="NAME">ep.setVisible</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1660</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1661</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1662</span> </span><span class="WHIT">			</span><span class="NAME">_operation</span><span class="PUNC">(</span><span class="NAME">elId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1663</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.isVisible</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1664</span> </span><span class="WHIT">				</span><span class="NAME">jpc.setVisible</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>1665</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1666</span> </span><span class="WHIT">			</span><span class="COMM">// todo this should call _elementProxy, and pass in the</span><span class="WHIT">
<span class='line'>1667</span> </span><span class="WHIT">			</span><span class="COMM">// _operation(elId, f) call as a function. cos _toggleDraggable does</span><span class="WHIT">
<span class='line'>1668</span> </span><span class="WHIT">			</span><span class="COMM">// that.</span><span class="WHIT">
<span class='line'>1669</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1670</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1671</span> 		 * updates the offset and size for a given element, and stores the
<span class='line'>1672</span> 		 * values. if 'offset' is not null we use that (it would have been
<span class='line'>1673</span> 		 * passed in from a drag call) because it's faster; but if it is null,
<span class='line'>1674</span> 		 * or if 'recalc' is true in order to force a recalculation, we get the current values.
<span class='line'>1675</span> 		 */</span><span class="WHIT">
<span class='line'>1676</span> </span><span class="WHIT">		</span><span class="NAME">_updateOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1677</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.recalc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.offset</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.elId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1678</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_suspendDrawing</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">timestamp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_suspendedAt</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1679</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">recalc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1680</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">offsetTimestamps</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1681</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1682</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1683</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">recalc</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">offset</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// if forced repaint or no offset available, we recalculate.</span><span class="WHIT">
<span class='line'>1684</span> </span><span class="WHIT">				</span><span class="COMM">// get the current size and offset, and store them</span><span class="WHIT">
<span class='line'>1685</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">elId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1686</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>1687</span> </span><span class="WHIT">					</span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getSize</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1688</span> </span><span class="WHIT">					</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getOffset</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1689</span> </span><span class="WHIT">					</span><span class="NAME">offsetTimestamps</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1690</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1691</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1692</span> </span><span class="WHIT">				</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1693</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1694</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">elId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1695</span> </span><span class="WHIT">				    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getSize</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1696</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1697</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1698</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1699</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">right</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1700</span> </span><span class="WHIT">				</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">right</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1701</span> </span><span class="WHIT">				</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">bottom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1702</span> </span><span class="WHIT">				</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1703</span> </span><span class="WHIT">				</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1704</span> </span><span class="WHIT">				</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">centerx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1705</span> </span><span class="WHIT">				</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">centery</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>1706</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1707</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1708</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1709</span> 
<span class='line'>1710</span> </span><span class="WHIT">		</span><span class="COMM">// TODO comparison performance</span><span class="WHIT">
<span class='line'>1711</span> </span><span class="WHIT">		</span><span class="NAME">_getCachedData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1712</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1713</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">elId</span><span class="PUNC">:</span><span class="NAME">elId</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1714</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">o</span><span class="PUNC">:</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">:</span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1715</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1716</span> 
<span class='line'>1717</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1718</span> 		 * gets an id for the given element, creating and setting one if
<span class='line'>1719</span> 		 * necessary.  the id is of the form
<span class='line'>1720</span> 		 *
<span class='line'>1721</span> 		 *	jsPlumb_&lt;instance index>_&lt;index in instance>
<span class='line'>1722</span> 		 *
<span class='line'>1723</span> 		 * where "index in instance" is a monotonically increasing integer that starts at 0,
<span class='line'>1724</span> 		 * for each instance.  this method is used not only to assign ids to elements that do not
<span class='line'>1725</span> 		 * have them but also to connections and endpoints.
<span class='line'>1726</span> 		 */</span><span class="WHIT">
<span class='line'>1727</span> </span><span class="WHIT">		</span><span class="NAME">_getId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">uuid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotCreateIfNotFound</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1728</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ele</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1729</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">ele</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1730</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1731</span> </span><span class="WHIT">				</span><span class="COMM">// check if fixed uuid parameter is given</span><span class="WHIT">
<span class='line'>1732</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1733</span> </span><span class="WHIT">					</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uuid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1734</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1735</span> </span><span class="WHIT">					</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"jsPlumb_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_instanceIndex</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_idstamp</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1736</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>1737</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">doNotCreateIfNotFound</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_setAttribute</span><span class="PUNC">(</span><span class="NAME">ele</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1738</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1739</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1740</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1741</span> 
<span class='line'>1742</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1743</span> 		 * wraps one function with another, creating a placeholder for the
<span class='line'>1744</span> 		 * wrapped function if it was null. this is used to wrap the various
<span class='line'>1745</span> 		 * drag/drop event functions - to allow jsPlumb to be notified of
<span class='line'>1746</span> 		 * important lifecycle events without imposing itself on the user's
<span class='line'>1747</span> 		 * drag/drop functionality. TODO: determine whether or not we should
<span class='line'>1748</span> 		 * support an error handler concept, if one of the functions fails.
<span class='line'>1749</span> 		 * 
<span class='line'>1750</span> 		 * @param wrappedFunction original function to wrap; may be null.
<span class='line'>1751</span> 		 * @param newFunction function to wrap the original with.
<span class='line'>1752</span> 		 * @param returnOnThisValue Optional. Indicates that the wrappedFunction should 
<span class='line'>1753</span> 		 * not be executed if the newFunction returns a value matching 'returnOnThisValue'.
<span class='line'>1754</span> 		 * note that this is a simple comparison and only works for primitives right now.
<span class='line'>1755</span> 		 */</span><span class="WHIT">
<span class='line'>1756</span> </span><span class="WHIT">		</span><span class="NAME">_wrap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">wrappedFunction</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newFunction</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">returnOnThisValue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1757</span> </span><span class="WHIT">			</span><span class="NAME">wrappedFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">wrappedFunction</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1758</span> </span><span class="WHIT">			</span><span class="NAME">newFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newFunction</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1759</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1760</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1761</span> </span><span class="WHIT">				</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1762</span> </span><span class="WHIT">					</span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newFunction.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1763</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1764</span> </span><span class="WHIT">					</span><span class="NAME">_log</span><span class="PUNC">(</span><span class="NAME">_currentInstance</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"jsPlumb function failed : "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1765</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1766</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">returnOnThisValue</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">returnOnThisValue</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1767</span> </span><span class="WHIT">					</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1768</span> </span><span class="WHIT">						</span><span class="NAME">wrappedFunction.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1769</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1770</span> </span><span class="WHIT">						</span><span class="NAME">_log</span><span class="PUNC">(</span><span class="NAME">_currentInstance</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"wrapped function failed : "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1771</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1772</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1773</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1774</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1775</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1776</span> 
<span class='line'>1777</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1778</span> 		 * Property: connectorClass 
<span class='line'>1779</span> 		 *   The CSS class to set on Connection elements. This value is a String and can have multiple classes; the entire String is appended as-is.
<span class='line'>1780</span> 		 */</span><span class="WHIT">
<span class='line'>1781</span> </span><span class="WHIT">		</span><span class="NAME">this.connectorClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"_jsPlumb_connector"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1782</span> 
<span class='line'>1783</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1784</span> 		 * Property: endpointClass 
<span class='line'>1785</span> 		 *   The CSS class to set on Endpoint elements. This value is a String and can have multiple classes; the entire String is appended as-is.
<span class='line'>1786</span> 		 */</span><span class="WHIT">
<span class='line'>1787</span> </span><span class="WHIT">		</span><span class="NAME">this.endpointClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"_jsPlumb_endpoint"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1788</span> 
<span class='line'>1789</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1790</span> 		 * Property: overlayClass 
<span class='line'>1791</span> 		 * The CSS class to set on an Overlay that is an HTML element. This value is a String and can have multiple classes; the entire String is appended as-is.
<span class='line'>1792</span> 		 */</span><span class="WHIT">
<span class='line'>1793</span> </span><span class="WHIT">		</span><span class="NAME">this.overlayClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"_jsPlumb_overlay"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1794</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1795</span> </span><span class="WHIT">		</span><span class="NAME">this.Anchors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1796</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1797</span> </span><span class="WHIT">		</span><span class="NAME">this.Connectors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1798</span> </span><span class="WHIT">			</span><span class="STRN">"canvas"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1799</span> </span><span class="WHIT">			</span><span class="STRN">"svg"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1800</span> </span><span class="WHIT">			</span><span class="STRN">"vml"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1801</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1802</span> 
<span class='line'>1803</span> </span><span class="WHIT">		</span><span class="NAME">this.Endpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1804</span> </span><span class="WHIT">			</span><span class="STRN">"canvas"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1805</span> </span><span class="WHIT">			</span><span class="STRN">"svg"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1806</span> </span><span class="WHIT">			</span><span class="STRN">"vml"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1807</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1808</span> 
<span class='line'>1809</span> </span><span class="WHIT">		</span><span class="NAME">this.Overlays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1810</span> </span><span class="WHIT">			</span><span class="STRN">"canvas"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1811</span> </span><span class="WHIT">			</span><span class="STRN">"svg"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1812</span> </span><span class="WHIT">			</span><span class="STRN">"vml"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1813</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1814</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1815</span> </span><span class="COMM">// ************************ PLACEHOLDER DOC ENTRIES FOR NATURAL DOCS *****************************************</span><span class="WHIT">
<span class='line'>1816</span> 
<span class='line'>1817</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1818</span> 		* Function: importDefaults
<span class='line'>1819</span> 		* Imports all the given defaults into this instance of jsPlumb.		
<span class='line'>1820</span> 		*/</span><span class="WHIT">
<span class='line'>1821</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1822</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1823</span> 		* Function: restoreDefaults
<span class='line'>1824</span> 		* Restores the default settings to "factory" values.
<span class='line'>1825</span> 		*/</span><span class="WHIT">
<span class='line'>1826</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1827</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1828</span> 		 * Function: bind
<span class='line'>1829</span> 		 * Bind to an event on jsPlumb.  
<span class='line'>1830</span> 		 * 
<span class='line'>1831</span> 		 * Parameters:
<span class='line'>1832</span> 		 * 	event - the event to bind.  Available events on jsPlumb are:
<span class='line'>1833</span> 		 *         - *jsPlumbConnection* 			: 	notification that a new Connection was established.  jsPlumb passes the new Connection to the callback.
<span class='line'>1834</span> 		 *         - *jsPlumbConnectionDetached* 	: 	notification that a Connection was detached.  jsPlumb passes the detached Connection to the callback.
<span class='line'>1835</span> 		 *         - *click*						:	notification that a Connection was clicked.  jsPlumb passes the Connection that was clicked to the callback.
<span class='line'>1836</span> 		 *         - *dblclick*						:	notification that a Connection was double clicked.  jsPlumb passes the Connection that was double clicked to the callback.
<span class='line'>1837</span> 		 *         - *endpointClick*				:	notification that an Endpoint was clicked.  jsPlumb passes the Endpoint that was clicked to the callback.
<span class='line'>1838</span> 		 *         - *endpointDblClick*				:	notification that an Endpoint was double clicked.  jsPlumb passes the Endpoint that was double clicked to the callback.
<span class='line'>1839</span> 		 *         - *beforeDrop*					: 	notification that a Connection is about to be dropped. Returning false from this method cancels the drop. jsPlumb passes { sourceId, targetId, scope, connection, dropEndpoint } to your callback. For more information, refer to the jsPlumb documentation.
<span class='line'>1840</span> 		 *         - *beforeDetach*					: 	notification that a Connection is about to be detached. Returning false from this method cancels the detach. jsPlumb passes the Connection to your callback. For more information, refer to the jsPlumb documentation.
<span class='line'>1841</span> 		 *		   - *connectionDrag* 				:   notification that an existing Connection is being dragged. jsPlumb passes the Connection to your callback function.
<span class='line'>1842</span> 		 *         - *connectionDragEnd*            :   notification that the drag of an existing Connection has ended.  jsPlumb passes the Connection to your callback function.
<span class='line'>1843</span> 		 *         
<span class='line'>1844</span> 		 *  callback - function to callback. This function will be passed the Connection/Endpoint that caused the event, and also the original event.    
<span class='line'>1845</span> 		 */</span><span class="WHIT">
<span class='line'>1846</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1847</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1848</span> 		 * Function: unbind
<span class='line'>1849</span> 		 * Clears either all listeners, or listeners for some specific event.
<span class='line'>1850</span> 		 * 
<span class='line'>1851</span> 		 * Parameters:
<span class='line'>1852</span> 		 * 	event	-	optional. constrains the clear to just listeners for this event.
<span class='line'>1853</span> 		 */</span><span class="WHIT">
<span class='line'>1854</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1855</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1856</span> 		* Function: addClass
<span class='line'>1857</span> 		* Add class(es) to some element(s).
<span class='line'>1858</span> 		*
<span class='line'>1859</span> 		* Parameters:
<span class='line'>1860</span> 		* 	el			-	element id, dom element, or selector representing the element(s) to add class(es) to.
<span class='line'>1861</span> 		* 	clazz		-	string representing the class(es) to add. may contain multiple classes separated by spaces.
<span class='line'>1862</span> 		*/</span><span class="WHIT">
<span class='line'>1863</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1864</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1865</span> 		* Function: removeClass
<span class='line'>1866</span> 		* Remove class from some selement(s).
<span class='line'>1867</span> 		*
<span class='line'>1868</span> 		* Parameters:
<span class='line'>1869</span> 		* 	el			-	element id, dom element, or selector representing the element(s) to remove a class from.
<span class='line'>1870</span> 		* 	clazz		-	string representing the class to remove. 
<span class='line'>1871</span> 		*/</span><span class="WHIT">
<span class='line'>1872</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1873</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1874</span> 		* Function: hasClass
<span class='line'>1875</span> 		* Checks if an element has some class.
<span class='line'>1876</span> 		*
<span class='line'>1877</span> 		* Parameters:
<span class='line'>1878</span> 		* 	el			-	element id, dom element, or selector representing the element to test. If the selector matches multiple elements, we return the test for the first element in the selector only.
<span class='line'>1879</span> 		* 	clazz		-	string representing the class to test for. 
<span class='line'>1880</span> 		*/</span><span class="WHIT">
<span class='line'>1881</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1882</span> </span><span class="COMM">// *************** END OF PLACEHOLDER DOC ENTRIES FOR NATURAL DOCS ***********************************************************		</span><span class="WHIT">
<span class='line'>1883</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1884</span> 
<span class='line'>1885</span> </span><span class="COMM">// --------------------------- jsPLumbInstance public API ---------------------------------------------------------</span><span class="WHIT">
<span class='line'>1886</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1887</span> </span><span class="WHIT">		</span><span class="NAME">this.addClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.addClass</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1888</span> </span><span class="WHIT">		</span><span class="NAME">this.removeClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.removeClass</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1889</span> </span><span class="WHIT">		</span><span class="NAME">this.hasClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.hasClass</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1890</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1891</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1892</span> 		  Function: addEndpoint 
<span class='line'>1893</span> 		  	
<span class='line'>1894</span> 		  Adds an &lt;Endpoint> to a given element or elements.
<span class='line'>1895</span> 		  			  
<span class='line'>1896</span> 		  Parameters:
<span class='line'>1897</span> 		   
<span class='line'>1898</span> 		  	el - Element to add the endpoint to. Either an element id, a selector representing some element(s), or an array of either of these. 
<span class='line'>1899</span> 		  	params - Object containing Endpoint constructor arguments.  For more information, see &lt;Endpoint>.
<span class='line'>1900</span> 		  	referenceParams - Object containing more Endpoint constructor arguments; it will be merged with params by jsPlumb.  You would use this if you had some 
<span class='line'>1901</span> 		  					  shared parameters that you wanted to reuse when you added Endpoints to a number of elements. The allowed values in
<span class='line'>1902</span> 		  					  this object are anything that 'params' can contain.  See &lt;Endpoint>.
<span class='line'>1903</span> 		  	 
<span class='line'>1904</span> 		  Returns: 
<span class='line'>1905</span> 		  	The newly created &lt;Endpoint>, if el referred to a single element.  Otherwise, an array of newly created &lt;Endpoint>s. 
<span class='line'>1906</span> 		  	
<span class='line'>1907</span> 		  See Also: 
<span class='line'>1908</span> 		  	&lt;addEndpoints>
<span class='line'>1909</span> 		 */</span><span class="WHIT">
<span class='line'>1910</span> </span><span class="WHIT">		</span><span class="NAME">this.addEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1911</span> </span><span class="WHIT">			</span><span class="NAME">referenceParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1912</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1913</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1914</span> </span><span class="WHIT">			</span><span class="NAME">p.endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.endpoint</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.Endpoint</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.Endpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1915</span> </span><span class="WHIT">			</span><span class="NAME">p.paintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.paintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.EndpointStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.EndpointStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1916</span> </span><span class="WHIT">            </span><span class="COMM">// YUI wrapper</span><span class="WHIT">
<span class='line'>1917</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_convertYUICollection</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1918</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1919</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">results</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">inputs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el.length</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">el.constructor</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">String</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1920</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>1921</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">inputs.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1922</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">inputs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1923</span> </span><span class="WHIT">				</span><span class="NAME">p.source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_el</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1924</span> </span><span class="WHIT">                </span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">_suspendedAt</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1925</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_newEndpoint</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1926</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p.parentAnchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">e.parentAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.parentAnchor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1927</span> </span><span class="WHIT">				</span><span class="NAME">_addToList</span><span class="PUNC">(</span><span class="NAME">endpointsByElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1928</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myWH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1929</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">anchorLoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e.anchor.compute</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">myOffset.left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myOffset.top</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myWH</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">_suspendedAt</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1930</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endpointPaintParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">anchorLoc</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">anchorLoc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">_suspendedAt</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1931</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_suspendDrawing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">endpointPaintParams.recalc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1932</span> </span><span class="WHIT">				</span><span class="NAME">e.paint</span><span class="PUNC">(</span><span class="NAME">endpointPaintParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1933</span> </span><span class="WHIT">				</span><span class="NAME">results.push</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1934</span> </span><span class="WHIT">				</span><span class="COMM">//if (!jsPlumbAdapter.headless)</span><span class="WHIT">
<span class='line'>1935</span> </span><span class="WHIT">					</span><span class="COMM">//_currentInstance.dragManager.endpointAdded(_el);</span><span class="WHIT">
<span class='line'>1936</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1937</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1938</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">results.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1939</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1940</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1941</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1942</span> 		  Function: addEndpoints 
<span class='line'>1943</span> 		  Adds a list of &lt;Endpoint>s to a given element or elements.
<span class='line'>1944</span> 		  
<span class='line'>1945</span> 		  Parameters: 
<span class='line'>1946</span> 		  	target - element to add the Endpoint to. Either an element id, a selector representing some element(s), or an array of either of these. 
<span class='line'>1947</span> 		  	endpoints - List of objects containing Endpoint constructor arguments. one Endpoint is created for each entry in this list.  See &lt;Endpoint>'s constructor documentation. 
<span class='line'>1948</span> 			referenceParams - Object containing more Endpoint constructor arguments; it will be merged with params by jsPlumb.  You would use this if you had some shared parameters that you wanted to reuse when you added Endpoints to a number of elements.		  	 
<span class='line'>1949</span> 
<span class='line'>1950</span> 		  Returns: 
<span class='line'>1951</span> 		  	List of newly created &lt;Endpoint>s, one for each entry in the 'endpoints' argument. 
<span class='line'>1952</span> 		  	
<span class='line'>1953</span> 		  See Also:
<span class='line'>1954</span> 		  	&lt;addEndpoint>
<span class='line'>1955</span> 		 */</span><span class="WHIT">
<span class='line'>1956</span> </span><span class="WHIT">		</span><span class="NAME">this.addEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpoints</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1957</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">results</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1958</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpoints.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1959</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.addEndpoint</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1960</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isArray</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1961</span> </span><span class="WHIT">					</span><span class="NAME">Array.prototype.push.apply</span><span class="PUNC">(</span><span class="NAME">results</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1962</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">results.push</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1963</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1964</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1965</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1966</span> 
<span class='line'>1967</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1968</span> 		  Function: animate 
<span class='line'>1969</span> 		  This is a wrapper around the supporting library's animate function; it injects a call to jsPlumb in the 'step' function (creating
<span class='line'>1970</span> 		  the 'step' function if necessary). This only supports the two-arg version of the animate call in jQuery, the one that takes an 'options' object as
<span class='line'>1971</span> 		  the second arg. MooTools has only one method, a two arg one. Which is handy.  YUI has a one-arg method, so jsPlumb merges 'properties' and 'options' together for YUI.
<span class='line'>1972</span> 		   
<span class='line'>1973</span> 		  Parameters: 
<span class='line'>1974</span> 		  	el - Element to animate. Either an id, or a selector representing the element. 
<span class='line'>1975</span> 		  	properties - The 'properties' argument you want passed to the library's animate call. 
<span class='line'>1976</span> 		   	options - The 'options' argument you want passed to the library's animate call.
<span class='line'>1977</span> 		    
<span class='line'>1978</span> 		  Returns: 
<span class='line'>1979</span> 		  	void
<span class='line'>1980</span> 		 */</span><span class="WHIT">
<span class='line'>1981</span> </span><span class="WHIT">		</span><span class="NAME">this.animate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">properties</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1982</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ele</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1983</span> </span><span class="WHIT">			</span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1984</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">stepFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.dragEvents</span><span class="PUNC">[</span><span class="STRN">'step'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1985</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">completeFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.dragEvents</span><span class="PUNC">[</span><span class="STRN">'complete'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1986</span> </span><span class="WHIT">			</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">stepFunction</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">stepFunction</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1987</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.repaint</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1988</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1989</span> 
<span class='line'>1990</span> </span><span class="WHIT">			</span><span class="COMM">// onComplete repaints, just to make sure everything looks good at the end of the animation.</span><span class="WHIT">
<span class='line'>1991</span> </span><span class="WHIT">			</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">completeFunction</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">completeFunction</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1992</span> </span><span class="WHIT">					</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1993</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.repaint</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1994</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1995</span> 
<span class='line'>1996</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.CurrentLibrary.animate</span><span class="PUNC">(</span><span class="NAME">ele</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">properties</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1997</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1998</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1999</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>2000</span> 		* checks for a listener for the given condition, executing it if found, passing in the given value.
<span class='line'>2001</span> 		* condition listeners would have been attached using "bind" (which is, you could argue, now overloaded, since
<span class='line'>2002</span> 		* firing click events etc is a bit different to what this does).  i thought about adding a "bindCondition"
<span class='line'>2003</span> 		* or something, but decided against it, for the sake of simplicity. jsPlumb will never fire one of these
<span class='line'>2004</span> 		* condition events anyway.
<span class='line'>2005</span> 		*/</span><span class="WHIT">
<span class='line'>2006</span> </span><span class="WHIT">		</span><span class="NAME">this.checkCondition</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">conditionName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2007</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getListener</span><span class="PUNC">(</span><span class="NAME">conditionName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2008</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2009</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">l.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2010</span> </span><span class="WHIT">				</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2011</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">l.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2012</span> </span><span class="WHIT">						</span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2013</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2014</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2015</span> </span><span class="WHIT">				</span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2016</span> </span><span class="WHIT">					</span><span class="NAME">_log</span><span class="PUNC">(</span><span class="NAME">_currentInstance</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"cannot check condition ["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">conditionName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"]"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2017</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2018</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2019</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2020</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2021</span> 
<span class='line'>2022</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2023</span> 		  Function: connect 
<span class='line'>2024</span> 		  Establishes a &lt;Connection> between two elements (or &lt;Endpoint>s, which are themselves registered to elements).
<span class='line'>2025</span> 		  
<span class='line'>2026</span> 		  Parameters: 
<span class='line'>2027</span> 		    params - Object containing constructor arguments for the Connection. See &lt;Connection>'s constructor documentation.
<span class='line'>2028</span> 		    referenceParams - Optional object containing more constructor arguments for the Connection. Typically you would pass in data that a lot of 
<span class='line'>2029</span> 		    Connections are sharing here, such as connector style etc, and then use the main params for data specific to this Connection.
<span class='line'>2030</span> 		     
<span class='line'>2031</span> 		  Returns: 
<span class='line'>2032</span> 		  	The newly created &lt;Connection>.
<span class='line'>2033</span> 		 */</span><span class="WHIT">
<span class='line'>2034</span> </span><span class="WHIT">		</span><span class="NAME">this.connect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2035</span> </span><span class="WHIT">			</span><span class="COMM">// prepare a final set of parameters to create connection with</span><span class="WHIT">
<span class='line'>2036</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_prepareConnectionParams</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2037</span> </span><span class="WHIT">			</span><span class="COMM">// TODO probably a nicer return value if the connection was not made.  _prepareConnectionParams</span><span class="WHIT">
<span class='line'>2038</span> </span><span class="WHIT">			</span><span class="COMM">// will return null (and log something) if either endpoint was full.  what would be nicer is to </span><span class="WHIT">
<span class='line'>2039</span> </span><span class="WHIT">			</span><span class="COMM">// create a dedicated 'error' object.</span><span class="WHIT">
<span class='line'>2040</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2041</span> </span><span class="WHIT">				</span><span class="COMM">// a connect call will delete its created endpoints on detach, unless otherwise specified.</span><span class="WHIT">
<span class='line'>2042</span> </span><span class="WHIT">				</span><span class="COMM">// this is because the endpoints belong to this connection only, and are no use to</span><span class="WHIT">
<span class='line'>2043</span> </span><span class="WHIT">				</span><span class="COMM">// anyone else, so they hang around like a bad smell.</span><span class="WHIT">
<span class='line'>2044</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.deleteEndpointsOnDetach</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2045</span> </span><span class="WHIT">					</span><span class="NAME">_p.deleteEndpointsOnDetach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2046</span> 
<span class='line'>2047</span> </span><span class="WHIT">				</span><span class="COMM">// create the connection.  it is not yet registered </span><span class="WHIT">
<span class='line'>2048</span> </span><span class="WHIT">				</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_newConnection</span><span class="PUNC">(</span><span class="NAME">_p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2049</span> </span><span class="WHIT">				</span><span class="COMM">// now add it the model, fire an event, and redraw</span><span class="WHIT">
<span class='line'>2050</span> </span><span class="WHIT">				</span><span class="NAME">_finaliseConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">										</span><span class="WHIT">
<span class='line'>2051</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2052</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2053</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2054</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2055</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2056</span> 		 Function: deleteEndpoint		 
<span class='line'>2057</span> 		 Deletes an Endpoint and removes all Connections it has (which removes the Connections from the other Endpoints involved too)
<span class='line'>2058</span> 		 
<span class='line'>2059</span> 		 Parameters:
<span class='line'>2060</span> 		 	object - either an &lt;Endpoint> object (such as from an addEndpoint call), or a String UUID.
<span class='line'>2061</span> 		 	
<span class='line'>2062</span> 		 Returns:
<span class='line'>2063</span> 		 	void		  
<span class='line'>2064</span> 		 */</span><span class="WHIT">
<span class='line'>2065</span> </span><span class="WHIT">		</span><span class="NAME">this.deleteEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2066</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">object</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">endpointsByUUID</span><span class="PUNC">[</span><span class="NAME">object</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">object</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2067</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2068</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">uuid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpoint.getUuid</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2069</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uuid</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">endpointsByUUID</span><span class="PUNC">[</span><span class="NAME">uuid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2070</span> </span><span class="WHIT">				</span><span class="NAME">endpoint.detachAll</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2071</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endpoint.endpoint.cleanup</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">endpoint.endpoint.cleanup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2072</span> </span><span class="WHIT">				</span><span class="NAME">_removeElements</span><span class="PUNC">(</span><span class="NAME">endpoint.endpoint.getDisplayElements</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2073</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.anchorManager.deleteEndpoint</span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2074</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2075</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2076</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endpoints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2077</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2078</span> </span><span class="WHIT">						</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpoints.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2079</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">newEndpoints.push</span><span class="PUNC">(</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2080</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>2081</span> </span><span class="WHIT">						</span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newEndpoints</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2082</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2083</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2084</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">jsPlumbAdapter.headless</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2085</span> </span><span class="WHIT">					</span><span class="NAME">_currentInstance.dragManager.endpointDeleted</span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>2086</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">									</span><span class="WHIT">
<span class='line'>2087</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2088</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2089</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2090</span> 		 Function: deleteEveryEndpoint
<span class='line'>2091</span> 		  Deletes every &lt;Endpoint>, and their associated &lt;Connection>s, in this instance of jsPlumb. Does not unregister any event listeners (this is the only difference
<span class='line'>2092</span> between this method and jsPlumb.reset).  
<span class='line'>2093</span> 		  
<span class='line'>2094</span> 		 Returns: 
<span class='line'>2095</span> 		 	void 
<span class='line'>2096</span> 		 */</span><span class="WHIT">
<span class='line'>2097</span> </span><span class="WHIT">		</span><span class="NAME">this.deleteEveryEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2098</span> </span><span class="WHIT">			</span><span class="NAME">_currentInstance.setSuspendDrawing</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2099</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2100</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2101</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endpoints</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">endpoints.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2102</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpoints.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2103</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.deleteEndpoint</span><span class="PUNC">(</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2104</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2105</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2106</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2107</span> </span><span class="WHIT">			</span><span class="NAME">endpointsByElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2108</span> </span><span class="WHIT">			</span><span class="NAME">endpointsByUUID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2109</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2110</span> </span><span class="WHIT">			</span><span class="NAME">_currentInstance.setSuspendDrawing</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2111</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2112</span> 
<span class='line'>2113</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fireDetachEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doFireEvent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2114</span> </span><span class="WHIT">            </span><span class="COMM">// may have been given a connection, or in special cases, an object</span><span class="WHIT">
<span class='line'>2115</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">connType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">_currentInstance.Defaults.ConnectionType</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getDefaultConnectionType</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2116</span> </span><span class="WHIT">                </span><span class="NAME">argIsConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">connType</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2117</span> </span><span class="WHIT">                </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">argIsConnection</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2118</span> </span><span class="WHIT">                    </span><span class="NAME">connection</span><span class="PUNC">:</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2119</span> </span><span class="WHIT">				    </span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.source</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">target</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.target</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2120</span> </span><span class="WHIT">				    </span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.targetId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2121</span> </span><span class="WHIT">				    </span><span class="NAME">sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>2122</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2123</span> 
<span class='line'>2124</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">doFireEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2125</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.fire</span><span class="PUNC">(</span><span class="STRN">"jsPlumbConnectionDetached"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2126</span> </span><span class="WHIT">				</span><span class="COMM">// introduced in 1.3.11..an alias because the original event name is unwieldy.  in future versions this will be the only event and the other will no longer be fired.</span><span class="WHIT">
<span class='line'>2127</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.fire</span><span class="PUNC">(</span><span class="STRN">"connectionDetached"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2128</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2129</span> </span><span class="WHIT">            </span><span class="NAME">_currentInstance.anchorManager.connectionDetached</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2130</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2131</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>2132</span> 			fires an event to indicate an existing connection is being dragged.
<span class='line'>2133</span> 		*/</span><span class="WHIT">
<span class='line'>2134</span> </span><span class="WHIT">		</span><span class="NAME">fireConnectionDraggingEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2135</span> </span><span class="WHIT">			</span><span class="NAME">_currentInstance.fire</span><span class="PUNC">(</span><span class="STRN">"connectionDrag"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>2136</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2137</span> </span><span class="WHIT">		</span><span class="NAME">fireConnectionDragStopEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2138</span> </span><span class="WHIT">			</span><span class="NAME">_currentInstance.fire</span><span class="PUNC">(</span><span class="STRN">"connectionDragStop"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2139</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2140</span> 
<span class='line'>2141</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2142</span> 		  Function: detach 
<span class='line'>2143</span> 		  Detaches and then removes a &lt;Connection>.  
<span class='line'>2144</span> 		  		   
<span class='line'>2145</span> 		  Parameters: 
<span class='line'>2146</span> 		    connection  -   the &lt;Connection> to detach
<span class='line'>2147</span> 		    params      -   optional parameters to the detach call.  valid values here are
<span class='line'>2148</span> 		                    fireEvent   :   defaults to false; indicates you want jsPlumb to fire a connection
<span class='line'>2149</span> 		                                    detached event. The thinking behind this is that if you made a programmatic
<span class='line'>2150</span> 		                                    call to detach an event, you probably don't need the callback.
<span class='line'>2151</span> 		                    forceDetach :   defaults to false. allows you to override any beforeDetach listeners that may be registered.
<span class='line'>2152</span> 
<span class='line'>2153</span> 		    Returns: 
<span class='line'>2154</span> 		    	true if successful, false if not.
<span class='line'>2155</span> 		 */</span><span class="WHIT">
<span class='line'>2156</span> </span><span class="WHIT">		</span><span class="NAME">this.detach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2157</span> 
<span class='line'>2158</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2159</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">connType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">_currentInstance.Defaults.ConnectionType</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getDefaultConnectionType</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2160</span> </span><span class="WHIT">                </span><span class="NAME">firstArgIsConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">connType</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2161</span> </span><span class="WHIT">                </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">firstArgIsConnection</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2162</span> </span><span class="WHIT">                </span><span class="NAME">fireEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.fireEvent</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2163</span> </span><span class="WHIT">                </span><span class="NAME">forceDetach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.forceDetach</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2164</span> </span><span class="WHIT">                </span><span class="NAME">connection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">firstArgIsConnection</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">params.connection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2165</span> 
<span class='line'>2166</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2167</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">forceDetach</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">connection.isDetachAllowed</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2168</span> </span><span class="WHIT">                                        </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">connection.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isDetachAllowed</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2169</span> </span><span class="WHIT">                                        </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">connection.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isDetachAllowed</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2170</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">forceDetach</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.checkCondition</span><span class="PUNC">(</span><span class="STRN">"beforeDetach"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connection</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2171</span> </span><span class="WHIT">						    </span><span class="NAME">connection.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">detach</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fireEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// TODO check this param iscorrect for endpoint's detach method</span><span class="WHIT">
<span class='line'>2172</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2173</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2174</span> </span><span class="WHIT">                </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2175</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// a backwards compatibility hack: source should be thought of as 'params' in this case.</span><span class="WHIT">
<span class='line'>2176</span> </span><span class="WHIT">					</span><span class="COMM">// test for endpoint uuids to detach</span><span class="WHIT">
<span class='line'>2177</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.uuids</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2178</span> </span><span class="WHIT">						</span><span class="NAME">_getEndpoint</span><span class="PUNC">(</span><span class="NAME">_p.uuids</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">detachFrom</span><span class="PUNC">(</span><span class="NAME">_getEndpoint</span><span class="PUNC">(</span><span class="NAME">_p.uuids</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fireEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2179</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_p.targetEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2180</span> </span><span class="WHIT">						</span><span class="NAME">_p.sourceEndpoint.detachFrom</span><span class="PUNC">(</span><span class="NAME">_p.targetEndpoint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2181</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2182</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">_p.source</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2183</span> </span><span class="WHIT">						    </span><span class="NAME">targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">_p.target</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2184</span> </span><span class="WHIT">						</span><span class="NAME">_operation</span><span class="PUNC">(</span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2185</span> </span><span class="WHIT">						    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">jpc.sourceId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">jpc.targetId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.targetId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">jpc.sourceId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2186</span> </span><span class="WHIT">							    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_currentInstance.checkCondition</span><span class="PUNC">(</span><span class="STRN">"beforeDetach"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2187</span> </span><span class="WHIT">                                    </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">detach</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fireEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2188</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2189</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2190</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2191</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2192</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2193</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2194</span> 
<span class='line'>2195</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2196</span> 		  Function: detachAllConnections
<span class='line'>2197</span> 		  Removes all an element's Connections.
<span class='line'>2198</span> 		   
<span class='line'>2199</span> 		  Parameters:
<span class='line'>2200</span> 		  	el - either the id of the element, or a selector for the element.
<span class='line'>2201</span> 		  	params - optional parameters.  alowed values:
<span class='line'>2202</span> 		  	        fireEvent : defaults to true, whether or not to fire the detach event.
<span class='line'>2203</span> 		  	
<span class='line'>2204</span> 		  Returns: 
<span class='line'>2205</span> 		  	void
<span class='line'>2206</span> 		 */</span><span class="WHIT">
<span class='line'>2207</span> </span><span class="WHIT">		</span><span class="NAME">this.detachAllConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2208</span> </span><span class="WHIT">            </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2209</span> </span><span class="WHIT">            </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2210</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2211</span> </span><span class="WHIT">                </span><span class="NAME">endpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2212</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endpoints</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">endpoints.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2213</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpoints.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2214</span> </span><span class="WHIT">					</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">detachAll</span><span class="PUNC">(</span><span class="NAME">params.fireEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2215</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2216</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2217</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2218</span> 
<span class='line'>2219</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2220</span> 		  Function: detachEveryConnection 
<span class='line'>2221</span> 		  Remove all Connections from all elements, but leaves Endpoints in place.
<span class='line'>2222</span> 
<span class='line'>2223</span> 		  Parameters:
<span class='line'>2224</span> 		    params  - optional params object containing:
<span class='line'>2225</span> 		            fireEvent : whether or not to fire detach events. defaults to true.
<span class='line'>2226</span> 
<span class='line'>2227</span> 		   
<span class='line'>2228</span> 		  Returns: 
<span class='line'>2229</span> 		  	void
<span class='line'>2230</span> 		  	 
<span class='line'>2231</span> 		  See Also:
<span class='line'>2232</span> 		  	&lt;removeEveryEndpoint>
<span class='line'>2233</span> 		 */</span><span class="WHIT">
<span class='line'>2234</span> </span><span class="WHIT">		</span><span class="NAME">this.detachEveryConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2235</span> </span><span class="WHIT">            </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2236</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2237</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2238</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endpoints</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">endpoints.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2239</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpoints.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2240</span> </span><span class="WHIT">						</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">detachAll</span><span class="PUNC">(</span><span class="NAME">params.fireEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2241</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2242</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2243</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2244</span> </span><span class="WHIT">			</span><span class="NAME">connectionsByScope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2245</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2246</span> 
<span class='line'>2247</span> 
<span class='line'>2248</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2249</span> 		  Function: draggable 
<span class='line'>2250</span> 		  Initialises the draggability of some element or elements.  You should use this instead of your 
<span class='line'>2251</span> 		  library's draggable method so that jsPlumb can setup the appropriate callbacks.  Your 
<span class='line'>2252</span> 		  underlying library's drag method is always called from this method.
<span class='line'>2253</span> 		  
<span class='line'>2254</span> 		  Parameters: 
<span class='line'>2255</span> 		  	el - either an element id, a list of element ids, or a selector. 
<span class='line'>2256</span> 		  	options - options to pass through to the underlying library
<span class='line'>2257</span> 		  	 
<span class='line'>2258</span> 		  Returns: 
<span class='line'>2259</span> 		  	void
<span class='line'>2260</span> 		 */</span><span class="WHIT">		 </span><span class="WHIT">
<span class='line'>2261</span> </span><span class="WHIT">		</span><span class="NAME">this.draggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2262</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">el.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2263</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">el.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2264</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ele</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2265</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ele</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_initDraggableIfNecessary</span><span class="PUNC">(</span><span class="NAME">ele</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2266</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2267</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2268</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el._nodes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> 	</span><span class="COMM">// TODO this is YUI specific; really the logic should be forced</span><span class="WHIT">
<span class='line'>2269</span> </span><span class="WHIT">				</span><span class="COMM">// into the library adapters (for jquery and mootools aswell)</span><span class="WHIT">
<span class='line'>2270</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">el._nodes.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2271</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ele</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el._nodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2272</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ele</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_initDraggableIfNecessary</span><span class="PUNC">(</span><span class="NAME">ele</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2273</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2274</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2275</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2276</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ele</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2277</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ele</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_initDraggableIfNecessary</span><span class="PUNC">(</span><span class="NAME">ele</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2278</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2279</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2280</span> 
<span class='line'>2281</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2282</span> 		  Function: extend 
<span class='line'>2283</span> 		  Wraps the underlying library's extend functionality.
<span class='line'>2284</span> 		  
<span class='line'>2285</span> 		  Parameters: 
<span class='line'>2286</span> 		  	o1 - object to extend 
<span class='line'>2287</span> 		  	o2 - object to extend o1 with
<span class='line'>2288</span> 		  	
<span class='line'>2289</span> 		  Returns: 
<span class='line'>2290</span> 		  	o1, extended with all properties from o2.
<span class='line'>2291</span> 		 */</span><span class="WHIT">
<span class='line'>2292</span> </span><span class="WHIT">		</span><span class="NAME">this.extend</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2293</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.extend</span><span class="PUNC">(</span><span class="NAME">o1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2294</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2295</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2296</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2297</span> 		 * Function: getDefaultEndpointType
<span class='line'>2298</span> 		 * 	Returns the default Endpoint type. Used when someone wants to subclass Endpoint and have jsPlumb return instances of their subclass.
<span class='line'>2299</span> 		 *  you would make a call like this in your class's constructor:
<span class='line'>2300</span> 		 *  
<span class='line'>2301</span> 		 *  : jsPlumb.getDefaultEndpointType().apply(this, arguments);
<span class='line'>2302</span> 		 *  
<span class='line'>2303</span> 		 * 
<span class='line'>2304</span> 		 * Returns:
<span class='line'>2305</span> 		 * 	the default Endpoint function used by jsPlumb.
<span class='line'>2306</span> 		 */</span><span class="WHIT">
<span class='line'>2307</span> </span><span class="WHIT">		</span><span class="NAME">this.getDefaultEndpointType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2308</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Endpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2309</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2310</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2311</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2312</span> 		 * Function: getDefaultConnectionType
<span class='line'>2313</span> 		 * 	Returns the default Connection type. Used when someone wants to subclass Connection and have jsPlumb return instances of their subclass.
<span class='line'>2314</span> 		 *  you would make a call like this in your class's constructor:
<span class='line'>2315</span> 		 *  
<span class='line'>2316</span> 		 *  : jsPlumb.getDefaultConnectionType().apply(this, arguments);
<span class='line'>2317</span> 		 * 
<span class='line'>2318</span> 		 * Returns:
<span class='line'>2319</span> 		 * 	the default Connection function used by jsPlumb.
<span class='line'>2320</span> 		 */</span><span class="WHIT">
<span class='line'>2321</span> </span><span class="WHIT">		</span><span class="NAME">this.getDefaultConnectionType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2322</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Connection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2323</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2324</span> 
<span class='line'>2325</span> </span><span class="WHIT">		</span><span class="COMM">// helpers for select/selectEndpoints</span><span class="WHIT">
<span class='line'>2326</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_setOperation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">selector</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2327</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">list.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2328</span> </span><span class="WHIT">					</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">func</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2329</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>2330</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">selector</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2331</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2332</span> </span><span class="WHIT">			</span><span class="NAME">_getOperation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2333</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">out</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2334</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">list.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2335</span> </span><span class="WHIT">					</span><span class="NAME">out.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">func</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2336</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>2337</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2338</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2339</span> </span><span class="WHIT">			</span><span class="NAME">setter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">selector</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2340</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2341</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_setOperation</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">selector</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2342</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2343</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2344</span> </span><span class="WHIT">			</span><span class="NAME">getter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2345</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2346</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_getOperation</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2347</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>2348</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2349</span> </span><span class="WHIT">			</span><span class="NAME">prepareList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotGetIds</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2350</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2351</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2352</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">input</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2353</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"*"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">input</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2354</span> </span><span class="WHIT">						</span><span class="NAME">r.push</span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2355</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2356</span> </span><span class="WHIT">					</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2357</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">doNotGetIds</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2358</span> </span><span class="WHIT">						</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2359</span> </span><span class="WHIT">							</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">input.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2360</span> </span><span class="WHIT">								</span><span class="NAME">r.push</span><span class="PUNC">(</span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2361</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>2362</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2363</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2364</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2365</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2366</span> </span><span class="WHIT">			</span><span class="NAME">filterList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">missingIsFalse</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2367</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">list</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"*"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2368</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">list.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_indexOf</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">missingIsFalse</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2369</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2370</span> 
<span class='line'>2371</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2372</span> 		 * Function: getConnections 
<span class='line'>2373</span> 		 * Gets all or a subset of connections currently managed by this jsPlumb instance.  If only one scope is passed in to this method,
<span class='line'>2374</span> 		 * the result will be a list of connections having that scope (passing in no scope at all will result in jsPlumb assuming you want the
<span class='line'>2375</span> 		 * default scope).
<span class='line'>2376</span> 		 *
<span class='line'>2377</span> 		 * If multiple scopes are passed in, the return value will be a map of
<span class='line'>2378</span> 		 *
<span class='line'>2379</span> 		 * : { scope -> [ connection... ] }
<span class='line'>2380</span> 		 * 
<span class='line'>2381</span> 		 *  Parameters:
<span class='line'>2382</span> 		 *  	scope	-	if the only argument to getConnections is a string, jsPlumb will treat that string as a scope filter, and return a list
<span class='line'>2383</span> 		 *                  of connections that are in the given scope. use '*' for all scopes.
<span class='line'>2384</span> 		 *      options	-	if the argument is a JS object, you can specify a finer-grained filter:
<span class='line'>2385</span> 		 *      
<span class='line'>2386</span> 		 *      		-	*scope* may be a string specifying a single scope, or an array of strings, specifying multiple scopes. Also may have the value '*', indicating any scope.
<span class='line'>2387</span> 		 *      		-	*source* either a string representing an element id, a selector, or an array of ids. Also may have the value '*', indicating any source.  Constrains the result to connections having this/these element(s) as source.
<span class='line'>2388</span> 		 *      		-	*target* either a string representing an element id, a selector, or an array of ids. Also may have the value '*', indicating any target.  Constrains the result to connections having this/these element(s) as target.		 
<span class='line'>2389</span> 		 *		flat    -	return results in a flat array (don't return an object whose keys are scopes and whose values are lists per scope).
<span class='line'>2390</span> 		 * 
<span class='line'>2391</span> 		 */</span><span class="WHIT">
<span class='line'>2392</span> </span><span class="WHIT">		</span><span class="NAME">this.getConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">flat</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2393</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2394</span> </span><span class="WHIT">				</span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2395</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">options.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2396</span> </span><span class="WHIT">				</span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="STRN">"scope"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2397</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2398</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT">
<span class='line'>2399</span> </span><span class="WHIT">			</span><span class="NAME">scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">options.scope</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getDefaultScope</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2400</span> </span><span class="WHIT">			</span><span class="NAME">scopes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prepareList</span><span class="PUNC">(</span><span class="NAME">scope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2401</span> </span><span class="WHIT">			</span><span class="NAME">sources</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prepareList</span><span class="PUNC">(</span><span class="NAME">options.source</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2402</span> </span><span class="WHIT">			</span><span class="NAME">targets</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prepareList</span><span class="PUNC">(</span><span class="NAME">options.target</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2403</span> </span><span class="WHIT">			</span><span class="NAME">results</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">flat</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">scopes.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2404</span> </span><span class="WHIT">			</span><span class="NAME">_addOne</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">scope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2405</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">flat</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">scopes.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2406</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ss</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">[</span><span class="NAME">scope</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2407</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ss</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2408</span> </span><span class="WHIT">						</span><span class="NAME">ss</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">[</span><span class="NAME">scope</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ss</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2409</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2410</span> </span><span class="WHIT">					</span><span class="NAME">ss.push</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2411</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">results.push</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2412</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2413</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">connectionsByScope</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2414</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">filterList</span><span class="PUNC">(</span><span class="NAME">scopes</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2415</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">connectionsByScope</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2416</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectionsByScope</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2417</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">filterList</span><span class="PUNC">(</span><span class="NAME">sources</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c.sourceId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">filterList</span><span class="PUNC">(</span><span class="NAME">targets</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c.targetId</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2418</span> </span><span class="WHIT">							</span><span class="NAME">_addOne</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2419</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2420</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2421</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2422</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2423</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2424</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2425</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_curryEach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2426</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2427</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">list.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2428</span> </span><span class="WHIT">						</span><span class="NAME">f</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2429</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2430</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2431</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2432</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2433</span> </span><span class="WHIT">			</span><span class="NAME">_curryGet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2434</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2435</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2436</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2437</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2438</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2439</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_makeCommonSelectHandler</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2440</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2441</span> </span><span class="WHIT">				</span><span class="COMM">// setters</span><span class="WHIT">
<span class='line'>2442</span> </span><span class="WHIT">				</span><span class="NAME">setHover</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setHover"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>2443</span> </span><span class="WHIT">				</span><span class="NAME">removeAllOverlays</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"removeAllOverlays"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2444</span> </span><span class="WHIT">				</span><span class="NAME">setLabel</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setLabel"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2445</span> </span><span class="WHIT">				</span><span class="NAME">addOverlay</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"addOverlay"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2446</span> </span><span class="WHIT">				</span><span class="NAME">removeOverlay</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"removeOverlay"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2447</span> </span><span class="WHIT">				</span><span class="NAME">removeOverlays</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"removeOverlays"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2448</span> </span><span class="WHIT">				</span><span class="NAME">showOverlay</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"showOverlay"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2449</span> </span><span class="WHIT">				</span><span class="NAME">hideOverlay</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"hideOverlay"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2450</span> </span><span class="WHIT">				</span><span class="NAME">showOverlays</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"showOverlays"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2451</span> </span><span class="WHIT">				</span><span class="NAME">hideOverlays</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"hideOverlays"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2452</span> </span><span class="WHIT">				</span><span class="NAME">setPaintStyle</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setPaintStyle"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2453</span> </span><span class="WHIT">				</span><span class="NAME">setHoverPaintStyle</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setHoverPaintStyle"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">									</span><span class="WHIT">
<span class='line'>2454</span> </span><span class="WHIT">				</span><span class="NAME">setParameter</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setParameter"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2455</span> </span><span class="WHIT">				</span><span class="NAME">setParameters</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setParameters"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2456</span> </span><span class="WHIT">				</span><span class="NAME">setVisible</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setVisible"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2457</span> </span><span class="WHIT">				</span><span class="NAME">setZIndex</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setZIndex"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2458</span> </span><span class="WHIT">				</span><span class="NAME">repaint</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"repaint"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2459</span> </span><span class="WHIT">				</span><span class="NAME">addType</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"addType"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2460</span> </span><span class="WHIT">				</span><span class="NAME">toggleType</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"toggleType"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2461</span> </span><span class="WHIT">				</span><span class="NAME">removeType</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"removeType"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2462</span> 
<span class='line'>2463</span> </span><span class="WHIT">				</span><span class="COMM">// getters</span><span class="WHIT">
<span class='line'>2464</span> </span><span class="WHIT">				</span><span class="NAME">getLabel</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"getLabel"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2465</span> </span><span class="WHIT">				</span><span class="NAME">getOverlay</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"getOverlay"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2466</span> </span><span class="WHIT">				</span><span class="NAME">isHover</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"isHover"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2467</span> </span><span class="WHIT">				</span><span class="NAME">getParameter</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"getParameter"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2468</span> </span><span class="WHIT">				</span><span class="NAME">getParameters</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"getParameters"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2469</span> </span><span class="WHIT">				</span><span class="NAME">getPaintStyle</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"getPaintStyle"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2470</span> </span><span class="WHIT">				</span><span class="NAME">getHoverPaintStyle</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"getHoverPaintStyle"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2471</span> </span><span class="WHIT">				</span><span class="NAME">isVisible</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"isVisible"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2472</span> </span><span class="WHIT">				</span><span class="NAME">getZIndex</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"getZIndex"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2473</span> </span><span class="WHIT">				</span><span class="NAME">hasType</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"hasType"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2474</span> </span><span class="WHIT">				</span><span class="NAME">getType</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"getType"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2475</span> 
<span class='line'>2476</span> </span><span class="WHIT">				</span><span class="COMM">// util</span><span class="WHIT">
<span class='line'>2477</span> </span><span class="WHIT">				</span><span class="NAME">length</span><span class="PUNC">:</span><span class="NAME">list.length</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2478</span> </span><span class="WHIT">				</span><span class="NAME">each</span><span class="PUNC">:</span><span class="NAME">_curryEach</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">executor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2479</span> </span><span class="WHIT">				</span><span class="NAME">get</span><span class="PUNC">:</span><span class="NAME">_curryGet</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2480</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2481</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2482</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2483</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2484</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT">	</span><span class="NAME">_makeConnectionSelectHandler</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2485</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">common</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_makeCommonSelectHandler</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2486</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.extend</span><span class="PUNC">(</span><span class="NAME">common</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2487</span> </span><span class="WHIT">				</span><span class="COMM">// setters									</span><span class="WHIT">
<span class='line'>2488</span> </span><span class="WHIT">				</span><span class="NAME">setDetachable</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setDetachable"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2489</span> </span><span class="WHIT">				</span><span class="NAME">setReattach</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setReattach"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2490</span> </span><span class="WHIT">				</span><span class="NAME">setConnector</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setConnector"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2491</span> </span><span class="WHIT">				</span><span class="NAME">detach</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2492</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">list.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2493</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.detach</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2494</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2495</span> </span><span class="WHIT">				</span><span class="COMM">// getters</span><span class="WHIT">
<span class='line'>2496</span> </span><span class="WHIT">				</span><span class="NAME">isDetachable</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"isDetachable"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2497</span> </span><span class="WHIT">				</span><span class="NAME">isReattach</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"isReattach"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2498</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2499</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2500</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2501</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT">	</span><span class="NAME">_makeEndpointSelectHandler</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2502</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">common</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_makeCommonSelectHandler</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeEndpointSelectHandler</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2503</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.extend</span><span class="PUNC">(</span><span class="NAME">common</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2504</span> </span><span class="WHIT">				</span><span class="NAME">setEnabled</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setEnabled"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeEndpointSelectHandler</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2505</span> </span><span class="WHIT">				</span><span class="NAME">isEnabled</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"isEnabled"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2506</span> </span><span class="WHIT">				</span><span class="NAME">detachAll</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2507</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">list.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2508</span> </span><span class="WHIT">						</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">detachAll</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2509</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2510</span> </span><span class="WHIT">				</span><span class="STRN">"delete"</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2511</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">list.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2512</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.deleteEndpoint</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2513</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2514</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2515</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2516</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2517</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2518</span> 		* Function: select
<span class='line'>2519</span> 		* Selects a set of Connections, using the filter options from the getConnections method, and returns an object
<span class='line'>2520</span> 		* that allows you to perform an operation on all of the Connections at once.
<span class='line'>2521</span> 		*
<span class='line'>2522</span> 		* The return value from any of these operations is the original list of Connections, allowing operations to be
<span class='line'>2523</span> 		* chained (for 'setter' type operations). 'getter' type operations return an array of values, where each entry is
<span class='line'>2524</span> 		* of the form:
<span class='line'>2525</span> 		*
<span class='line'>2526</span> 		* : [ Connection, return value ]
<span class='line'>2527</span> 		* 
<span class='line'>2528</span> 		* Parameters:
<span class='line'>2529</span> 		*	scope - see getConnections
<span class='line'>2530</span> 		* 	source - see getConnections
<span class='line'>2531</span> 		*	target - see getConnections
<span class='line'>2532</span> 		*
<span class='line'>2533</span> 		* Returns:
<span class='line'>2534</span> 		* A list of Connections on which operations may be executed. 'Setter' type operations can be chained; 'getter' type operations
<span class='line'>2535</span> 		* return an array of [Connection, value] pairs, one entry for each Connection in the list returned. The full list of operations 
<span class='line'>2536</span> 		* is as follows (where not specified, the operation's effect or return value is the same as the corresponding method on Connection) :
<span class='line'>2537</span> 		* 
<span class='line'>2538</span> 		*	-	setHover								
<span class='line'>2539</span> 		*	-	removeAllOverlays
<span class='line'>2540</span> 		*	-	setLabel
<span class='line'>2541</span> 		*	-	addOverlay
<span class='line'>2542</span> 		*	-	removeOverlay
<span class='line'>2543</span> 		*	-	removeOverlays
<span class='line'>2544</span> 		*	-	showOverlay
<span class='line'>2545</span> 		*	-	hideOverlay
<span class='line'>2546</span> 		*	-	showOverlays
<span class='line'>2547</span> 		*	-	hideOverlays
<span class='line'>2548</span> 		*	-	setPaintStyle
<span class='line'>2549</span> 		*	-	setHoverPaintStyle
<span class='line'>2550</span> 		*	-	setDetachable
<span class='line'>2551</span> 		*	- 	setReattach
<span class='line'>2552</span> 		*	-	setConnector
<span class='line'>2553</span> 		*	-	setParameter
<span class='line'>2554</span> 		*	-	setParameters
<span class='line'>2555</span> 		*   - 	getLabel
<span class='line'>2556</span> 		*	-	getOverlay
<span class='line'>2557</span> 		*	-	isHover
<span class='line'>2558</span> 		*	-	isDetachable
<span class='line'>2559</span> 		*	-	isReattach
<span class='line'>2560</span> 		*	-	getParameter
<span class='line'>2561</span> 		*	-	getParameters
<span class='line'>2562</span> 		*	-	getPaintStyle
<span class='line'>2563</span> 		*	-	getHoverPaintStyle
<span class='line'>2564</span> 		*	-	detach : detaches all the connections in the list. not chainable and does not return anything.
<span class='line'>2565</span> 		*	-	length : returns the length of the list.
<span class='line'>2566</span> 		*	-	get(index) : returns the Connection at 'index' in the list.
<span class='line'>2567</span> 		*	-	each(function(connection)...) : allows you to specify your own function to execute; this function is chainable.
<span class='line'>2568</span> 		*/</span><span class="WHIT">
<span class='line'>2569</span> </span><span class="WHIT">		</span><span class="NAME">this.select</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2570</span> </span><span class="WHIT">			</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2571</span> </span><span class="WHIT">			</span><span class="NAME">params.scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.scope</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">"*"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2572</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getConnections</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2573</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>2574</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2575</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2576</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2577</span> 		* Function: selectEndpoints
<span class='line'>2578</span> 		* Selects a set of Endpoints and returns an object that allows you to execute various different methods on them at once. The return 
<span class='line'>2579</span> 		* value from any of these operations is the original list of Endpoints, allowing operations to be chained (for 'setter' type 
<span class='line'>2580</span> 		* operations). 'getter' type operations return an array of values, where each entry is of the form:
<span class='line'>2581</span> 		*
<span class='line'>2582</span> 		* : [ Endpoint, return value ]
<span class='line'>2583</span> 		* 
<span class='line'>2584</span> 		* Parameters:
<span class='line'>2585</span> 		*	scope - either a string or an array of strings.
<span class='line'>2586</span> 		* 	source - either a string, a dom element, or a selector, or an array of any mix of these. limits returned endpoints to those that are declared as a source endpoint on any elements identified.
<span class='line'>2587</span> 		*	target - either a string, a dom element, or a selector, or an array of any mix of these. limits returned endpoints to those that are declared as a target endpoint on any elements identified.
<span class='line'>2588</span> 		*	element - either a string, a dom element, or a selector, or an array of any mix of these. limits returned endpoints to those that are declared as either a source OR a target endpoint on any elements identified.		
<span class='line'>2589</span> 		*
<span class='line'>2590</span> 		* Returns:
<span class='line'>2591</span> 		* A list of Endpoints on which operations may be executed. 'Setter' type operations can be chained; 'getter' type operations
<span class='line'>2592</span> 		* return an array of [Endpoint, value] pairs, one entry for each Endpoint in the list returned. 
<span class='line'>2593</span> 		*
<span class='line'>2594</span> 		* The full list of operations is as follows (where not specified, the operation's effect or return value is the
<span class='line'>2595</span> 		* same as the corresponding method on Endpoint) :
<span class='line'>2596</span> 		* 
<span class='line'>2597</span> 		*	-	setHover								
<span class='line'>2598</span> 		*	-	removeAllOverlays
<span class='line'>2599</span> 		*	-	setLabel
<span class='line'>2600</span> 		*	-	addOverlay
<span class='line'>2601</span> 		*	-	removeOverlay
<span class='line'>2602</span> 		*	-	removeOverlays
<span class='line'>2603</span> 		*	-	showOverlay
<span class='line'>2604</span> 		*	-	hideOverlay
<span class='line'>2605</span> 		*	-	showOverlays
<span class='line'>2606</span> 		*	-	hideOverlays
<span class='line'>2607</span> 		*	-	setPaintStyle
<span class='line'>2608</span> 		*	-	setHoverPaintStyle
<span class='line'>2609</span> 		*	-	setParameter
<span class='line'>2610</span> 		*	-	setParameters
<span class='line'>2611</span> 		*   - 	getLabel
<span class='line'>2612</span> 		*	-	getOverlay
<span class='line'>2613</span> 		*	-	isHover
<span class='line'>2614</span> 		*	-	isDetachable
<span class='line'>2615</span> 		*	-	getParameter
<span class='line'>2616</span> 		*	-	getParameters
<span class='line'>2617</span> 		*	-	getPaintStyle
<span class='line'>2618</span> 		*	-	getHoverPaintStyle
<span class='line'>2619</span> 		*	-	detachAll : Detaches all the Connections from every Endpoint in the list. not chainable and does not return anything.
<span class='line'>2620</span> 		*	-	delete : Deletes every Endpoint in the list. not chainable and does not return anything.		
<span class='line'>2621</span> 		*	-	length : returns the length of the list.
<span class='line'>2622</span> 		*	-	get(index) : returns the Endpoint at 'index' in the list.
<span class='line'>2623</span> 		*	-	each(function(endpoint)...) : allows you to specify your own function to execute; this function is chainable.
<span class='line'>2624</span> 		*/</span><span class="WHIT">
<span class='line'>2625</span> </span><span class="WHIT">		</span><span class="NAME">this.selectEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2626</span> </span><span class="WHIT">			</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2627</span> </span><span class="WHIT">			</span><span class="NAME">params.scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.scope</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">"*"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2628</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">noElementFilters</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">params.element</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">params.source</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">params.target</span><span class="PUNC">,</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2629</span> </span><span class="WHIT">				</span><span class="NAME">elements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">noElementFilters</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"*"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">prepareList</span><span class="PUNC">(</span><span class="NAME">params.element</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2630</span> </span><span class="WHIT">				</span><span class="NAME">sources</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">noElementFilters</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"*"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">prepareList</span><span class="PUNC">(</span><span class="NAME">params.source</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2631</span> </span><span class="WHIT">				</span><span class="NAME">targets</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">noElementFilters</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"*"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">prepareList</span><span class="PUNC">(</span><span class="NAME">params.target</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2632</span> </span><span class="WHIT">				</span><span class="NAME">scopes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prepareList</span><span class="PUNC">(</span><span class="NAME">params.scope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2633</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2634</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2635</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2636</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2637</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">either</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">filterList</span><span class="PUNC">(</span><span class="NAME">elements</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2638</span> </span><span class="WHIT">					</span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">filterList</span><span class="PUNC">(</span><span class="NAME">sources</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2639</span> </span><span class="WHIT">					</span><span class="NAME">sourceMatchExact</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sources</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"*"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2640</span> </span><span class="WHIT">					</span><span class="NAME">target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">filterList</span><span class="PUNC">(</span><span class="NAME">targets</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2641</span> </span><span class="WHIT">					</span><span class="NAME">targetMatchExact</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">targets</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"*"</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2642</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2643</span> </span><span class="WHIT">				</span><span class="COMM">// if they requested 'either' then just match scope. otherwise if they requested 'source' (not as a wildcard) then we have to match only endpoints that have isSource set to to true, and the same thing with isTarget.  </span><span class="WHIT">
<span class='line'>2644</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">either</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">source</span><span class="WHIT">  </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">target</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2645</span> </span><span class="WHIT">					</span><span class="NAME">inner</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2646</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">el</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2647</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_ep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">el</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2648</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">filterList</span><span class="PUNC">(</span><span class="NAME">scopes</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_ep.scope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2649</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>2650</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">noMatchSource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceMatchExact</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sources.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_ep.isSource</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2651</span> </span><span class="WHIT">								</span><span class="NAME">noMatchTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetMatchExact</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">targets.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_ep.isTarget</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2652</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>2653</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">noMatchSource</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">noMatchTarget</span><span class="PUNC">)</span><span class="WHIT">								  </span><span class="WHIT">
<span class='line'>2654</span> </span><span class="WHIT">								  </span><span class="KEYW">continue</span><span class="WHIT"> </span><span class="NAME">inner</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2655</span> </span><span class="WHIT">							 							</span><span class="WHIT">
<span class='line'>2656</span> </span><span class="WHIT">							</span><span class="NAME">ep.push</span><span class="PUNC">(</span><span class="NAME">_ep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2657</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2658</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2659</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2660</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2661</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2662</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_makeEndpointSelectHandler</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2663</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2664</span> 
<span class='line'>2665</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2666</span> 		 * Function: getAllConnections
<span class='line'>2667</span> 		 * Gets all connections, as a map of the form:
<span class='line'>2668</span> 		 *
<span class='line'>2669</span> 		 * : { scope -> [ connection... ] } 
<span class='line'>2670</span> 		 */</span><span class="WHIT">
<span class='line'>2671</span> </span><span class="WHIT">		</span><span class="NAME">this.getAllConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2672</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">connectionsByScope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2673</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2674</span> 
<span class='line'>2675</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2676</span> 		 * Function: getDefaultScope 
<span class='line'>2677</span> 		 * Gets the default scope for connections and  endpoints.
<span class='line'>2678</span> 		 *
<span class='line'>2679</span> 		 * A scope defines a type of endpoint/connection; supplying a
<span class='line'>2680</span> 		 * scope to an Endpoint or Connection allows you to support different
<span class='line'>2681</span> 		 * types of connections in the same UI. but if you're only interested in
<span class='line'>2682</span> 		 * one type of connection, you don't need to supply a scope. this method
<span class='line'>2683</span> 		 * will probably be used by very few people; it's good for testing
<span class='line'>2684</span> 		 * though.
<span class='line'>2685</span> 		 */</span><span class="WHIT">
<span class='line'>2686</span> </span><span class="WHIT">		</span><span class="NAME">this.getDefaultScope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2687</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">DEFAULT_SCOPE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2688</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2689</span> 
<span class='line'>2690</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2691</span> 		  Function: getEndpoint 
<span class='line'>2692</span> 		  Gets an Endpoint by UUID
<span class='line'>2693</span> 		   
<span class='line'>2694</span> 		  Parameters: 
<span class='line'>2695</span> 		  	uuid - the UUID for the Endpoint
<span class='line'>2696</span> 		  	 
<span class='line'>2697</span> 		  Returns: 
<span class='line'>2698</span> 		  	Endpoint with the given UUID, null if nothing found.
<span class='line'>2699</span> 		 */</span><span class="WHIT">
<span class='line'>2700</span> </span><span class="WHIT">		</span><span class="NAME">this.getEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2701</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2702</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>2703</span> 		 * Function: getEndpoints
<span class='line'>2704</span> 		 * Gets the list of Endpoints for a given element.
<span class='line'>2705</span> 		 *
<span class='line'>2706</span> 		 * Parameters:
<span class='line'>2707</span> 		 * 	el - element id, dom element, or selector.
<span class='line'>2708</span> 		 *
<span class='line'>2709</span> 		 * Returns:
<span class='line'>2710</span> 		 * 	An array of Endpoints for the specified element.
<span class='line'>2711</span> 		 */</span><span class="WHIT">
<span class='line'>2712</span> </span><span class="WHIT">		</span><span class="NAME">this.getEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2713</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2714</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2715</span> 
<span class='line'>2716</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2717</span> 		 * Gets an element's id, creating one if necessary. really only exposed
<span class='line'>2718</span> 		 * for the lib-specific functionality to access; would be better to pass
<span class='line'>2719</span> 		 * the current instance into the lib-specific code (even though this is
<span class='line'>2720</span> 		 * a static call. i just don't want to expose it to the public API).
<span class='line'>2721</span> 		 */</span><span class="WHIT">
<span class='line'>2722</span> </span><span class="WHIT">		</span><span class="NAME">this.getId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2723</span> </span><span class="WHIT">		</span><span class="NAME">this.getOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2724</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2725</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">elId</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2726</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2727</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2728</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2729</span> 		 * Function: getSelector
<span class='line'>2730</span> 		 * This method takes the given selector spec and, using the current underlying library, turns it into
<span class='line'>2731</span> 		 * a selector from that library.  This method exists really as a helper function for those applications
<span class='line'>2732</span> 		 * where you're writing jsPlumb code that will target more than one library (such as in the case of the
<span class='line'>2733</span> 		 * jsPlumb demo pages).
<span class='line'>2734</span> 		 *
<span class='line'>2735</span> 		 * Parameters:
<span class='line'>2736</span> 		 * 	spec 	-	a valid selector string.
<span class='line'>2737</span> 		 */</span><span class="WHIT"> 	</span><span class="WHIT">
<span class='line'>2738</span> </span><span class="WHIT">		</span><span class="NAME">this.getSelector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">spec</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2739</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getSelector</span><span class="PUNC">(</span><span class="NAME">spec</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2740</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2741</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2742</span> </span><span class="WHIT">		</span><span class="COMM">// get the size of the element with the given id, perhaps from cache.</span><span class="WHIT">
<span class='line'>2743</span> </span><span class="WHIT">		</span><span class="NAME">this.getSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2744</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2745</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">elId</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2746</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2747</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2748</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2749</span> </span><span class="WHIT">		</span><span class="NAME">this.appendElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_appendElement</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2750</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2751</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_hoverSuspended</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2752</span> </span><span class="WHIT">		</span><span class="NAME">this.isHoverSuspended</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_hoverSuspended</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2753</span> </span><span class="WHIT">		</span><span class="NAME">this.setHoverSuspended</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">_hoverSuspended</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2754</span> 
<span class='line'>2755</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_isAvailable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2756</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2757</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumbAdapter.isRenderModeAvailable</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2758</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2759</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2760</span> </span><span class="WHIT">		</span><span class="NAME">this.isCanvasAvailable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_isAvailable</span><span class="PUNC">(</span><span class="STRN">"canvas"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2761</span> </span><span class="WHIT">		</span><span class="NAME">this.isSVGAvailable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_isAvailable</span><span class="PUNC">(</span><span class="STRN">"svg"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2762</span> </span><span class="WHIT">		</span><span class="NAME">this.isVMLAvailable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_isAvailable</span><span class="PUNC">(</span><span class="STRN">"vml"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2763</span> 
<span class='line'>2764</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2765</span> 		  Function: hide 
<span class='line'>2766</span> 		  Sets an element's connections to be hidden.
<span class='line'>2767</span> 		  
<span class='line'>2768</span> 		  Parameters: 
<span class='line'>2769</span> 		  	el - either the id of the element, or a selector for the element.
<span class='line'>2770</span> 		  	changeEndpoints - whether not to also hide endpoints on the element. by default this is false.  
<span class='line'>2771</span> 		  	 
<span class='line'>2772</span> 		  Returns: 
<span class='line'>2773</span> 		  	void
<span class='line'>2774</span> 		 */</span><span class="WHIT">
<span class='line'>2775</span> </span><span class="WHIT">		</span><span class="NAME">this.hide</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">changeEndpoints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2776</span> </span><span class="WHIT">			</span><span class="NAME">_setVisible</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"none"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">changeEndpoints</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2777</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2778</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2779</span> </span><span class="WHIT">		</span><span class="COMM">// exposed for other objects to use to get a unique id.</span><span class="WHIT">
<span class='line'>2780</span> </span><span class="WHIT">		</span><span class="NAME">this.idstamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_idstamp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2781</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2782</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>2783</span> 		 * callback from the current library to tell us to prepare ourselves (attach
<span class='line'>2784</span> 		 * mouse listeners etc; can't do that until the library has provided a bind method)		 
<span class='line'>2785</span> 		 */</span><span class="WHIT">
<span class='line'>2786</span> </span><span class="WHIT">		</span><span class="NAME">this.init</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2787</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">initialized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2788</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.setRenderMode</span><span class="PUNC">(</span><span class="NAME">_currentInstance.Defaults.RenderMode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// calling the method forces the capability logic to be run.</span><span class="WHIT">
<span class='line'>2789</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2790</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bindOne</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2791</span> </span><span class="WHIT">						</span><span class="NAME">jsPlumb.CurrentLibrary.bind</span><span class="PUNC">(</span><span class="NAME">document</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2792</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_currentInstance.currentlyDragging</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">renderMode</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CANVAS</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2793</span> </span><span class="WHIT">								</span><span class="COMM">// try connections first</span><span class="WHIT">
<span class='line'>2794</span> </span><span class="WHIT">								</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">connectionsByScope</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2795</span> </span><span class="WHIT">					    			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectionsByScope</span><span class="PUNC">[</span><span class="NAME">scope</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2796</span> </span><span class="WHIT">					    			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">c.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2797</span> </span><span class="WHIT">					    				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connector</span><span class="PUNC">[</span><span class="NAME">event</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2798</span> </span><span class="WHIT">					    				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>2799</span> </span><span class="WHIT">					    			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2800</span> </span><span class="WHIT">					    		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2801</span> </span><span class="WHIT">								</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2802</span> </span><span class="WHIT">									</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ee</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">el</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2803</span> </span><span class="WHIT">									</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ee.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2804</span> </span><span class="WHIT">										</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ee</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoint</span><span class="PUNC">[</span><span class="NAME">event</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2805</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2806</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2807</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2808</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2809</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2810</span> </span><span class="WHIT">				</span><span class="NAME">bindOne</span><span class="PUNC">(</span><span class="STRN">"click"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bindOne</span><span class="PUNC">(</span><span class="STRN">"dblclick"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bindOne</span><span class="PUNC">(</span><span class="STRN">"mousemove"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bindOne</span><span class="PUNC">(</span><span class="STRN">"mousedown"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bindOne</span><span class="PUNC">(</span><span class="STRN">"mouseup"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bindOne</span><span class="PUNC">(</span><span class="STRN">"contextmenu"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2811</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2812</span> </span><span class="WHIT">				</span><span class="NAME">initialized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2813</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.fire</span><span class="PUNC">(</span><span class="STRN">"ready"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2814</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2815</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2816</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2817</span> </span><span class="WHIT">		</span><span class="NAME">this.log</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">log</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2818</span> </span><span class="WHIT">		</span><span class="NAME">this.jsPlumbUIComponent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUIComponent</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2819</span> 
<span class='line'>2820</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2821</span> 		 * Creates an anchor with the given params.
<span class='line'>2822</span> 		 * 
<span class='line'>2823</span> 		 * 
<span class='line'>2824</span> 		 * Returns: The newly created Anchor.
<span class='line'>2825</span> 		 */</span><span class="WHIT">
<span class='line'>2826</span> </span><span class="WHIT">		</span><span class="NAME">this.makeAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2827</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2828</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">specimen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jsPlumbInstance</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2829</span> </span><span class="WHIT">			</span><span class="COMM">// if it appears to be an anchor already...</span><span class="WHIT">
<span class='line'>2830</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">specimen.compute</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">specimen.getOrientation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">specimen</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">//TODO hazy here about whether it should be added or is already added somehow.</span><span class="WHIT">
<span class='line'>2831</span> </span><span class="WHIT">			</span><span class="COMM">// is it the name of an anchor type?</span><span class="WHIT">
<span class='line'>2832</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">specimen</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2833</span> </span><span class="WHIT">				</span><span class="NAME">newAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">elementId</span><span class="PUNC">:</span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jsPlumbInstance</span><span class="PUNC">:</span><span class="NAME">_currentInstance</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2834</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2835</span> </span><span class="WHIT">			</span><span class="COMM">// is it an array? it will be one of:</span><span class="WHIT">
<span class='line'>2836</span> </span><span class="WHIT">			</span><span class="COMM">// 		an array of [name, params] - this defines a single anchor</span><span class="WHIT">
<span class='line'>2837</span> </span><span class="WHIT">			</span><span class="COMM">//		an array of arrays - this defines some dynamic anchors</span><span class="WHIT">
<span class='line'>2838</span> </span><span class="WHIT">			</span><span class="COMM">//		an array of numbers - this defines a single anchor.				</span><span class="WHIT">
<span class='line'>2839</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isArray</span><span class="PUNC">(</span><span class="NAME">specimen</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2840</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isArray</span><span class="PUNC">(</span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_isString</span><span class="PUNC">(</span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2841</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">specimen.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_isString</span><span class="PUNC">(</span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_isObject</span><span class="PUNC">(</span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2842</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">elementId</span><span class="PUNC">:</span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jsPlumbInstance</span><span class="PUNC">:</span><span class="NAME">_currentInstance</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2843</span> </span><span class="WHIT">						</span><span class="NAME">newAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">pp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2844</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2845</span> </span><span class="WHIT">					</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>2846</span> </span><span class="WHIT">						</span><span class="NAME">newAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DynamicAnchor</span><span class="PUNC">(</span><span class="NAME">specimen</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2847</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2848</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2849</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">anchorParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2850</span> </span><span class="WHIT">						</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2851</span> </span><span class="WHIT">						</span><span class="NAME">orientation</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">specimen.length</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2852</span> </span><span class="WHIT">						</span><span class="NAME">offsets</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">specimen.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2853</span> </span><span class="WHIT">						</span><span class="NAME">elementId</span><span class="PUNC">:</span><span class="NAME">elementId</span><span class="WHIT">
<span class='line'>2854</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>2855</span> </span><span class="WHIT">					</span><span class="NAME">newAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Anchor</span><span class="PUNC">(</span><span class="NAME">anchorParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2856</span> </span><span class="WHIT">					</span><span class="NAME">newAnchor.clone</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Anchor</span><span class="PUNC">(</span><span class="NAME">anchorParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">						 					</span><span class="WHIT">
<span class='line'>2857</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2858</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2859</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2860</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">newAnchor.id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">newAnchor.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"anchor_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_idstamp</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2861</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">newAnchor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2862</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2863</span> 
<span class='line'>2864</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>2865</span> 		 * makes a list of anchors from the given list of types or coords, eg
<span class='line'>2866</span> 		 * ["TopCenter", "RightMiddle", "BottomCenter", [0, 1, -1, -1] ]
<span class='line'>2867</span> 		 */</span><span class="WHIT">
<span class='line'>2868</span> </span><span class="WHIT">		</span><span class="NAME">this.makeAnchors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">types</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jsPlumbInstance</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2869</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2870</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">types.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2871</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">types</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2872</span> </span><span class="WHIT">					</span><span class="NAME">r.push</span><span class="PUNC">(</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="NAME">types</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">elementId</span><span class="PUNC">:</span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jsPlumbInstance</span><span class="PUNC">:</span><span class="NAME">jsPlumbInstance</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2873</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isArray</span><span class="PUNC">(</span><span class="NAME">types</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2874</span> </span><span class="WHIT">					</span><span class="NAME">r.push</span><span class="PUNC">(</span><span class="NAME">_currentInstance.makeAnchor</span><span class="PUNC">(</span><span class="NAME">types</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jsPlumbInstance</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2875</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2876</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2877</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2878</span> 
<span class='line'>2879</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>2880</span> 		 * Makes a dynamic anchor from the given list of anchors (which may be in shorthand notation as strings or dimension arrays, or Anchor
<span class='line'>2881</span> 		 * objects themselves) and the given, optional, anchorSelector function (jsPlumb uses a default if this is not provided; most people will
<span class='line'>2882</span> 		 * not need to provide this - i think). 
<span class='line'>2883</span> 		 */</span><span class="WHIT">
<span class='line'>2884</span> </span><span class="WHIT">		</span><span class="NAME">this.makeDynamicAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchors</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchorSelector</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2885</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DynamicAnchor</span><span class="PUNC">(</span><span class="NAME">anchors</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchorSelector</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2886</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2887</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2888</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>2889</span> 		 * Function: makeTarget
<span class='line'>2890</span> 		 * Makes some DOM element a Connection target, allowing you to drag connections to it
<span class='line'>2891</span> 		 * without having to register any Endpoints on it first.  When a Connection is established,
<span class='line'>2892</span> 		 * the endpoint spec that was passed in to this method is used to create a suitable 
<span class='line'>2893</span> 		 * Endpoint (the default will be used if you do not provide one).
<span class='line'>2894</span> 		 * 
<span class='line'>2895</span> 		 * Parameters:
<span class='line'>2896</span> 		 *  el		-	string id or element selector for the element to make a target.
<span class='line'>2897</span> 		 * 	params	-	JS object containing parameters:
<span class='line'>2898</span> 		 * 	  - *endpoint*	optional.	specification of an Endpoint to create when a Connection is established.
<span class='line'>2899</span> 		 * 	  - *scope*		optional.   scope for the drop zone.
<span class='line'>2900</span> 		 * 	  - *dropOptions* optional. same stuff as you would pass to dropOptions of an Endpoint definition.
<span class='line'>2901</span> 		 * 	  - *deleteEndpointsOnDetach*  optional, defaults to true. whether or not to delete
<span class='line'>2902</span> 		 *                             any Endpoints created by a connection to this target if
<span class='line'>2903</span> 		 *                             the connection is subsequently detached. this will not 
<span class='line'>2904</span> 		 *                             remove Endpoints that have had more Connections attached
<span class='line'>2905</span> 		 *                             to them after they were created.
<span class='line'>2906</span> 		 *   - *maxConnections*  optional. Specifies the maximum number of Connections that can be made to this element as a target. Default is no limit.
<span class='line'>2907</span> 		 *   - *onMaxConnections* optional. Function to call when user attempts to drop a connection but the limit has been reached.
<span class='line'>2908</span> 		 *   		The callback is passed two arguments: a JS object with:
<span class='line'>2909</span> 		 *   		: { element, connection, maxConnection }
<span class='line'>2910</span> 		 *   		...and the original event.		 
<span class='line'>2911</span> 		 */</span><span class="WHIT">
<span class='line'>2912</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_targetEndpointDefinitions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2913</span> </span><span class="WHIT">			</span><span class="NAME">_targetEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2914</span> </span><span class="WHIT">			</span><span class="NAME">_targetEndpointsUnique</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2915</span> </span><span class="WHIT">			</span><span class="NAME">_targetMaxConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2916</span> </span><span class="WHIT">			</span><span class="NAME">_setEndpointPaintStylesAndAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">epIndex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2917</span> </span><span class="WHIT">				</span><span class="NAME">ep.paintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ep.paintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2918</span> </span><span class="WHIT">				 				</span><span class="NAME">_currentInstance.Defaults.EndpointStyles</span><span class="PUNC">[</span><span class="NAME">epIndex</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2919</span> </span><span class="WHIT">	                            </span><span class="NAME">_currentInstance.Defaults.EndpointStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2920</span> </span><span class="WHIT">	                            </span><span class="NAME">jsPlumb.Defaults.EndpointStyles</span><span class="PUNC">[</span><span class="NAME">epIndex</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2921</span> </span><span class="WHIT">	                            </span><span class="NAME">jsPlumb.Defaults.EndpointStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2922</span> </span><span class="WHIT">				</span><span class="NAME">ep.hoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ep.hoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2923</span> </span><span class="WHIT">	                           </span><span class="NAME">_currentInstance.Defaults.EndpointHoverStyles</span><span class="PUNC">[</span><span class="NAME">epIndex</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2924</span> </span><span class="WHIT">	                           </span><span class="NAME">_currentInstance.Defaults.EndpointHoverStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2925</span> </span><span class="WHIT">	                           </span><span class="NAME">jsPlumb.Defaults.EndpointHoverStyles</span><span class="PUNC">[</span><span class="NAME">epIndex</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2926</span> </span><span class="WHIT">	                           </span><span class="NAME">jsPlumb.Defaults.EndpointHoverStyle</span><span class="PUNC">;</span><span class="WHIT">                            </span><span class="WHIT">
<span class='line'>2927</span> 
<span class='line'>2928</span> </span><span class="WHIT">				</span><span class="NAME">ep.anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ep.anchor</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2929</span> </span><span class="WHIT">	                      	</span><span class="NAME">_currentInstance.Defaults.Anchors</span><span class="PUNC">[</span><span class="NAME">epIndex</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2930</span> </span><span class="WHIT">	                      	</span><span class="NAME">_currentInstance.Defaults.Anchor</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2931</span> </span><span class="WHIT">	                      	</span><span class="NAME">jsPlumb.Defaults.Anchors</span><span class="PUNC">[</span><span class="NAME">epIndex</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2932</span> </span><span class="WHIT">	                      	</span><span class="NAME">jsPlumb.Defaults.Anchor</span><span class="PUNC">;</span><span class="WHIT">                           </span><span class="WHIT">
<span class='line'>2933</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2934</span> </span><span class="WHIT">				</span><span class="NAME">ep.endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ep.endpoint</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2935</span> </span><span class="WHIT">							  </span><span class="NAME">_currentInstance.Defaults.Endpoints</span><span class="PUNC">[</span><span class="NAME">epIndex</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2936</span> </span><span class="WHIT">							  </span><span class="NAME">_currentInstance.Defaults.Endpoint</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2937</span> </span><span class="WHIT">							  </span><span class="NAME">jsPlumb.Defaults.Endpoints</span><span class="PUNC">[</span><span class="NAME">epIndex</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2938</span> </span><span class="WHIT">							  </span><span class="NAME">jsPlumb.Defaults.Endpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2939</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2940</span> 
<span class='line'>2941</span> </span><span class="WHIT">		</span><span class="NAME">this.makeTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>2942</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2943</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">_jsPlumb</span><span class="PUNC">:</span><span class="NAME">_currentInstance</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2944</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2945</span> </span><span class="WHIT">			</span><span class="NAME">_setEndpointPaintStylesAndAnchor</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">                                                    </span><span class="WHIT">
<span class='line'>2946</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jpcl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2947</span> </span><span class="WHIT">			    </span><span class="NAME">targetScope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.scope</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.Scope</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2948</span> </span><span class="WHIT">			    </span><span class="NAME">deleteEndpointsOnDetach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">p.deleteEndpointsOnDetach</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2949</span> </span><span class="WHIT">			    </span><span class="NAME">maxConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.maxConnections</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2950</span> </span><span class="WHIT">				</span><span class="NAME">onMaxConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.onMaxConnections</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2951</span> </span><span class="WHIT">			</span><span class="NAME">_doOne</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2952</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2953</span> </span><span class="WHIT">				</span><span class="COMM">// get the element's id and store the endpoint definition for it.  jsPlumb.connect calls will look for one of these,</span><span class="WHIT">
<span class='line'>2954</span> </span><span class="WHIT">				</span><span class="COMM">// and use the endpoint definition if found.</span><span class="WHIT">
<span class='line'>2955</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2956</span> </span><span class="WHIT">				</span><span class="NAME">_targetEndpointDefinitions</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2957</span> </span><span class="WHIT">				</span><span class="NAME">_targetEndpointsUnique</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.uniqueEndpoint</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2958</span> </span><span class="WHIT">				</span><span class="NAME">_targetMaxConnections</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">maxConnections</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2959</span> </span><span class="WHIT">				</span><span class="NAME">_targetsEnabled</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2960</span> </span><span class="WHIT">				</span><span class="NAME">proxyComponent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">jsPlumbUIComponent</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>2961</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2962</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dropOptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p.dropOptions</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2963</span> </span><span class="WHIT">				</span><span class="NAME">_drop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2964</span> 
<span class='line'>2965</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getDropEvent</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2966</span> </span><span class="WHIT">						</span><span class="NAME">targetCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.select</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">target</span><span class="PUNC">:</span><span class="NAME">elid</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">																							</span><span class="WHIT">
<span class='line'>2967</span> 
<span class='line'>2968</span> </span><span class="WHIT">					</span><span class="NAME">_currentInstance.currentlyDragging</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2969</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">draggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">jpcl.getDragObject</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2970</span> </span><span class="WHIT">						</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"dragId"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2971</span> </span><span class="WHIT">						</span><span class="COMM">// restore the original scope if necessary (issue 57)</span><span class="WHIT">
<span class='line'>2972</span> </span><span class="WHIT">						</span><span class="NAME">scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"originalScope"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2973</span> </span><span class="WHIT">						</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">floatingConnections</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2974</span> </span><span class="WHIT">						</span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2975</span> </span><span class="WHIT">						</span><span class="NAME">_endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.endpoint</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p.endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2976</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>2977</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_targetsEnabled</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_targetMaxConnections</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">targetCount</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">_targetMaxConnections</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2978</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">onMaxConnections</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2979</span> </span><span class="WHIT">							</span><span class="NAME">onMaxConnections</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2980</span> </span><span class="WHIT">								</span><span class="NAME">element</span><span class="PUNC">:</span><span class="NAME">_el</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2981</span> </span><span class="WHIT">								</span><span class="NAME">connection</span><span class="PUNC">:</span><span class="NAME">jpc</span><span class="WHIT">
<span class='line'>2982</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2983</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2984</span> </span><span class="WHIT">						</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2985</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2986</span> 
<span class='line'>2987</span> </span><span class="WHIT">					</span><span class="COMM">// unlock the source anchor to allow it to refresh its position if necessary</span><span class="WHIT">
<span class='line'>2988</span> </span><span class="WHIT">					</span><span class="NAME">source.anchor.locked</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2989</span> </span><span class="WHIT">										</span><span class="WHIT">
<span class='line'>2990</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">scope</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">jpcl.setDragScope</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2991</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2992</span> </span><span class="WHIT">					</span><span class="COMM">// check if drop is allowed here.					</span><span class="WHIT">
<span class='line'>2993</span> </span><span class="WHIT">					</span><span class="COMM">//var _continue = jpc.isDropAllowed(jpc.sourceId, _getId(_el), jpc.scope);		</span><span class="WHIT">
<span class='line'>2994</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_continue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">proxyComponent.isDropAllowed</span><span class="PUNC">(</span><span class="NAME">jpc.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc.scope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2995</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2996</span> </span><span class="WHIT">					</span><span class="COMM">// regardless of whether the connection is ok, reconfigure the existing connection to </span><span class="WHIT">
<span class='line'>2997</span> </span><span class="WHIT">					</span><span class="COMM">// point at the current info. we need this to be correct for the detach event that will follow.</span><span class="WHIT">
<span class='line'>2998</span> </span><span class="WHIT">					</span><span class="COMM">// clear the source endpoint from the list to detach. we will detach this connection at this</span><span class="WHIT">
<span class='line'>2999</span> </span><span class="WHIT">					</span><span class="COMM">// point, but we want to keep the source endpoint.  the target is a floating endpoint and should</span><span class="WHIT">
<span class='line'>3000</span> </span><span class="WHIT">					</span><span class="COMM">// be removed.  TODO need to figure out whether this code can result in endpoints kicking around</span><span class="WHIT">
<span class='line'>3001</span> </span><span class="WHIT">					</span><span class="COMM">// when they shouldnt be.  like is this a full detach of a connection?  can it be?</span><span class="WHIT">
<span class='line'>3002</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.endpointsToDeleteOnDetach</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3003</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">jpc.endpointsToDeleteOnDetach</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3004</span> </span><span class="WHIT">							</span><span class="NAME">jpc.endpointsToDeleteOnDetach</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3005</span> </span><span class="WHIT">						</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">jpc.endpointsToDeleteOnDetach</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3006</span> </span><span class="WHIT">							</span><span class="NAME">jpc.endpointsToDeleteOnDetach</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3007</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3008</span> </span><span class="WHIT">					</span><span class="COMM">// reinstate any suspended endpoint; this just puts the connection back into</span><span class="WHIT">
<span class='line'>3009</span> </span><span class="WHIT">					</span><span class="COMM">// a state in which it will report sensible values if someone asks it about</span><span class="WHIT">
<span class='line'>3010</span> </span><span class="WHIT">					</span><span class="COMM">// its target.  we're going to throw this connection away shortly so it doesnt matter</span><span class="WHIT">
<span class='line'>3011</span> </span><span class="WHIT">					</span><span class="COMM">// if we manipulate it a bit.</span><span class="WHIT">
<span class='line'>3012</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.suspendedEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3013</span> </span><span class="WHIT">						</span><span class="NAME">jpc.targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3014</span> </span><span class="WHIT">						</span><span class="NAME">jpc.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getElementObject</span><span class="PUNC">(</span><span class="NAME">jpc.suspendedEndpoint.elementId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3015</span> </span><span class="WHIT">						</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3016</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">																										</span><span class="WHIT">
<span class='line'>3017</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>3018</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_continue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3019</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>3020</span> </span><span class="WHIT">						</span><span class="COMM">// detach this connection from the source.						</span><span class="WHIT">
<span class='line'>3021</span> </span><span class="WHIT">						</span><span class="NAME">source.detach</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3022</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>3023</span> </span><span class="WHIT">						</span><span class="COMM">// make a new Endpoint for the target												</span><span class="WHIT">
<span class='line'>3024</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_targetEndpoints</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.addEndpoint</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3025</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p.uniqueEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_targetEndpoints</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newEndpoint</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// may of course just store what it just pulled out. that's ok.</span><span class="WHIT">
<span class='line'>3026</span> </span><span class="WHIT">						</span><span class="NAME">newEndpoint._makeTargetCreator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3027</span> </span><span class="WHIT">																</span><span class="WHIT">
<span class='line'>3028</span> </span><span class="WHIT">						</span><span class="COMM">// if the anchor has a 'positionFinder' set, then delegate to that function to find</span><span class="WHIT">
<span class='line'>3029</span> </span><span class="WHIT">						</span><span class="COMM">// out where to locate the anchor.</span><span class="WHIT">
<span class='line'>3030</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">newEndpoint.anchor.positionFinder</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3031</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dropPosition</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getUIPosition</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3032</span> </span><span class="WHIT">							</span><span class="NAME">elPosition</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getOffset</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3033</span> </span><span class="WHIT">							</span><span class="NAME">elSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getSize</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3034</span> </span><span class="WHIT">							</span><span class="NAME">ap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newEndpoint.anchor.positionFinder</span><span class="PUNC">(</span><span class="NAME">dropPosition</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elPosition</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elSize</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newEndpoint.anchor.constructorParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3035</span> </span><span class="WHIT">							</span><span class="NAME">newEndpoint.anchor.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ap</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3036</span> </span><span class="WHIT">							</span><span class="NAME">newEndpoint.anchor.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ap</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3037</span> </span><span class="WHIT">							</span><span class="COMM">// now figure an orientation for it..kind of hard to know what to do actually. probably the best thing i can do is to</span><span class="WHIT">
<span class='line'>3038</span> </span><span class="WHIT">							</span><span class="COMM">// support specifying an orientation in the anchor's spec. if one is not supplied then i will make the orientation </span><span class="WHIT">
<span class='line'>3039</span> </span><span class="WHIT">							</span><span class="COMM">// be what will cause the most natural link to the source: it will be pointing at the source, but it needs to be</span><span class="WHIT">
<span class='line'>3040</span> </span><span class="WHIT">							</span><span class="COMM">// specified in one axis only, and so how to make that choice? i think i will use whichever axis is the one in which</span><span class="WHIT">
<span class='line'>3041</span> </span><span class="WHIT">							</span><span class="COMM">// the target is furthest away from the source.</span><span class="WHIT">
<span class='line'>3042</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3043</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.connect</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3044</span> </span><span class="WHIT">							</span><span class="NAME">source</span><span class="PUNC">:</span><span class="NAME">source</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3045</span> </span><span class="WHIT">							</span><span class="NAME">target</span><span class="PUNC">:</span><span class="NAME">newEndpoint</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3046</span> </span><span class="WHIT">							</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="NAME">scope</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3047</span> </span><span class="WHIT">							</span><span class="NAME">previousConnection</span><span class="PUNC">:</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3048</span> </span><span class="WHIT">							</span><span class="NAME">container</span><span class="PUNC">:</span><span class="NAME">jpc.parent</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3049</span> </span><span class="WHIT">							</span><span class="NAME">deleteEndpointsOnDetach</span><span class="PUNC">:</span><span class="NAME">deleteEndpointsOnDetach</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3050</span> </span><span class="WHIT">							</span><span class="COMM">// 'endpointWillMoveAfterConnection' is set by the makeSource function, and it indicates that the</span><span class="WHIT">
<span class='line'>3051</span> </span><span class="WHIT">							</span><span class="COMM">// given endpoint will actually transfer from the element it is currently attached to to some other</span><span class="WHIT">
<span class='line'>3052</span> </span><span class="WHIT">							</span><span class="COMM">// element after a connection has been established.  in that case, we do not want to fire the</span><span class="WHIT">
<span class='line'>3053</span> </span><span class="WHIT">							</span><span class="COMM">// connection event, since it will have the wrong data in it; makeSource will do it for us.</span><span class="WHIT">
<span class='line'>3054</span> </span><span class="WHIT">							</span><span class="COMM">// this is controlled by the 'parent' parameter on a makeSource call.</span><span class="WHIT">
<span class='line'>3055</span> </span><span class="WHIT">							</span><span class="NAME">doNotFireConnectionEvent</span><span class="PUNC">:</span><span class="NAME">source.endpointWillMoveAfterConnection</span><span class="WHIT">
<span class='line'>3056</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3057</span> 
<span class='line'>3058</span> </span><span class="WHIT">						</span><span class="COMM">// delete the original target endpoint.  but only want to do this if the endpoint was created</span><span class="WHIT">
<span class='line'>3059</span> </span><span class="WHIT">						</span><span class="COMM">// automatically and has no other connections.</span><span class="WHIT">
<span class='line'>3060</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">_makeTargetCreator</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connections.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3061</span> </span><span class="WHIT">							</span><span class="NAME">_currentInstance.deleteEndpoint</span><span class="PUNC">(</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3062</span> 
<span class='line'>3063</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">deleteEndpointsOnDetach</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3064</span> </span><span class="WHIT">							</span><span class="NAME">c.endpointsToDeleteOnDetach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">source</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newEndpoint</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3065</span> 
<span class='line'>3066</span> </span><span class="WHIT">						</span><span class="NAME">c.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3067</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3068</span> </span><span class="WHIT">					</span><span class="COMM">// if not allowed to drop...</span><span class="WHIT">
<span class='line'>3069</span> </span><span class="WHIT">					</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3070</span> </span><span class="WHIT">						</span><span class="COMM">// TODO this code is identical (pretty much) to what happens when a connection</span><span class="WHIT">
<span class='line'>3071</span> </span><span class="WHIT">						</span><span class="COMM">// dragged from a normal endpoint is in this situation. refactor.</span><span class="WHIT">
<span class='line'>3072</span> </span><span class="WHIT">						</span><span class="COMM">// is this an existing connection, and will we reattach?</span><span class="WHIT">
<span class='line'>3073</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.suspendedEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3074</span> </span><span class="WHIT">							</span><span class="COMM">//if (source.isReattach) {</span><span class="WHIT">
<span class='line'>3075</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.isReattach</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3076</span> </span><span class="WHIT">								</span><span class="NAME">jpc.setHover</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3077</span> </span><span class="WHIT">								</span><span class="NAME">jpc.floatingAnchorIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3078</span> </span><span class="WHIT">								</span><span class="NAME">jpc.suspendedEndpoint.addConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3079</span> </span><span class="WHIT">								</span><span class="NAME">_currentInstance.repaint</span><span class="PUNC">(</span><span class="NAME">source.elementId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3080</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3081</span> </span><span class="WHIT">							</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>3082</span> </span><span class="WHIT">								</span><span class="NAME">source.detach</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// otherwise, detach the connection and tell everyone about it.</span><span class="WHIT">
<span class='line'>3083</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3084</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>3085</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">														</span><span class="WHIT">
<span class='line'>3086</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3087</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3088</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dropEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.dragEvents</span><span class="PUNC">[</span><span class="STRN">'drop'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3089</span> </span><span class="WHIT">				</span><span class="NAME">dropOptions</span><span class="PUNC">[</span><span class="STRN">"scope"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dropOptions</span><span class="PUNC">[</span><span class="STRN">"scope"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">targetScope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3090</span> </span><span class="WHIT">				</span><span class="NAME">dropOptions</span><span class="PUNC">[</span><span class="NAME">dropEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">dropOptions</span><span class="PUNC">[</span><span class="NAME">dropEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_drop</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3091</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3092</span> </span><span class="WHIT">				</span><span class="NAME">jpcl.initDroppable</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropOptions</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3093</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3094</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3095</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_convertYUICollection</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3096</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3097</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inputs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el.length</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">el.constructor</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">String</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3098</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>3099</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">inputs.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3100</span> </span><span class="WHIT">				</span><span class="NAME">_doOne</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">inputs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3101</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3102</span> 
<span class='line'>3103</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3104</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3105</span> 
<span class='line'>3106</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3107</span> 		*	Function: unmakeTarget
<span class='line'>3108</span> 		*	Sets the given element to no longer be a connection target.
<span class='line'>3109</span> 		*	
<span class='line'>3110</span> 		*	Parameters:
<span class='line'>3111</span> 		*		el - a string id, a dom element, or a selector representing the element.
<span class='line'>3112</span> 		*		
<span class='line'>3113</span> 		*	Returns:
<span class='line'>3114</span> 		*	The current jsPlumb instance.
<span class='line'>3115</span> 		*/</span><span class="WHIT">
<span class='line'>3116</span> </span><span class="WHIT">		</span><span class="NAME">this.unmakeTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotClearArrays</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3117</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3118</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3119</span> 
<span class='line'>3120</span> </span><span class="WHIT">			</span><span class="COMM">// TODO this is not an exhaustive unmake of a target, since it does not remove the droppable stuff from</span><span class="WHIT">
<span class='line'>3121</span> </span><span class="WHIT">			</span><span class="COMM">// the element.  the effect will be to prevent it form behaving as a target, but it's not completely purged.</span><span class="WHIT">
<span class='line'>3122</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">doNotClearArrays</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3123</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_targetEndpointDefinitions</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3124</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_targetEndpointsUnique</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3125</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_targetMaxConnections</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3126</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_targetsEnabled</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3127</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3128</span> 
<span class='line'>3129</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3130</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3131</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3132</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3133</span> 		 * Function: makeTargets
<span class='line'>3134</span> 		 * Makes all elements in some array or a selector connection targets.
<span class='line'>3135</span> 		 * 
<span class='line'>3136</span> 		 * Parameters:
<span class='line'>3137</span> 		 * 	els 	- 	either an array of ids or a selector
<span class='line'>3138</span> 		 *  params  -   parameters to configure each element as a target with
<span class='line'>3139</span> 		 *  referenceParams - extra parameters to configure each element as a taretsource with.
<span class='line'>3140</span> 		 *
<span class='line'>3141</span> 		 * Returns:
<span class='line'>3142</span> 		 * The current jsPlumb instance.
<span class='line'>3143</span> 		 */</span><span class="WHIT">
<span class='line'>3144</span> </span><span class="WHIT">		</span><span class="NAME">this.makeTargets</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">els</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3145</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">els.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3146</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.makeTarget</span><span class="PUNC">(</span><span class="NAME">els</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3147</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3148</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3149</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3150</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>3151</span> 		 * Function: makeSource
<span class='line'>3152</span> 		 * Makes some DOM element a Connection source, allowing you to drag connections from it
<span class='line'>3153</span> 		 * without having to register any Endpoints on it first.  When a Connection is established,
<span class='line'>3154</span> 		 * the endpoint spec that was passed in to this method is used to create a suitable 
<span class='line'>3155</span> 		 * Endpoint (the default will be used if you do not provide one).
<span class='line'>3156</span> 		 * 
<span class='line'>3157</span> 		 * Parameters:
<span class='line'>3158</span> 		 *  el		-	string id or element selector for the element to make a source.
<span class='line'>3159</span> 		 * 	params	-	JS object containing parameters:
<span class='line'>3160</span> 		 * 	  - *endpoint*	optional.	specification of an endpoint to create when a connection is created.
<span class='line'>3161</span> 		 * 	  - *parent*	optional.   the element to add Endpoints to when a Connection is established.  if you omit this, 
<span class='line'>3162</span> 		 *                          Endpoints will be added to 'el'.
<span class='line'>3163</span> 		 * 	  - *scope*		optional.   scope for the connections dragged from this element.
<span class='line'>3164</span> 		 * 	  - *dragOptions* optional. same stuff as you would pass to dragOptions of an Endpoint definition.
<span class='line'>3165</span> 		 * 	  - *deleteEndpointsOnDetach*  optional, defaults to false. whether or not to delete
<span class='line'>3166</span> 		 *                             any Endpoints created by a connection from this source if
<span class='line'>3167</span> 		 *                             the connection is subsequently detached. this will not 
<span class='line'>3168</span> 		 *                             remove Endpoints that have had more Connections attached
<span class='line'>3169</span> 		 *                             to them after they were created.
<span class='line'>3170</span> 		 * 	  - *filter* - optional function to call when the user presses the mouse button to start a drag. This function is passed the original 
<span class='line'>3171</span> 		 * event and the element on which the associated makeSource call was made.  If it returns anything other than false,
<span class='line'>3172</span> 		 * the drag begins as usual. But if it returns false (the boolean false, not just something falsey), the drag is aborted.
<span class='line'>3173</span> 		 *                   	
<span class='line'>3174</span> 		 * 
<span class='line'>3175</span> 		 */</span><span class="WHIT">
<span class='line'>3176</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_sourceEndpointDefinitions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3177</span> </span><span class="WHIT">			</span><span class="NAME">_sourceEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3178</span> </span><span class="WHIT">			</span><span class="NAME">_sourceEndpointsUnique</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3179</span> </span><span class="WHIT">			</span><span class="NAME">_sourcesEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3180</span> </span><span class="WHIT">			</span><span class="NAME">_sourceTriggers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3181</span> </span><span class="WHIT">			</span><span class="NAME">_sourceMaxConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3182</span> </span><span class="WHIT">			</span><span class="NAME">_targetsEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3183</span> 
<span class='line'>3184</span> </span><span class="WHIT">		</span><span class="NAME">this.makeSource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3185</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3186</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3187</span> </span><span class="WHIT">			</span><span class="NAME">_setEndpointPaintStylesAndAnchor</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">   </span><span class="WHIT">
<span class='line'>3188</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jpcl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3189</span> </span><span class="WHIT">				</span><span class="NAME">maxConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.maxConnections</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3190</span> </span><span class="WHIT">				</span><span class="NAME">onMaxConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.onMaxConnections</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3191</span> </span><span class="WHIT">			</span><span class="NAME">_doOne</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3192</span> </span><span class="WHIT">				</span><span class="COMM">// get the element's id and store the endpoint definition for it.  jsPlumb.connect calls will look for one of these,</span><span class="WHIT">
<span class='line'>3193</span> </span><span class="WHIT">				</span><span class="COMM">// and use the endpoint definition if found.</span><span class="WHIT">
<span class='line'>3194</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3195</span> </span><span class="WHIT">					</span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.parent</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3196</span> </span><span class="WHIT">					</span><span class="NAME">idToRegisterAgainst</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getId</span><span class="PUNC">(</span><span class="NAME">jpcl.getElementObject</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">elid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3197</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3198</span> </span><span class="WHIT">				</span><span class="NAME">_sourceEndpointDefinitions</span><span class="PUNC">[</span><span class="NAME">idToRegisterAgainst</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3199</span> </span><span class="WHIT">				</span><span class="NAME">_sourceEndpointsUnique</span><span class="PUNC">[</span><span class="NAME">idToRegisterAgainst</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.uniqueEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3200</span> </span><span class="WHIT">				</span><span class="NAME">_sourcesEnabled</span><span class="PUNC">[</span><span class="NAME">idToRegisterAgainst</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3201</span> 
<span class='line'>3202</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">stopEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.dragEvents</span><span class="PUNC">[</span><span class="STRN">"stop"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3203</span> </span><span class="WHIT">					</span><span class="NAME">dragEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.dragEvents</span><span class="PUNC">[</span><span class="STRN">"drag"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3204</span> </span><span class="WHIT">					</span><span class="NAME">dragOptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p.dragOptions</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3205</span> </span><span class="WHIT">					</span><span class="NAME">existingDrag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dragOptions.drag</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3206</span> </span><span class="WHIT">					</span><span class="NAME">existingStop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dragOptions.stop</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3207</span> </span><span class="WHIT">					</span><span class="NAME">ep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3208</span> </span><span class="WHIT">					</span><span class="NAME">endpointAddedButNoDragYet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3209</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3210</span> </span><span class="WHIT">				</span><span class="NAME">_sourceMaxConnections</span><span class="PUNC">[</span><span class="NAME">idToRegisterAgainst</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">maxConnections</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3211</span> 
<span class='line'>3212</span> </span><span class="WHIT">				</span><span class="COMM">// set scope if its not set in dragOptions but was passed in in params</span><span class="WHIT">
<span class='line'>3213</span> </span><span class="WHIT">				</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="STRN">"scope"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="STRN">"scope"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">p.scope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3214</span> 
<span class='line'>3215</span> </span><span class="WHIT">				</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="NAME">dragEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="NAME">dragEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3216</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">existingDrag</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">existingDrag.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3217</span> </span><span class="WHIT">					</span><span class="NAME">endpointAddedButNoDragYet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3218</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3219</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>3220</span> </span><span class="WHIT">				</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="NAME">stopEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="NAME">stopEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> 							</span><span class="WHIT">
<span class='line'>3221</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">existingStop</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">existingStop.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>3222</span> 
<span class='line'>3223</span> </span><span class="WHIT">                    </span><span class="COMM">//_currentlyDown = false;</span><span class="WHIT">
<span class='line'>3224</span> </span><span class="WHIT">					</span><span class="NAME">_currentInstance.currentlyDragging</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3225</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>3226</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ep.connections.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3227</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.deleteEndpoint</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3228</span> </span><span class="WHIT">					</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3229</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>3230</span> </span><span class="WHIT">						</span><span class="NAME">jpcl.unbind</span><span class="PUNC">(</span><span class="NAME">ep.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mousedown"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3231</span> </span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>3232</span> </span><span class="WHIT">						</span><span class="COMM">// reset the anchor to the anchor that was initially provided. the one we were using to drag</span><span class="WHIT">
<span class='line'>3233</span> </span><span class="WHIT">						</span><span class="COMM">// the connection was just a placeholder that was located at the place the user pressed the</span><span class="WHIT">
<span class='line'>3234</span> </span><span class="WHIT">						</span><span class="COMM">// mouse button to initiate the drag.</span><span class="WHIT">
<span class='line'>3235</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">anchorDef</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.anchor</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.Anchor</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3236</span> </span><span class="WHIT">							</span><span class="NAME">oldAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ep.anchor</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3237</span> </span><span class="WHIT">							</span><span class="NAME">oldConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ep.connections</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3238</span> 
<span class='line'>3239</span> </span><span class="WHIT">						</span><span class="NAME">ep.anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.makeAnchor</span><span class="PUNC">(</span><span class="NAME">anchorDef</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">																							</span><span class="WHIT">
<span class='line'>3240</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>3241</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p.parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>3242</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getElementObject</span><span class="PUNC">(</span><span class="NAME">p.parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3243</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3244</span> </span><span class="WHIT">								</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ep.elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3245</span> </span><span class="WHIT">											</span><span class="WHIT">
<span class='line'>3246</span> </span><span class="WHIT">								</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">potentialParent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.container</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.Container</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.Container</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3247</span> </span><span class="WHIT">																</span><span class="WHIT">
<span class='line'>3248</span> </span><span class="WHIT">								</span><span class="NAME">ep.setElement</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">potentialParent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3249</span> </span><span class="WHIT">								</span><span class="NAME">ep.endpointWillMoveAfterConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">														</span><span class="WHIT">
<span class='line'>3250</span> </span><span class="WHIT">								</span><span class="NAME">_currentInstance.anchorManager.rehomeEndpoint</span><span class="PUNC">(</span><span class="NAME">currentId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">													</span><span class="WHIT">
<span class='line'>3251</span> </span><span class="WHIT">								</span><span class="NAME">oldConnection.previousConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3252</span> </span><span class="WHIT">								</span><span class="COMM">// remove from connectionsByScope</span><span class="WHIT">
<span class='line'>3253</span> </span><span class="WHIT">								</span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">connectionsByScope</span><span class="PUNC">[</span><span class="NAME">oldConnection.scope</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3254</span> </span><span class="WHIT">									</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">oldConnection.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3255</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">										</span><span class="WHIT">
<span class='line'>3256</span> </span><span class="WHIT">								</span><span class="NAME">_currentInstance.anchorManager.connectionDetached</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3257</span> </span><span class="WHIT">									</span><span class="NAME">sourceId</span><span class="PUNC">:</span><span class="NAME">oldConnection.sourceId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3258</span> </span><span class="WHIT">									</span><span class="NAME">targetId</span><span class="PUNC">:</span><span class="NAME">oldConnection.targetId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3259</span> </span><span class="WHIT">									</span><span class="NAME">connection</span><span class="PUNC">:</span><span class="NAME">oldConnection</span><span class="WHIT">
<span class='line'>3260</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">											</span><span class="WHIT">
<span class='line'>3261</span> </span><span class="WHIT">								</span><span class="NAME">_finaliseConnection</span><span class="PUNC">(</span><span class="NAME">oldConnection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>3262</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3263</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>3264</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>3265</span> </span><span class="WHIT">						</span><span class="NAME">ep.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3266</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.repaint</span><span class="PUNC">(</span><span class="NAME">ep.elementId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">																		</span><span class="WHIT">
<span class='line'>3267</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.repaint</span><span class="PUNC">(</span><span class="NAME">oldConnection.targetId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3268</span> 
<span class='line'>3269</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3270</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3271</span> </span><span class="WHIT">				</span><span class="COMM">// when the user presses the mouse, add an Endpoint, if we are enabled.</span><span class="WHIT">
<span class='line'>3272</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mouseDownListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3273</span> 
<span class='line'>3274</span> </span><span class="WHIT">					</span><span class="COMM">// if disabled, return.</span><span class="WHIT">
<span class='line'>3275</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_sourcesEnabled</span><span class="PUNC">[</span><span class="NAME">idToRegisterAgainst</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3276</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>3277</span> </span><span class="WHIT">					</span><span class="COMM">// if maxConnections reached</span><span class="WHIT">
<span class='line'>3278</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sourceCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.select</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">source</span><span class="PUNC">:</span><span class="NAME">idToRegisterAgainst</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT">
<span class='line'>3279</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_sourceMaxConnections</span><span class="PUNC">[</span><span class="NAME">idToRegisterAgainst</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sourceCount</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">_sourceMaxConnections</span><span class="PUNC">[</span><span class="NAME">idToRegisterAgainst</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3280</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">onMaxConnections</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3281</span> </span><span class="WHIT">							</span><span class="NAME">onMaxConnections</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3282</span> </span><span class="WHIT">								</span><span class="NAME">element</span><span class="PUNC">:</span><span class="NAME">_el</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3283</span> </span><span class="WHIT">								</span><span class="NAME">maxConnections</span><span class="PUNC">:</span><span class="NAME">maxConnections</span><span class="WHIT">
<span class='line'>3284</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3285</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3286</span> </span><span class="WHIT">						</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3287</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3288</span> 
<span class='line'>3289</span> </span><span class="WHIT">					</span><span class="COMM">// if a filter was given, run it, and return if it says no.</span><span class="WHIT">
<span class='line'>3290</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.filter</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3291</span> </span><span class="WHIT">						</span><span class="COMM">// pass the original event to the user: </span><span class="WHIT">
<span class='line'>3292</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.filter</span><span class="PUNC">(</span><span class="NAME">jpcl.getOriginalEvent</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3293</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3294</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3295</span> 
<span class='line'>3296</span> </span><span class="WHIT">					</span><span class="COMM">// make sure we have the latest offset for this div </span><span class="WHIT">
<span class='line'>3297</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myOffsetInfo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">elId</span><span class="PUNC">:</span><span class="NAME">elid</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3298</span> 
<span class='line'>3299</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">e.pageX</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">e.page.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">myOffsetInfo.left</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">myOffsetInfo.width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3300</span> </span><span class="WHIT">					    </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">e.pageY</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">e.page.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">myOffsetInfo.top</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">myOffsetInfo.height</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3301</span> </span><span class="WHIT">					    </span><span class="NAME">parentX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3302</span> </span><span class="WHIT">					    </span><span class="NAME">parentY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>3303</span> </span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>3304</span> </span><span class="WHIT">					</span><span class="COMM">// if there is a parent, the endpoint will actually be added to it now, rather than the div</span><span class="WHIT">
<span class='line'>3305</span> </span><span class="WHIT">					</span><span class="COMM">// that was the source.  in that case, we have to adjust the anchor position so it refers to</span><span class="WHIT">
<span class='line'>3306</span> </span><span class="WHIT">					</span><span class="COMM">// the parent.</span><span class="WHIT">
<span class='line'>3307</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p.parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3308</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pEl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getElementObject</span><span class="PUNC">(</span><span class="NAME">p.parent</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3309</span> </span><span class="WHIT">							</span><span class="NAME">pId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">pEl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3310</span> </span><span class="WHIT">						</span><span class="NAME">myOffsetInfo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">elId</span><span class="PUNC">:</span><span class="NAME">pId</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3311</span> </span><span class="WHIT">						</span><span class="NAME">parentX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">e.pageX</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">e.page.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">myOffsetInfo.left</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">myOffsetInfo.width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3312</span> </span><span class="WHIT">					    </span><span class="NAME">parentY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">e.pageY</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">e.page.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">myOffsetInfo.top</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">myOffsetInfo.height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3313</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">											</span><span class="WHIT">
<span class='line'>3314</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>3315</span> </span><span class="WHIT">					</span><span class="COMM">// we need to override the anchor in here, and force 'isSource', but we don't want to mess with</span><span class="WHIT">
<span class='line'>3316</span> </span><span class="WHIT">					</span><span class="COMM">// the params passed in, because after a connection is established we're going to reset the endpoint</span><span class="WHIT">
<span class='line'>3317</span> </span><span class="WHIT">					</span><span class="COMM">// to have the anchor we were given.</span><span class="WHIT">
<span class='line'>3318</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tempEndpointParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3319</span> </span><span class="WHIT">					</span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">tempEndpointParams</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3320</span> </span><span class="WHIT">					</span><span class="NAME">tempEndpointParams.isSource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3321</span> </span><span class="WHIT">					</span><span class="NAME">tempEndpointParams.anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3322</span> </span><span class="WHIT">					</span><span class="NAME">tempEndpointParams.parentAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">parentX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parentY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3323</span> </span><span class="WHIT">					</span><span class="NAME">tempEndpointParams.dragOptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dragOptions</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3324</span> </span><span class="WHIT">					</span><span class="COMM">// if a parent was given we need to turn that into a "container" argument.  this is, by default,</span><span class="WHIT">
<span class='line'>3325</span> </span><span class="WHIT">					</span><span class="COMM">// the parent of the element we will move to, so parent of p.parent in this case.  however, if</span><span class="WHIT">
<span class='line'>3326</span> </span><span class="WHIT">					</span><span class="COMM">// the user has specified a 'container' on the endpoint definition or on </span><span class="WHIT">
<span class='line'>3327</span> </span><span class="WHIT">					</span><span class="COMM">// the defaults, we should use that.</span><span class="WHIT">
<span class='line'>3328</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p.parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3329</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">potentialParent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tempEndpointParams.container</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.Container</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.Container</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3330</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">potentialParent</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3331</span> </span><span class="WHIT">							</span><span class="NAME">tempEndpointParams.container</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">potentialParent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3332</span> </span><span class="WHIT">						</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>3333</span> </span><span class="WHIT">							</span><span class="NAME">tempEndpointParams.container</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getParent</span><span class="PUNC">(</span><span class="NAME">p.parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3334</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3335</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>3336</span> </span><span class="WHIT">					</span><span class="NAME">ep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.addEndpoint</span><span class="PUNC">(</span><span class="NAME">elid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tempEndpointParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3337</span> 
<span class='line'>3338</span> </span><span class="WHIT">					</span><span class="NAME">endpointAddedButNoDragYet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3339</span> </span><span class="WHIT">					</span><span class="COMM">// we set this to prevent connections from firing attach events before this function has had a chance</span><span class="WHIT">
<span class='line'>3340</span> </span><span class="WHIT">					</span><span class="COMM">// to move the endpoint.</span><span class="WHIT">
<span class='line'>3341</span> </span><span class="WHIT">					</span><span class="NAME">ep.endpointWillMoveAfterConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.parent</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3342</span> </span><span class="WHIT">					</span><span class="NAME">ep.endpointWillMoveTo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.parent</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">jpcl.getElementObject</span><span class="PUNC">(</span><span class="NAME">p.parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3343</span> 
<span class='line'>3344</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_delTempEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3345</span> </span><span class="WHIT">						</span><span class="COMM">// this mouseup event is fired only if no dragging occurred, by jquery and yui, but for mootools</span><span class="WHIT">
<span class='line'>3346</span> </span><span class="WHIT">						</span><span class="COMM">// it is fired even if dragging has occurred, in which case we would blow away a perfectly</span><span class="WHIT">
<span class='line'>3347</span> </span><span class="WHIT">						</span><span class="COMM">// legitimate endpoint, were it not for this check.  the flag is set after adding an</span><span class="WHIT">
<span class='line'>3348</span> </span><span class="WHIT">						</span><span class="COMM">// endpoint and cleared in a drag listener we set in the dragOptions above.</span><span class="WHIT">
<span class='line'>3349</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">endpointAddedButNoDragYet</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3350</span> </span><span class="WHIT">							</span><span class="NAME">_currentInstance.deleteEndpoint</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3351</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3352</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3353</span> 
<span class='line'>3354</span> </span><span class="WHIT">					</span><span class="NAME">_currentInstance.registerListener</span><span class="PUNC">(</span><span class="NAME">ep.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mouseup"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_delTempEndpoint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3355</span> </span><span class="WHIT">                    </span><span class="NAME">_currentInstance.registerListener</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mouseup"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_delTempEndpoint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3356</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>3357</span> </span><span class="WHIT">					</span><span class="COMM">// and then trigger its mousedown event, which will kick off a drag, which will start dragging</span><span class="WHIT">
<span class='line'>3358</span> </span><span class="WHIT">					</span><span class="COMM">// a new connection from this endpoint.</span><span class="WHIT">
<span class='line'>3359</span> </span><span class="WHIT">					</span><span class="NAME">jpcl.trigger</span><span class="PUNC">(</span><span class="NAME">ep.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mousedown"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3360</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3361</span> </span><span class="WHIT">               </span><span class="WHIT">
<span class='line'>3362</span> </span><span class="WHIT">                </span><span class="COMM">// register this on jsPlumb so that it can be cleared by a reset.</span><span class="WHIT">
<span class='line'>3363</span> </span><span class="WHIT">                </span><span class="NAME">_currentInstance.registerListener</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mousedown"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mouseDownListener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3364</span> </span><span class="WHIT">                </span><span class="NAME">_sourceTriggers</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mouseDownListener</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3365</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3366</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3367</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_convertYUICollection</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3368</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3369</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inputs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el.length</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">el.constructor</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">String</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3370</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>3371</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">inputs.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3372</span> </span><span class="WHIT">				</span><span class="NAME">_doOne</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">inputs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3373</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3374</span> 
<span class='line'>3375</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3376</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3377</span> 
<span class='line'>3378</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>3379</span> 		*	Function: unmakeSource
<span class='line'>3380</span> 		*	Sets the given element to no longer be a connection source.
<span class='line'>3381</span> 		*	
<span class='line'>3382</span> 		*	Parameters:
<span class='line'>3383</span> 		*		el - a string id, a dom element, or a selector representing the element.
<span class='line'>3384</span> 		*		
<span class='line'>3385</span> 		*	Returns:
<span class='line'>3386</span> 		*	The current jsPlumb instance.
<span class='line'>3387</span> 		*/</span><span class="WHIT">
<span class='line'>3388</span> </span><span class="WHIT">		</span><span class="NAME">this.unmakeSource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotClearArrays</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3389</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3390</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3391</span> </span><span class="WHIT">				</span><span class="NAME">mouseDownListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_sourceTriggers</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3392</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3393</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mouseDownListener</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3394</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.unregisterListener</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mousedown"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mouseDownListener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3395</span> 
<span class='line'>3396</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">doNotClearArrays</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3397</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_sourceEndpointDefinitions</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3398</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_sourceEndpointsUnique</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3399</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_sourcesEnabled</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3400</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_sourceTriggers</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3401</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_sourceMaxConnections</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3402</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3403</span> 
<span class='line'>3404</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3405</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3406</span> 
<span class='line'>3407</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3408</span> 		*	Function: unmakeEverySource
<span class='line'>3409</span> 		*	Resets all elements in this instance of jsPlumb so that none of them are connection sources.
<span class='line'>3410</span> 		*	
<span class='line'>3411</span> 		*	Returns:
<span class='line'>3412</span> 		*	The current jsPlumb instance.
<span class='line'>3413</span> 		*/</span><span class="WHIT">
<span class='line'>3414</span> </span><span class="WHIT">		</span><span class="NAME">this.unmakeEverySource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3415</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">_sourcesEnabled</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3416</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.unmakeSource</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3417</span> 
<span class='line'>3418</span> </span><span class="WHIT">			</span><span class="NAME">_sourceEndpointDefinitions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3419</span> </span><span class="WHIT">			</span><span class="NAME">_sourceEndpointsUnique</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3420</span> </span><span class="WHIT">			</span><span class="NAME">_sourcesEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3421</span> </span><span class="WHIT">			</span><span class="NAME">_sourceTriggers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3422</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3423</span> 
<span class='line'>3424</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3425</span> 		*	Function: unmakeEveryTarget
<span class='line'>3426</span> 		*	Resets all elements in this instance of jsPlumb so that none of them are connection targets.
<span class='line'>3427</span> 		*	
<span class='line'>3428</span> 		*	Returns:
<span class='line'>3429</span> 		*	The current jsPlumb instance.
<span class='line'>3430</span> 		*/</span><span class="WHIT">
<span class='line'>3431</span> </span><span class="WHIT">		</span><span class="NAME">this.unmakeEveryTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3432</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">_targetsEnabled</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3433</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.unmakeTarget</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3434</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3435</span> </span><span class="WHIT">			</span><span class="NAME">_targetEndpointDefinitions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3436</span> </span><span class="WHIT">			</span><span class="NAME">_targetEndpointsUnique</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3437</span> </span><span class="WHIT">			</span><span class="NAME">_targetMaxConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3438</span> </span><span class="WHIT">			</span><span class="NAME">_targetsEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3439</span> 
<span class='line'>3440</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3441</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3442</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3443</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3444</span> 		 * Function: makeSources
<span class='line'>3445</span> 		 * Makes all elements in some array or a selector connection sources.
<span class='line'>3446</span> 		 * 
<span class='line'>3447</span> 		 * Parameters:
<span class='line'>3448</span> 		 * 	els 	- 	either an array of ids or a selector
<span class='line'>3449</span> 		 *  params  -   parameters to configure each element as a source with
<span class='line'>3450</span> 		 *  referenceParams - extra parameters to configure each element as a source with.
<span class='line'>3451</span> 		 *
<span class='line'>3452</span> 		 * Returns:
<span class='line'>3453</span> 		 * The current jsPlumb instance.
<span class='line'>3454</span> 		 */</span><span class="WHIT">
<span class='line'>3455</span> </span><span class="WHIT">		</span><span class="NAME">this.makeSources</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">els</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3456</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">els.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3457</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.makeSource</span><span class="PUNC">(</span><span class="NAME">els</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3458</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3459</span> 
<span class='line'>3460</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3461</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3462</span> 
<span class='line'>3463</span> </span><span class="WHIT">		</span><span class="COMM">// does the work of setting a source enabled or disabled.</span><span class="WHIT">
<span class='line'>3464</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_setEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">toggle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3465</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"source"</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_sourcesEnabled</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_targetsEnabled</span><span class="PUNC">;</span><span class="WHIT">									</span><span class="WHIT">
<span class='line'>3466</span> 
<span class='line'>3467</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isString</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">el</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">toggle</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">el</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3468</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3469</span> </span><span class="WHIT">				</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_convertYUICollection</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3470</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">el.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3471</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3472</span> </span><span class="WHIT">					</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">toggle</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3473</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3474</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3475</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3476</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3477</span> 
<span class='line'>3478</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3479</span> 		* Function: setSourceEnabled
<span class='line'>3480</span> 		* Sets the enabled state of one or more elements that were previously made a connection source with the makeSource
<span class='line'>3481</span> 		* method.
<span class='line'>3482</span> 		*
<span class='line'>3483</span> 		* Parameters:
<span class='line'>3484</span> 		*	el 	- 	either a string representing some element's id, or an array of ids, or a selector.
<span class='line'>3485</span> 		*	state - true to enable the element(s), false to disable it.
<span class='line'>3486</span> 		*
<span class='line'>3487</span> 		* Returns:
<span class='line'>3488</span> 		*	The current jsPlumb instance.
<span class='line'>3489</span> 		*/</span><span class="WHIT">
<span class='line'>3490</span> </span><span class="WHIT">		</span><span class="NAME">this.setSourceEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3491</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_setEnabled</span><span class="PUNC">(</span><span class="STRN">"source"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3492</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3493</span> 
<span class='line'>3494</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3495</span> 		*	Function: toggleSourceEnabled
<span class='line'>3496</span> 		*	Toggles the source enabled state of the given element or elements.
<span class='line'>3497</span> 		*
<span class='line'>3498</span> 		* 	Parameters:
<span class='line'>3499</span> 		*		el 	- 	either a string representing some element's id, or an array of ids, or a selector.
<span class='line'>3500</span> 		*		state - true to enable the element(s), false to disable it.
<span class='line'>3501</span> 		*
<span class='line'>3502</span> 		*	Returns:
<span class='line'>3503</span> 		*	The current enabled state of the source.
<span class='line'>3504</span> 		*/</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3505</span> </span><span class="WHIT">		</span><span class="NAME">this.toggleSourceEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3506</span> </span><span class="WHIT">			</span><span class="NAME">_setEnabled</span><span class="PUNC">(</span><span class="STRN">"source"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3507</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance.isSourceEnabled</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3508</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3509</span> 
<span class='line'>3510</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3511</span> 		*	Function: isSource
<span class='line'>3512</span> 		*	Returns whether or not the given element is registered as a connection source.
<span class='line'>3513</span> 		*
<span class='line'>3514</span> 		*	Parameters:
<span class='line'>3515</span> 		*		el 	- 	a string id, a dom element, or a selector representing a single element.
<span class='line'>3516</span> 		*
<span class='line'>3517</span> 		*	Returns:
<span class='line'>3518</span> 		*	True if source, false if not.
<span class='line'>3519</span> 		*/</span><span class="WHIT">
<span class='line'>3520</span> </span><span class="WHIT">		</span><span class="NAME">this.isSource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3521</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3522</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_sourcesEnabled</span><span class="PUNC">[</span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3523</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3524</span> 
<span class='line'>3525</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3526</span> 		*	Function: isSourceEnabled
<span class='line'>3527</span> 		*	Returns whether or not the given connection source is enabled.
<span class='line'>3528</span> 		*
<span class='line'>3529</span> 		*	Parameters:
<span class='line'>3530</span> 		*	el 	- 	a string id, a dom element, or a selector representing a single element.
<span class='line'>3531</span> 		*
<span class='line'>3532</span> 		*	Returns:
<span class='line'>3533</span> 		*	True if enabled, false if not.
<span class='line'>3534</span> 		*/</span><span class="WHIT">
<span class='line'>3535</span> </span><span class="WHIT">		</span><span class="NAME">this.isSourceEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3536</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3537</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_sourcesEnabled</span><span class="PUNC">[</span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3538</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3539</span> 
<span class='line'>3540</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3541</span> 		*	Function: setTargetEnabled
<span class='line'>3542</span> 		*	Sets the enabled state of one or more elements that were previously made a connection target with the makeTarget method.
<span class='line'>3543</span> 		*	method.
<span class='line'>3544</span> 		*
<span class='line'>3545</span> 		*	Parameters:
<span class='line'>3546</span> 		*		el 	- 	either a string representing some element's id, or an array of ids, or a selector.
<span class='line'>3547</span> 		*		state - true to enable the element(s), false to disable it.
<span class='line'>3548</span> 		*
<span class='line'>3549</span> 		*	Returns:
<span class='line'>3550</span> 		*	The current jsPlumb instance.
<span class='line'>3551</span> 		*/</span><span class="WHIT">
<span class='line'>3552</span> </span><span class="WHIT">		</span><span class="NAME">this.setTargetEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3553</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_setEnabled</span><span class="PUNC">(</span><span class="STRN">"target"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3554</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3555</span> 
<span class='line'>3556</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3557</span> 		*	Function: toggleTargetEnabled
<span class='line'>3558</span> 		*	Toggles the target enabled state of the given element or elements.
<span class='line'>3559</span> 		*
<span class='line'>3560</span> 		*	Parameters:
<span class='line'>3561</span> 		*		el 	- 	either a string representing some element's id, or an array of ids, or a selector.
<span class='line'>3562</span> 		*		state - true to enable the element(s), false to disable it.
<span class='line'>3563</span> 		*
<span class='line'>3564</span> 		*	Returns:
<span class='line'>3565</span> 		*	The current enabled state of the target.
<span class='line'>3566</span> 		*/</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3567</span> </span><span class="WHIT">		</span><span class="NAME">this.toggleTargetEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3568</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_setEnabled</span><span class="PUNC">(</span><span class="STRN">"target"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3569</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance.isTargetEnabled</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3570</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3571</span> 
<span class='line'>3572</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3573</span> 			Function: isTarget
<span class='line'>3574</span> 			Returns whether or not the given element is registered as a connection target.
<span class='line'>3575</span> 
<span class='line'>3576</span> 			Parameters:
<span class='line'>3577</span> 				el 	- 	a string id, a dom element, or a selector representing a single element.
<span class='line'>3578</span> 
<span class='line'>3579</span> 			Returns:
<span class='line'>3580</span> 			True if source, false if not.
<span class='line'>3581</span> 		*/</span><span class="WHIT">
<span class='line'>3582</span> </span><span class="WHIT">		</span><span class="NAME">this.isTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3583</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3584</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_targetsEnabled</span><span class="PUNC">[</span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3585</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3586</span> 
<span class='line'>3587</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3588</span> 			Function: isTargetEnabled
<span class='line'>3589</span> 			Returns whether or not the given connection target is enabled.
<span class='line'>3590</span> 
<span class='line'>3591</span> 			Parameters:
<span class='line'>3592</span> 				el 	- 	a string id, a dom element, or a selector representing a single element.
<span class='line'>3593</span> 
<span class='line'>3594</span> 			Returns:
<span class='line'>3595</span> 			True if enabled, false if not.
<span class='line'>3596</span> 		*/</span><span class="WHIT">
<span class='line'>3597</span> </span><span class="WHIT">		</span><span class="NAME">this.isTargetEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3598</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3599</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_targetsEnabled</span><span class="PUNC">[</span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3600</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3601</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3602</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3603</span> 		* Function: ready
<span class='line'>3604</span> 		* Helper method to bind a function to jsPlumb's ready event. You should use this method instead of your
<span class='line'>3605</span> 		* library's equivalent, to ensure that jsPlumb has loaded properly before you start to use it. This is
<span class='line'>3606</span> 		* particularly true in the case of YUI, because of the asynchronous nature of the module loading process.
<span class='line'>3607</span> 		 */</span><span class="WHIT">
<span class='line'>3608</span> </span><span class="WHIT">		</span><span class="NAME">this.ready</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3609</span> </span><span class="WHIT">			</span><span class="NAME">_currentInstance.bind</span><span class="PUNC">(</span><span class="STRN">"ready"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3610</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3611</span> 
<span class='line'>3612</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3613</span> 		* Function: repaint 
<span class='line'>3614</span> 		* Repaints an element and its connections. This method gets new sizes for the elements before painting anything.
<span class='line'>3615</span> 		*  
<span class='line'>3616</span> 		* Parameters: 
<span class='line'>3617</span> 		*	el - id of the element, a dom element, or a selector representing the element.
<span class='line'>3618</span> 		*  	 
<span class='line'>3619</span> 		* Returns: 
<span class='line'>3620</span> 		*	The current jsPlumb instance.
<span class='line'>3621</span> 		*  	 
<span class='line'>3622</span> 		* See Also: 
<span class='line'>3623</span> 		*	&lt;repaintEverything>
<span class='line'>3624</span> 		*/</span><span class="WHIT">
<span class='line'>3625</span> </span><span class="WHIT">		</span><span class="NAME">this.repaint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3626</span> </span><span class="WHIT">			</span><span class="COMM">// support both lists...</span><span class="WHIT">
<span class='line'>3627</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3628</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">el.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3629</span> </span><span class="WHIT">					</span><span class="NAME">_draw</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3630</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3631</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="COMM">// ...and single strings.				</span><span class="WHIT">
<span class='line'>3632</span> </span><span class="WHIT">				</span><span class="NAME">_draw</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3633</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3634</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3635</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3636</span> 
<span class='line'>3637</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3638</span> 		* Function: repaintEverything 
<span class='line'>3639</span> 		* Repaints all connections.
<span class='line'>3640</span> 		*  
<span class='line'>3641</span> 		* Returns: 
<span class='line'>3642</span> 		*	The current jsPlumb instance.
<span class='line'>3643</span> 		* 	
<span class='line'>3644</span> 		* See Also: 
<span class='line'>3645</span> 		*	&lt;repaint>
<span class='line'>3646</span> 		*/</span><span class="WHIT">
<span class='line'>3647</span> </span><span class="WHIT">		</span><span class="NAME">this.repaintEverything</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3648</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3649</span> </span><span class="WHIT">				</span><span class="NAME">_draw</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">elId</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3650</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3651</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3652</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3653</span> 
<span class='line'>3654</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3655</span> 		* Function: removeAllEndpoints 
<span class='line'>3656</span> 		* Removes all Endpoints associated with a given element. Also removes all Connections associated with each Endpoint it removes.
<span class='line'>3657</span> 		* 
<span class='line'>3658</span> 		* Parameters: 
<span class='line'>3659</span> 		*	el - either an element id, or a selector for an element.
<span class='line'>3660</span> 		*  	 
<span class='line'>3661</span> 		* Returns: 
<span class='line'>3662</span> 		* The current jsPlumb instance.
<span class='line'>3663</span> 		*  	 
<span class='line'>3664</span> 		* See Also: 
<span class='line'>3665</span> 		* &lt;removeEndpoint>
<span class='line'>3666</span> 		*/</span><span class="WHIT">
<span class='line'>3667</span> </span><span class="WHIT">		</span><span class="NAME">this.removeAllEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3668</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3669</span> </span><span class="WHIT">			    </span><span class="NAME">ebe</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3670</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ebe</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3671</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ebe.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3672</span> </span><span class="WHIT">					</span><span class="NAME">_currentInstance.deleteEndpoint</span><span class="PUNC">(</span><span class="NAME">ebe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3673</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3674</span> </span><span class="WHIT">			</span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3675</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3676</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3677</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3678</span> 
<span class='line'>3679</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_registeredListeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3680</span> </span><span class="WHIT">			</span><span class="NAME">_unbindRegisteredListeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3681</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">_registeredListeners</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3682</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">_registeredListeners</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3683</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">info</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_registeredListeners</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3684</span> </span><span class="WHIT">						</span><span class="NAME">jsPlumb.CurrentLibrary.unbind</span><span class="PUNC">(</span><span class="NAME">info.el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">info.event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">info.listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3685</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3686</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3687</span> </span><span class="WHIT">				</span><span class="NAME">_registeredListeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3688</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3689</span> 
<span class='line'>3690</span> </span><span class="WHIT">        </span><span class="COMM">// internal register listener method.  gives us a hook to clean things up</span><span class="WHIT">
<span class='line'>3691</span> </span><span class="WHIT">        </span><span class="COMM">// with if the user calls jsPlumb.reset.</span><span class="WHIT">
<span class='line'>3692</span> </span><span class="WHIT">        </span><span class="NAME">this.registerListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3693</span> </span><span class="WHIT">            </span><span class="NAME">jsPlumb.CurrentLibrary.bind</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3694</span> </span><span class="WHIT">            </span><span class="NAME">_addToList</span><span class="PUNC">(</span><span class="NAME">_registeredListeners</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">el</span><span class="PUNC">:</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">event</span><span class="PUNC">:</span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">:</span><span class="NAME">listener</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3695</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3696</span> 
<span class='line'>3697</span> </span><span class="WHIT">        </span><span class="NAME">this.unregisterListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3698</span> </span><span class="WHIT">        	</span><span class="NAME">jsPlumb.CurrentLibrary.unbind</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3699</span> </span><span class="WHIT">        	</span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">_registeredListeners</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3700</span> </span><span class="WHIT">        		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rl.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">rl.listener</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3701</span> </span><span class="WHIT">        	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3702</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3703</span> 
<span class='line'>3704</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3705</span> 		* Function:reset 
<span class='line'>3706</span> 		* Removes all endpoints and connections and clears the listener list. To keep listeners call
<span class='line'>3707</span> 		* : jsPlumb.deleteEveryEndpoint()
<span class='line'>3708</span> 		* instead of this.
<span class='line'>3709</span> 		*/</span><span class="WHIT">
<span class='line'>3710</span> </span><span class="WHIT">		</span><span class="NAME">this.reset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3711</span> </span><span class="WHIT">			</span><span class="NAME">_currentInstance.deleteEveryEndpoint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3712</span> </span><span class="WHIT">			</span><span class="NAME">_currentInstance.unbind</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3713</span> </span><span class="WHIT">			</span><span class="NAME">_targetEndpointDefinitions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3714</span> </span><span class="WHIT">			</span><span class="NAME">_targetEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3715</span> </span><span class="WHIT">			</span><span class="NAME">_targetEndpointsUnique</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3716</span> </span><span class="WHIT">			</span><span class="NAME">_targetMaxConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3717</span> </span><span class="WHIT">			</span><span class="NAME">_sourceEndpointDefinitions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3718</span> </span><span class="WHIT">			</span><span class="NAME">_sourceEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3719</span> </span><span class="WHIT">			</span><span class="NAME">_sourceEndpointsUnique</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3720</span> </span><span class="WHIT">			</span><span class="NAME">_sourceMaxConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3721</span> </span><span class="WHIT">			</span><span class="NAME">_unbindRegisteredListeners</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3722</span> </span><span class="WHIT">			</span><span class="NAME">_currentInstance.anchorManager.reset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3723</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">jsPlumbAdapter.headless</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3724</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.dragManager.reset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3725</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3726</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3727</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3728</span> 		 * Function: setDefaultScope 
<span class='line'>3729</span> 		 * Sets the default scope for Connections and Endpoints. A scope defines a type of Endpoint/Connection; supplying a
<span class='line'>3730</span> 		 * scope to an Endpoint or Connection allows you to support different
<span class='line'>3731</span> 		 * types of Connections in the same UI.  If you're only interested in
<span class='line'>3732</span> 		 * one type of Connection, you don't need to supply a scope. This method
<span class='line'>3733</span> 		 * will probably be used by very few people; it just instructs jsPlumb
<span class='line'>3734</span> 		 * to use a different key for the default scope.
<span class='line'>3735</span> 		 * 
<span class='line'>3736</span> 		 * Parameters:
<span class='line'>3737</span> 		 * 	scope - scope to set as default.
<span class='line'>3738</span> 		 *
<span class='line'>3739</span> 		 * Returns:
<span class='line'>3740</span> 		 * The current jsPlumb instance.
<span class='line'>3741</span> 		 */</span><span class="WHIT">
<span class='line'>3742</span> </span><span class="WHIT">		</span><span class="NAME">this.setDefaultScope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">scope</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3743</span> </span><span class="WHIT">			</span><span class="NAME">DEFAULT_SCOPE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3744</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3745</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3746</span> 
<span class='line'>3747</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3748</span> 		 * Function: setDraggable 
<span class='line'>3749</span> 		 * Sets whether or not a given element is
<span class='line'>3750</span> 		 * draggable, regardless of what any jsPlumb command may request.
<span class='line'>3751</span> 		 * 
<span class='line'>3752</span> 		 * Parameters: 
<span class='line'>3753</span> 		 * 	el - either the id for the element, or a selector representing the element.
<span class='line'>3754</span> 		 * 	draggable - whether or not the element should be draggable.
<span class='line'>3755</span> 		 *  
<span class='line'>3756</span> 		 * Returns: 
<span class='line'>3757</span> 		 * 	void
<span class='line'>3758</span> 		 */</span><span class="WHIT">
<span class='line'>3759</span> </span><span class="WHIT">		</span><span class="NAME">this.setDraggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_setDraggable</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3760</span> 
<span class='line'>3761</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3762</span> 		* Function: setId
<span class='line'>3763</span> 		* Changes the id of some element, adjusting all connections and endpoints
<span class='line'>3764</span> 		*
<span class='line'>3765</span> 		* Parameters:
<span class='line'>3766</span> 		* 	el - a selector, a DOM element, or a string. 
<span class='line'>3767</span> 		* 	newId - string.
<span class='line'>3768</span> 		*/</span><span class="WHIT">
<span class='line'>3769</span> </span><span class="WHIT">		</span><span class="NAME">this.setId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotSetAttribute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3770</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3771</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">String</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3772</span> </span><span class="WHIT">				</span><span class="NAME">sConns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getConnections</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">source</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">:</span><span class="STRN">'*'</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3773</span> </span><span class="WHIT">				</span><span class="NAME">tConns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getConnections</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">target</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">:</span><span class="STRN">'*'</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3774</span> 
<span class='line'>3775</span> </span><span class="WHIT">			</span><span class="NAME">newId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3776</span> </span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>3777</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">doNotSetAttribute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3778</span> </span><span class="WHIT">				</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3779</span> </span><span class="WHIT">				</span><span class="NAME">jsPlumb.CurrentLibrary.setAttribute</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3780</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3781</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3782</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">newId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3783</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3784</span> 
<span class='line'>3785</span> </span><span class="WHIT">			</span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">newId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3786</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">newId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3787</span> </span><span class="WHIT">				</span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">newId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">elementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3788</span> </span><span class="WHIT">				</span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">newId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3789</span> </span><span class="WHIT">				</span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">newId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor.elementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3790</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3791</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3792</span> 
<span class='line'>3793</span> </span><span class="WHIT">			</span><span class="NAME">_currentInstance.anchorManager.changeId</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3794</span> 
<span class='line'>3795</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_conns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">epIdx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3796</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">list.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3797</span> </span><span class="WHIT">					</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">epIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">elementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3798</span> </span><span class="WHIT">					</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">epIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3799</span> </span><span class="WHIT">					</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"Id"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3800</span> </span><span class="WHIT">					</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3801</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3802</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3803</span> </span><span class="WHIT">			</span><span class="NAME">_conns</span><span class="PUNC">(</span><span class="NAME">sConns</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"source"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3804</span> </span><span class="WHIT">			</span><span class="NAME">_conns</span><span class="PUNC">(</span><span class="NAME">tConns</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"target"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3805</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3806</span> 
<span class='line'>3807</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3808</span> 		* Function: setIdChanged
<span class='line'>3809</span> 		* Notify jsPlumb that the element with oldId has had its id changed to newId.
<span class='line'>3810</span> 		*
<span class='line'>3811</span> 		* This method is equivalent to what jsPlumb does itself in the second step of the setId method above.
<span class='line'>3812</span> 		*
<span class='line'>3813</span> 		* Parameters:
<span class='line'>3814</span> 		* 	oldId	- 	previous element id
<span class='line'>3815</span> 		* 	newId	-	element's new id
<span class='line'>3816</span> 		*
<span class='line'>3817</span> 		* See Also:
<span class='line'>3818</span> 		* 	&lt;setId>
<span class='line'>3819</span> 		*/</span><span class="WHIT">
<span class='line'>3820</span> </span><span class="WHIT">		</span><span class="NAME">this.setIdChanged</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">oldId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3821</span> </span><span class="WHIT">			</span><span class="NAME">_currentInstance.setId</span><span class="PUNC">(</span><span class="NAME">oldId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3822</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3823</span> 
<span class='line'>3824</span> </span><span class="WHIT">		</span><span class="NAME">this.setDebugLog</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">debugLog</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3825</span> </span><span class="WHIT">			</span><span class="NAME">log</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">debugLog</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3826</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3827</span> 
<span class='line'>3828</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3829</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_suspendDrawing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3830</span> </span><span class="WHIT">				</span><span class="NAME">_suspendedAt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3831</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3832</span> 		 * Function: setSuspendDrawing
<span class='line'>3833</span> 		 * Suspends drawing operations.  This can (and should!) be used when you have a lot of connections to make or endpoints to register;
<span class='line'>3834</span> 		 * it will save you a lot of time.
<span class='line'>3835</span> 		 *
<span class='line'>3836</span> 		 * Parameters:
<span class='line'>3837</span> 		 * 	val	-	boolean indicating whether to suspend or not
<span class='line'>3838</span> 		 * 	repaintAfterwards	-	optional boolean instructing jsPlumb to do a full repaint after changing the suspension
<span class='line'>3839</span> 		 * 	state. defaults to false.
<span class='line'>3840</span> 		 */</span><span class="WHIT">
<span class='line'>3841</span> </span><span class="WHIT">		</span><span class="NAME">this.setSuspendDrawing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">val</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">repaintAfterwards</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3842</span> </span><span class="WHIT">		    </span><span class="NAME">_suspendDrawing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">val</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3843</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">val</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_suspendedAt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">_suspendedAt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3844</span> </span><span class="WHIT">		    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">repaintAfterwards</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_currentInstance.repaintEverything</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3845</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3846</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>3847</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3848</span> 		* Function: isSuspendDrawing
<span class='line'>3849</span> 		* Returns whether or not drawing is currently suspended.
<span class='line'>3850</span> 		*/</span><span class="WHIT">
<span class='line'>3851</span> </span><span class="WHIT">		</span><span class="NAME">this.isSuspendDrawing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3852</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_suspendDrawing</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3853</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3854</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3855</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3856</span> 		 * Property: CANVAS
<span class='line'>3857</span> 		 * Constant for use with the setRenderMode method
<span class='line'>3858</span> 		 */</span><span class="WHIT">
<span class='line'>3859</span> </span><span class="WHIT">		</span><span class="NAME">this.CANVAS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"canvas"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3860</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3861</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3862</span> 		 * Property: SVG
<span class='line'>3863</span> 		 * Constant for use with the setRenderMode method
<span class='line'>3864</span> 		 */</span><span class="WHIT">
<span class='line'>3865</span> </span><span class="WHIT">		</span><span class="NAME">this.SVG</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"svg"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3866</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3867</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3868</span> 		 * Property: VML
<span class='line'>3869</span> 		 * Constant for use with the setRenderMode method
<span class='line'>3870</span> 		 */</span><span class="WHIT">
<span class='line'>3871</span> </span><span class="WHIT">		</span><span class="NAME">this.VML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"vml"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3872</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3873</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3874</span> 		 * Function: setRenderMode
<span class='line'>3875</span> 		 * Sets render mode: jsPlumb.CANVAS, jsPlumb.SVG or jsPlumb.VML.  jsPlumb will fall back to VML if it determines that
<span class='line'>3876</span> 		 * what you asked for is not supported (and that VML is).  If you asked for VML but the browser does
<span class='line'>3877</span> 		 * not support it, jsPlumb uses SVG.
<span class='line'>3878</span> 		 *
<span class='line'>3879</span> 		 * Parameters:
<span class='line'>3880</span> 		 * mode	-	a string representing the mode. Use one of the jsPlumb render mode constants as discussed above.
<span class='line'>3881</span> 		 * 
<span class='line'>3882</span> 		 * Returns:
<span class='line'>3883</span> 		 * The render mode that jsPlumb set, which of course may be different from that requested.
<span class='line'>3884</span> 		 */</span><span class="WHIT">
<span class='line'>3885</span> </span><span class="WHIT">		</span><span class="NAME">this.setRenderMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">mode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3886</span> </span><span class="WHIT">			</span><span class="NAME">renderMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbAdapter.setRenderMode</span><span class="PUNC">(</span><span class="NAME">mode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3887</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">renderMode</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3888</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3889</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3890</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3891</span> 		 * Function: getRenderMode
<span class='line'>3892</span> 		 *
<span class='line'>3893</span> 		 * Returns:
<span class='line'>3894</span> 		 * The current render mode.
<span class='line'>3895</span> 		 */</span><span class="WHIT">
<span class='line'>3896</span> </span><span class="WHIT">		</span><span class="NAME">this.getRenderMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">renderMode</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3897</span> 
<span class='line'>3898</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3899</span> 		 * Function: show 
<span class='line'>3900</span> 		 * Sets an element's connections to be visible.
<span class='line'>3901</span> 		 * 
<span class='line'>3902</span> 		 * Parameters: 
<span class='line'>3903</span> 		 * 	el - either the id of the element, or a selector for the element.
<span class='line'>3904</span> 		 *  changeEndpoints - whether or not to also change the visible state of the endpoints on the element.  this also has a bearing on
<span class='line'>3905</span> 		 *  other connections on those endpoints: if their other endpoint is also visible, the connections are made visible.  
<span class='line'>3906</span> 		 *  
<span class='line'>3907</span> 		 * Returns: 
<span class='line'>3908</span> 		 * 	The current jsPlumb instance.
<span class='line'>3909</span> 		 */</span><span class="WHIT">
<span class='line'>3910</span> </span><span class="WHIT">		</span><span class="NAME">this.show</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">changeEndpoints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3911</span> </span><span class="WHIT">			</span><span class="NAME">_setVisible</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"block"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">changeEndpoints</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3912</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3913</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3914</span> 
<span class='line'>3915</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3916</span> 		 * Function: sizeCanvas 
<span class='line'>3917</span> 		 * Helper to size a canvas. You would typically use
<span class='line'>3918</span> 		 * this when writing your own Connector or Endpoint implementation.
<span class='line'>3919</span> 		 * 
<span class='line'>3920</span> 		 * Parameters: 
<span class='line'>3921</span> 		 * 	x - [int] x position for the Canvas origin 
<span class='line'>3922</span> 		 * 	y - [int] y position for the Canvas origin 
<span class='line'>3923</span> 		 * 	w - [int] width of the canvas 
<span class='line'>3924</span> 		 * 	h - [int] height of the canvas
<span class='line'>3925</span> 		 *  
<span class='line'>3926</span> 		 * Returns: 
<span class='line'>3927</span> 		 * 	The current jsPlumb instance
<span class='line'>3928</span> 		 */</span><span class="WHIT">
<span class='line'>3929</span> </span><span class="WHIT">		</span><span class="NAME">this.sizeCanvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3930</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">canvas</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3931</span> </span><span class="WHIT">				</span><span class="NAME">canvas.style.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3932</span> </span><span class="WHIT">				</span><span class="NAME">canvas.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3933</span> </span><span class="WHIT">				</span><span class="NAME">canvas.style.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3934</span> </span><span class="WHIT">				</span><span class="NAME">canvas.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3935</span> </span><span class="WHIT">				</span><span class="NAME">canvas.style.left</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3936</span> </span><span class="WHIT">				</span><span class="NAME">canvas.style.top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3937</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3938</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3939</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3940</span> 
<span class='line'>3941</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>3942</span> 		 * gets some test hooks. nothing writable.
<span class='line'>3943</span> 		 */</span><span class="WHIT">
<span class='line'>3944</span> </span><span class="WHIT">		</span><span class="NAME">this.getTestHarness</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3945</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3946</span> </span><span class="WHIT">				</span><span class="NAME">endpointsByElement</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>3947</span> </span><span class="WHIT">				</span><span class="NAME">endpointCount</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3948</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3949</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">e.length</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3950</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3951</span> </span><span class="WHIT">				</span><span class="NAME">connectionCount</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">scope</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3952</span> </span><span class="WHIT">					</span><span class="NAME">scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">DEFAULT_SCOPE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3953</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectionsByScope</span><span class="PUNC">[</span><span class="NAME">scope</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3954</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">c.length</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3955</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3956</span> </span><span class="WHIT">				</span><span class="COMM">//findIndex : _findIndex,</span><span class="WHIT">
<span class='line'>3957</span> </span><span class="WHIT">				</span><span class="NAME">getId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3958</span> </span><span class="WHIT">				</span><span class="NAME">makeAnchor</span><span class="PUNC">:</span><span class="NAME">self.makeAnchor</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3959</span> </span><span class="WHIT">				</span><span class="NAME">makeDynamicAnchor</span><span class="PUNC">:</span><span class="NAME">self.makeDynamicAnchor</span><span class="WHIT">
<span class='line'>3960</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3961</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3962</span> 
<span class='line'>3963</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>3964</span> 		 * Toggles visibility of an element's connections. kept for backwards
<span class='line'>3965</span> 		 * compatibility
<span class='line'>3966</span> 		 */</span><span class="WHIT">
<span class='line'>3967</span> </span><span class="WHIT">		</span><span class="NAME">this.toggle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_toggleVisible</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3968</span> 
<span class='line'>3969</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3970</span> 		 * Function: toggleVisible 
<span class='line'>3971</span> 		 * Toggles visibility of an element's Connections.
<span class='line'>3972</span> 		 *  
<span class='line'>3973</span> 		 * Parameters: 
<span class='line'>3974</span> 		 * 	el - either the element's id, or a selector representing the element.
<span class='line'>3975</span> 		 *  changeEndpoints - whether or not to also toggle the endpoints on the element.
<span class='line'>3976</span> 		 *  
<span class='line'>3977</span> 		 * Returns: 
<span class='line'>3978</span> 		 * 	void, but should be updated to return the current state
<span class='line'>3979</span> 		 */</span><span class="WHIT">
<span class='line'>3980</span> </span><span class="WHIT">		</span><span class="COMM">// TODO: update this method to return the current state.</span><span class="WHIT">
<span class='line'>3981</span> </span><span class="WHIT">		</span><span class="NAME">this.toggleVisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_toggleVisible</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3982</span> 
<span class='line'>3983</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3984</span> 		 * Function: toggleDraggable 
<span class='line'>3985</span> 		 * Toggles draggability (sic?) of an element's Connections.
<span class='line'>3986</span> 		 *  
<span class='line'>3987</span> 		 * Parameters: 
<span class='line'>3988</span> 		 * 	el - either the element's id, or a selector representing the element.
<span class='line'>3989</span> 		 *  
<span class='line'>3990</span> 		 * Returns: 
<span class='line'>3991</span> 		 * 	The current draggable state.
<span class='line'>3992</span> 		 */</span><span class="WHIT">
<span class='line'>3993</span> </span><span class="WHIT">		</span><span class="NAME">this.toggleDraggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_toggleDraggable</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3994</span> 
<span class='line'>3995</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3996</span> 		 * Helper method to wrap an existing function with one of
<span class='line'>3997</span> 		 * your own. This is used by the various implementations to wrap event
<span class='line'>3998</span> 		 * callbacks for drag/drop etc; it allows jsPlumb to be transparent in
<span class='line'>3999</span> 		 * its handling of these things. If a user supplies their own event
<span class='line'>4000</span> 		 * callback, for anything, it will always be called. 
<span class='line'>4001</span> 		 */</span><span class="WHIT">
<span class='line'>4002</span> </span><span class="WHIT">		</span><span class="NAME">this.wrap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4003</span> </span><span class="WHIT">		</span><span class="NAME">this.addListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.bind</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4004</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>4005</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">adjustForParentOffsetAndScroll</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">xy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4006</span> 
<span class='line'>4007</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">offsetParent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4008</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el.tagName.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"svg"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">el.parentNode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4009</span> </span><span class="WHIT">				</span><span class="NAME">offsetParent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el.parentNode</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4010</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4011</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el.offsetParent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4012</span> </span><span class="WHIT">				</span><span class="NAME">offsetParent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el.offsetParent</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4013</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4014</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">offsetParent</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4015</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">po</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetParent.tagName.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"body"</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">top</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_getOffset</span><span class="PUNC">(</span><span class="NAME">offsetParent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4016</span> </span><span class="WHIT">					</span><span class="NAME">so</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetParent.tagName.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"body"</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">top</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NAME">offsetParent.scrollLeft</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">:</span><span class="NAME">offsetParent.scrollTop</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4017</span> 
<span class='line'>4018</span> 
<span class='line'>4019</span> </span><span class="WHIT">				</span><span class="COMM">// i thought it might be cool to do this:</span><span class="WHIT">
<span class='line'>4020</span> </span><span class="WHIT">				</span><span class="COMM">//	lastReturnValue[0] = lastReturnValue[0] - offsetParent.offsetLeft + offsetParent.scrollLeft;</span><span class="WHIT">
<span class='line'>4021</span> </span><span class="WHIT">				</span><span class="COMM">//	lastReturnValue[1] = lastReturnValue[1] - offsetParent.offsetTop + offsetParent.scrollTop;					</span><span class="WHIT">
<span class='line'>4022</span> </span><span class="WHIT">				</span><span class="COMM">// but i think it ignores margins.  my reasoning was that it's quicker to not hand off to some underlying					</span><span class="WHIT">
<span class='line'>4023</span> </span><span class="WHIT">				</span><span class="COMM">// library.</span><span class="WHIT">
<span class='line'>4024</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4025</span> </span><span class="WHIT">				</span><span class="NAME">result</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">po.left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">so.left</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4026</span> </span><span class="WHIT">				</span><span class="NAME">result</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">po.top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">so.top</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4027</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4028</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>4029</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4030</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4031</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4032</span> 
<span class='line'>4033</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>4034</span> 		 * Anchors model a position on some element at which an Endpoint may be located.  They began as a first class citizen of jsPlumb, ie. a user
<span class='line'>4035</span> 		 * was required to create these themselves, but over time this has been replaced by the concept of referring to them either by name (eg. "TopMiddle"),
<span class='line'>4036</span> 		 * or by an array describing their coordinates (eg. [ 0, 0.5, 0, -1 ], which is the same as "TopMiddle").  jsPlumb now handles all of the
<span class='line'>4037</span> 		 * creation of Anchors without user intervention.
<span class='line'>4038</span> 		 */</span><span class="WHIT">
<span class='line'>4039</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4040</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4041</span> </span><span class="WHIT">			</span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.x</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4042</span> </span><span class="WHIT">			</span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.y</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4043</span> </span><span class="WHIT">			</span><span class="NAME">this.elementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4044</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.orientation</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4045</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lastTimestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lastReturnValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4046</span> </span><span class="WHIT">			</span><span class="NAME">this.offsets</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.offsets</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4047</span> </span><span class="WHIT">			</span><span class="NAME">self.timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4048</span> </span><span class="WHIT">			</span><span class="NAME">this.compute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4049</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.xy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.wh</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.timestamp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4050</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4051</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">self.timestamp</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4052</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">lastReturnValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4053</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>4054</span> </span><span class="WHIT">				</span><span class="NAME">lastReturnValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.x</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">self.offsets</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.y</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">self.offsets</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4055</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4056</span> </span><span class="WHIT">				</span><span class="COMM">// adjust loc if there is an offsetParent</span><span class="WHIT">
<span class='line'>4057</span> </span><span class="WHIT">				</span><span class="NAME">lastReturnValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">adjustForParentOffsetAndScroll</span><span class="PUNC">(</span><span class="NAME">lastReturnValue</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element.canvas</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4058</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4059</span> </span><span class="WHIT">				</span><span class="NAME">self.timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4060</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">lastReturnValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4061</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4062</span> 
<span class='line'>4063</span> </span><span class="WHIT">			</span><span class="NAME">this.getOrientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4064</span> 
<span class='line'>4065</span> </span><span class="WHIT">			</span><span class="NAME">this.equals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4066</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4067</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ao</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchor.getOrientation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4068</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getOrientation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4069</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">anchor.x</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">anchor.y</span><span class="WHIT">
<span class='line'>4070</span> </span><span class="WHIT">						</span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.offsets</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">anchor.offsets</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>4071</span> </span><span class="WHIT">						</span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.offsets</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">anchor.offsets</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>4072</span> </span><span class="WHIT">						</span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">ao</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">ao</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4073</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4074</span> 
<span class='line'>4075</span> </span><span class="WHIT">			</span><span class="NAME">this.getCurrentLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">lastReturnValue</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4076</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4077</span> 
<span class='line'>4078</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>4079</span> 		 * An Anchor that floats. its orientation is computed dynamically from
<span class='line'>4080</span> 		 * its position relative to the anchor it is floating relative to.  It is used when creating 
<span class='line'>4081</span> 		 * a connection through drag and drop.
<span class='line'>4082</span> 		 * 
<span class='line'>4083</span> 		 * TODO FloatingAnchor could totally be refactored to extend Anchor just slightly.
<span class='line'>4084</span> 		 */</span><span class="WHIT">
<span class='line'>4085</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">FloatingAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4086</span> 
<span class='line'>4087</span> </span><span class="WHIT">			</span><span class="COMM">// this is the anchor that this floating anchor is referenced to for</span><span class="WHIT">
<span class='line'>4088</span> </span><span class="WHIT">			</span><span class="COMM">// purposes of calculating the orientation.</span><span class="WHIT">
<span class='line'>4089</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ref</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.reference</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4090</span> </span><span class="WHIT">			</span><span class="COMM">// the canvas this refers to.</span><span class="WHIT">
<span class='line'>4091</span> </span><span class="WHIT">			</span><span class="NAME">refCanvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.referenceCanvas</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4092</span> </span><span class="WHIT">			</span><span class="NAME">size</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getSize</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">refCanvas</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4093</span> 
<span class='line'>4094</span> </span><span class="WHIT">			</span><span class="COMM">// these are used to store the current relative position of our</span><span class="WHIT">
<span class='line'>4095</span> </span><span class="WHIT">			</span><span class="COMM">// anchor wrt the reference anchor. they only indicate</span><span class="WHIT">
<span class='line'>4096</span> </span><span class="WHIT">			</span><span class="COMM">// direction, so have a value of 1 or -1 (or, very rarely, 0). these</span><span class="WHIT">
<span class='line'>4097</span> </span><span class="WHIT">			</span><span class="COMM">// values are written by the compute method, and read</span><span class="WHIT">
<span class='line'>4098</span> </span><span class="WHIT">			</span><span class="COMM">// by the getOrientation method.</span><span class="WHIT">
<span class='line'>4099</span> </span><span class="WHIT">			</span><span class="NAME">xDir</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">yDir</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4100</span> </span><span class="WHIT">			</span><span class="COMM">// temporary member used to store an orientation when the floating</span><span class="WHIT">
<span class='line'>4101</span> </span><span class="WHIT">			</span><span class="COMM">// anchor is hovering over another anchor.</span><span class="WHIT">
<span class='line'>4102</span> </span><span class="WHIT">			</span><span class="NAME">orientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4103</span> </span><span class="WHIT">			</span><span class="NAME">_lastResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4104</span> 
<span class='line'>4105</span> </span><span class="WHIT">			</span><span class="COMM">// set these to 0 each; they are used by certain types of connectors in the loopback case,</span><span class="WHIT">
<span class='line'>4106</span> </span><span class="WHIT">			</span><span class="COMM">// when the connector is trying to clear the element it is on. but for floating anchor it's not</span><span class="WHIT">
<span class='line'>4107</span> </span><span class="WHIT">			</span><span class="COMM">// very important.</span><span class="WHIT">
<span class='line'>4108</span> </span><span class="WHIT">			</span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4109</span> 
<span class='line'>4110</span> </span><span class="WHIT">			</span><span class="NAME">this.isFloating</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4111</span> 
<span class='line'>4112</span> </span><span class="WHIT">			</span><span class="NAME">this.compute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4113</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.xy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.element</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4114</span> </span><span class="WHIT">				</span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// return origin of the element. we may wish to improve this so that any object can be the drag proxy.</span><span class="WHIT">
<span class='line'>4115</span> </span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>4116</span> </span><span class="WHIT">				</span><span class="COMM">// adjust loc if there is an offsetParent</span><span class="WHIT">
<span class='line'>4117</span> </span><span class="WHIT">				</span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">adjustForParentOffsetAndScroll</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element.canvas</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4118</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4119</span> </span><span class="WHIT">				</span><span class="NAME">_lastResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4120</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4121</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4122</span> 
<span class='line'>4123</span> </span><span class="WHIT">			</span><span class="NAME">this.getOrientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4124</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">orientation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4125</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4126</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ref.getOrientation</span><span class="PUNC">(</span><span class="NAME">_endpoint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4127</span> </span><span class="WHIT">					</span><span class="COMM">// here we take into account the orientation of the other</span><span class="WHIT">
<span class='line'>4128</span> </span><span class="WHIT">					</span><span class="COMM">// anchor: if it declares zero for some direction, we declare zero too. this might not be the most awesome. perhaps we can come</span><span class="WHIT">
<span class='line'>4129</span> </span><span class="WHIT">					</span><span class="COMM">// up with a better way. it's just so that the line we draw looks like it makes sense. maybe this wont make sense.</span><span class="WHIT">
<span class='line'>4130</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">xDir</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4131</span> </span><span class="WHIT">							</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">yDir</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4132</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4133</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4134</span> 
<span class='line'>4135</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>4136</span> 			 * notification the endpoint associated with this anchor is hovering
<span class='line'>4137</span> 			 * over another anchor; we want to assume that anchor's orientation
<span class='line'>4138</span> 			 * for the duration of the hover.
<span class='line'>4139</span> 			 */</span><span class="WHIT">
<span class='line'>4140</span> </span><span class="WHIT">			</span><span class="NAME">this.over</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4141</span> </span><span class="WHIT">				</span><span class="NAME">orientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchor.getOrientation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4142</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4143</span> 
<span class='line'>4144</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>4145</span> 			 * notification the endpoint associated with this anchor is no
<span class='line'>4146</span> 			 * longer hovering over another anchor; we should resume calculating
<span class='line'>4147</span> 			 * orientation as we normally do.
<span class='line'>4148</span> 			 */</span><span class="WHIT">
<span class='line'>4149</span> </span><span class="WHIT">			</span><span class="NAME">this.out</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4150</span> 
<span class='line'>4151</span> </span><span class="WHIT">			</span><span class="NAME">this.getCurrentLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_lastResult</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4152</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4153</span> 
<span class='line'>4154</span> </span><span class="WHIT">		</span><span class="COMM">/* 
<span class='line'>4155</span> 		 * A DynamicAnchor is an Anchor that contains a list of other Anchors, which it cycles
<span class='line'>4156</span> 		 * through at compute time to find the one that is located closest to
<span class='line'>4157</span> 		 * the center of the target element, and returns that Anchor's compute
<span class='line'>4158</span> 		 * method result. this causes endpoints to follow each other with
<span class='line'>4159</span> 		 * respect to the orientation of their target elements, which is a useful
<span class='line'>4160</span> 		 * feature for some applications.
<span class='line'>4161</span> 		 * 
<span class='line'>4162</span> 		 */</span><span class="WHIT">
<span class='line'>4163</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">DynamicAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchors</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchorSelector</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4164</span> </span><span class="WHIT">			</span><span class="NAME">this.isSelective</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4165</span> </span><span class="WHIT">			</span><span class="NAME">this.isDynamic</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4166</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_anchors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4167</span> </span><span class="WHIT">			</span><span class="NAME">_convert</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4168</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">anchor.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Anchor</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_currentInstance.makeAnchor</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4169</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4170</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">anchors.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4171</span> </span><span class="WHIT">				</span><span class="NAME">_anchors</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_convert</span><span class="PUNC">(</span><span class="NAME">anchors</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4172</span> </span><span class="WHIT">			</span><span class="NAME">this.addAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">_anchors.push</span><span class="PUNC">(</span><span class="NAME">_convert</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4173</span> </span><span class="WHIT">			</span><span class="NAME">this.getAnchors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_anchors</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4174</span> </span><span class="WHIT">			</span><span class="NAME">this.locked</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4175</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_curAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_anchors.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_anchors</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4176</span> </span><span class="WHIT">				</span><span class="NAME">_curIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_anchors.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4177</span> </span><span class="WHIT">				</span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4178</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4179</span> </span><span class="WHIT">				</span><span class="COMM">// helper method to calculate the distance between the centers of the two elements.</span><span class="WHIT">
<span class='line'>4180</span> </span><span class="WHIT">				</span><span class="NAME">_distance</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4181</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ax</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">anchor.x</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">anchor.y</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4182</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">cx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">ax</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">cy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">ay</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4183</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4184</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4185</span> </span><span class="WHIT">			</span><span class="COMM">// default method uses distance between element centers.  you can provide your own method in the dynamic anchor</span><span class="WHIT">
<span class='line'>4186</span> </span><span class="WHIT">			</span><span class="COMM">// constructor (and also to jsPlumb.makeDynamicAnchor). the arguments to it are four arrays: </span><span class="WHIT">
<span class='line'>4187</span> </span><span class="WHIT">			</span><span class="COMM">// xy - xy loc of the anchor's element</span><span class="WHIT">
<span class='line'>4188</span> </span><span class="WHIT">			</span><span class="COMM">// wh - anchor's element's dimensions</span><span class="WHIT">
<span class='line'>4189</span> </span><span class="WHIT">			</span><span class="COMM">// txy - xy loc of the element of the other anchor in the connection</span><span class="WHIT">
<span class='line'>4190</span> </span><span class="WHIT">			</span><span class="COMM">// twh - dimensions of the element of the other anchor in the connection.</span><span class="WHIT">
<span class='line'>4191</span> </span><span class="WHIT">			</span><span class="COMM">// anchors - the list of selectable anchors</span><span class="WHIT">
<span class='line'>4192</span> </span><span class="WHIT">			</span><span class="NAME">_anchorSelector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchorSelector</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">xy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">txy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">twh</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchors</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4193</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">txy</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">twh</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">txy</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">twh</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4194</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">minDist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Infinity</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4195</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">anchors.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4196</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_distance</span><span class="PUNC">(</span><span class="NAME">anchors</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4197</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">minDist</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4198</span> </span><span class="WHIT">						</span><span class="NAME">minIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4199</span> </span><span class="WHIT">						</span><span class="NAME">minDist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4200</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4201</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4202</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">anchors</span><span class="PUNC">[</span><span class="NAME">minIdx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4203</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4204</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4205</span> </span><span class="WHIT">			</span><span class="NAME">this.compute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4206</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.xy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.wh</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">txy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.txy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">twh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.twh</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4207</span> </span><span class="WHIT">				</span><span class="COMM">// if anchor is locked or an opposite element was not given, we</span><span class="WHIT">
<span class='line'>4208</span> </span><span class="WHIT">				</span><span class="COMM">// maintain our state. anchor will be locked</span><span class="WHIT">
<span class='line'>4209</span> </span><span class="WHIT">				</span><span class="COMM">// if it is the source of a drag and drop.</span><span class="WHIT">
<span class='line'>4210</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.locked</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">txy</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">twh</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4211</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_curAnchor.compute</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4212</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>4213</span> </span><span class="WHIT">					</span><span class="NAME">params.timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// otherwise clear this, i think. we want the anchor to compute.</span><span class="WHIT">
<span class='line'>4214</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4215</span> </span><span class="WHIT">				</span><span class="NAME">_curAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_anchorSelector</span><span class="PUNC">(</span><span class="NAME">xy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">txy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">twh</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_anchors</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4216</span> </span><span class="WHIT">				</span><span class="NAME">self.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curAnchor.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4217</span> </span><span class="WHIT">				</span><span class="NAME">self.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curAnchor.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4218</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4219</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_curAnchor.compute</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4220</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4221</span> 
<span class='line'>4222</span> </span><span class="WHIT">			</span><span class="NAME">this.getCurrentLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4223</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_curAnchor</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_curAnchor.getCurrentLocation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4224</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4225</span> 
<span class='line'>4226</span> </span><span class="WHIT">			</span><span class="NAME">this.getOrientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_curAnchor</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_curAnchor.getOrientation</span><span class="PUNC">(</span><span class="NAME">_endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4227</span> </span><span class="WHIT">			</span><span class="NAME">this.over</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_curAnchor</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_curAnchor.over</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4228</span> </span><span class="WHIT">			</span><span class="NAME">this.out</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_curAnchor</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_curAnchor.out</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4229</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4230</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>4231</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>4232</span> 	manages anchors for all elements.
<span class='line'>4233</span> 	*/</span><span class="WHIT">
<span class='line'>4234</span> </span><span class="WHIT">	</span><span class="COMM">// "continuous" anchors: anchors that pick their location based on how many connections the given element has.</span><span class="WHIT">
<span class='line'>4235</span> </span><span class="WHIT">	</span><span class="COMM">// this requires looking at a lot more elements than normal - anything that has had a Continuous anchor applied has</span><span class="WHIT">
<span class='line'>4236</span> </span><span class="WHIT">	</span><span class="COMM">// to be recalculated.  so this manager is used as a reference point.  the first time, with a new timestamp, that</span><span class="WHIT">
<span class='line'>4237</span> </span><span class="WHIT">	</span><span class="COMM">// a continuous anchor is asked to compute, it calls this guy.  or maybe, even, this guy gets called somewhere else</span><span class="WHIT">
<span class='line'>4238</span> </span><span class="WHIT">	</span><span class="COMM">// and compute only ever returns pre-computed values.  either way, this is the central point, and we want it to</span><span class="WHIT">
<span class='line'>4239</span> </span><span class="WHIT">	</span><span class="COMM">// be called as few times as possible.</span><span class="WHIT">
<span class='line'>4240</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">continuousAnchors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4241</span> </span><span class="WHIT">        </span><span class="NAME">continuousAnchorLocations</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4242</span> </span><span class="WHIT">	    </span><span class="NAME">continuousAnchorOrientations</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4243</span> </span><span class="WHIT">	    </span><span class="NAME">Orientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">HORIZONTAL</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"horizontal"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">VERTICAL</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"vertical"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">DIAGONAL</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"diagonal"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">IDENTITY</span><span class="PUNC">:</span><span class="STRN">"identity"</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4244</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>4245</span> </span><span class="WHIT">	</span><span class="COMM">// TODO this functions uses a crude method of determining orientation between two elements.</span><span class="WHIT">
<span class='line'>4246</span> </span><span class="WHIT">	</span><span class="COMM">// 'diagonal' should be chosen when the angle of the line between the two centers is around</span><span class="WHIT">
<span class='line'>4247</span> </span><span class="WHIT">	</span><span class="COMM">// one of 45, 135, 225 and 315 degrees. maybe +- 15 degrees.</span><span class="WHIT">
<span class='line'>4248</span> </span><span class="WHIT">	</span><span class="NAME">calculateOrientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sd</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">td</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4249</span> 
<span class='line'>4250</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4251</span> </span><span class="WHIT">			</span><span class="NAME">orientation</span><span class="PUNC">:</span><span class="NAME">Orientation.IDENTITY</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4252</span> </span><span class="WHIT">			</span><span class="NAME">a</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">"top"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"top"</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>4253</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4254</span> 
<span class='line'>4255</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">theta</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.atan2</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">td.centery</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sd.centery</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">td.centerx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sd.centerx</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4256</span> </span><span class="WHIT">		    </span><span class="NAME">theta2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.atan2</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">sd.centery</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">td.centery</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sd.centerx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">td.centerx</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4257</span> </span><span class="WHIT">		    </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">sd.left</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">td.left</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sd.right</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">td.left</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sd.left</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">td.right</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sd.right</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">td.right</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>4258</span> </span><span class="WHIT">			    </span><span class="PUNC">(</span><span class="NAME">sd.left</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">td.left</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sd.right</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">td.right</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">td.left</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">sd.left</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">td.right</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">sd.right</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4259</span> </span><span class="WHIT">		    </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">sd.top</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">td.top</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sd.bottom</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">td.top</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sd.top</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">td.bottom</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sd.bottom</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">td.bottom</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>4260</span> </span><span class="WHIT">			    </span><span class="PUNC">(</span><span class="NAME">sd.top</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">td.top</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sd.bottom</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">td.bottom</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">td.top</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">sd.top</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">td.bottom</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">sd.bottom</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4261</span> 
<span class='line'>4262</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4263</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rls</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rrs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sortValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4264</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">td.left</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">sd.left</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">td.top</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">sd.top</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4265</span> </span><span class="WHIT">				</span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"top"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4266</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">td.left</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">sd.left</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sd.top</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">td.top</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4267</span> </span><span class="WHIT">				</span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="STRN">"top"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4268</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">td.left</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sd.left</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">td.top</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sd.top</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4269</span> </span><span class="WHIT">				</span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="STRN">"top"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4270</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">td.left</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sd.left</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">td.top</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">sd.top</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4271</span> </span><span class="WHIT">				</span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"top"</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4272</span> 
<span class='line'>4273</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">:</span><span class="NAME">Orientation.DIAGONAL</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">:</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">theta</span><span class="PUNC">:</span><span class="NAME">theta</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">theta2</span><span class="PUNC">:</span><span class="NAME">theta2</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4274</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4275</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4276</span> </span><span class="WHIT">			</span><span class="NAME">orientation</span><span class="PUNC">:</span><span class="NAME">Orientation.HORIZONTAL</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4277</span> </span><span class="WHIT">			</span><span class="NAME">a</span><span class="PUNC">:</span><span class="NAME">sd.top</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">td.top</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"bottom"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"top"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"top"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"bottom"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4278</span> </span><span class="WHIT">			</span><span class="NAME">theta</span><span class="PUNC">:</span><span class="NAME">theta</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">theta2</span><span class="PUNC">:</span><span class="NAME">theta2</span><span class="WHIT">
<span class='line'>4279</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4280</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4281</span> </span><span class="WHIT">			</span><span class="NAME">orientation</span><span class="PUNC">:</span><span class="NAME">Orientation.VERTICAL</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4282</span> </span><span class="WHIT">			</span><span class="NAME">a</span><span class="PUNC">:</span><span class="NAME">sd.left</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">td.left</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4283</span> </span><span class="WHIT">			</span><span class="NAME">theta</span><span class="PUNC">:</span><span class="NAME">theta</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">theta2</span><span class="PUNC">:</span><span class="NAME">theta2</span><span class="WHIT">
<span class='line'>4284</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4285</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4286</span> </span><span class="WHIT">	</span><span class="NAME">placeAnchorsOnLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">desc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementDimensions</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementPosition</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4287</span> </span><span class="WHIT">					</span><span class="NAME">connections</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">horizontal</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherMultiplier</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">reverse</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4288</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">step</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elementDimensions</span><span class="PUNC">[</span><span class="NAME">horizontal</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">connections.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4289</span> 
<span class='line'>4290</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">connections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4291</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">step</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">other</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">otherMultiplier</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">elementDimensions</span><span class="PUNC">[</span><span class="NAME">horizontal</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4292</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">reverse</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4293</span> </span><span class="WHIT">			  </span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elementDimensions</span><span class="PUNC">[</span><span class="NAME">horizontal</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">val</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4294</span> 
<span class='line'>4295</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">horizontal</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">other</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elementPosition</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NAME">xp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">elementDimensions</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4296</span> </span><span class="WHIT">			 	</span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">horizontal</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">other</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">val</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elementPosition</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">yp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">elementDimensions</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4297</span> 
<span class='line'>4298</span> </span><span class="WHIT">			</span><span class="NAME">a.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">yp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4299</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4300</span> 
<span class='line'>4301</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4302</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4303</span> </span><span class="WHIT">	</span><span class="NAME">standardEdgeSort</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4304</span> </span><span class="WHIT">	</span><span class="NAME">currySort</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">reverseAngles</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4305</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4306</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4307</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">reverseAngles</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4308</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4309</span> </span><span class="WHIT">					</span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4310</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>4311</span> </span><span class="WHIT">					</span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4312</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4313</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4314</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4315</span> </span><span class="WHIT">					</span><span class="NAME">r</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4316</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>4317</span> </span><span class="WHIT">					</span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4318</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4319</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4320</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4321</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4322</span> </span><span class="WHIT">	</span><span class="NAME">leftSort</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4323</span> </span><span class="WHIT">		</span><span class="COMM">// first get adjusted values</span><span class="WHIT">
<span class='line'>4324</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4325</span> </span><span class="WHIT">		</span><span class="NAME">p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4326</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p1</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4327</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4328</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4329</span> </span><span class="WHIT">	</span><span class="NAME">edgeSortFunctions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4330</span> </span><span class="WHIT">		</span><span class="STRN">"top"</span><span class="PUNC">:</span><span class="NAME">standardEdgeSort</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4331</span> </span><span class="WHIT">		</span><span class="STRN">"right"</span><span class="PUNC">:</span><span class="NAME">currySort</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4332</span> </span><span class="WHIT">		</span><span class="STRN">"bottom"</span><span class="PUNC">:</span><span class="NAME">currySort</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4333</span> </span><span class="WHIT">		</span><span class="STRN">"left"</span><span class="PUNC">:</span><span class="NAME">leftSort</span><span class="WHIT">
<span class='line'>4334</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4335</span> </span><span class="WHIT">    </span><span class="NAME">_sortHelper</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_array</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4336</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_array.sort</span><span class="PUNC">(</span><span class="NAME">_fn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4337</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4338</span> </span><span class="WHIT">	</span><span class="NAME">placeAnchors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_anchorLists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>4339</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sO</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4340</span> </span><span class="WHIT">		</span><span class="NAME">placeSomeAnchors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">desc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementDimensions</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementPosition</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">unsortedConnections</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isHorizontal</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherMultiplier</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4341</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">unsortedConnections.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4342</span> </span><span class="WHIT">			    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_sortHelper</span><span class="PUNC">(</span><span class="NAME">unsortedConnections</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">edgeSortFunctions</span><span class="PUNC">[</span><span class="NAME">desc</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// puts them in order based on the target element's pos on screen			    </span><span class="WHIT">
<span class='line'>4343</span> </span><span class="WHIT">				    </span><span class="NAME">reverse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">desc</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"right"</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">desc</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"top"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4344</span> </span><span class="WHIT">				    </span><span class="NAME">anchors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">placeAnchorsOnLine</span><span class="PUNC">(</span><span class="NAME">desc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementDimensions</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4345</span> </span><span class="WHIT">											 </span><span class="NAME">elementPosition</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sc</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4346</span> </span><span class="WHIT">											 </span><span class="NAME">isHorizontal</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherMultiplier</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">reverse</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4347</span> 
<span class='line'>4348</span> </span><span class="WHIT">			    </span><span class="COMM">// takes a computed anchor position and adjusts it for parent offset and scroll, then stores it.</span><span class="WHIT">
<span class='line'>4349</span> </span><span class="WHIT">			    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_setAnchorLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchorPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4350</span> </span><span class="WHIT">				    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">adjustForParentOffsetAndScroll</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">anchorPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchorPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpoint.canvas</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4351</span> </span><span class="WHIT">				    </span><span class="NAME">continuousAnchorLocations</span><span class="PUNC">[</span><span class="NAME">endpoint.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchorPos</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchorPos</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4352</span> </span><span class="WHIT">				    </span><span class="NAME">continuousAnchorOrientations</span><span class="PUNC">[</span><span class="NAME">endpoint.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4353</span> </span><span class="WHIT">			    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4354</span> 
<span class='line'>4355</span> </span><span class="WHIT">			    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">anchors.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4356</span> </span><span class="WHIT">				    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchors</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">weAreSource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">elementId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">weAreTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">elementId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4357</span> </span><span class="WHIT">				    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">weAreSource</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4358</span> </span><span class="WHIT">					    </span><span class="NAME">_setAnchorLocation</span><span class="PUNC">(</span><span class="NAME">c.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchors</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4359</span> </span><span class="WHIT">				    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">weAreTarget</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4360</span> </span><span class="WHIT">					    </span><span class="NAME">_setAnchorLocation</span><span class="PUNC">(</span><span class="NAME">c.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchors</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4361</span> </span><span class="WHIT">			    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4362</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4363</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4364</span> 
<span class='line'>4365</span> </span><span class="WHIT">		</span><span class="NAME">placeSomeAnchors</span><span class="PUNC">(</span><span class="STRN">"bottom"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">sO.left</span><span class="PUNC">,</span><span class="NAME">sO.top</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_anchorLists.bottom</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4366</span> </span><span class="WHIT">		</span><span class="NAME">placeSomeAnchors</span><span class="PUNC">(</span><span class="STRN">"top"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">sO.left</span><span class="PUNC">,</span><span class="NAME">sO.top</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_anchorLists.top</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4367</span> </span><span class="WHIT">		</span><span class="NAME">placeSomeAnchors</span><span class="PUNC">(</span><span class="STRN">"left"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">sO.left</span><span class="PUNC">,</span><span class="NAME">sO.top</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_anchorLists.left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4368</span> </span><span class="WHIT">		</span><span class="NAME">placeSomeAnchors</span><span class="PUNC">(</span><span class="STRN">"right"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">sO.left</span><span class="PUNC">,</span><span class="NAME">sO.top</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_anchorLists.right</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4369</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4370</span> </span><span class="WHIT">    </span><span class="NAME">AnchorManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4371</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_amEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4372</span> </span><span class="WHIT">			</span><span class="NAME">connectionsByElementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4373</span> </span><span class="WHIT">			</span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4374</span> </span><span class="WHIT">            </span><span class="NAME">anchorLists</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4375</span> 
<span class='line'>4376</span> </span><span class="WHIT">        </span><span class="NAME">this.reset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4377</span> </span><span class="WHIT">        	</span><span class="NAME">_amEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4378</span> </span><span class="WHIT">        	</span><span class="NAME">connectionsByElementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4379</span> </span><span class="WHIT">            </span><span class="NAME">anchorLists</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4380</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4381</span> </span><span class="WHIT"> 		</span><span class="NAME">this.newConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">conn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4382</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conn.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conn.targetId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4383</span> </span><span class="WHIT">				</span><span class="NAME">ep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conn.endpoints</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4384</span> </span><span class="WHIT">                </span><span class="NAME">doRegisterTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4385</span> </span><span class="WHIT">			    </span><span class="NAME">registerConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">otherIndex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4386</span> 
<span class='line'>4387</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">otherAnchor.isContinuous</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4388</span> </span><span class="WHIT">                       </span><span class="COMM">// remove the target endpoint's canvas.  we dont need it.</span><span class="WHIT">
<span class='line'>4389</span> </span><span class="WHIT">                        </span><span class="NAME">jsPlumb.CurrentLibrary.removeElement</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">canvas</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4390</span> </span><span class="WHIT">                        </span><span class="NAME">doRegisterTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4391</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4392</span> </span><span class="WHIT">					</span><span class="NAME">_addToList</span><span class="PUNC">(</span><span class="NAME">connectionsByElementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherAnchor.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">DynamicAnchor</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4393</span> </span><span class="WHIT">			    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4394</span> 
<span class='line'>4395</span> </span><span class="WHIT">			</span><span class="NAME">registerConnection</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4396</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">doRegisterTarget</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4397</span> </span><span class="WHIT">            	</span><span class="NAME">registerConnection</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4398</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4399</span> </span><span class="WHIT">		</span><span class="NAME">this.connectionDetached</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">connInfo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4400</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">connection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connInfo.connection</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">connInfo</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4401</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connection.sourceId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4402</span> </span><span class="WHIT">                </span><span class="NAME">targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connection.targetId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4403</span> </span><span class="WHIT">				</span><span class="NAME">ep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connection.endpoints</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4404</span> </span><span class="WHIT">				</span><span class="NAME">removeConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">otherIndex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4405</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">otherAnchor.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">FloatingAnchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4406</span> </span><span class="WHIT">						</span><span class="COMM">// no-op</span><span class="WHIT">
<span class='line'>4407</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4408</span> </span><span class="WHIT">					</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4409</span> </span><span class="WHIT">						</span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">connectionsByElementId</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4410</span> </span><span class="WHIT">							</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_c</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4411</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4412</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4413</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4414</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4415</span> </span><span class="WHIT">			</span><span class="NAME">removeConnection</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4416</span> </span><span class="WHIT">			</span><span class="NAME">removeConnection</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4417</span> 
<span class='line'>4418</span> </span><span class="WHIT">            </span><span class="COMM">// remove from anchorLists</span><span class="WHIT">
<span class='line'>4419</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sEl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connection.sourceId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4420</span> </span><span class="WHIT">                </span><span class="NAME">tEl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connection.targetId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4421</span> </span><span class="WHIT">                </span><span class="NAME">sE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">connection.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4422</span> </span><span class="WHIT">                </span><span class="NAME">tE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connection.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4423</span> </span><span class="WHIT">                </span><span class="NAME">_remove</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4424</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">  </span><span class="COMM">// transient anchors dont get entries in this list.</span><span class="WHIT">
<span class='line'>4425</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">eId</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4426</span> </span><span class="WHIT">                        </span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">[</span><span class="STRN">"top"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4427</span> </span><span class="WHIT">                        </span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4428</span> </span><span class="WHIT">                        </span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">[</span><span class="STRN">"bottom"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4429</span> </span><span class="WHIT">                        </span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4430</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4431</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4432</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>4433</span> </span><span class="WHIT">            </span><span class="NAME">_remove</span><span class="PUNC">(</span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">sEl</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sE</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4434</span> </span><span class="WHIT">            </span><span class="NAME">_remove</span><span class="PUNC">(</span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">tEl</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tE</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4435</span> </span><span class="WHIT">            </span><span class="NAME">self.redraw</span><span class="PUNC">(</span><span class="NAME">sEl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4436</span> </span><span class="WHIT">            </span><span class="NAME">self.redraw</span><span class="PUNC">(</span><span class="NAME">tEl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4437</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4438</span> </span><span class="WHIT">		</span><span class="NAME">this.add</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4439</span> </span><span class="WHIT">			</span><span class="NAME">_addToList</span><span class="PUNC">(</span><span class="NAME">_amEndpoints</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4440</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4441</span> </span><span class="WHIT">		</span><span class="NAME">this.changeId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">oldId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4442</span> </span><span class="WHIT">			</span><span class="NAME">connectionsByElementId</span><span class="PUNC">[</span><span class="NAME">newId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectionsByElementId</span><span class="PUNC">[</span><span class="NAME">oldId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4443</span> </span><span class="WHIT">			</span><span class="NAME">_amEndpoints</span><span class="PUNC">[</span><span class="NAME">newId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_amEndpoints</span><span class="PUNC">[</span><span class="NAME">oldId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4444</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">connectionsByElementId</span><span class="PUNC">[</span><span class="NAME">oldId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4445</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_amEndpoints</span><span class="PUNC">[</span><span class="NAME">oldId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>4446</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4447</span> </span><span class="WHIT">		</span><span class="NAME">this.getConnectionsFor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4448</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">connectionsByElementId</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4449</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4450</span> </span><span class="WHIT">		</span><span class="NAME">this.getEndpointsFor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4451</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_amEndpoints</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4452</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4453</span> </span><span class="WHIT">		</span><span class="NAME">this.deleteEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4454</span> </span><span class="WHIT">			</span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">_amEndpoints</span><span class="PUNC">[</span><span class="NAME">endpoint.elementId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4455</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">endpoint.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4456</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4457</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4458</span> </span><span class="WHIT">		</span><span class="NAME">this.clearFor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4459</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_amEndpoints</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4460</span> </span><span class="WHIT">			</span><span class="NAME">_amEndpoints</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4461</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4462</span> </span><span class="WHIT">        </span><span class="COMM">// updates the given anchor list by either updating an existing anchor's info, or adding it. this function</span><span class="WHIT">
<span class='line'>4463</span> </span><span class="WHIT">        </span><span class="COMM">// also removes the anchor from its previous list, if the edge it is on has changed.</span><span class="WHIT">
<span class='line'>4464</span> </span><span class="WHIT">        </span><span class="COMM">// all connections found along the way (those that are connected to one of the faces this function</span><span class="WHIT">
<span class='line'>4465</span> </span><span class="WHIT">        </span><span class="COMM">// operates on) are added to the connsToPaint list, as are their endpoints. in this way we know to repaint</span><span class="WHIT">
<span class='line'>4466</span> </span><span class="WHIT">        </span><span class="COMM">// them wthout having to calculate anything else about them.</span><span class="WHIT">
<span class='line'>4467</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_updateAnchorList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lists</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">theta</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">order</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aBoolean</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherElId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">reverse</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">edgeId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointsToPaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4468</span> </span><span class="WHIT">            </span><span class="COMM">// first try to find the exact match, but keep track of the first index of a matching element id along the way.s</span><span class="WHIT">
<span class='line'>4469</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">exactIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4470</span> </span><span class="WHIT">                </span><span class="NAME">firstMatchingElIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4471</span> </span><span class="WHIT">                </span><span class="NAME">endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conn.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4472</span> </span><span class="WHIT">                </span><span class="NAME">endpointId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpoint.id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4473</span> </span><span class="WHIT">                </span><span class="NAME">oIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4474</span> </span><span class="WHIT">                </span><span class="NAME">values</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">theta</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">order</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aBoolean</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherElId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointId</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4475</span> </span><span class="WHIT">                </span><span class="NAME">listToAddTo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lists</span><span class="PUNC">[</span><span class="NAME">edgeId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4476</span> </span><span class="WHIT">                </span><span class="NAME">listToRemoveFrom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpoint._continuousAnchorEdge</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">lists</span><span class="PUNC">[</span><span class="NAME">endpoint._continuousAnchorEdge</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4477</span> 
<span class='line'>4478</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">listToRemoveFrom</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4479</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_findWithFunction</span><span class="PUNC">(</span><span class="NAME">listToRemoveFrom</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">endpointId</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4480</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rIdx</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4481</span> </span><span class="WHIT">                    </span><span class="NAME">listToRemoveFrom.splice</span><span class="PUNC">(</span><span class="NAME">rIdx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4482</span> </span><span class="WHIT">                    </span><span class="COMM">// get all connections from this list</span><span class="WHIT">
<span class='line'>4483</span> </span><span class="WHIT">                    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">listToRemoveFrom.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4484</span> </span><span class="WHIT">                        </span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">connsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listToRemoveFrom</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">listToRemoveFrom</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4485</span> </span><span class="WHIT">                        </span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">endpointsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listToRemoveFrom</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">listToRemoveFrom</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4486</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4487</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4488</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4489</span> 
<span class='line'>4490</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">listToAddTo.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4491</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">listToAddTo</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">otherElId</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">firstMatchingElIdx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4492</span> </span><span class="WHIT">                    </span><span class="NAME">firstMatchingElIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4493</span> </span><span class="WHIT">                </span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">connsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listToAddTo</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">listToAddTo</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>4494</span> </span><span class="WHIT">                </span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">endpointsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listToAddTo</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">listToAddTo</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4495</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4496</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">exactIdx</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4497</span> </span><span class="WHIT">                </span><span class="NAME">listToAddTo</span><span class="PUNC">[</span><span class="NAME">exactIdx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">values</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4498</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4499</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4500</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">insertIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">reverse</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">firstMatchingElIdx</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">firstMatchingElIdx</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">listToAddTo.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// of course we will get this from having looked through the array shortly.</span><span class="WHIT">
<span class='line'>4501</span> </span><span class="WHIT">                </span><span class="NAME">listToAddTo.splice</span><span class="PUNC">(</span><span class="NAME">insertIdx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">values</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4502</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4503</span> 
<span class='line'>4504</span> </span><span class="WHIT">            </span><span class="COMM">// store this for next time.</span><span class="WHIT">
<span class='line'>4505</span> </span><span class="WHIT">            </span><span class="NAME">endpoint._continuousAnchorEdge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">edgeId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4506</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4507</span> </span><span class="WHIT">		</span><span class="NAME">this.redraw</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">offsetToUI</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4508</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>4509</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_suspendDrawing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4510</span> </span><span class="WHIT">				</span><span class="COMM">// get all the endpoints for this element</span><span class="WHIT">
<span class='line'>4511</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_amEndpoints</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4512</span> </span><span class="WHIT">					</span><span class="NAME">endpointConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectionsByElementId</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4513</span> </span><span class="WHIT">					</span><span class="NAME">connectionsToPaint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4514</span> </span><span class="WHIT">					</span><span class="NAME">endpointsToPaint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4515</span> </span><span class="WHIT">	                </span><span class="NAME">anchorsToUpdate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4516</span> </span><span class="WHIT">	            </span><span class="WHIT">
<span class='line'>4517</span> </span><span class="WHIT">				</span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_timestamp</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4518</span> </span><span class="WHIT">				</span><span class="COMM">// offsetToUI are values that would have been calculated in the dragManager when registering</span><span class="WHIT">
<span class='line'>4519</span> </span><span class="WHIT">				</span><span class="COMM">// an endpoint for an element that had a parent (somewhere in the hierarchy) that had been</span><span class="WHIT">
<span class='line'>4520</span> </span><span class="WHIT">				</span><span class="COMM">// registered as draggable.</span><span class="WHIT">
<span class='line'>4521</span> </span><span class="WHIT">				</span><span class="NAME">offsetToUI</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetToUI</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4522</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ui</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4523</span> </span><span class="WHIT">					</span><span class="NAME">ui</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4524</span> </span><span class="WHIT">						</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NAME">ui.left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetToUI.left</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4525</span> </span><span class="WHIT">						</span><span class="NAME">top</span><span class="PUNC">:</span><span class="NAME">ui.top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetToUI.top</span><span class="WHIT">
<span class='line'>4526</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4527</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4528</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4529</span> </span><span class="WHIT">				</span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4530</span> </span><span class="WHIT">				</span><span class="COMM">// valid for one paint cycle.</span><span class="WHIT">
<span class='line'>4531</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4532</span> </span><span class="WHIT">	                </span><span class="NAME">myWH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4533</span> </span><span class="WHIT">	                </span><span class="NAME">orientationCache</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4534</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4535</span> </span><span class="WHIT">				</span><span class="COMM">// actually, first we should compute the orientation of this element to all other elements to which</span><span class="WHIT">
<span class='line'>4536</span> </span><span class="WHIT">				</span><span class="COMM">// this element is connected with a continuous anchor (whether both ends of the connection have</span><span class="WHIT">
<span class='line'>4537</span> </span><span class="WHIT">				</span><span class="COMM">// a continuous anchor or just one)</span><span class="WHIT">
<span class='line'>4538</span> </span><span class="WHIT">	            </span><span class="COMM">//for (var i = 0; i &lt; continuousAnchorConnections.length; i++) {</span><span class="WHIT">
<span class='line'>4539</span> </span><span class="WHIT">	            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpointConnections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4540</span> </span><span class="WHIT">	                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">conn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4541</span> </span><span class="WHIT">						</span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conn.sourceId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4542</span> </span><span class="WHIT">	                    </span><span class="NAME">targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conn.targetId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4543</span> </span><span class="WHIT">	                    </span><span class="NAME">sourceContinuous</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conn.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor.isContinuous</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4544</span> </span><span class="WHIT">	                    </span><span class="NAME">targetContinuous</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conn.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor.isContinuous</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4545</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>4546</span> </span><span class="WHIT">	                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceContinuous</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">targetContinuous</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4547</span> </span><span class="WHIT">		                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4548</span> </span><span class="WHIT">		                    </span><span class="NAME">oKey2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4549</span> </span><span class="WHIT">		                    </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">orientationCache</span><span class="PUNC">[</span><span class="NAME">oKey</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4550</span> </span><span class="WHIT">		                    </span><span class="NAME">oIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conn.sourceId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4551</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>4552</span> </span><span class="WHIT">		                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceContinuous</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">sourceId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">sourceId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">right</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bottom</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">left</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4553</span> </span><span class="WHIT">		                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetContinuous</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">targetId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">targetId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">right</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bottom</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">left</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4554</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>4555</span> </span><span class="WHIT">		                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elementId</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4556</span> </span><span class="WHIT">		                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elementId</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4557</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>4558</span> </span><span class="WHIT">		                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">td</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getCachedData</span><span class="PUNC">(</span><span class="NAME">targetId</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4559</span> </span><span class="WHIT">							</span><span class="NAME">sd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getCachedData</span><span class="PUNC">(</span><span class="NAME">sourceId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4560</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>4561</span> </span><span class="WHIT">		                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceContinuous</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">targetContinuous</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4562</span> </span><span class="WHIT">		                    </span><span class="COMM">// here we may want to improve this by somehow determining the face we'd like</span><span class="WHIT">
<span class='line'>4563</span> </span><span class="WHIT">						    </span><span class="COMM">// to put the connector on.  ideally, when drawing, the face should be calculated</span><span class="WHIT">
<span class='line'>4564</span> </span><span class="WHIT">						    </span><span class="COMM">// by determining which face is closest to the point at which the mouse button</span><span class="WHIT">
<span class='line'>4565</span> </span><span class="WHIT">							</span><span class="COMM">// was released.  for now, we're putting it on the top face.</span><span class="WHIT">
<span class='line'>4566</span> </span><span class="WHIT">		                    </span><span class="NAME">_updateAnchorList</span><span class="PUNC">(</span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">sourceId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"top"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectionsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointsToPaint</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4567</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4568</span> </span><span class="WHIT">		                </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4569</span> </span><span class="WHIT">		                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4570</span> </span><span class="WHIT">		                        </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateOrientation</span><span class="PUNC">(</span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sd.o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">td.o</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4571</span> </span><span class="WHIT">		                        </span><span class="NAME">orientationCache</span><span class="PUNC">[</span><span class="NAME">oKey</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4572</span> </span><span class="WHIT">		                        </span><span class="COMM">// this would be a performance enhancement, but the computed angles need to be clamped to</span><span class="WHIT">
<span class='line'>4573</span> </span><span class="WHIT">		                        </span><span class="COMM">//the (-PI/2 -> PI/2) range in order for the sorting to work properly.</span><span class="WHIT">
<span class='line'>4574</span> </span><span class="WHIT">		                    </span><span class="COMM">/*  orientationCache[oKey2] = {
<span class='line'>4575</span> 		                            orientation:o.orientation,
<span class='line'>4576</span> 		                            a:[o.a[1], o.a[0]],
<span class='line'>4577</span> 		                            theta:o.theta + Math.PI,
<span class='line'>4578</span> 		                            theta2:o.theta2 + Math.PI
<span class='line'>4579</span> 		                        };*/</span><span class="WHIT">
<span class='line'>4580</span> </span><span class="WHIT">		                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4581</span> </span><span class="WHIT">		                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceContinuous</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_updateAnchorList</span><span class="PUNC">(</span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">sourceId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o.theta</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o.a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectionsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointsToPaint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4582</span> </span><span class="WHIT">		                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetContinuous</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_updateAnchorList</span><span class="PUNC">(</span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">targetId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o.theta2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o.a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectionsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointsToPaint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4583</span> </span><span class="WHIT">		                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4584</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>4585</span> </span><span class="WHIT">		                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceContinuous</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">anchorsToUpdate</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4586</span> </span><span class="WHIT">		                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetContinuous</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">anchorsToUpdate</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4587</span> </span><span class="WHIT">		                </span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">connectionsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">conn.id</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4588</span> </span><span class="WHIT">		                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">sourceContinuous</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">oIdx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetContinuous</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">oIdx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4589</span> </span><span class="WHIT">		                	</span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">endpointsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conn.endpoints</span><span class="PUNC">[</span><span class="NAME">oIdx</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">conn.endpoints</span><span class="PUNC">[</span><span class="NAME">oIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4590</span> </span><span class="WHIT">		            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4591</span> </span><span class="WHIT">	            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4592</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4593</span> </span><span class="WHIT">				</span><span class="COMM">// place Endpoints whose anchors are continuous but have no Connections</span><span class="WHIT">
<span class='line'>4594</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ep.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4595</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connections.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor.isContinuous</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4596</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">right</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bottom</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">left</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4597</span> </span><span class="WHIT">						</span><span class="NAME">_updateAnchorList</span><span class="PUNC">(</span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">endpoints</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">paint</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"top"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectionsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointsToPaint</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4598</span> </span><span class="WHIT">						</span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">anchorsToUpdate</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4599</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4600</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4601</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>4602</span> </span><span class="WHIT">	            </span><span class="COMM">// now place all the continuous anchors we need to;</span><span class="WHIT">
<span class='line'>4603</span> </span><span class="WHIT">	            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">anchorsToUpdate.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4604</span> </span><span class="WHIT">					</span><span class="NAME">placeAnchors</span><span class="PUNC">(</span><span class="NAME">anchorsToUpdate</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">anchorsToUpdate</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4605</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4606</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4607</span> </span><span class="WHIT">				</span><span class="COMM">// now that continuous anchors have been placed, paint all the endpoints for this element</span><span class="WHIT">
<span class='line'>4608</span> </span><span class="WHIT">	            </span><span class="COMM">// TODO performance: add the endpoint ids to a temp array, and then when iterating in the next</span><span class="WHIT">
<span class='line'>4609</span> </span><span class="WHIT">	            </span><span class="COMM">// loop, check that we didn't just paint that endpoint. we can probably shave off a few more milliseconds this way.</span><span class="WHIT">
<span class='line'>4610</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ep.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4611</span> </span><span class="WHIT">					</span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">paint</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myOffset</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myWH</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4612</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4613</span> </span><span class="WHIT">	            </span><span class="COMM">// ... and any other endpoints we came across as a result of the continuous anchors.</span><span class="WHIT">
<span class='line'>4614</span> </span><span class="WHIT">	            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpointsToPaint.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4615</span> </span><span class="WHIT">					</span><span class="NAME">endpointsToPaint</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">paint</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myOffset</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myWH</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4616</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4617</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>4618</span> </span><span class="WHIT">				</span><span class="COMM">// paint all the standard and "dynamic connections", which are connections whose other anchor is</span><span class="WHIT">
<span class='line'>4619</span> </span><span class="WHIT">				</span><span class="COMM">// static and therefore does need to be recomputed; we make sure that happens only one time.</span><span class="WHIT">
<span class='line'>4620</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>4621</span> </span><span class="WHIT">				</span><span class="COMM">// TODO we could have compiled a list of these in the first pass through connections; might save some time.</span><span class="WHIT">
<span class='line'>4622</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpointConnections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4623</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">otherEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4624</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">otherEndpoint.anchor.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">DynamicAnchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			 							</span><span class="WHIT">
<span class='line'>4625</span> </span><span class="WHIT">						</span><span class="NAME">otherEndpoint.paint</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elementWithPrecedence</span><span class="PUNC">:</span><span class="NAME">elementId</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>4626</span> </span><span class="WHIT">	                    </span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">connectionsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">endpointConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4627</span> </span><span class="WHIT">						</span><span class="COMM">// all the connections for the other endpoint now need to be repainted</span><span class="WHIT">
<span class='line'>4628</span> </span><span class="WHIT">						</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">otherEndpoint.connections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4629</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">otherEndpoint.connections</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">endpointConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>4630</span> </span><span class="WHIT">	                            </span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">connectionsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherEndpoint.connections</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">otherEndpoint.connections</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4631</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4632</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">otherEndpoint.anchor.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4633</span> </span><span class="WHIT">	                    </span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">connectionsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">endpointConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4634</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4635</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4636</span> </span><span class="WHIT">				</span><span class="COMM">// paint current floating connection for this element, if there is one.</span><span class="WHIT">
<span class='line'>4637</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">floatingConnections</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4638</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4639</span> </span><span class="WHIT">					</span><span class="NAME">fc.paint</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="PUNC">:</span><span class="NAME">elementId</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4640</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4641</span> </span><span class="WHIT">				</span><span class="COMM">// paint all the connections</span><span class="WHIT">
<span class='line'>4642</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">connectionsToPaint.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4643</span> </span><span class="WHIT">					</span><span class="NAME">connectionsToPaint</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">paint</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">elId</span><span class="PUNC">:</span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4644</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4645</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4646</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4647</span> </span><span class="WHIT">		</span><span class="NAME">this.rehomeEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">currentId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4648</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">eps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_amEndpoints</span><span class="PUNC">[</span><span class="NAME">currentId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//, </span><span class="WHIT">
<span class='line'>4649</span> </span><span class="WHIT">				</span><span class="NAME">elementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getId</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4650</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elementId</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">currentId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4651</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">eps.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4652</span> </span><span class="WHIT">					</span><span class="NAME">self.add</span><span class="PUNC">(</span><span class="NAME">eps</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4653</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4654</span> </span><span class="WHIT">				</span><span class="NAME">eps.splice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eps.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4655</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4656</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4657</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4658</span> </span><span class="WHIT">	</span><span class="NAME">_currentInstance.anchorManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">AnchorManager</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4659</span> </span><span class="WHIT">	</span><span class="NAME">_currentInstance.continuousAnchorFactory</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4660</span> </span><span class="WHIT">		</span><span class="NAME">get</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4661</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">existing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">continuousAnchors</span><span class="PUNC">[</span><span class="NAME">params.elementId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4662</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">existing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4663</span> </span><span class="WHIT">				</span><span class="NAME">existing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4664</span> </span><span class="WHIT">					</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">"Continuous"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4665</span> </span><span class="WHIT">					</span><span class="NAME">compute</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4666</span> </span><span class="WHIT">						</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">continuousAnchorLocations</span><span class="PUNC">[</span><span class="NAME">params.element.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4667</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4668</span> </span><span class="WHIT">					</span><span class="NAME">getCurrentLocation</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4669</span> </span><span class="WHIT">						</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">continuousAnchorLocations</span><span class="PUNC">[</span><span class="NAME">endpoint.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4670</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4671</span> </span><span class="WHIT">					</span><span class="NAME">getOrientation</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4672</span> </span><span class="WHIT">						</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">continuousAnchorOrientations</span><span class="PUNC">[</span><span class="NAME">endpoint.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4673</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4674</span> </span><span class="WHIT">					</span><span class="NAME">isDynamic</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4675</span> </span><span class="WHIT">					</span><span class="NAME">isContinuous</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT">
<span class='line'>4676</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4677</span> </span><span class="WHIT">				</span><span class="NAME">continuousAnchors</span><span class="PUNC">[</span><span class="NAME">params.elementId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">existing</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4678</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4679</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">existing</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4680</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4681</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4682</span> 
<span class='line'>4683</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">jsPlumbAdapter.headless</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4684</span> </span><span class="WHIT">		</span><span class="NAME">_currentInstance.dragManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbAdapter.getDragManager</span><span class="PUNC">(</span><span class="NAME">_currentInstance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4685</span> 
<span class='line'>4686</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>4687</span> 		 * Class: Connection
<span class='line'>4688</span> 		 * The connecting line between two Endpoints.
<span class='line'>4689</span> 		 */</span><span class="WHIT">
<span class='line'>4690</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>4691</span> 		 * Function: Connection
<span class='line'>4692</span> 		 * Connection constructor. You should not ever create one of these directly. If you make a call to jsPlumb.connect, all of
<span class='line'>4693</span> 		 * the parameters that you pass in to that function will be passed to the Connection constructor; if your UI
<span class='line'>4694</span> 		 * uses the various Endpoint-centric methods like addEndpoint/makeSource/makeTarget, along with drag and drop,
<span class='line'>4695</span> 		 * then the parameters you set on those functions are translated and passed in to the Connection constructor. So
<span class='line'>4696</span> 		 * you should check the documentation for each of those methods.
<span class='line'>4697</span> 		 * 
<span class='line'>4698</span> 		 * Parameters:
<span class='line'>4699</span> 		 * 	source 	- either an element id, a selector for an element, or an Endpoint.
<span class='line'>4700</span> 		 * 	target	- either an element id, a selector for an element, or an Endpoint
<span class='line'>4701</span> 		 * 	scope	- scope descriptor for this connection. optional.
<span class='line'>4702</span> 		 *  container - optional id or selector instructing jsPlumb where to attach all the elements it creates for this connection.  you should read the documentation for a full discussion of this.
<span class='line'>4703</span> 		 *  detachable - optional, defaults to true. Defines whether or not the connection may be detached using the mouse.
<span class='line'>4704</span> 		 *  reattach	- optional, defaults to false. Defines whether not the connection should be retached if it was dragged off an Endpoint and then dropped in whitespace.
<span class='line'>4705</span> 		 *  endpoint - Optional. Endpoint definition to use for both ends of the connection.
<span class='line'>4706</span> 		 *  endpoints - Optional. Array of two Endpoint definitions, one for each end of the Connection. This and 'endpoint' are mutually exclusive parameters.
<span class='line'>4707</span> 		 *  endpointStyle - Optional. Endpoint style definition to use for both ends of the Connection.
<span class='line'>4708</span> 		 *  endpointStyles - Optional. Array of two Endpoint style definitions, one for each end of the Connection. This and 'endpoint' are mutually exclusive parameters.
<span class='line'>4709</span> 		 *  paintStyle - Parameters defining the appearance of the Connection. Optional; jsPlumb will use the defaults if you supply nothing here.
<span class='line'>4710</span> 		 *  hoverPaintStyle - Parameters defining the appearance of the Connection when the mouse is hovering over it. Optional; jsPlumb will use the defaults if you supply nothing here (note that the default hoverPaintStyle is null).
<span class='line'>4711</span> 		 *  cssClass - optional CSS class to set on the display element associated with this Connection.
<span class='line'>4712</span> 		 *  hoverClass - optional CSS class to set on the display element associated with this Connection when it is in hover state.
<span class='line'>4713</span> 		 *  overlays - Optional array of Overlay definitions to appear on this Connection.
<span class='line'>4714</span> 		 *  drawEndpoints - if false, instructs jsPlumb to not draw the endpoints for this Connection.  Be careful with this: it only really works when you tell jsPlumb to attach elements to the document body. Read the documentation for a full discussion of this. 
<span class='line'>4715</span> 		 *  parameters - Optional JS object containing parameters to set on the Connection. These parameters are then available via the getParameter method.
<span class='line'>4716</span> 		 */</span><span class="WHIT">
<span class='line'>4717</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Connection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4718</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">visible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_internalHover</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_superClassHover</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4719</span> </span><span class="WHIT">			</span><span class="NAME">self.idPrefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"_jsplumb_c_"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4720</span> </span><span class="WHIT">			</span><span class="NAME">self.defaultLabelLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4721</span> </span><span class="WHIT">			</span><span class="NAME">self.defaultOverlayKeys</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"Overlays"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"ConnectionOverlays"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4722</span> </span><span class="WHIT">			</span><span class="NAME">this.parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.parent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4723</span> </span><span class="WHIT">			</span><span class="NAME">overlayCapableJsPlumbUIComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4724</span> </span><span class="WHIT">			</span><span class="COMM">// ************** get the source and target and register the connection. *******************</span><span class="WHIT">
<span class='line'>4725</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4726</span> </span><span class="COMM">// VISIBILITY						</span><span class="WHIT">
<span class='line'>4727</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4728</span> 			* Function: isVisible
<span class='line'>4729</span> 			* Returns whether or not the Connection is currently visible.
<span class='line'>4730</span> 			*/</span><span class="WHIT">
<span class='line'>4731</span> </span><span class="WHIT">			</span><span class="NAME">this.isVisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">visible</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4732</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4733</span> 			* Function: setVisible
<span class='line'>4734</span> 			* Sets whether or not the Connection should be visible.
<span class='line'>4735</span> 			*
<span class='line'>4736</span> 			* Parameters:
<span class='line'>4737</span> 			*	visible - boolean indicating desired visible state.
<span class='line'>4738</span> 			*/</span><span class="WHIT">
<span class='line'>4739</span> </span><span class="WHIT">			</span><span class="NAME">this.setVisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4740</span> </span><span class="WHIT">				</span><span class="NAME">visible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4741</span> </span><span class="WHIT">				</span><span class="NAME">self</span><span class="PUNC">[</span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"showOverlays"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"hideOverlays"</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4742</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connector</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">self.connector.canvas</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.connector.canvas.style.display</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"block"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4743</span> </span><span class="WHIT">				</span><span class="NAME">self.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4744</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4745</span> </span><span class="COMM">// END VISIBILITY						</span><span class="WHIT">
<span class='line'>4746</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>4747</span> </span><span class="COMM">// TYPE		</span><span class="WHIT">
<span class='line'>4748</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4749</span> </span><span class="WHIT">			</span><span class="NAME">this.getTypeDescriptor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"connection"</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4750</span> </span><span class="WHIT">			</span><span class="NAME">this.getDefaultType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4751</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4752</span> </span><span class="WHIT">					</span><span class="NAME">parameters</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4753</span> </span><span class="WHIT">					</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4754</span> </span><span class="WHIT">					</span><span class="NAME">detachable</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb.Defaults.ConnectionsDetachable</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4755</span> </span><span class="WHIT">					</span><span class="NAME">rettach</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb.Defaults.ReattachConnections</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4756</span> </span><span class="WHIT">					</span><span class="NAME">paintStyle</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb.Defaults.PaintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.PaintStyle</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4757</span> </span><span class="WHIT">					</span><span class="NAME">connector</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb.Defaults.Connector</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.Connector</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4758</span> </span><span class="WHIT">					</span><span class="NAME">hoverPaintStyle</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb.Defaults.HoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.HoverPaintStyle</span><span class="PUNC">,</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4759</span> </span><span class="WHIT">					</span><span class="NAME">overlays</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb.Defaults.ConnectorOverlays</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.ConnectorOverlays</span><span class="WHIT">
<span class='line'>4760</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4761</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4762</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">superAt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.applyType</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4763</span> </span><span class="WHIT">			</span><span class="NAME">this.applyType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4764</span> </span><span class="WHIT">				</span><span class="NAME">superAt</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4765</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">t.detachable</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.setDetachable</span><span class="PUNC">(</span><span class="NAME">t.detachable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4766</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">t.reattach</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.setReattach</span><span class="PUNC">(</span><span class="NAME">t.reattach</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4767</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">t.scope</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">t.scope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4768</span> </span><span class="WHIT">				</span><span class="NAME">self.setConnector</span><span class="PUNC">(</span><span class="NAME">t.connector</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4769</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4770</span> </span><span class="COMM">// END TYPE</span><span class="WHIT">
<span class='line'>4771</span> 
<span class='line'>4772</span> </span><span class="COMM">// HOVER			</span><span class="WHIT">
<span class='line'>4773</span> </span><span class="WHIT">			</span><span class="COMM">// override setHover to pass it down to the underlying connector</span><span class="WHIT">
<span class='line'>4774</span> </span><span class="WHIT">			</span><span class="NAME">_superClassHover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.setHover</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4775</span> </span><span class="WHIT">			</span><span class="NAME">self.setHover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4776</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">zi</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.ConnectorZIndex</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.ConnectorZIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4777</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">zi</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4778</span> </span><span class="WHIT">					</span><span class="NAME">self.connector.setZIndex</span><span class="PUNC">(</span><span class="NAME">zi</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4779</span> </span><span class="WHIT">				</span><span class="NAME">self.connector.setHover.apply</span><span class="PUNC">(</span><span class="NAME">self.connector</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4780</span> </span><span class="WHIT">				</span><span class="NAME">_superClassHover.apply</span><span class="PUNC">(</span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4781</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4782</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4783</span> </span><span class="WHIT">			</span><span class="NAME">_internalHover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4784</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_connectionBeingDragged</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4785</span> </span><span class="WHIT">					</span><span class="NAME">self.setHover</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4786</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4787</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4788</span> </span><span class="COMM">// END HOVER</span><span class="WHIT">
<span class='line'>4789</span> 
<span class='line'>4790</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4791</span> 			 * Function: setConnector
<span class='line'>4792</span> 			 * Sets the Connection's connector (eg "Bezier", "Flowchart", etc).  You pass a Connector definition into this method, the same
<span class='line'>4793</span> 			 * thing that you would set as the 'connector' property on a jsPlumb.connect call.
<span class='line'>4794</span> 			 * 
<span class='line'>4795</span> 			 * Parameters:
<span class='line'>4796</span> 			 * 	connector		-	Connector definition
<span class='line'>4797</span> 			 */</span><span class="WHIT">
<span class='line'>4798</span> </span><span class="WHIT">			</span><span class="NAME">this.setConnector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">connector</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4799</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connector</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_removeElements</span><span class="PUNC">(</span><span class="NAME">self.connector.getDisplayElements</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4800</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">connectorArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">_jsPlumb</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">:</span><span class="NAME">params.parent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4801</span> </span><span class="WHIT">					</span><span class="NAME">cssClass</span><span class="PUNC">:</span><span class="NAME">params.cssClass</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">container</span><span class="PUNC">:</span><span class="NAME">params.container</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tooltip</span><span class="PUNC">:</span><span class="NAME">self.tooltip</span><span class="WHIT">
<span class='line'>4802</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4803</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isString</span><span class="PUNC">(</span><span class="NAME">connector</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4804</span> </span><span class="WHIT">					</span><span class="NAME">this.connector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Connectors</span><span class="PUNC">[</span><span class="NAME">renderMode</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">connector</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">connectorArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// lets you use a string as shorthand.</span><span class="WHIT">
<span class='line'>4805</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isArray</span><span class="PUNC">(</span><span class="NAME">connector</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4806</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">connector.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4807</span> </span><span class="WHIT">						</span><span class="NAME">this.connector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Connectors</span><span class="PUNC">[</span><span class="NAME">renderMode</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">connector</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">connectorArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4808</span> </span><span class="WHIT">					</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>4809</span> </span><span class="WHIT">						</span><span class="NAME">this.connector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Connectors</span><span class="PUNC">[</span><span class="NAME">renderMode</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">connector</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">connector</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectorArgs</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4810</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4811</span> </span><span class="WHIT">				</span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.connector.canvas</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4812</span> </span><span class="WHIT">				</span><span class="COMM">// binds mouse listeners to the current connector.</span><span class="WHIT">
<span class='line'>4813</span> </span><span class="WHIT">				</span><span class="NAME">_bindListeners</span><span class="PUNC">(</span><span class="NAME">self.connector</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_internalHover</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4814</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4815</span> </span><span class="WHIT">				</span><span class="COMM">// set z-index if it was set on Defaults.</span><span class="WHIT">
<span class='line'>4816</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">zi</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.ConnectorZIndex</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.ConnectorZIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4817</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">zi</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4818</span> </span><span class="WHIT">					</span><span class="NAME">self.connector.setZIndex</span><span class="PUNC">(</span><span class="NAME">zi</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4819</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4820</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4821</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4822</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4823</span> </span><span class="COMM">// INITIALISATION CODE			</span><span class="WHIT">
<span class='line'>4824</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>4825</span> </span><span class="WHIT">			</span><span class="NAME">this.source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">params.source</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4826</span> </span><span class="WHIT">			</span><span class="NAME">this.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">params.target</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4827</span> </span><span class="WHIT">			</span><span class="COMM">// sourceEndpoint and targetEndpoint override source/target, if they are present. but </span><span class="WHIT">
<span class='line'>4828</span> </span><span class="WHIT">			</span><span class="COMM">// source is not overridden if the Endpoint has declared it is not the final target of a connection;</span><span class="WHIT">
<span class='line'>4829</span> </span><span class="WHIT">			</span><span class="COMM">// instead we use the source that the Endpoint declares will be the final source element.</span><span class="WHIT">
<span class='line'>4830</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.sourceEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.sourceEndpoint.endpointWillMoveTo</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">params.sourceEndpoint.getElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4831</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.targetEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.targetEndpoint.getElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4832</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4833</span> </span><span class="WHIT">			</span><span class="COMM">// if a new connection is the result of moving some existing connection, params.previousConnection</span><span class="WHIT">
<span class='line'>4834</span> </span><span class="WHIT">			</span><span class="COMM">// will have that Connection in it. listeners for the jsPlumbConnection event can look for that</span><span class="WHIT">
<span class='line'>4835</span> </span><span class="WHIT">			</span><span class="COMM">// member and take action if they need to.</span><span class="WHIT">
<span class='line'>4836</span> </span><span class="WHIT">			</span><span class="NAME">self.previousConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.previousConnection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4837</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>4838</span> </span><span class="WHIT">			</span><span class="NAME">this.sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">this.source</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4839</span> </span><span class="WHIT">			</span><span class="NAME">this.targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">this.target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4840</span> </span><span class="WHIT">			</span><span class="NAME">this.scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.scope</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// scope may have been passed in to the connect call. if it wasn't, we will pull it from the source endpoint, after having initialised the endpoints.			</span><span class="WHIT">
<span class='line'>4841</span> </span><span class="WHIT">			</span><span class="NAME">this.endpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4842</span> </span><span class="WHIT">			</span><span class="NAME">this.endpointStyles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4843</span> </span><span class="WHIT">			</span><span class="COMM">// wrapped the main function to return null if no input given. this lets us cascade defaults properly.</span><span class="WHIT">
<span class='line'>4844</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_makeAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchorParams</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4845</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">anchorParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_currentInstance.makeAnchor</span><span class="PUNC">(</span><span class="NAME">anchorParams</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4846</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4847</span> </span><span class="WHIT">			</span><span class="NAME">prepareEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">existing</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectorPaintStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectorHoverPaintStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4848</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4849</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">existing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4850</span> </span><span class="WHIT">					</span><span class="NAME">self.endpoints</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">existing</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4851</span> </span><span class="WHIT">					</span><span class="NAME">existing.addConnection</span><span class="PUNC">(</span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4852</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4853</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">params.endpoints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">params.endpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4854</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.endpoints</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4855</span> </span><span class="WHIT">					        </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">params.endpoint</span><span class="WHIT">
<span class='line'>4856</span> </span><span class="WHIT">							</span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.Endpoints</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>4857</span> </span><span class="WHIT">							</span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.Endpoints</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>4858</span> </span><span class="WHIT">							</span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.Endpoint</span><span class="WHIT">
<span class='line'>4859</span> </span><span class="WHIT">							</span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.Endpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4860</span> 
<span class='line'>4861</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">params.endpointStyles</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">params.endpointStyles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4862</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">params.endpointHoverStyles</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">params.endpointHoverStyles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4863</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">es</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.endpointStyles</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">params.endpointStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.EndpointStyles</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.EndpointStyles</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.EndpointStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.EndpointStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4864</span> </span><span class="WHIT">					</span><span class="COMM">// Endpoints derive their fillStyle from the connector's strokeStyle, if no fillStyle was specified.</span><span class="WHIT">
<span class='line'>4865</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">es.fillStyle</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">connectorPaintStyle</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4866</span> </span><span class="WHIT">						</span><span class="NAME">es.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectorPaintStyle.strokeStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4867</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4868</span> </span><span class="WHIT">					</span><span class="COMM">// TODO: decide if the endpoint should derive the connection's outline width and color.  currently it does:</span><span class="WHIT">
<span class='line'>4869</span> </span><span class="WHIT">					</span><span class="COMM">//*</span><span class="WHIT">
<span class='line'>4870</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">es.outlineColor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">connectorPaintStyle</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4871</span> </span><span class="WHIT">						</span><span class="NAME">es.outlineColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectorPaintStyle.outlineColor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4872</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">es.outlineWidth</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">connectorPaintStyle</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4873</span> </span><span class="WHIT">						</span><span class="NAME">es.outlineWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectorPaintStyle.outlineWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4874</span> </span><span class="WHIT">					</span><span class="COMM">//*/</span><span class="WHIT">
<span class='line'>4875</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4876</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ehs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.endpointHoverStyles</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">params.endpointHoverStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.EndpointHoverStyles</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.EndpointHoverStyles</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.EndpointHoverStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.EndpointHoverStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4877</span> </span><span class="WHIT">					</span><span class="COMM">// endpoint hover fill style is derived from connector's hover stroke style.  TODO: do we want to do this by default? for sure?</span><span class="WHIT">
<span class='line'>4878</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">connectorHoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4879</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ehs</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">ehs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4880</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ehs.fillStyle</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4881</span> </span><span class="WHIT">							</span><span class="NAME">ehs.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectorHoverPaintStyle.strokeStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4882</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4883</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4884</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.anchors</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">params.anchors</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4885</span> </span><span class="WHIT">						</span><span class="NAME">params.anchor</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">params.anchor</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4886</span> </span><span class="WHIT">						</span><span class="NAME">_makeAnchor</span><span class="PUNC">(</span><span class="NAME">_currentInstance.Defaults.Anchors</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4887</span> </span><span class="WHIT">						</span><span class="NAME">_makeAnchor</span><span class="PUNC">(</span><span class="NAME">jsPlumb.Defaults.Anchors</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4888</span> </span><span class="WHIT">						</span><span class="NAME">_makeAnchor</span><span class="PUNC">(</span><span class="NAME">_currentInstance.Defaults.Anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4889</span> </span><span class="WHIT">						</span><span class="NAME">_makeAnchor</span><span class="PUNC">(</span><span class="NAME">jsPlumb.Defaults.Anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4890</span> </span><span class="WHIT">					</span><span class="NAME">u</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.uuids</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">params.uuids</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4891</span> </span><span class="WHIT">					</span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_newEndpoint</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4892</span> </span><span class="WHIT">						</span><span class="NAME">paintStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">es</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NAME">hoverPaintStyle</span><span class="PUNC">:</span><span class="NAME">ehs</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NAME">endpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NAME">connections</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4893</span> </span><span class="WHIT">						</span><span class="NAME">uuid</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NAME">anchor</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="WHIT">  </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">params.scope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">container</span><span class="PUNC">:</span><span class="NAME">params.container</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4894</span> </span><span class="WHIT">						</span><span class="NAME">reattach</span><span class="PUNC">:</span><span class="NAME">params.reattach</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.ReattachConnections</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4895</span> </span><span class="WHIT">						</span><span class="NAME">detachable</span><span class="PUNC">:</span><span class="NAME">params.detachable</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.ConnectionsDetachable</span><span class="WHIT">
<span class='line'>4896</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4897</span> </span><span class="WHIT">					</span><span class="NAME">self.endpoints</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4898</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4899</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.drawEndpoints</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">e.setVisible</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4900</span> </span><span class="WHIT">										</span><span class="WHIT">
<span class='line'>4901</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4902</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4903</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4904</span> 
<span class='line'>4905</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">eS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prepareEndpoint</span><span class="PUNC">(</span><span class="NAME">params.sourceEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.source</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4906</span> </span><span class="WHIT">									 </span><span class="NAME">self.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.paintStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.hoverPaintStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4907</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eS</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_addToList</span><span class="PUNC">(</span><span class="NAME">endpointsByElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>4908</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">eT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prepareEndpoint</span><span class="PUNC">(</span><span class="NAME">params.targetEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4909</span> </span><span class="WHIT">									 </span><span class="NAME">self.targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.paintStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.hoverPaintStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4910</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eT</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_addToList</span><span class="PUNC">(</span><span class="NAME">endpointsByElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eT</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4911</span> </span><span class="WHIT">			</span><span class="COMM">// if scope not set, set it to be the scope for the source endpoint.</span><span class="WHIT">
<span class='line'>4912</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.scope</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scope</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>4913</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4914</span> </span><span class="WHIT">			</span><span class="COMM">// if delete endpoints on detach, keep a record of just exactly which endpoints they are.</span><span class="WHIT">
<span class='line'>4915</span> </span><span class="WHIT">			</span><span class="NAME">self.endpointsToDeleteOnDetach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4916</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.deleteEndpointsOnDetach</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4917</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.sourceIsNew</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.endpointsToDeleteOnDetach</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4918</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.targetIsNew</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.endpointsToDeleteOnDetach</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4919</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4920</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>4921</span> </span><span class="WHIT">			</span><span class="NAME">self.setConnector</span><span class="PUNC">(</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connector</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4922</span> </span><span class="WHIT">							  </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connector</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4923</span> </span><span class="WHIT">							  </span><span class="NAME">params.connector</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4924</span> </span><span class="WHIT">							  </span><span class="NAME">_currentInstance.Defaults.Connector</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4925</span> </span><span class="WHIT">							  </span><span class="NAME">jsPlumb.Defaults.Connector</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">							  							  		</span><span class="WHIT">
<span class='line'>4926</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4927</span> </span><span class="WHIT">			</span><span class="NAME">this.setPaintStyle</span><span class="PUNC">(</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connectorStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4928</span> </span><span class="WHIT">							   </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connectorStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4929</span> </span><span class="WHIT">							   </span><span class="NAME">params.paintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4930</span> </span><span class="WHIT">							   </span><span class="NAME">_currentInstance.Defaults.PaintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4931</span> </span><span class="WHIT">							   </span><span class="NAME">jsPlumb.Defaults.PaintStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4932</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>4933</span> </span><span class="WHIT">			</span><span class="NAME">this.setHoverPaintStyle</span><span class="PUNC">(</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connectorHoverStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4934</span> </span><span class="WHIT">									</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connectorHoverStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4935</span> </span><span class="WHIT">									</span><span class="NAME">params.hoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4936</span> </span><span class="WHIT">									</span><span class="NAME">_currentInstance.Defaults.HoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4937</span> </span><span class="WHIT">									</span><span class="NAME">jsPlumb.Defaults.HoverPaintStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4938</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4939</span> </span><span class="WHIT">			</span><span class="NAME">this.paintStyleInUse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getPaintStyle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4940</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4941</span> </span><span class="WHIT">			</span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">_suspendedAt</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4942</span> </span><span class="WHIT">			</span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">_suspendedAt</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4943</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4944</span> </span><span class="WHIT">			</span><span class="COMM">// paint the endpoints</span><span class="WHIT">
<span class='line'>4945</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">this.sourceId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myWH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">this.sourceId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4946</span> </span><span class="WHIT">				</span><span class="NAME">otherOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">this.targetId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4947</span> </span><span class="WHIT">				</span><span class="NAME">otherWH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">this.targetId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4948</span> </span><span class="WHIT">				</span><span class="NAME">initialTimestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_suspendedAt</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_timestamp</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4949</span> </span><span class="WHIT">				</span><span class="NAME">anchorLoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor.compute</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4950</span> </span><span class="WHIT">					</span><span class="NAME">xy</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">myOffset.left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myOffset.top</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myWH</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4951</span> </span><span class="WHIT">					</span><span class="NAME">elementId</span><span class="PUNC">:</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4952</span> </span><span class="WHIT">					</span><span class="NAME">txy</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">otherOffset.left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherOffset.top</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">twh</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">otherWH</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tElement</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4953</span> </span><span class="WHIT">					</span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">initialTimestamp</span><span class="WHIT">
<span class='line'>4954</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4955</span> 
<span class='line'>4956</span> </span><span class="WHIT">			</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">paint</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">anchorLoc</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">anchorLoc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">initialTimestamp</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4957</span> 
<span class='line'>4958</span> </span><span class="WHIT">			</span><span class="NAME">anchorLoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor.compute</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4959</span> </span><span class="WHIT">				</span><span class="NAME">xy</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">otherOffset.left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherOffset.top</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">otherWH</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4960</span> </span><span class="WHIT">				</span><span class="NAME">elementId</span><span class="PUNC">:</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4961</span> </span><span class="WHIT">				</span><span class="NAME">txy</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">myOffset.left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myOffset.top</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">twh</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myWH</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tElement</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4962</span> </span><span class="WHIT">				</span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">initialTimestamp</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4963</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4964</span> </span><span class="WHIT">			</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">paint</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">anchorLoc</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">anchorLoc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">initialTimestamp</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4965</span> </span><span class="WHIT">									</span><span class="WHIT">
<span class='line'>4966</span> </span><span class="COMM">// END INITIALISATION CODE			</span><span class="WHIT">
<span class='line'>4967</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4968</span> </span><span class="COMM">// DETACHABLE 				</span><span class="WHIT">
<span class='line'>4969</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_detachable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.ConnectionsDetachable</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4970</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.detachable</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_detachable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4971</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">self.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connectionsDetachable</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_detachable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4972</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">self.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connectionsDetachable</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_detachable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4973</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4974</span>             * Function: isDetachable
<span class='line'>4975</span>             * Returns whether or not this connection can be detached from its target/source endpoint.  by default this
<span class='line'>4976</span>             * is false; use it in conjunction with the 'reattach' parameter.
<span class='line'>4977</span>             */</span><span class="WHIT">
<span class='line'>4978</span> </span><span class="WHIT">            </span><span class="NAME">this.isDetachable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4979</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_detachable</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4980</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4981</span> </span><span class="WHIT">            </span><span class="COMM">/*
<span class='line'>4982</span>             * Function: setDetachable
<span class='line'>4983</span>             * Sets whether or not this connection is detachable.
<span class='line'>4984</span>             *
<span class='line'>4985</span>             * Parameters:
<span class='line'>4986</span>             * 	detachable - whether or not to set the Connection to be detachable.
<span class='line'>4987</span>             */</span><span class="WHIT">
<span class='line'>4988</span> </span><span class="WHIT">            </span><span class="NAME">this.setDetachable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">detachable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4989</span> </span><span class="WHIT">              </span><span class="NAME">_detachable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">detachable</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4990</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4991</span> </span><span class="COMM">// END DETACHABLE</span><span class="WHIT">
<span class='line'>4992</span> 
<span class='line'>4993</span> </span><span class="COMM">// REATTACH</span><span class="WHIT">
<span class='line'>4994</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_reattach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.reattach</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>4995</span> </span><span class="WHIT">				</span><span class="NAME">self.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">reattachConnections</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>4996</span> </span><span class="WHIT">				</span><span class="NAME">self.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">reattachConnections</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>4997</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.Defaults.ReattachConnections</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4998</span> </span><span class="WHIT">            </span><span class="COMM">/*
<span class='line'>4999</span>             * Function: isReattach
<span class='line'>5000</span>             * Returns whether or not this connection will be reattached after having been detached via the mouse and dropped.  by default this
<span class='line'>5001</span>             * is false; use it in conjunction with the 'detachable' parameter.
<span class='line'>5002</span>             */</span><span class="WHIT">
<span class='line'>5003</span> </span><span class="WHIT">            </span><span class="NAME">this.isReattach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5004</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_reattach</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5005</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5006</span> </span><span class="WHIT">            </span><span class="COMM">/*
<span class='line'>5007</span>             * Function: setReattach
<span class='line'>5008</span>             * Sets whether or not this connection will reattach after having been detached via the mouse and dropped.
<span class='line'>5009</span>             *
<span class='line'>5010</span>             * Parameters:
<span class='line'>5011</span>             * 	reattach	-	whether or not to set the Connection to reattach after drop in whitespace.
<span class='line'>5012</span>             */</span><span class="WHIT">
<span class='line'>5013</span> </span><span class="WHIT">            </span><span class="NAME">this.setReattach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">reattach</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5014</span> </span><span class="WHIT">              </span><span class="NAME">_reattach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">reattach</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5015</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5016</span> 
<span class='line'>5017</span> </span><span class="COMM">// END REATTACH</span><span class="WHIT">
<span class='line'>5018</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5019</span> </span><span class="COMM">// COST + DIRECTIONALITY</span><span class="WHIT">
<span class='line'>5020</span> </span><span class="WHIT">			</span><span class="COMM">// if cost not supplied, try to inherit from source endpoint</span><span class="WHIT">
<span class='line'>5021</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_cost</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.cost</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getConnectionCost</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5022</span> </span><span class="WHIT">			</span><span class="NAME">self.getCost</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_cost</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5023</span> </span><span class="WHIT">			</span><span class="NAME">self.setCost</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">_cost</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5024</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_bidirectional</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">params.bidirectional</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5025</span> </span><span class="WHIT">			</span><span class="COMM">// inherit bidirectional flag if set no source endpoint</span><span class="WHIT">
<span class='line'>5026</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.bidirectional</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_bidirectional</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">areConnectionsBidirectional</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5027</span> </span><span class="WHIT">			</span><span class="NAME">self.isBidirectional</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_bidirectional</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5028</span> </span><span class="COMM">// END COST + DIRECTIONALITY</span><span class="WHIT">
<span class='line'>5029</span> </span><span class="WHIT">                        </span><span class="WHIT">
<span class='line'>5030</span> </span><span class="COMM">// PARAMETERS						</span><span class="WHIT">
<span class='line'>5031</span> </span><span class="WHIT">			</span><span class="COMM">// merge all the parameters objects into the connection.  parameters set</span><span class="WHIT">
<span class='line'>5032</span> </span><span class="WHIT">			</span><span class="COMM">// on the connection take precedence; then target endpoint params, then</span><span class="WHIT">
<span class='line'>5033</span> </span><span class="WHIT">			</span><span class="COMM">// finally source endpoint params.</span><span class="WHIT">
<span class='line'>5034</span> </span><span class="WHIT">			</span><span class="COMM">// TODO jsPlumb.extend could be made to take more than two args, and it would</span><span class="WHIT">
<span class='line'>5035</span> </span><span class="WHIT">			</span><span class="COMM">// apply the second through nth args in order.</span><span class="WHIT">
<span class='line'>5036</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getParameters</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5037</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">_p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getParameters</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5038</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">_p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.getParameters</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5039</span> </span><span class="WHIT">			</span><span class="NAME">self.setParameters</span><span class="PUNC">(</span><span class="NAME">_p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5040</span> </span><span class="COMM">// END PARAMETERS</span><span class="WHIT">
<span class='line'>5041</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>5042</span> </span><span class="COMM">// MISCELLANEOUS			</span><span class="WHIT">
<span class='line'>5043</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>5044</span> 			 * implementation of abstract method in jsPlumbUtil.EventGenerator
<span class='line'>5045</span> 			 * @return list of attached elements. in our case, a list of Endpoints.
<span class='line'>5046</span> 			 */</span><span class="WHIT">
<span class='line'>5047</span> </span><span class="WHIT">			</span><span class="NAME">this.getAttachedElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5048</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self.endpoints</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5049</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5050</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5051</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>5052</span> 			 * changes the parent element of this connection to newParent.  not exposed for the public API.
<span class='line'>5053</span> 			 */</span><span class="WHIT">
<span class='line'>5054</span> </span><span class="WHIT">			</span><span class="NAME">this.moveParent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">newParent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5055</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jpcl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curParent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getParent</span><span class="PUNC">(</span><span class="NAME">self.connector.canvas</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>5056</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connector.bgCanvas</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5057</span> </span><span class="WHIT">				    </span><span class="NAME">jpcl.removeElement</span><span class="PUNC">(</span><span class="NAME">self.connector.bgCanvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curParent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5058</span> </span><span class="WHIT">				    </span><span class="NAME">jpcl.appendElement</span><span class="PUNC">(</span><span class="NAME">self.connector.bgCanvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newParent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5059</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5060</span> </span><span class="WHIT">				</span><span class="NAME">jpcl.removeElement</span><span class="PUNC">(</span><span class="NAME">self.connector.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curParent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5061</span> </span><span class="WHIT">				</span><span class="NAME">jpcl.appendElement</span><span class="PUNC">(</span><span class="NAME">self.connector.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newParent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>5062</span> </span><span class="WHIT">                </span><span class="COMM">// this only applies for DOMOverlays</span><span class="WHIT">
<span class='line'>5063</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.overlays.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5064</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isAppendedAtTopLevel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5065</span> </span><span class="WHIT">					    </span><span class="NAME">jpcl.removeElement</span><span class="PUNC">(</span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curParent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5066</span> </span><span class="WHIT">					    </span><span class="NAME">jpcl.appendElement</span><span class="PUNC">(</span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newParent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5067</span> </span><span class="WHIT">					    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">reattachListeners</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5068</span> </span><span class="WHIT">					    	</span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">reattachListeners</span><span class="PUNC">(</span><span class="NAME">self.connector</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5069</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5070</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5071</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connector.reattachListeners</span><span class="PUNC">)</span><span class="WHIT">		</span><span class="COMM">// this is for SVG/VML; change an element's parent and you have to reinit its listeners.</span><span class="WHIT">
<span class='line'>5072</span> </span><span class="WHIT">					</span><span class="NAME">self.connector.reattachListeners</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">     </span><span class="COMM">// the Canvas implementation doesn't have to care about this</span><span class="WHIT">
<span class='line'>5073</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5074</span> </span><span class="WHIT">		    </span><span class="WHIT">
<span class='line'>5075</span> </span><span class="COMM">// END MISCELLANEOUS</span><span class="WHIT">
<span class='line'>5076</span> 
<span class='line'>5077</span> </span><span class="COMM">// PAINTING</span><span class="WHIT">
<span class='line'>5078</span> 
<span class='line'>5079</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5080</span> 			 * Paints the Connection.  Not exposed for public usage. 
<span class='line'>5081</span> 			 * 
<span class='line'>5082</span> 			 * Parameters:
<span class='line'>5083</span> 			 * 	elId - Id of the element that is in motion.
<span class='line'>5084</span> 			 * 	ui - current library's event system ui object (present if we came from a drag to get here).
<span class='line'>5085</span> 			 *  recalc - whether or not to recalculate all anchors etc before painting. 
<span class='line'>5086</span> 			 *  timestamp - timestamp of this paint.  If the Connection was last painted with the same timestamp, it does not paint again.
<span class='line'>5087</span> 			 */</span><span class="WHIT">
<span class='line'>5088</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lastPaintedAt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5089</span> </span><span class="WHIT">			</span><span class="NAME">this.paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5090</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>5091</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">visible</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5092</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>5093</span> </span><span class="WHIT">					</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5094</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.elId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.ui</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.recalc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.timestamp</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5095</span> </span><span class="WHIT">						</span><span class="COMM">// if the moving object is not the source we must transpose the two references.</span><span class="WHIT">
<span class='line'>5096</span> </span><span class="WHIT">						</span><span class="NAME">swap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5097</span> </span><span class="WHIT">						</span><span class="NAME">tId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">swap</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.sourceId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">swap</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.targetId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.sourceId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5098</span> </span><span class="WHIT">						</span><span class="NAME">tIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">swap</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">swap</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5099</span> 
<span class='line'>5100</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">lastPaintedAt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5101</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sourceInfo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5102</span> </span><span class="WHIT">							</span><span class="NAME">targetInfo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// update the target if this is a forced repaint. otherwise, only the source has been moved.</span><span class="WHIT">
<span class='line'>5103</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>5104</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NAME">sIdx</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NAME">tIdx</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5105</span> </span><span class="WHIT">							</span><span class="NAME">sAnchorP</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sE.anchor.getCurrentLocation</span><span class="PUNC">(</span><span class="NAME">sE</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>5106</span> </span><span class="WHIT">							</span><span class="NAME">tAnchorP</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tE.anchor.getCurrentLocation</span><span class="PUNC">(</span><span class="NAME">tE</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5107</span> </span><span class="WHIT">									</span><span class="WHIT">
<span class='line'>5108</span> </span><span class="WHIT">						</span><span class="COMM">/* paint overlays*/</span><span class="WHIT">
<span class='line'>5109</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5110</span> </span><span class="WHIT">						</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.overlays.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5111</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5112</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o.isVisible</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">maxSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">maxSize</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o.computeMaxSize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5113</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5114</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>5115</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.connector.compute</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>5116</span> </span><span class="WHIT">							</span><span class="NAME">sAnchorP</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5117</span> </span><span class="WHIT">							</span><span class="NAME">tAnchorP</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5118</span> </span><span class="WHIT">							</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NAME">sIdx</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5119</span> </span><span class="WHIT">							</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NAME">tIdx</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5120</span> </span><span class="WHIT">							</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NAME">sIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5121</span> </span><span class="WHIT">							</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NAME">tIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5122</span> </span><span class="WHIT">							</span><span class="NAME">self.paintStyleInUse.lineWidth</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5123</span> </span><span class="WHIT">							</span><span class="NAME">maxSize</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5124</span> </span><span class="WHIT">							</span><span class="NAME">sourceInfo</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5125</span> </span><span class="WHIT">							</span><span class="NAME">targetInfo</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5126</span> </span><span class="WHIT">												</span><span class="WHIT">
<span class='line'>5127</span> </span><span class="WHIT">						</span><span class="NAME">self.connector.paint</span><span class="PUNC">(</span><span class="NAME">dim</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.paintStyleInUse</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5128</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>5129</span> </span><span class="WHIT">						</span><span class="COMM">/* paint overlays*/</span><span class="WHIT">
<span class='line'>5130</span> </span><span class="WHIT">						</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.overlays.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5131</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5132</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o.isVisible</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.overlayPlacements</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">o.draw</span><span class="PUNC">(</span><span class="NAME">self.connector</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.paintStyleInUse</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5133</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5134</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5135</span> </span><span class="WHIT">					</span><span class="NAME">lastPaintedAt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>5136</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>5137</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5138</span> 
<span class='line'>5139</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5140</span> 			 * Function: repaint
<span class='line'>5141</span> 			 * Repaints the Connection. No parameters exposed to public API.
<span class='line'>5142</span> 			 */</span><span class="WHIT">
<span class='line'>5143</span> </span><span class="WHIT">			</span><span class="NAME">this.repaint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5144</span> </span><span class="WHIT">				</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5145</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">params.recalc</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5146</span> </span><span class="WHIT">				</span><span class="NAME">this.paint</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">params.timestamp</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5147</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5148</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5149</span> </span><span class="WHIT">			</span><span class="COMM">// the very last thing we do is check to see if a 'type' was supplied in the params</span><span class="WHIT">
<span class='line'>5150</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.type</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connectionType</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connectionType</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5151</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_type</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5152</span> </span><span class="WHIT">				</span><span class="NAME">self.addType</span><span class="PUNC">(</span><span class="NAME">_type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5153</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5154</span> </span><span class="COMM">// END PAINTING</span><span class="WHIT">
<span class='line'>5155</span> 
<span class='line'>5156</span> </span><span class="COMM">// ***************************** PLACEHOLDERS FOR NATURAL DOCS *************************************************</span><span class="WHIT">
<span class='line'>5157</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5158</span> 			 * Function: bind
<span class='line'>5159</span> 			 * Bind to an event on the Connection.  
<span class='line'>5160</span> 			 * 
<span class='line'>5161</span> 			 * Parameters:
<span class='line'>5162</span> 			 * 	event - the event to bind.  Available events on a Connection are:
<span class='line'>5163</span> 			 *         - *click*						:	notification that a Connection was clicked.  
<span class='line'>5164</span> 			 *         - *dblclick*						:	notification that a Connection was double clicked.
<span class='line'>5165</span> 			 *         - *mouseenter*					:	notification that the mouse is over a Connection. 
<span class='line'>5166</span> 			 *         - *mouseexit*					:	notification that the mouse exited a Connection.
<span class='line'>5167</span> 			 * 		   - *contextmenu*                  :   notification that the user right-clicked on the Connection.
<span class='line'>5168</span> 			 *         
<span class='line'>5169</span> 			 *  callback - function to callback. This function will be passed the Connection that caused the event, and also the original event.    
<span class='line'>5170</span> 			 */</span><span class="WHIT">
<span class='line'>5171</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5172</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5173</span> 		     * Function: setPaintStyle
<span class='line'>5174</span> 		     * Sets the Connection's paint style and then repaints the Connection.
<span class='line'>5175</span> 		     * 
<span class='line'>5176</span> 		     * Parameters:
<span class='line'>5177</span> 		     * 	style - Style to use.
<span class='line'>5178</span> 		     */</span><span class="WHIT">
<span class='line'>5179</span> 
<span class='line'>5180</span> </span><span class="WHIT">		     </span><span class="COMM">/*
<span class='line'>5181</span> 		     * Function: getPaintStyle
<span class='line'>5182</span> 		     * Gets the Connection's paint style. This is not necessarily the paint style in use at the time;
<span class='line'>5183</span> 		     * this is the paint style for the connection when the mouse it not hovering over it.
<span class='line'>5184</span> 		     */</span><span class="WHIT">
<span class='line'>5185</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5186</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5187</span> 		     * Function: setHoverPaintStyle
<span class='line'>5188</span> 		     * Sets the paint style to use when the mouse is hovering over the Connection. This is null by default.
<span class='line'>5189</span> 		     * The hover paint style is applied as extensions to the paintStyle; it does not entirely replace
<span class='line'>5190</span> 		     * it.  This is because people will most likely want to change just one thing when hovering, say the
<span class='line'>5191</span> 		     * color for example, but leave the rest of the appearance the same.
<span class='line'>5192</span> 		     * 
<span class='line'>5193</span> 		     * Parameters:
<span class='line'>5194</span> 		     * 	style - Style to use when the mouse is hovering.
<span class='line'>5195</span> 		     *  doNotRepaint - if true, the Connection will not be repainted.  useful when setting things up initially.
<span class='line'>5196</span> 		     */</span><span class="WHIT">
<span class='line'>5197</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5198</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5199</span> 		     * Function: setHover
<span class='line'>5200</span> 		     * Sets/unsets the hover state of this Connection.
<span class='line'>5201</span> 		     * 
<span class='line'>5202</span> 		     * Parameters:
<span class='line'>5203</span> 		     * 	hover - hover state boolean
<span class='line'>5204</span> 		     * 	ignoreAttachedElements - if true, does not notify any attached elements of the change in hover state.  used mostly to avoid infinite loops.
<span class='line'>5205</span> 		     */</span><span class="WHIT">
<span class='line'>5206</span> 
<span class='line'>5207</span> </span><span class="WHIT">		     </span><span class="COMM">/*
<span class='line'>5208</span> 		     * Function: getParameter
<span class='line'>5209</span> 		     * Gets the named parameter; returns null if no parameter with that name is set. Parameter values may have been supplied to a 'connect' or 'addEndpoint' call (connections made with the mouse get a copy of all parameters set on each of their Endpoints), or the parameter value may have been set with setParameter.
<span class='line'>5210</span> 		     *
<span class='line'>5211</span> 		     * Parameters:
<span class='line'>5212</span> 		     *   key - Parameter name.
<span class='line'>5213</span> 		     */</span><span class="WHIT">
<span class='line'>5214</span> 
<span class='line'>5215</span> </span><span class="WHIT">		     </span><span class="COMM">/*
<span class='line'>5216</span> 		     * Function: setParameter
<span class='line'>5217</span> 		     * Sets the named parameter to the given value.
<span class='line'>5218</span> 		     *
<span class='line'>5219</span> 		     * Parameters:
<span class='line'>5220</span> 		     *   key - Parameter name.
<span class='line'>5221</span> 		     *   value - Parameter value.
<span class='line'>5222</span> 		     */</span><span class="WHIT">
<span class='line'>5223</span> </span><span class="WHIT">			 </span><span class="WHIT">
<span class='line'>5224</span> </span><span class="WHIT">			 </span><span class="COMM">/*
<span class='line'>5225</span> 			 * Property: connector
<span class='line'>5226</span> 			 * The underlying Connector for this Connection (eg. a Bezier connector, straight line connector, flowchart connector etc)
<span class='line'>5227</span> 			 */</span><span class="WHIT">
<span class='line'>5228</span> </span><span class="WHIT">			 </span><span class="WHIT">
<span class='line'>5229</span> </span><span class="WHIT">			 </span><span class="COMM">/*
<span class='line'>5230</span> 			 * Property: sourceId
<span class='line'>5231</span> 			 * Id of the source element in the connection.
<span class='line'>5232</span> 			 */</span><span class="WHIT">
<span class='line'>5233</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5234</span> 			 * Property: targetId
<span class='line'>5235</span> 			 * Id of the target element in the connection.
<span class='line'>5236</span> 			 */</span><span class="WHIT">
<span class='line'>5237</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5238</span> 			 * Property: scope
<span class='line'>5239</span> 			 * Optional scope descriptor for the connection.
<span class='line'>5240</span> 			 */</span><span class="WHIT">
<span class='line'>5241</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5242</span> 			 * Property: endpoints
<span class='line'>5243</span> 			 * Array of [source, target] Endpoint objects.
<span class='line'>5244</span> 			 */</span><span class="WHIT">
<span class='line'>5245</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5246</span> 			 *	Property: source
<span class='line'>5247</span> 			 *	The source element for this Connection.
<span class='line'>5248</span> 			 */</span><span class="WHIT">
<span class='line'>5249</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5250</span> 			 *	Property: target
<span class='line'>5251</span> 			 *	The target element for this Connection.
<span class='line'>5252</span> 			 */</span><span class="WHIT">
<span class='line'>5253</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5254</span> 			 * Property: overlays
<span class='line'>5255</span> 			 * List of Overlays for this component.
<span class='line'>5256</span> 			 */</span><span class="WHIT">
<span class='line'>5257</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5258</span> 			 * Function: addOverlay
<span class='line'>5259</span> 			 * Adds an Overlay to the Connection.
<span class='line'>5260</span> 			 * 
<span class='line'>5261</span> 			 * Parameters:
<span class='line'>5262</span> 			 * 	overlay - Overlay to add.
<span class='line'>5263</span> 			 */</span><span class="WHIT">
<span class='line'>5264</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5265</span> 			 * Function: getOverlay
<span class='line'>5266</span> 			 * Gets an overlay, by ID. Note: by ID.  You would pass an 'id' parameter
<span class='line'>5267</span> 			 * in to the Overlay's constructor arguments, and then use that to retrieve
<span class='line'>5268</span> 			 * it via this method.
<span class='line'>5269</span> 			 *
<span class='line'>5270</span> 			 * Parameters:
<span class='line'>5271</span> 			 * 	overlayId 	-	id of the overlay to retrieve.
<span class='line'>5272</span> 			 */</span><span class="WHIT">
<span class='line'>5273</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5274</span> 			* Function: getOverlays
<span class='line'>5275</span> 			* Gets all the overlays for this component.
<span class='line'>5276</span> 			*/</span><span class="WHIT">
<span class='line'>5277</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5278</span> 			 * Function: hideOverlay
<span class='line'>5279</span> 			 * Hides the overlay specified by the given id.
<span class='line'>5280</span> 			 *
<span class='line'>5281</span> 			 * Parameters:
<span class='line'>5282</span> 			 * 	overlayId 	-	id of the overlay to hide.
<span class='line'>5283</span> 			 */</span><span class="WHIT">
<span class='line'>5284</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5285</span> 			 * Function: hideOverlays
<span class='line'>5286</span> 			 * Hides all Overlays
<span class='line'>5287</span> 			 */</span><span class="WHIT">
<span class='line'>5288</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5289</span> 			 * Function: showOverlay
<span class='line'>5290</span> 			 * Shows the overlay specified by the given id.
<span class='line'>5291</span> 			 *
<span class='line'>5292</span> 			 * Parameters:
<span class='line'>5293</span> 			 * 	overlayId 	-	id of the overlay to show. 
<span class='line'>5294</span> 			 */</span><span class="WHIT">
<span class='line'>5295</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5296</span> 			 * Function: showOverlays
<span class='line'>5297</span> 			 * Shows all Overlays 
<span class='line'>5298</span> 			 */</span><span class="WHIT">
<span class='line'>5299</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>5300</span> 			 * Function: removeAllOverlays
<span class='line'>5301</span> 			 * Removes all overlays from the Connection, and then repaints.
<span class='line'>5302</span> 			 */</span><span class="WHIT">
<span class='line'>5303</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>5304</span> 			 * Function: removeOverlay
<span class='line'>5305</span> 			 * Removes an overlay by ID.  Note: by ID.  this is a string you set in the overlay spec.
<span class='line'>5306</span> 			 * 
<span class='line'>5307</span> 			 * Parameters:
<span class='line'>5308</span> 			 * 	overlayId - id of the overlay to remove.
<span class='line'>5309</span> 			 */</span><span class="WHIT">
<span class='line'>5310</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>5311</span> 			 * Function: removeOverlays
<span class='line'>5312</span> 			 * Removes a set of overlays by ID.  Note: by ID.  this is a string you set in the overlay spec.
<span class='line'>5313</span> 			 * 
<span class='line'>5314</span> 			 * Parameters:
<span class='line'>5315</span> 			 * 	overlayIds - this function takes an arbitrary number of arguments, each of which is a single overlay id.
<span class='line'>5316</span> 			 */</span><span class="WHIT">
<span class='line'>5317</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5318</span> 			 * Function: setLabel
<span class='line'>5319</span> 			 * Sets the Connection's label.  
<span class='line'>5320</span> 			 * 
<span class='line'>5321</span> 			 * Parameters:
<span class='line'>5322</span> 			 * 	l	- label to set. May be a String, a Function that returns a String, or a params object containing { "label", "labelStyle", "location", "cssClass" }.  Note that this uses innerHTML on the label div, so keep
<span class='line'>5323</span> 			 * that in mind if you need escaped HTML.
<span class='line'>5324</span> 			 */</span><span class="WHIT">
<span class='line'>5325</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5326</span> 			* Function: getLabel
<span class='line'>5327</span> 			* Returns the label text for this Connection (or a function if you are labelling with a function).
<span class='line'>5328</span> 			* 
<span class='line'>5329</span> 			* This does not return the overlay itself; this is a convenience method which is a pair with
<span class='line'>5330</span> 			* setLabel; together they allow you to add and access a Label Overlay without having to create the
<span class='line'>5331</span> 			* Overlay object itself.  For access to the underlying label overlay that jsPlumb has created,
<span class='line'>5332</span> 			* use getLabelOverlay.
<span class='line'>5333</span> 			*
<span class='line'>5334</span> 			* See Also:
<span class='line'>5335</span> 			* 	&lt;getOverlay>
<span class='line'>5336</span> 			*/</span><span class="WHIT">
<span class='line'>5337</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5338</span> 			* Function: getLabelOverlay
<span class='line'>5339</span> 			* Returns the underlying internal label overlay, which will exist if you specified a label on
<span class='line'>5340</span> 			* a connect call, or have called setLabel at any stage.   
<span class='line'>5341</span> 			*/</span><span class="WHIT">
<span class='line'>5342</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5343</span> </span><span class="COMM">// ***************************** END OF PLACEHOLDERS FOR NATURAL DOCS *************************************************												</span><span class="WHIT">
<span class='line'>5344</span> 
<span class='line'>5345</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5346</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// END Connection class</span><span class="WHIT">
<span class='line'>5347</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>5348</span> </span><span class="COMM">// ENDPOINT HELPER FUNCTIONS</span><span class="WHIT">
<span class='line'>5349</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_makeConnectionDragHandler</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">placeholder</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5350</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">stopped</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5351</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5352</span> </span><span class="WHIT">                </span><span class="NAME">drag</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5353</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">stopped</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5354</span> </span><span class="WHIT">                        </span><span class="NAME">stopped</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5355</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5356</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5357</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_ui</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getUIPosition</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getZoom</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5358</span> </span><span class="WHIT">                        </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">placeholder.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5359</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>5360</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5361</span> </span><span class="WHIT">                        </span><span class="NAME">jsPlumb.CurrentLibrary.setOffset</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_ui</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5362</span> </span><span class="WHIT">                        </span><span class="NAME">_draw</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_ui</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5363</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5364</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5365</span> </span><span class="WHIT">                </span><span class="NAME">stopDrag</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5366</span> </span><span class="WHIT">                    </span><span class="NAME">stopped</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5367</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5368</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5369</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>5370</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>5371</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_makeFloatingEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">paintStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceCanvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5372</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">floatingAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">FloatingAnchor</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">reference</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">referenceAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceCanvas</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">referenceCanvas</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5373</span> </span><span class="WHIT">        </span><span class="COMM">//setting the scope here should not be the way to fix that mootools issue.  it should be fixed by not</span><span class="WHIT">
<span class='line'>5374</span> </span><span class="WHIT">        </span><span class="COMM">// adding the floating endpoint as a droppable.  that makes more sense anyway!</span><span class="WHIT">
<span class='line'>5375</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_newEndpoint</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">paintStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">paintStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">endpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">floatingAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">sourceElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">:</span><span class="STRN">"__floating"</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5376</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5377</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>5378</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>5379</span> 		 * creates a placeholder div for dragging purposes, adds it to the DOM, and pre-computes its offset.
<span class='line'>5380</span> 		 */</span><span class="WHIT">
<span class='line'>5381</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_makeDraggablePlaceholder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">placeholder</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5382</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5383</span> </span><span class="WHIT">			</span><span class="NAME">n.style.position</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"absolute"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5384</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">placeholderDragElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5385</span> </span><span class="WHIT">			</span><span class="NAME">_appendElement</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5386</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">placeholderDragElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5387</span> </span><span class="WHIT">			</span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5388</span> </span><span class="WHIT">			</span><span class="COMM">// create and assign an id, and initialize the offset.</span><span class="WHIT">
<span class='line'>5389</span> </span><span class="WHIT">			</span><span class="NAME">placeholder.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5390</span> </span><span class="WHIT">			</span><span class="NAME">placeholder.element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">placeholderDragElement</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5391</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5392</span> 
<span class='line'>5393</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>5394</span> 		 * Class: Endpoint 
<span class='line'>5395</span> 		 * 
<span class='line'>5396</span> 		 * Models an endpoint. Can have 1 to 'maxConnections' Connections emanating from it (set maxConnections to -1 
<span class='line'>5397</span> 		 * to allow unlimited).  Typically, if you use 'jsPlumb.connect' to programmatically connect two elements, you won't
<span class='line'>5398</span> 		 * actually deal with the underlying Endpoint objects.  But if you wish to support drag and drop Connections, one of the ways you
<span class='line'>5399</span> 		 * do so is by creating and registering Endpoints using 'jsPlumb.addEndpoint', and marking these Endpoints as 'source' and/or
<span class='line'>5400</span> 		 * 'target' Endpoints for Connections.  
<span class='line'>5401</span> 		 * 
<span class='line'>5402</span> 		 * 
<span class='line'>5403</span> 		 */</span><span class="WHIT">
<span class='line'>5404</span> 
<span class='line'>5405</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>5406</span> 		 * Function: Endpoint 
<span class='line'>5407</span> 		 * 
<span class='line'>5408</span> 		 * Endpoint constructor.
<span class='line'>5409</span> 		 * 
<span class='line'>5410</span> 		 * Parameters: 
<span class='line'>5411</span> 		 * anchor - definition of the Anchor for the endpoint.  You can include one or more Anchor definitions here; if you include more than one, jsPlumb creates a 'dynamic' Anchor, ie. an Anchor which changes position relative to the other elements in a Connection.  Each Anchor definition can be either a string nominating one of the basic Anchors provided by jsPlumb (eg. "TopCenter"), or a four element array that designates the Anchor's location and orientation (eg, and this is equivalent to TopCenter, [ 0.5, 0, 0, -1 ]).  To provide more than one Anchor definition just put them all in an array. You can mix string definitions with array definitions.
<span class='line'>5412</span> 		 * endpoint - optional Endpoint definition. This takes the form of either a string nominating one of the basic Endpoints provided by jsPlumb (eg. "Rectangle"), or an array containing [name,params] for those cases where you don't wish to use the default values, eg. [ "Rectangle", { width:5, height:10 } ].
<span class='line'>5413</span> 		 * enabled - optional, defaults to true. Indicates whether or not the Endpoint should be enabled for mouse events (drag/drop).
<span class='line'>5414</span> 		 * paintStyle - endpoint style, a js object. may be null. 
<span class='line'>5415</span> 		 * hoverPaintStyle - style to use when the mouse is hovering over the Endpoint. A js object. may be null; defaults to null.
<span class='line'>5416</span> 		 * cssClass - optional CSS class to set on the display element associated with this Endpoint.
<span class='line'>5417</span> 		 * hoverClass - optional CSS class to set on the display element associated with this Endpoint when it is in hover state.
<span class='line'>5418</span> 		 * source - element the Endpoint is attached to, of type String (an element id) or element selector. Required.
<span class='line'>5419</span> 		 * canvas - canvas element to use. may be, and most often is, null.
<span class='line'>5420</span> 		 * container - optional id or selector instructing jsPlumb where to attach the element it creates for this endpoint.  you should read the documentation for a full discussion of this.
<span class='line'>5421</span> 		 * connections - optional list of Connections to configure the Endpoint with. 
<span class='line'>5422</span> 		 * isSource - boolean. indicates the endpoint can act as a source of new connections. Optional; defaults to false.
<span class='line'>5423</span> 		 * maxConnections - integer; defaults to 1.  a value of -1 means no upper limit. 
<span class='line'>5424</span> 		 * dragOptions - if isSource is set to true, you can supply arguments for the underlying library's drag method. Optional; defaults to null. 
<span class='line'>5425</span> 		 * connectorStyle - if isSource is set to true, this is the paint style for Connections from this Endpoint. Optional; defaults to null.
<span class='line'>5426</span> 		 * connectorHoverStyle - if isSource is set to true, this is the hover paint style for Connections from this Endpoint. Optional; defaults to null.
<span class='line'>5427</span> 		 * connector - optional Connector type to use.  Like 'endpoint', this may be either a single string nominating a known Connector type (eg. "Bezier", "Straight"), or an array containing [name, params], eg. [ "Bezier", { curviness:160 } ].
<span class='line'>5428</span> 		 * connectorOverlays - optional array of Overlay definitions that will be applied to any Connection from this Endpoint. 
<span class='line'>5429</span> 		 * connectorClass - optional CSS class to set on Connections emanating from this Endpoint.
<span class='line'>5430</span> 		 * connectorHoverClass - optional CSS class to set on to set on Connections emanating from this Endpoint when they are in hover state.		 
<span class='line'>5431</span> 		 * connectionsDetachable - optional, defaults to true. Sets whether connections to/from this Endpoint should be detachable or not.
<span class='line'>5432</span> 		 * isTarget - boolean. indicates the endpoint can act as a target of new connections. Optional; defaults to false.
<span class='line'>5433</span> 		 * dropOptions - if isTarget is set to true, you can supply arguments for the underlying library's drop method with this parameter. Optional; defaults to null. 
<span class='line'>5434</span> 		 * reattach - optional boolean that determines whether or not the Connections reattach after they have been dragged off an Endpoint and left floating. defaults to false: Connections dropped in this way will just be deleted.
<span class='line'>5435</span> 		 * parameters - Optional JS object containing parameters to set on the Endpoint. These parameters are then available via the getParameter method.  When a connection is made involving this Endpoint, the parameters from this Endpoint are copied into that Connection. Source Endpoint parameters override target Endpoint parameters if they both have a parameter with the same name.
<span class='line'>5436</span> 		 */</span><span class="WHIT">
<span class='line'>5437</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5438</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5439</span> </span><span class="WHIT">			</span><span class="NAME">self.idPrefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"_jsplumb_e_"</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5440</span> </span><span class="WHIT">			</span><span class="NAME">self.defaultLabelLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5441</span> </span><span class="WHIT">			</span><span class="NAME">self.defaultOverlayKeys</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"Overlays"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"EndpointOverlays"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5442</span> </span><span class="WHIT">			</span><span class="NAME">this.parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.parent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5443</span> </span><span class="WHIT">			</span><span class="NAME">overlayCapableJsPlumbUIComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5444</span> </span><span class="WHIT">			</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5445</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5446</span> </span><span class="COMM">// TYPE		</span><span class="WHIT">
<span class='line'>5447</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5448</span> </span><span class="WHIT">			</span><span class="NAME">this.getTypeDescriptor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"endpoint"</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5449</span> </span><span class="WHIT">			</span><span class="NAME">this.getDefaultType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>5450</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5451</span> </span><span class="WHIT">					</span><span class="NAME">parameters</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5452</span> </span><span class="WHIT">					</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5453</span> </span><span class="WHIT">					</span><span class="NAME">maxConnections</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb.Defaults.MaxConnections</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5454</span> </span><span class="WHIT">					</span><span class="NAME">paintStyle</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb.Defaults.EndpointStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.EndpointStyle</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5455</span> </span><span class="WHIT">					</span><span class="NAME">endpoint</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb.Defaults.Endpoint</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.Endpoint</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5456</span> </span><span class="WHIT">					</span><span class="NAME">hoverPaintStyle</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb.Defaults.EndpointHoverStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.EndpointHoverStyle</span><span class="PUNC">,</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>5457</span> </span><span class="WHIT">					</span><span class="NAME">overlays</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb.Defaults.EndpointOverlays</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.EndpointOverlays</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5458</span> </span><span class="WHIT">					</span><span class="NAME">connectorStyle</span><span class="PUNC">:</span><span class="NAME">params.connectorStyle</span><span class="PUNC">,</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>5459</span> </span><span class="WHIT">					</span><span class="NAME">connectorHoverStyle</span><span class="PUNC">:</span><span class="NAME">params.connectorHoverStyle</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5460</span> </span><span class="WHIT">					</span><span class="NAME">connectorClass</span><span class="PUNC">:</span><span class="NAME">params.connectorClass</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5461</span> </span><span class="WHIT">					</span><span class="NAME">connectorHoverClass</span><span class="PUNC">:</span><span class="NAME">params.connectorHoverClass</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5462</span> </span><span class="WHIT">					</span><span class="NAME">connectorOverlays</span><span class="PUNC">:</span><span class="NAME">params.connectorOverlays</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5463</span> </span><span class="WHIT">					</span><span class="NAME">connector</span><span class="PUNC">:</span><span class="NAME">params.connector</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5464</span> </span><span class="WHIT">					</span><span class="NAME">connectorTooltip</span><span class="PUNC">:</span><span class="NAME">params.connectorTooltip</span><span class="WHIT">
<span class='line'>5465</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5466</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5467</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">superAt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.applyType</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5468</span> </span><span class="WHIT">			</span><span class="NAME">this.applyType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5469</span> </span><span class="WHIT">				</span><span class="NAME">superAt</span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5470</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">t.maxConnections</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_maxConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">t.maxConnections</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5471</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">t.scope</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">t.scope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5472</span> </span><span class="WHIT">				</span><span class="NAME">self.connectorStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">t.connectorStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5473</span> </span><span class="WHIT">				</span><span class="NAME">self.connectorHoverStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">t.connectorHoverStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5474</span> </span><span class="WHIT">				</span><span class="NAME">self.connectorOverlays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">t.connectorOverlays</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5475</span> </span><span class="WHIT">				</span><span class="NAME">self.connector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">t.connector</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5476</span> </span><span class="WHIT">				</span><span class="NAME">self.connectorTooltip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">t.connectorTooltip</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5477</span> </span><span class="WHIT">				</span><span class="NAME">self.connectionType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">t.connectionType</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5478</span> </span><span class="WHIT">				</span><span class="NAME">self.connectorClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">t.connectorClass</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5479</span> </span><span class="WHIT">				</span><span class="NAME">self.connectorHoverClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">t.connectorHoverClass</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5480</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5481</span> </span><span class="COMM">// END TYPE</span><span class="WHIT">
<span class='line'>5482</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>5483</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">visible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">__enabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">params.enabled</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5484</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5485</span> 				Function: isVisible
<span class='line'>5486</span> 				Returns whether or not the Endpoint is currently visible.
<span class='line'>5487</span> 			*/</span><span class="WHIT">
<span class='line'>5488</span> </span><span class="WHIT">			</span><span class="NAME">this.isVisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">visible</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5489</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5490</span> 				Function: setVisible
<span class='line'>5491</span> 				Sets whether or not the Endpoint is currently visible.
<span class='line'>5492</span> 
<span class='line'>5493</span> 				Parameters:
<span class='line'>5494</span> 					visible - whether or not the Endpoint should be visible.
<span class='line'>5495</span> 					doNotChangeConnections - Instructs jsPlumb to not pass the visible state on to any attached Connections. defaults to false.
<span class='line'>5496</span> 					doNotNotifyOtherEndpoint - Instructs jsPlumb to not pass the visible state on to Endpoints at the other end of any attached Connections. defaults to false. 
<span class='line'>5497</span> 			*/</span><span class="WHIT">
<span class='line'>5498</span> </span><span class="WHIT">			</span><span class="NAME">this.setVisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotChangeConnections</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotNotifyOtherEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5499</span> </span><span class="WHIT">				</span><span class="NAME">visible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5500</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.canvas.style.display</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"block"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5501</span> </span><span class="WHIT">				</span><span class="NAME">self</span><span class="PUNC">[</span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"showOverlays"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"hideOverlays"</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5502</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">doNotChangeConnections</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5503</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.connections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5504</span> </span><span class="WHIT">						</span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setVisible</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5505</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">doNotNotifyOtherEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5506</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5507</span> </span><span class="WHIT">							</span><span class="COMM">// only change the other endpoint if this is its only connection.</span><span class="WHIT">
<span class='line'>5508</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">oIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connections.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">oIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setVisible</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5509</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5510</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5511</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5512</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5513</span> 
<span class='line'>5514</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5515</span> 				Function: isEnabled
<span class='line'>5516</span> 				Returns whether or not the Endpoint is enabled for drag/drop connections.
<span class='line'>5517</span> 			*/</span><span class="WHIT">
<span class='line'>5518</span> </span><span class="WHIT">			</span><span class="NAME">this.isEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">__enabled</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5519</span> 
<span class='line'>5520</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5521</span> 				Function: setEnabled
<span class='line'>5522</span> 				Sets whether or not the Endpoint is enabled for drag/drop connections.
<span class='line'>5523</span> 				
<span class='line'>5524</span> 				Parameters:
<span class='line'>5525</span> 					enabled - whether or not the Endpoint is enabled.			
<span class='line'>5526</span> 			*/</span><span class="WHIT">
<span class='line'>5527</span> </span><span class="WHIT">			</span><span class="NAME">this.setEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">__enabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5528</span> 
<span class='line'>5529</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.source</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NAME">_uuid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.uuid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">floatingEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NAME">inPlaceCopy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5530</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_uuid</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">endpointsByUUID</span><span class="PUNC">[</span><span class="NAME">_uuid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5531</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">_element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5532</span> </span><span class="WHIT">			</span><span class="NAME">this.elementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5533</span> </span><span class="WHIT">			</span><span class="NAME">this.element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5534</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5535</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_connectionCost</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.connectionCost</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5536</span> </span><span class="WHIT">			</span><span class="NAME">this.getConnectionCost</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_connectionCost</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5537</span> </span><span class="WHIT">			</span><span class="NAME">this.setConnectionCost</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5538</span> </span><span class="WHIT">				</span><span class="NAME">_connectionCost</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5539</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5540</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5541</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_connectionsBidirectional</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.connectionsBidirectional</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5542</span> </span><span class="WHIT">			</span><span class="NAME">this.areConnectionsBidirectional</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_connectionsBidirectional</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5543</span> </span><span class="WHIT">			</span><span class="NAME">this.setConnectionsBidirectional</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">_connectionsBidirectional</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5544</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>5545</span> </span><span class="WHIT">			</span><span class="NAME">self.anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.anchor</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_currentInstance.makeAnchor</span><span class="PUNC">(</span><span class="NAME">params.anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">params.anchors</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_currentInstance.makeAnchor</span><span class="PUNC">(</span><span class="NAME">params.anchors</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_currentInstance.makeAnchor</span><span class="PUNC">(</span><span class="NAME">_currentInstance.Defaults.Anchor</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">"TopCenter"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5546</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>5547</span> </span><span class="WHIT">			</span><span class="COMM">// ANCHOR MANAGER</span><span class="WHIT">
<span class='line'>5548</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">params._transient</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// in place copies, for example, are transient.  they will never need to be retrieved during a paint cycle, because they dont move, and then they are deleted.</span><span class="WHIT">
<span class='line'>5549</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.anchorManager.add</span><span class="PUNC">(</span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5550</span> 
<span class='line'>5551</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5552</span> </span><span class="WHIT">			</span><span class="NAME">this.setEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5553</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endpointArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5554</span> </span><span class="WHIT">	                </span><span class="NAME">_jsPlumb</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5555</span> </span><span class="WHIT">	                </span><span class="NAME">parent</span><span class="PUNC">:</span><span class="NAME">params.parent</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5556</span> </span><span class="WHIT">	                </span><span class="NAME">container</span><span class="PUNC">:</span><span class="NAME">params.container</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5557</span> </span><span class="WHIT">	                </span><span class="NAME">tooltip</span><span class="PUNC">:</span><span class="NAME">params.tooltip</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5558</span> </span><span class="WHIT">	                </span><span class="NAME">connectorTooltip</span><span class="PUNC">:</span><span class="NAME">params.connectorTooltip</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5559</span> </span><span class="WHIT">	                </span><span class="NAME">endpoint</span><span class="PUNC">:</span><span class="NAME">self</span><span class="WHIT">
<span class='line'>5560</span> </span><span class="WHIT">	            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5561</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isString</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5562</span> </span><span class="WHIT">					</span><span class="NAME">_endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Endpoints</span><span class="PUNC">[</span><span class="NAME">renderMode</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">ep</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">endpointArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5563</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isArray</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5564</span> </span><span class="WHIT">					</span><span class="NAME">endpointArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5565</span> </span><span class="WHIT">					</span><span class="NAME">_endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Endpoints</span><span class="PUNC">[</span><span class="NAME">renderMode</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">endpointArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5566</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5567</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5568</span> </span><span class="WHIT">					</span><span class="NAME">_endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ep.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5569</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5570</span> 
<span class='line'>5571</span> </span><span class="WHIT">				</span><span class="COMM">// assign a clone function using a copy of endpointArgs. this is used when a drag starts: the endpoint that was dragged is cloned,</span><span class="WHIT">
<span class='line'>5572</span> </span><span class="WHIT">				</span><span class="COMM">// and the clone is left in its place while the original one goes off on a magical journey. </span><span class="WHIT">
<span class='line'>5573</span> </span><span class="WHIT">				</span><span class="COMM">// the copy is to get around a closure problem, in which endpointArgs ends up getting shared by</span><span class="WHIT">
<span class='line'>5574</span> </span><span class="WHIT">				</span><span class="COMM">// the whole world.</span><span class="WHIT">
<span class='line'>5575</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">argsForClone</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>5576</span> </span><span class="WHIT">				</span><span class="NAME">_endpoint.clone</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5577</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5578</span> </span><span class="WHIT">					</span><span class="NAME">_endpoint.constructor.apply</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">argsForClone</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5579</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5580</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5581</span> 
<span class='line'>5582</span> </span><span class="WHIT">				</span><span class="NAME">self.endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_endpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5583</span> </span><span class="WHIT">				</span><span class="NAME">self.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.endpoint.type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5584</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5585</span> </span><span class="WHIT">			 </span><span class="WHIT">
<span class='line'>5586</span> </span><span class="WHIT">			</span><span class="NAME">this.setEndpoint</span><span class="PUNC">(</span><span class="NAME">params.endpoint</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.Endpoint</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.Endpoint</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">"Dot"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>5587</span> </span><span class="WHIT">			</span><span class="NAME">originalEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_endpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5588</span> 
<span class='line'>5589</span> </span><span class="WHIT">			</span><span class="COMM">// override setHover to pass it down to the underlying endpoint</span><span class="WHIT">
<span class='line'>5590</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_sh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.setHover</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5591</span> </span><span class="WHIT">			</span><span class="NAME">self.setHover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5592</span> </span><span class="WHIT">				</span><span class="NAME">self.endpoint.setHover.apply</span><span class="PUNC">(</span><span class="NAME">self.endpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5593</span> </span><span class="WHIT">				</span><span class="NAME">_sh.apply</span><span class="PUNC">(</span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5594</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5595</span> </span><span class="WHIT">            </span><span class="COMM">// endpoint delegates to first connection for hover, if there is one.</span><span class="WHIT">
<span class='line'>5596</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">internalHover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5597</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connections.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5598</span> </span><span class="WHIT">                </span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setHover</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5599</span> </span><span class="WHIT">              </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>5600</span> </span><span class="WHIT">                </span><span class="NAME">self.setHover</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5601</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5602</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5603</span> </span><span class="WHIT">			</span><span class="COMM">// bind listeners from endpoint to self, with the internal hover function defined above.</span><span class="WHIT">
<span class='line'>5604</span> </span><span class="WHIT">            </span><span class="NAME">_bindListeners</span><span class="PUNC">(</span><span class="NAME">self.endpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">internalHover</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5605</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5606</span> </span><span class="WHIT">			</span><span class="NAME">this.setPaintStyle</span><span class="PUNC">(</span><span class="NAME">params.paintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5607</span> </span><span class="WHIT">							   </span><span class="NAME">params.style</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5608</span> </span><span class="WHIT">							   </span><span class="NAME">_currentInstance.Defaults.EndpointStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5609</span> </span><span class="WHIT">							   </span><span class="NAME">jsPlumb.Defaults.EndpointStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5610</span> </span><span class="WHIT">			</span><span class="NAME">this.setHoverPaintStyle</span><span class="PUNC">(</span><span class="NAME">params.hoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5611</span> </span><span class="WHIT">									</span><span class="NAME">_currentInstance.Defaults.EndpointHoverStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5612</span> </span><span class="WHIT">									</span><span class="NAME">jsPlumb.Defaults.EndpointHoverStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5613</span> </span><span class="WHIT">			</span><span class="NAME">this.paintStyleInUse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getPaintStyle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5614</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">originalPaintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getPaintStyle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5615</span> </span><span class="WHIT">			</span><span class="NAME">this.connectorStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.connectorStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5616</span> </span><span class="WHIT">			</span><span class="NAME">this.connectorHoverStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.connectorHoverStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5617</span> </span><span class="WHIT">			</span><span class="NAME">this.connectorOverlays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.connectorOverlays</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5618</span> </span><span class="WHIT">			</span><span class="NAME">this.connector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.connector</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5619</span> </span><span class="WHIT">			</span><span class="NAME">this.connectorTooltip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.connectorTooltip</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5620</span> </span><span class="WHIT">			</span><span class="NAME">this.connectorClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.connectorClass</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5621</span> </span><span class="WHIT">			</span><span class="NAME">this.connectorHoverClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.connectorHoverClass</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>5622</span> </span><span class="WHIT">			</span><span class="NAME">this.isSource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.isSource</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5623</span> </span><span class="WHIT">			</span><span class="NAME">this.isTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.isTarget</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5624</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5625</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_maxConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.maxConnections</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.MaxConnections</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// maximum number of connections this endpoint can be the source of.</span><span class="WHIT">
<span class='line'>5626</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>5627</span> </span><span class="WHIT">			</span><span class="NAME">this.getAttachedElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5628</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self.connections</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5629</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5630</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>5631</span> </span><span class="WHIT">			</span><span class="NAME">this.canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.endpoint.canvas</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5632</span> </span><span class="WHIT">			</span><span class="NAME">this.connections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.connections</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5633</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5634</span> </span><span class="WHIT">			</span><span class="NAME">this.scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.scope</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">DEFAULT_SCOPE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5635</span> </span><span class="WHIT">			</span><span class="NAME">this.connectionType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.connectionType</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5636</span> </span><span class="WHIT">			</span><span class="NAME">this.timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5637</span> </span><span class="WHIT">			</span><span class="COMM">//self.isReattach = params.reattach || false;</span><span class="WHIT">
<span class='line'>5638</span> </span><span class="WHIT">			</span><span class="NAME">self.reattachConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.reattach</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.ReattachConnections</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5639</span> </span><span class="WHIT">			</span><span class="COMM">//self.isReattach = params.reattach || false;</span><span class="WHIT">
<span class='line'>5640</span> </span><span class="WHIT">            </span><span class="NAME">self.connectionsDetachable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.ConnectionsDetachable</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5641</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.connectionsDetachable</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">params.detachable</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5642</span> </span><span class="WHIT">                </span><span class="NAME">self.connectionsDetachable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5643</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dragAllowedWhenFull</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.dragAllowedWhenFull</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5644</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5645</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.onMaxConnections</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5646</span> </span><span class="WHIT">				</span><span class="NAME">self.bind</span><span class="PUNC">(</span><span class="STRN">"maxConnections"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.onMaxConnections</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5647</span> 
<span class='line'>5648</span> </span><span class="WHIT">			</span><span class="NAME">this.computeAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5649</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self.anchor.compute</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5650</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5651</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5652</span> 			 * Function: addConnection
<span class='line'>5653</span> 			 *   Adds a Connection to this Endpoint.
<span class='line'>5654</span> 			 *   
<span class='line'>5655</span> 			 * Parameters:
<span class='line'>5656</span> 			 *   connection - the Connection to add.
<span class='line'>5657</span> 			 */</span><span class="WHIT">
<span class='line'>5658</span> </span><span class="WHIT">			</span><span class="NAME">this.addConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5659</span> </span><span class="WHIT">				</span><span class="NAME">self.connections.push</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5660</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5661</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5662</span> 			 * Function: detach
<span class='line'>5663</span> 			 *   Detaches the given Connection from this Endpoint.
<span class='line'>5664</span> 			 *   
<span class='line'>5665</span> 			 * Parameters:
<span class='line'>5666</span> 			 *   connection - the Connection to detach.
<span class='line'>5667</span> 			 *   ignoreTarget - optional; tells the Endpoint to not notify the Connection target that the Connection was detached.  The default behaviour is to notify the target.
<span class='line'>5668</span> 			 */</span><span class="WHIT">
<span class='line'>5669</span> </span><span class="WHIT">			</span><span class="NAME">this.detach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ignoreTarget</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">forceDetach</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fireEvent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5670</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_findWithFunction</span><span class="PUNC">(</span><span class="NAME">self.connections</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">connection.id</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5671</span> </span><span class="WHIT">					</span><span class="NAME">actuallyDetached</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5672</span> </span><span class="WHIT">                </span><span class="NAME">fireEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fireEvent</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5673</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>5674</span> </span><span class="WHIT">					</span><span class="COMM">// 1. does the connection have a before detach (note this also checks jsPlumb's bound</span><span class="WHIT">
<span class='line'>5675</span> </span><span class="WHIT">					</span><span class="COMM">// detach handlers; but then Endpoint's check will, too, hmm.)</span><span class="WHIT">
<span class='line'>5676</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">forceDetach</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">connection._forceDetach</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">connection.isDetachable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">connection.isDetachAllowed</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5677</span> </span><span class="WHIT">						</span><span class="COMM">// get the target endpoint</span><span class="WHIT">
<span class='line'>5678</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connection.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">connection.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">connection.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5679</span> </span><span class="WHIT">						</span><span class="COMM">// it would be nice to check with both endpoints that it is ok to detach. but </span><span class="WHIT">
<span class='line'>5680</span> </span><span class="WHIT">						</span><span class="COMM">// for this we'll have to get a bit fancier: right now if you use the same beforeDetach</span><span class="WHIT">
<span class='line'>5681</span> </span><span class="WHIT">						</span><span class="COMM">// interceptor for two endpoints (which is kind of common, because it's part of the</span><span class="WHIT">
<span class='line'>5682</span> </span><span class="WHIT">						</span><span class="COMM">// endpoint definition), then it gets fired twice.  so in fact we need to loop through</span><span class="WHIT">
<span class='line'>5683</span> </span><span class="WHIT">						</span><span class="COMM">// each beforeDetach and see if it returns false, at which point we exit.  but if it</span><span class="WHIT">
<span class='line'>5684</span> </span><span class="WHIT">						</span><span class="COMM">// returns true, we have to check the next one.  however we need to track which ones</span><span class="WHIT">
<span class='line'>5685</span> </span><span class="WHIT">						</span><span class="COMM">// have already been run, and not run them again.</span><span class="WHIT">
<span class='line'>5686</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">forceDetach</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">connection._forceDetach</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.isDetachAllowed</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">/*&& t.isDetachAllowed(connection)*/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5687</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>5688</span> </span><span class="WHIT">							</span><span class="NAME">self.connections.splice</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">										</span><span class="WHIT">
<span class='line'>5689</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>5690</span> </span><span class="WHIT">							</span><span class="COMM">// this avoids a circular loop</span><span class="WHIT">
<span class='line'>5691</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ignoreTarget</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5692</span> </span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>5693</span> </span><span class="WHIT">								</span><span class="NAME">t.detach</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">forceDetach</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5694</span> </span><span class="WHIT">								</span><span class="COMM">// check connection to see if we want to delete the endpoints associated with it.</span><span class="WHIT">
<span class='line'>5695</span> </span><span class="WHIT">								</span><span class="COMM">// we only detach those that have just this connection; this scenario is most</span><span class="WHIT">
<span class='line'>5696</span> </span><span class="WHIT">								</span><span class="COMM">// likely if we got to this bit of code because it is set by the methods that</span><span class="WHIT">
<span class='line'>5697</span> </span><span class="WHIT">								</span><span class="COMM">// create their own endpoints, like .connect or .makeTarget. the user is</span><span class="WHIT">
<span class='line'>5698</span> </span><span class="WHIT">								</span><span class="COMM">// not likely to have interacted with those endpoints.</span><span class="WHIT">
<span class='line'>5699</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">connection.endpointsToDeleteOnDetach</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5700</span> </span><span class="WHIT">									</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">connection.endpointsToDeleteOnDetach.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5701</span> </span><span class="WHIT">										</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cde</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connection.endpointsToDeleteOnDetach</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5702</span> </span><span class="WHIT">										</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cde</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">cde.connections.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5703</span> </span><span class="WHIT">											</span><span class="NAME">_currentInstance.deleteEndpoint</span><span class="PUNC">(</span><span class="NAME">cde</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>5704</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5705</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5706</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5707</span> </span><span class="WHIT">							</span><span class="NAME">_removeElements</span><span class="PUNC">(</span><span class="NAME">connection.connector.getDisplayElements</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connection.parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5708</span> </span><span class="WHIT">							</span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">connectionsByScope</span><span class="PUNC">[</span><span class="NAME">connection.scope</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5709</span> </span><span class="WHIT">								</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">connection.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5710</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5711</span> </span><span class="WHIT">							</span><span class="NAME">actuallyDetached</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5712</span> </span><span class="WHIT">                            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">doFireEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ignoreTarget</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">fireEvent</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5713</span> </span><span class="WHIT">							</span><span class="NAME">fireDetachEvent</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doFireEvent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5714</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5715</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5716</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5717</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">actuallyDetached</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5718</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5719</span> 
<span class='line'>5720</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5721</span> 			 * Function: detachAll
<span class='line'>5722</span> 			 *   Detaches all Connections this Endpoint has.
<span class='line'>5723</span> 			 *
<span class='line'>5724</span> 			 * Parameters:
<span class='line'>5725</span> 			 *  fireEvent   -   whether or not to fire the detach event.  defaults to false.
<span class='line'>5726</span> 			 */</span><span class="WHIT">
<span class='line'>5727</span> </span><span class="WHIT">			</span><span class="NAME">this.detachAll</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fireEvent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5728</span> </span><span class="WHIT">				</span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connections.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5729</span> </span><span class="WHIT">					</span><span class="NAME">self.detach</span><span class="PUNC">(</span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fireEvent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5730</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5731</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5732</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5733</span> 			 * Function: detachFrom
<span class='line'>5734</span> 			 *   Removes any connections from this Endpoint that are connected to the given target endpoint.
<span class='line'>5735</span> 			 *   
<span class='line'>5736</span> 			 * Parameters:
<span class='line'>5737</span> 			 *   targetEndpoint     - Endpoint from which to detach all Connections from this Endpoint.
<span class='line'>5738</span> 			 *   fireEvent          - whether or not to fire the detach event. defaults to false.
<span class='line'>5739</span> 			 */</span><span class="WHIT">
<span class='line'>5740</span> </span><span class="WHIT">			</span><span class="NAME">this.detachFrom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">targetEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fireEvent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5741</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5742</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.connections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5743</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">targetEndpoint</span><span class="WHIT">
<span class='line'>5744</span> </span><span class="WHIT">							</span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">targetEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5745</span> </span><span class="WHIT">						</span><span class="NAME">c.push</span><span class="PUNC">(</span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5746</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5747</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5748</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">c.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5749</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.detach</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fireEvent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5750</span> </span><span class="WHIT">						</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setHover</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>5751</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5752</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5753</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5754</span> 			 * Function: detachFromConnection
<span class='line'>5755</span> 			 *   Detach this Endpoint from the Connection, but leave the Connection alive. Used when dragging.
<span class='line'>5756</span> 			 *   
<span class='line'>5757</span> 			 * Parameters:
<span class='line'>5758</span> 			 *   connection - Connection to detach from.
<span class='line'>5759</span> 			 */</span><span class="WHIT">
<span class='line'>5760</span> </span><span class="WHIT">			</span><span class="NAME">this.detachFromConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5761</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">_findWithFunction</span><span class="PUNC">(</span><span class="NAME">self.connections</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">connection.id</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5762</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5763</span> </span><span class="WHIT">					</span><span class="NAME">self.connections.splice</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5764</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5765</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5766</span> 
<span class='line'>5767</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5768</span> 			 * Function: getElement
<span class='line'>5769</span> 			 *
<span class='line'>5770</span> 			 * Returns:
<span class='line'>5771</span> 			 * 	The DOM element this Endpoint is attached to.
<span class='line'>5772</span> 			 */</span><span class="WHIT">
<span class='line'>5773</span> </span><span class="WHIT">			</span><span class="NAME">this.getElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5774</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5775</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>5776</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5777</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5778</span> 			 * Function: setElement
<span class='line'>5779</span> 			 * Sets the DOM element this Endpoint is attached to.
<span class='line'>5780</span> 			 *
<span class='line'>5781</span> 			 * Parameters:
<span class='line'>5782</span> 			 * 	el	-	dom element or selector
<span class='line'>5783</span> 			 * 	container	-	optional, specifies the actual parent element to use as the parent for this Endpoint's visual representation.
<span class='line'>5784</span> 			 * 	See the jsPlumb documentation for a discussion about this.
<span class='line'>5785</span> 			 */</span><span class="WHIT">
<span class='line'>5786</span> </span><span class="WHIT">			</span><span class="NAME">this.setElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">container</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5787</span> 
<span class='line'>5788</span> </span><span class="WHIT">				</span><span class="COMM">// TODO possibly have this object take charge of moving the UI components into the appropriate</span><span class="WHIT">
<span class='line'>5789</span> </span><span class="WHIT">				</span><span class="COMM">// parent.  this is used only by makeSource right now, and that function takes care of</span><span class="WHIT">
<span class='line'>5790</span> </span><span class="WHIT">				</span><span class="COMM">// moving the UI bits and pieces.  however it would s			</span><span class="WHIT">
<span class='line'>5791</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parentId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5792</span> </span><span class="WHIT">				</span><span class="COMM">// remove the endpoint from the list for the current endpoint's element</span><span class="WHIT">
<span class='line'>5793</span> </span><span class="WHIT">				</span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">self.elementId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5794</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">self.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5795</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5796</span> </span><span class="WHIT">				</span><span class="NAME">_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5797</span> </span><span class="WHIT">				</span><span class="NAME">_elementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">_element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5798</span> </span><span class="WHIT">				</span><span class="NAME">self.elementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5799</span> </span><span class="WHIT">				</span><span class="COMM">// need to get the new parent now</span><span class="WHIT">
<span class='line'>5800</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newParentElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getParentFromParams</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">source</span><span class="PUNC">:</span><span class="NAME">parentId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">container</span><span class="PUNC">:</span><span class="NAME">container</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5801</span> </span><span class="WHIT">				</span><span class="NAME">curParent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getParent</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5802</span> </span><span class="WHIT">				</span><span class="NAME">jpcl.removeElement</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curParent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5803</span> </span><span class="WHIT">				</span><span class="NAME">jpcl.appendElement</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newParentElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>5804</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>5805</span> </span><span class="WHIT">				</span><span class="COMM">// now move connection(s)...i would expect there to be only one but we will iterate.</span><span class="WHIT">
<span class='line'>5806</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.connections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5807</span> </span><span class="WHIT">					</span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">moveParent</span><span class="PUNC">(</span><span class="NAME">newParentElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5808</span> </span><span class="WHIT">					</span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5809</span> </span><span class="WHIT">					</span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_element</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>5810</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>5811</span> </span><span class="WHIT">				</span><span class="NAME">_addToList</span><span class="PUNC">(</span><span class="NAME">endpointsByElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parentId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5812</span> </span><span class="WHIT">				</span><span class="COMM">//_currentInstance.repaint(parentId);			</span><span class="WHIT">
<span class='line'>5813</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5814</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5815</span> 
<span class='line'>5816</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5817</span> 			 * Function: getUuid
<span class='line'>5818</span> 			 *   Returns the UUID for this Endpoint, if there is one. Otherwise returns null.
<span class='line'>5819</span> 			 */</span><span class="WHIT">
<span class='line'>5820</span> </span><span class="WHIT">			</span><span class="NAME">this.getUuid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5821</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_uuid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5822</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5823</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>5824</span> 			 * private but must be exposed.
<span class='line'>5825</span> 			 */</span><span class="WHIT">
<span class='line'>5826</span> </span><span class="WHIT">			</span><span class="NAME">this.makeInPlaceCopy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5827</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">loc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.anchor.getCurrentLocation</span><span class="PUNC">(</span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5828</span> </span><span class="WHIT">					</span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.anchor.getOrientation</span><span class="PUNC">(</span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5829</span> </span><span class="WHIT">					</span><span class="NAME">inPlaceAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5830</span> </span><span class="WHIT">						</span><span class="NAME">compute</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">loc</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loc</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5831</span> </span><span class="WHIT">						</span><span class="NAME">getCurrentLocation</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">loc</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loc</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5832</span> </span><span class="WHIT">						</span><span class="NAME">getOrientation</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5833</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5834</span> 
<span class='line'>5835</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_newEndpoint</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5836</span> </span><span class="WHIT">					</span><span class="NAME">anchor</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">inPlaceAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5837</span> </span><span class="WHIT">					</span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5838</span> </span><span class="WHIT">					</span><span class="NAME">paintStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.getPaintStyle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5839</span> </span><span class="WHIT">					</span><span class="NAME">endpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_endpoint</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5840</span> </span><span class="WHIT">					</span><span class="NAME">_transient</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5841</span> </span><span class="WHIT">                    </span><span class="NAME">scope</span><span class="PUNC">:</span><span class="NAME">self.scope</span><span class="WHIT">
<span class='line'>5842</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5843</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5844</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5845</span> 			 * Function: isConnectedTo
<span class='line'>5846</span> 			 *   Returns whether or not this endpoint is connected to the given Endpoint.
<span class='line'>5847</span> 			 *   
<span class='line'>5848</span> 			 * Parameters:
<span class='line'>5849</span> 			 *   endpoint - Endpoint to test.
<span class='line'>5850</span> 			 */</span><span class="WHIT">
<span class='line'>5851</span> </span><span class="WHIT">			</span><span class="NAME">this.isConnectedTo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5852</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">found</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5853</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5854</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.connections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5855</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5856</span> </span><span class="WHIT">							</span><span class="NAME">found</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5857</span> </span><span class="WHIT">							</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5858</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5859</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5860</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5861</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">found</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5862</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5863</span> 
<span class='line'>5864</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>5865</span> 			 * private but needs to be exposed.
<span class='line'>5866</span> 			 */</span><span class="WHIT">
<span class='line'>5867</span> </span><span class="WHIT">			</span><span class="NAME">this.isFloating</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5868</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">floatingEndpoint</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5869</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5870</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5871</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>5872</span> 			 * returns a connection from the pool; used when dragging starts.  just gets the head of the array if it can.
<span class='line'>5873</span> 			 */</span><span class="WHIT">
<span class='line'>5874</span> </span><span class="WHIT">			</span><span class="NAME">this.connectorSelector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5875</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">candidate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5876</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.isTarget</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">candidate</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">candidate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5877</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5878</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connections.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">_maxConnections</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_maxConnections</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">candidate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5879</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5880</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5881</span> 
<span class='line'>5882</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5883</span> 			 * Function: isFull
<span class='line'>5884</span> 			 *   Returns whether or not the Endpoint can accept any more Connections.
<span class='line'>5885</span> 			 */</span><span class="WHIT">
<span class='line'>5886</span> </span><span class="WHIT">			</span><span class="NAME">this.isFull</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5887</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">self.isFloating</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_maxConnections</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.connections.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">_maxConnections</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>5888</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5889</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5890</span> 			 * Function: setDragAllowedWhenFull
<span class='line'>5891</span> 			 *   Sets whether or not connections can be dragged from this Endpoint once it is full. You would use this in a UI in 
<span class='line'>5892</span> 			 *   which you're going to provide some other way of breaking connections, if you need to break them at all. This property 
<span class='line'>5893</span> 			 *   is by default true; use it in conjunction with the 'reattach' option on a connect call.
<span class='line'>5894</span> 			 *   
<span class='line'>5895</span> 			 * Parameters:
<span class='line'>5896</span> 			 *   allowed - whether drag is allowed or not when the Endpoint is full.
<span class='line'>5897</span> 			 */</span><span class="WHIT">
<span class='line'>5898</span> </span><span class="WHIT">			</span><span class="NAME">this.setDragAllowedWhenFull</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">allowed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5899</span> </span><span class="WHIT">				</span><span class="NAME">dragAllowedWhenFull</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">allowed</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5900</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5901</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5902</span> 			 * Function: setStyle
<span class='line'>5903</span> 			 *   Sets the paint style of the Endpoint.  This is a JS object of the same form you supply to a jsPlumb.addEndpoint or jsPlumb.connect call.
<span class='line'>5904</span> 			 *   TODO move setStyle into EventGenerator, remove it from here. is Connection's method currently setPaintStyle ? wire that one up to
<span class='line'>5905</span> 			 *   setStyle and deprecate it if so.
<span class='line'>5906</span> 			 *   
<span class='line'>5907</span> 			 * Parameters:
<span class='line'>5908</span> 			 *   style - Style object to set, for example {fillStyle:"blue"}.
<span class='line'>5909</span> 			 *   
<span class='line'>5910</span> 			 *  @deprecated use setPaintStyle instead.
<span class='line'>5911</span> 			 */</span><span class="WHIT">
<span class='line'>5912</span> </span><span class="WHIT">			</span><span class="NAME">this.setStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.setPaintStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5913</span> 
<span class='line'>5914</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>5915</span> 			 * a deep equals check. everything must match, including the anchor,
<span class='line'>5916</span> 			 * styles, everything. TODO: finish Endpoint.equals
<span class='line'>5917</span> 			 */</span><span class="WHIT">
<span class='line'>5918</span> </span><span class="WHIT">			</span><span class="NAME">this.equals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5919</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.anchor.equals</span><span class="PUNC">(</span><span class="NAME">endpoint.anchor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5920</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5921</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5922</span> </span><span class="WHIT">			</span><span class="COMM">// a helper function that tries to find a connection to the given element, and returns it if so. if elementWithPrecedence is null,</span><span class="WHIT">
<span class='line'>5923</span> </span><span class="WHIT">			</span><span class="COMM">// or no connection to it is found, we return the first connection in our list.</span><span class="WHIT">
<span class='line'>5924</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">findConnectionToUseForDynamicAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elementWithPrecedence</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5925</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5926</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elementWithPrecedence</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5927</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.connections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5928</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">elementWithPrecedence</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">targetId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">elementWithPrecedence</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5929</span> </span><span class="WHIT">							</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5930</span> </span><span class="WHIT">							</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5931</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5932</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5933</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5934</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>5935</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5936</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5937</span> 
<span class='line'>5938</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5939</span> 			 * Function: paint
<span class='line'>5940</span> 			 *   Paints the Endpoint, recalculating offset and anchor positions if necessary. This does NOT paint
<span class='line'>5941</span> 			 *   any of the Endpoint's connections.
<span class='line'>5942</span> 			 *   
<span class='line'>5943</span> 			 * Parameters:
<span class='line'>5944</span> 			 *   timestamp - optional timestamp advising the Endpoint of the current paint time; if it has painted already once for this timestamp, it will not paint again.
<span class='line'>5945</span> 			 *   canvas - optional Canvas to paint on.  Only used internally by jsPlumb in certain obscure situations.
<span class='line'>5946</span> 			 *   connectorPaintStyle - paint style of the Connector attached to this Endpoint. Used to get a fillStyle if nothing else was supplied.
<span class='line'>5947</span> 			 */</span><span class="WHIT">
<span class='line'>5948</span> </span><span class="WHIT">			</span><span class="NAME">this.paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5949</span> </span><span class="WHIT">				</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5950</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">params.recalc</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5951</span> </span><span class="WHIT">								</span><span class="COMM">//recalc = params.recalc;</span><span class="WHIT">
<span class='line'>5952</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.timestamp</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>5953</span> </span><span class="WHIT">					</span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="PUNC">:</span><span class="NAME">_elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="PUNC">:</span><span class="NAME">recalc</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5954</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.offset</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">_elementId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5955</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">xy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5956</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.anchorPoint</span><span class="PUNC">,</span><span class="NAME">connectorPaintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.connectorPaintStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5957</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ap</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5958</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.dimensions</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">_elementId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5959</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">xy</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5960</span> </span><span class="WHIT">								</span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5961</span> </span><span class="WHIT">								</span><span class="NAME">xy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">_elementId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5962</span> </span><span class="WHIT">								</span><span class="NAME">wh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">_elementId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5963</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5964</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">anchorParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">xy.left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xy.top</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5965</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">recalc</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">self.anchor.isDynamic</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">self.connections.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5966</span> </span><span class="WHIT">								</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">findConnectionToUseForDynamicAnchor</span><span class="PUNC">(</span><span class="NAME">params.elementWithPrecedence</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5967</span> </span><span class="WHIT">								</span><span class="NAME">oIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5968</span> </span><span class="WHIT">								</span><span class="NAME">oId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oIdx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">c.sourceId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">c.targetId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5969</span> </span><span class="WHIT">								</span><span class="NAME">oOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">oId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oWH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">oId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5970</span> </span><span class="WHIT">								</span><span class="NAME">anchorParams.txy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">oOffset.left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oOffset.top</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5971</span> </span><span class="WHIT">								</span><span class="NAME">anchorParams.twh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oWH</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5972</span> </span><span class="WHIT">								</span><span class="NAME">anchorParams.tElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c.endpoints</span><span class="PUNC">[</span><span class="NAME">oIdx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5973</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5974</span> </span><span class="WHIT">							</span><span class="NAME">ap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.anchor.compute</span><span class="PUNC">(</span><span class="NAME">anchorParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5975</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5976</span> </span><span class="WHIT">											</span><span class="WHIT">
<span class='line'>5977</span> </span><span class="WHIT">						</span><span class="COMM">// switched _endpoint to self here; continuous anchors, for instance, look for the</span><span class="WHIT">
<span class='line'>5978</span> </span><span class="WHIT">						</span><span class="COMM">// endpoint's id, but here "_endpoint" is the renderer, not the actual endpoint.</span><span class="WHIT">
<span class='line'>5979</span> </span><span class="WHIT">						</span><span class="COMM">// TODO need to verify this does not break anything.</span><span class="WHIT">
<span class='line'>5980</span> </span><span class="WHIT">						</span><span class="COMM">//var d = _endpoint.compute(ap, self.anchor.getOrientation(_endpoint), self.paintStyleInUse, connectorPaintStyle || self.paintStyleInUse);</span><span class="WHIT">
<span class='line'>5981</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_endpoint.compute</span><span class="PUNC">(</span><span class="NAME">ap</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.anchor.getOrientation</span><span class="PUNC">(</span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.paintStyleInUse</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectorPaintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.paintStyleInUse</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5982</span> </span><span class="WHIT">						</span><span class="NAME">_endpoint.paint</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.paintStyleInUse</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.anchor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>5983</span> </span><span class="WHIT">						</span><span class="NAME">self.timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5984</span> 
<span class='line'>5985</span> </span><span class="WHIT">						</span><span class="COMM">/* paint overlays*/</span><span class="WHIT">
<span class='line'>5986</span> </span><span class="WHIT">						</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.overlays.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5987</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5988</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o.isVisible</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.overlayPlacements</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">o.draw</span><span class="PUNC">(</span><span class="NAME">self.endpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.paintStyleInUse</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5989</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5990</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5991</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5992</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5993</span> 
<span class='line'>5994</span> </span><span class="WHIT">            </span><span class="NAME">this.repaint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.paint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5995</span> 
<span class='line'>5996</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>5997</span> 			 * @deprecated
<span class='line'>5998</span> 			 */</span><span class="WHIT">
<span class='line'>5999</span> </span><span class="WHIT">			</span><span class="NAME">this.removeConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.detach</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// backwards compatibility</span><span class="WHIT">
<span class='line'>6000</span> 
<span class='line'>6001</span> </span><span class="WHIT">			</span><span class="COMM">// is this a connection source? we make it draggable and have the</span><span class="WHIT">
<span class='line'>6002</span> </span><span class="WHIT">			</span><span class="COMM">// drag listener maintain a connection with a floating endpoint.</span><span class="WHIT">
<span class='line'>6003</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jsPlumb.CurrentLibrary.isDragSupported</span><span class="PUNC">(</span><span class="NAME">_element</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6004</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">placeholderInfo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6005</span> </span><span class="WHIT">                    </span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6006</span> </span><span class="WHIT">                    </span><span class="NAME">existingJpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6007</span> </span><span class="WHIT">                    </span><span class="NAME">existingJpcParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6008</span> </span><span class="WHIT">                    </span><span class="NAME">_dragHandler</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_makeConnectionDragHandler</span><span class="PUNC">(</span><span class="NAME">placeholderInfo</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6009</span> 
<span class='line'>6010</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>6011</span> </span><span class="WHIT">				</span><span class="COMM">// drag might have started on an endpoint that is not actually a source, but which has</span><span class="WHIT">
<span class='line'>6012</span> </span><span class="WHIT">				</span><span class="COMM">// one or more connections.</span><span class="WHIT">
<span class='line'>6013</span> </span><span class="WHIT">					</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.connectorSelector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6014</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_continue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6015</span> </span><span class="WHIT">                    </span><span class="COMM">// if not enabled, return</span><span class="WHIT">
<span class='line'>6016</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">self.isEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_continue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6017</span> </span><span class="WHIT">					</span><span class="COMM">// if no connection and we're not a source, return.</span><span class="WHIT">
<span class='line'>6018</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">params.isSource</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_continue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6019</span> </span><span class="WHIT">                    </span><span class="COMM">// otherwise if we're full and not allowed to drag, also return false.</span><span class="WHIT">
<span class='line'>6020</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.isSource</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">self.isFull</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">dragAllowedWhenFull</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_continue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6021</span> </span><span class="WHIT">                    </span><span class="COMM">// if the connection was setup as not detachable or one of its endpoints</span><span class="WHIT">
<span class='line'>6022</span> </span><span class="WHIT">                    </span><span class="COMM">// was setup as connectionsDetachable = false, or Defaults.ConnectionsDetachable</span><span class="WHIT">
<span class='line'>6023</span> </span><span class="WHIT">                    </span><span class="COMM">// is set to false...</span><span class="WHIT">
<span class='line'>6024</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">jpc.isDetachable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_continue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6025</span> 
<span class='line'>6026</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_continue</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6027</span> </span><span class="WHIT">                        </span><span class="COMM">// this is for mootools and yui. returning false from this causes jquery to stop drag.</span><span class="WHIT">
<span class='line'>6028</span> </span><span class="WHIT">                        </span><span class="COMM">// the events are wrapped in both mootools and yui anyway, but i don't think returning</span><span class="WHIT">
<span class='line'>6029</span> </span><span class="WHIT">                        </span><span class="COMM">// false from the start callback would stop a drag.</span><span class="WHIT">
<span class='line'>6030</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jsPlumb.CurrentLibrary.stopDrag</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.stopDrag</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6031</span> </span><span class="WHIT">                        </span><span class="NAME">_dragHandler.stopDrag</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6032</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6033</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6034</span> 
<span class='line'>6035</span> </span><span class="WHIT">					</span><span class="COMM">// if we're not full but there was a connection, make it null. we'll create a new one.</span><span class="WHIT">
<span class='line'>6036</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">self.isFull</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">params.isSource</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6037</span> 
<span class='line'>6038</span> </span><span class="WHIT">					</span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6039</span> </span><span class="WHIT">					</span><span class="NAME">inPlaceCopy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.makeInPlaceCopy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6040</span> </span><span class="WHIT">					</span><span class="NAME">inPlaceCopy.referenceEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6041</span> </span><span class="WHIT">					</span><span class="NAME">inPlaceCopy.paint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">																</span><span class="WHIT">
<span class='line'>6042</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>6043</span> </span><span class="WHIT">					</span><span class="NAME">_makeDraggablePlaceholder</span><span class="PUNC">(</span><span class="NAME">placeholderInfo</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6044</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>6045</span> </span><span class="WHIT">					</span><span class="COMM">// set the offset of this div to be where 'inPlaceCopy' is, to start with.</span><span class="WHIT">
<span class='line'>6046</span> </span><span class="WHIT">					</span><span class="COMM">// TODO merge this code with the code in both Anchor and FloatingAnchor, because it</span><span class="WHIT">
<span class='line'>6047</span> </span><span class="WHIT">					</span><span class="COMM">// does the same stuff.</span><span class="WHIT">
<span class='line'>6048</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ipcoel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">inPlaceCopy.canvas</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6049</span> </span><span class="WHIT">					    </span><span class="NAME">ipco</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getOffset</span><span class="PUNC">(</span><span class="NAME">ipcoel</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6050</span> </span><span class="WHIT">					    </span><span class="NAME">po</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">adjustForParentOffsetAndScroll</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">ipco.left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ipco.top</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">inPlaceCopy.canvas</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6051</span> </span><span class="WHIT">					</span><span class="NAME">jsPlumb.CurrentLibrary.setOffset</span><span class="PUNC">(</span><span class="NAME">placeholderInfo.element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NAME">po</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">:</span><span class="NAME">po</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">															</span><span class="WHIT">
<span class='line'>6052</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>6053</span> </span><span class="WHIT">					</span><span class="COMM">// when using makeSource and a parent, we first draw the source anchor on the source element, then</span><span class="WHIT">
<span class='line'>6054</span> </span><span class="WHIT">					</span><span class="COMM">// move it to the parent.  note that this happens after drawing the placeholder for the</span><span class="WHIT">
<span class='line'>6055</span> </span><span class="WHIT">					</span><span class="COMM">// first time.</span><span class="WHIT">
<span class='line'>6056</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.parentAnchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.makeAnchor</span><span class="PUNC">(</span><span class="NAME">self.parentAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6057</span> 
<span class='line'>6058</span> </span><span class="WHIT">					</span><span class="COMM">// store the id of the dragging div and the source element. the drop function will pick these up.					</span><span class="WHIT">
<span class='line'>6059</span> </span><span class="WHIT">					</span><span class="NAME">_setAttribute</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"dragId"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">placeholderInfo.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6060</span> </span><span class="WHIT">					</span><span class="NAME">_setAttribute</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"elId"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6061</span> 
<span class='line'>6062</span> </span><span class="WHIT">					</span><span class="COMM">// create a floating endpoint.</span><span class="WHIT">
<span class='line'>6063</span> </span><span class="WHIT">					</span><span class="COMM">// here we test to see if a dragProxy was specified in this endpoint's constructor params, and</span><span class="WHIT">
<span class='line'>6064</span> </span><span class="WHIT">					</span><span class="COMM">// if so, we create that endpoint instead of cloning ourselves.</span><span class="WHIT">
<span class='line'>6065</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.proxy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6066</span> </span><span class="WHIT">				</span><span class="COMM">/*		var floatingAnchor = new FloatingAnchor( { reference : self.anchor, referenceCanvas : self.canvas });
<span class='line'>6067</span> 
<span class='line'>6068</span> 						floatingEndpoint = _newEndpoint({ 
<span class='line'>6069</span> 							paintStyle : params.proxy.paintStyle,
<span class='line'>6070</span> 							endpoint : params.proxy.endpoint,
<span class='line'>6071</span> 							anchor : floatingAnchor, 
<span class='line'>6072</span> 							source : placeholderInfo.element, 
<span class='line'>6073</span> 							scope:"__floating" 
<span class='line'>6074</span> 						});		
<span class='line'>6075</span> 						
<span class='line'>6076</span> 						//$(self.canvas).hide();									
<span class='line'>6077</span> 						*/</span><span class="WHIT">
<span class='line'>6078</span> </span><span class="WHIT">						</span><span class="NAME">self.setPaintStyle</span><span class="PUNC">(</span><span class="NAME">params.proxy.paintStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6079</span> </span><span class="WHIT">						</span><span class="COMM">// if we do this, we have to cleanup the old one. like just remove its display parts												</span><span class="WHIT">
<span class='line'>6080</span> </span><span class="WHIT">						</span><span class="COMM">//self.setEndpoint(params.proxy.endpoint);</span><span class="WHIT">
<span class='line'>6081</span> 
<span class='line'>6082</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6083</span> </span><span class="WHIT">				</span><span class="COMM">//	else {</span><span class="WHIT">
<span class='line'>6084</span> </span><span class="WHIT">						</span><span class="NAME">floatingEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_makeFloatingEndpoint</span><span class="PUNC">(</span><span class="NAME">self.getPaintStyle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_endpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">placeholderInfo.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6085</span> </span><span class="WHIT">				</span><span class="COMM">//	}</span><span class="WHIT">
<span class='line'>6086</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>6087</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">                                                                                                                                                         </span><span class="WHIT">
<span class='line'>6088</span> </span><span class="WHIT">						</span><span class="NAME">self.anchor.locked</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6089</span> </span><span class="WHIT">                        </span><span class="NAME">self.setHover</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6090</span> </span><span class="WHIT">                        </span><span class="COMM">// TODO the hover call above does not reset any target endpoint's hover</span><span class="WHIT">
<span class='line'>6091</span> </span><span class="WHIT">                        </span><span class="COMM">// states.</span><span class="WHIT">
<span class='line'>6092</span> </span><span class="WHIT">						</span><span class="COMM">// create a connection. one end is this endpoint, the other is a floating endpoint.</span><span class="WHIT">
<span class='line'>6093</span> </span><span class="WHIT">						</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_newConnection</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6094</span> </span><span class="WHIT">							</span><span class="NAME">sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6095</span> </span><span class="WHIT">							</span><span class="NAME">targetEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">floatingEndpoint</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6096</span> </span><span class="WHIT">							</span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">self.endpointWillMoveTo</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">_element</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="COMM">// for makeSource with parent option.  ensure source element is represented correctly.</span><span class="WHIT">
<span class='line'>6097</span> </span><span class="WHIT">							</span><span class="NAME">target</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">placeholderInfo.element</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6098</span> </span><span class="WHIT">							</span><span class="NAME">anchors</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">self.anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">floatingEndpoint.anchor</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6099</span> </span><span class="WHIT">							</span><span class="NAME">paintStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">params.connectorStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// this can be null. Connection will use the default.</span><span class="WHIT">
<span class='line'>6100</span> </span><span class="WHIT">							</span><span class="NAME">hoverPaintStyle</span><span class="PUNC">:</span><span class="NAME">params.connectorHoverStyle</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6101</span> </span><span class="WHIT">							</span><span class="NAME">connector</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">params.connector</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// this can also be null. Connection will use the default.</span><span class="WHIT">
<span class='line'>6102</span> </span><span class="WHIT">							</span><span class="NAME">overlays</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">params.connectorOverlays</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6103</span> </span><span class="WHIT">							</span><span class="NAME">type</span><span class="PUNC">:</span><span class="NAME">self.connectionType</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6104</span> </span><span class="WHIT">							</span><span class="NAME">cssClass</span><span class="PUNC">:</span><span class="NAME">self.connectorClass</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6105</span> </span><span class="WHIT">							</span><span class="NAME">hoverClass</span><span class="PUNC">:</span><span class="NAME">self.connectorHoverClass</span><span class="WHIT">
<span class='line'>6106</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6107</span> 
<span class='line'>6108</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6109</span> </span><span class="WHIT">						</span><span class="NAME">existingJpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6110</span> </span><span class="WHIT">						</span><span class="NAME">jpc.connector.setHover</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6111</span> </span><span class="WHIT">						</span><span class="COMM">// if existing connection, allow to be dropped back on the source endpoint (issue 51).</span><span class="WHIT">
<span class='line'>6112</span> </span><span class="WHIT">						</span><span class="NAME">_initDropTarget</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">inPlaceCopy.canvas</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6113</span> </span><span class="WHIT">						</span><span class="COMM">// new anchor idx</span><span class="WHIT">
<span class='line'>6114</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">anchorIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">self.id</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6115</span> </span><span class="WHIT">						</span><span class="NAME">jpc.floatingAnchorIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchorIdx</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="COMM">// save our anchor index as the connection's floating index.						</span><span class="WHIT">
<span class='line'>6116</span> </span><span class="WHIT">						</span><span class="NAME">self.detachFromConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">							</span><span class="COMM">// detach from the connection while dragging is occurring.</span><span class="WHIT">
<span class='line'>6117</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>6118</span> </span><span class="WHIT">						</span><span class="COMM">// store the original scope (issue 57)</span><span class="WHIT">
<span class='line'>6119</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6120</span> </span><span class="WHIT">						    </span><span class="NAME">dragScope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getDragScope</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6121</span> </span><span class="WHIT">						</span><span class="NAME">_setAttribute</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"originalScope"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragScope</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6122</span> </span><span class="WHIT">						</span><span class="COMM">// now we want to get this endpoint's DROP scope, and set it for now: we can only be dropped on drop zones</span><span class="WHIT">
<span class='line'>6123</span> </span><span class="WHIT">						</span><span class="COMM">// that have our drop scope (issue 57).</span><span class="WHIT">
<span class='line'>6124</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dropScope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getDropScope</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6125</span> </span><span class="WHIT">						</span><span class="NAME">jsPlumb.CurrentLibrary.setDragScope</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropScope</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6126</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>6127</span> </span><span class="WHIT">						</span><span class="COMM">// now we replace ourselves with the temporary div we created above:</span><span class="WHIT">
<span class='line'>6128</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">anchorIdx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6129</span> </span><span class="WHIT">							</span><span class="NAME">existingJpcParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">jpc.source</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragScope</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6130</span> </span><span class="WHIT">							</span><span class="NAME">jpc.source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">placeholderInfo.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6131</span> </span><span class="WHIT">							</span><span class="NAME">jpc.sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">placeholderInfo.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6132</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6133</span> </span><span class="WHIT">							</span><span class="NAME">existingJpcParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">jpc.target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc.targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragScope</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6134</span> </span><span class="WHIT">							</span><span class="NAME">jpc.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">placeholderInfo.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6135</span> </span><span class="WHIT">							</span><span class="NAME">jpc.targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">placeholderInfo.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6136</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6137</span> 
<span class='line'>6138</span> </span><span class="WHIT">						</span><span class="COMM">// lock the other endpoint; if it is dynamic it will not move while the drag is occurring.</span><span class="WHIT">
<span class='line'>6139</span> </span><span class="WHIT">						</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">anchorIdx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor.locked</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6140</span> </span><span class="WHIT">						</span><span class="COMM">// store the original endpoint and assign the new floating endpoint for the drag.</span><span class="WHIT">
<span class='line'>6141</span> </span><span class="WHIT">						</span><span class="NAME">jpc.suspendedEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">anchorIdx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6142</span> </span><span class="WHIT">						</span><span class="NAME">jpc.suspendedEndpoint.setHover</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6143</span> </span><span class="WHIT">						</span><span class="NAME">floatingEndpoint.referenceEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6144</span> </span><span class="WHIT">						</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">anchorIdx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">floatingEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6145</span> 
<span class='line'>6146</span> </span><span class="WHIT">						</span><span class="COMM">// fire an event that informs that a connection is being dragged</span><span class="WHIT">
<span class='line'>6147</span> </span><span class="WHIT">						</span><span class="NAME">fireConnectionDraggingEvent</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6148</span> 
<span class='line'>6149</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6150</span> </span><span class="WHIT">					</span><span class="COMM">// register it and register connection on it.</span><span class="WHIT">
<span class='line'>6151</span> </span><span class="WHIT">					</span><span class="NAME">floatingConnections</span><span class="PUNC">[</span><span class="NAME">placeholderInfo.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6152</span> </span><span class="WHIT">					</span><span class="NAME">floatingEndpoint.addConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6153</span> </span><span class="WHIT">					</span><span class="COMM">// only register for the target endpoint; we will not be dragging the source at any time</span><span class="WHIT">
<span class='line'>6154</span> </span><span class="WHIT">					</span><span class="COMM">// before this connection is either discarded or made into a permanent connection.</span><span class="WHIT">
<span class='line'>6155</span> </span><span class="WHIT">					</span><span class="NAME">_addToList</span><span class="PUNC">(</span><span class="NAME">endpointsByElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">placeholderInfo.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">floatingEndpoint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6156</span> </span><span class="WHIT">					</span><span class="COMM">// tell jsplumb about it</span><span class="WHIT">
<span class='line'>6157</span> </span><span class="WHIT">					</span><span class="NAME">_currentInstance.currentlyDragging</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6158</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6159</span> 
<span class='line'>6160</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jpcl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6161</span> </span><span class="WHIT">				    </span><span class="NAME">dragOptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.dragOptions</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6162</span> </span><span class="WHIT">				    </span><span class="NAME">defaultOpts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpcl.defaultDragOptions</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6163</span> </span><span class="WHIT">				    </span><span class="NAME">startEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.dragEvents</span><span class="PUNC">[</span><span class="STRN">"start"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6164</span> </span><span class="WHIT">				    </span><span class="NAME">stopEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.dragEvents</span><span class="PUNC">[</span><span class="STRN">"stop"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6165</span> </span><span class="WHIT">				    </span><span class="NAME">dragEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.dragEvents</span><span class="PUNC">[</span><span class="STRN">"drag"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6166</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>6167</span> </span><span class="WHIT">				</span><span class="NAME">dragOptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">defaultOpts</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragOptions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6168</span> </span><span class="WHIT">				</span><span class="NAME">dragOptions.scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dragOptions.scope</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.scope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6169</span> </span><span class="WHIT">				</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="NAME">startEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="NAME">startEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">start</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6170</span> </span><span class="WHIT">				</span><span class="COMM">// extracted drag handler function so can be used by makeSource</span><span class="WHIT">
<span class='line'>6171</span> </span><span class="WHIT">				</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="NAME">dragEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="NAME">dragEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_dragHandler.drag</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6172</span> </span><span class="WHIT">				</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="NAME">stopEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="NAME">stopEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6173</span> </span><span class="WHIT">					</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6174</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getDropEvent</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6175</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.currentlyDragging</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>6176</span> </span><span class="WHIT">						</span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">placeholderInfo.id</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6177</span> </span><span class="WHIT">							</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">floatingEndpoint.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6178</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6179</span> </span><span class="WHIT">						</span><span class="NAME">_removeElements</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">placeholderInfo.element</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">floatingEndpoint.canvas</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// TODO: clean up the connection canvas (if the user aborted)</span><span class="WHIT">
<span class='line'>6180</span> </span><span class="WHIT">						</span><span class="NAME">_removeElement</span><span class="PUNC">(</span><span class="NAME">inPlaceCopy.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6181</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.anchorManager.clearFor</span><span class="PUNC">(</span><span class="NAME">placeholderInfo.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>6182</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.floatingAnchorIndex</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.floatingAnchorIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6183</span> </span><span class="WHIT">						</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor.locked</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6184</span> </span><span class="WHIT">						</span><span class="NAME">self.setPaintStyle</span><span class="PUNC">(</span><span class="NAME">originalPaintStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// reset to original; may have been changed by drag proxy.</span><span class="WHIT">
<span class='line'>6185</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">floatingEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6186</span> </span><span class="WHIT">							</span><span class="COMM">// if the connection was an existing one:</span><span class="WHIT">
<span class='line'>6187</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">existingJpc</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6188</span> </span><span class="WHIT">								</span><span class="COMM">// fix for issue35, thanks Sylvain Gizard: when firing the detach event make sure the</span><span class="WHIT">
<span class='line'>6189</span> </span><span class="WHIT">								</span><span class="COMM">// floating endpoint has been replaced.</span><span class="WHIT">
<span class='line'>6190</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6191</span> </span><span class="WHIT">									</span><span class="NAME">jpc.source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">existingJpcParams</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6192</span> </span><span class="WHIT">									</span><span class="NAME">jpc.sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">existingJpcParams</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6193</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6194</span> </span><span class="WHIT">									</span><span class="NAME">jpc.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">existingJpcParams</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6195</span> </span><span class="WHIT">									</span><span class="NAME">jpc.targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">existingJpcParams</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6196</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6197</span> </span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>6198</span> </span><span class="WHIT">								</span><span class="COMM">// restore the original scope (issue 57)</span><span class="WHIT">
<span class='line'>6199</span> </span><span class="WHIT">								</span><span class="NAME">jsPlumb.CurrentLibrary.setDragScope</span><span class="PUNC">(</span><span class="NAME">existingJpcParams</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">existingJpcParams</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6200</span> </span><span class="WHIT">								</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6201</span> </span><span class="WHIT">								</span><span class="COMM">//if (self.isReattach || jpc._forceDetach || !jpc.endpoints[idx == 0 ? 1 : 0].detach(jpc, false, false, true, originalEvent)) {</span><span class="WHIT">
<span class='line'>6202</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.isReattach</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jpc._forceReattach</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jpc._forceDetach</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">detach</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">									</span><span class="WHIT">
<span class='line'>6203</span> </span><span class="WHIT">									</span><span class="NAME">jpc.setHover</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6204</span> </span><span class="WHIT">									</span><span class="NAME">jpc.floatingAnchorIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6205</span> </span><span class="WHIT">									</span><span class="NAME">jpc.suspendedEndpoint.addConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6206</span> </span><span class="WHIT">									</span><span class="NAME">_currentInstance.repaint</span><span class="PUNC">(</span><span class="NAME">existingJpcParams</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6207</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6208</span> </span><span class="WHIT">                                </span><span class="NAME">jpc._forceDetach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6209</span> </span><span class="WHIT">								</span><span class="NAME">jpc._forceReattach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6210</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6211</span> </span><span class="WHIT">								</span><span class="COMM">// TODO this looks suspiciously kind of like an Endpoint.detach call too.</span><span class="WHIT">
<span class='line'>6212</span> </span><span class="WHIT">								</span><span class="COMM">// i wonder if this one should post an event though.  maybe this is good like this.</span><span class="WHIT">
<span class='line'>6213</span> </span><span class="WHIT">								</span><span class="NAME">_removeElements</span><span class="PUNC">(</span><span class="NAME">jpc.connector.getDisplayElements</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6214</span> </span><span class="WHIT">								</span><span class="NAME">self.detachFromConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>6215</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">																</span><span class="WHIT">
<span class='line'>6216</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6217</span> </span><span class="WHIT">						</span><span class="NAME">self.anchor.locked</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">												</span><span class="WHIT">
<span class='line'>6218</span> </span><span class="WHIT">						</span><span class="NAME">self.paint</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">recalc</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6219</span> </span><span class="WHIT">						</span><span class="NAME">jpc.setHover</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6220</span> 
<span class='line'>6221</span> </span><span class="WHIT">						</span><span class="NAME">fireConnectionDragStopEvent</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6222</span> 
<span class='line'>6223</span> </span><span class="WHIT">						</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>6224</span> </span><span class="WHIT">						</span><span class="NAME">inPlaceCopy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>6225</span> </span><span class="WHIT">						</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">floatingEndpoint.elementId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6226</span> </span><span class="WHIT">						</span><span class="NAME">floatingEndpoint.anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6227</span> </span><span class="WHIT">                        </span><span class="NAME">floatingEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6228</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.currentlyDragging</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6229</span> 
<span class='line'>6230</span> 
<span class='line'>6231</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6232</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>6233</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>6234</span> </span><span class="WHIT">				</span><span class="NAME">jsPlumb.CurrentLibrary.initDraggable</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragOptions</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6235</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6236</span> 
<span class='line'>6237</span> </span><span class="WHIT">			</span><span class="COMM">// pulled this out into a function so we can reuse it for the inPlaceCopy canvas; you can now drop detached connections</span><span class="WHIT">
<span class='line'>6238</span> </span><span class="WHIT">			</span><span class="COMM">// back onto the endpoint you detached it from.</span><span class="WHIT">
<span class='line'>6239</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_initDropTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">forceInit</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isTransient</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6240</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">params.isTarget</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">forceInit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.isDropSupported</span><span class="PUNC">(</span><span class="NAME">_element</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6241</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dropOptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.dropOptions</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.DropOptions</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.DropOptions</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6242</span> </span><span class="WHIT">					</span><span class="NAME">dropOptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropOptions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6243</span> </span><span class="WHIT">					</span><span class="NAME">dropOptions.scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dropOptions.scope</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.scope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6244</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dropEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.dragEvents</span><span class="PUNC">[</span><span class="STRN">'drop'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6245</span> </span><span class="WHIT">					    </span><span class="NAME">overEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.dragEvents</span><span class="PUNC">[</span><span class="STRN">'over'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6246</span> </span><span class="WHIT">					    </span><span class="NAME">outEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.dragEvents</span><span class="PUNC">[</span><span class="STRN">'out'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6247</span> </span><span class="WHIT">						</span><span class="NAME">drop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6248</span> </span><span class="WHIT">														</span><span class="WHIT">
<span class='line'>6249</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getDropEvent</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6250</span> </span><span class="WHIT">								</span><span class="NAME">draggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">jsPlumb.CurrentLibrary.getDragObject</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6251</span> </span><span class="WHIT">								</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"dragId"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6252</span> </span><span class="WHIT">								</span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"elId"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>6253</span> </span><span class="WHIT">								</span><span class="NAME">scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"originalScope"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6254</span> </span><span class="WHIT">								</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">floatingConnections</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6255</span> </span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>6256</span> </span><span class="WHIT">							</span><span class="COMM">// if this is a drop back where the connection came from, mark it force rettach and</span><span class="WHIT">
<span class='line'>6257</span> </span><span class="WHIT">							</span><span class="COMM">// return; the stop handler will reattach. without firing an event.</span><span class="WHIT">
<span class='line'>6258</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">redrop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.suspendedEndpoint.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">self.id</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>6259</span> </span><span class="WHIT">											</span><span class="NAME">self.referenceEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">self.referenceEndpoint.id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>6260</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">redrop</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>6261</span> </span><span class="WHIT">								</span><span class="NAME">jpc._forceReattach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6262</span> </span><span class="WHIT">								</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6263</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6264</span> 
<span class='line'>6265</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6266</span> </span><span class="WHIT">								</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.floatingAnchorIndex</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.floatingAnchorIndex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oidx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6267</span> </span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>6268</span> </span><span class="WHIT">								</span><span class="COMM">// restore the original scope if necessary (issue 57)						</span><span class="WHIT">
<span class='line'>6269</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">scope</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.setDragScope</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>6270</span> </span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>6271</span> </span><span class="WHIT">								</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endpointEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpoint</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">endpoint.isEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6272</span> </span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>6273</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.isFull</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6274</span> </span><span class="WHIT">									</span><span class="NAME">self.fire</span><span class="PUNC">(</span><span class="STRN">"maxConnections"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>6275</span> </span><span class="WHIT">										</span><span class="NAME">endpoint</span><span class="PUNC">:</span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>6276</span> </span><span class="WHIT">										</span><span class="NAME">connection</span><span class="PUNC">:</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>6277</span> </span><span class="WHIT">										</span><span class="NAME">maxConnections</span><span class="PUNC">:</span><span class="NAME">_maxConnections</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>6278</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6279</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6280</span> </span><span class="WHIT">																</span><span class="WHIT">
<span class='line'>6281</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">self.isFull</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">self.isSource</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">self.isTarget</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">endpointEnabled</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6282</span> </span><span class="WHIT">									</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_doContinue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6283</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>6284</span> </span><span class="WHIT">									</span><span class="COMM">// the second check here is for the case that the user is dropping it back</span><span class="WHIT">
<span class='line'>6285</span> </span><span class="WHIT">									</span><span class="COMM">// where it came from.</span><span class="WHIT">
<span class='line'>6286</span> </span><span class="WHIT">									</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.suspendedEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.id</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">self.id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6287</span> </span><span class="WHIT">										</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6288</span> </span><span class="WHIT">											</span><span class="NAME">jpc.source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6289</span> </span><span class="WHIT">											</span><span class="NAME">jpc.sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6290</span> </span><span class="WHIT">										</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6291</span> </span><span class="WHIT">											</span><span class="NAME">jpc.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6292</span> </span><span class="WHIT">											</span><span class="NAME">jpc.targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6293</span> </span><span class="WHIT">										</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6294</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>6295</span> </span><span class="WHIT">										</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">jpc.isDetachAllowed</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isDetachAllowed</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">jpc.suspendedEndpoint.isDetachAllowed</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_currentInstance.checkCondition</span><span class="PUNC">(</span><span class="STRN">"beforeDetach"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6296</span> </span><span class="WHIT">											</span><span class="NAME">_doContinue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>6297</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6298</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>6299</span> </span><span class="WHIT">									</span><span class="COMM">// these have to be set before testing for beforeDrop.</span><span class="WHIT">
<span class='line'>6300</span> </span><span class="WHIT">									</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6301</span> </span><span class="WHIT">										</span><span class="NAME">jpc.source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6302</span> </span><span class="WHIT">										</span><span class="NAME">jpc.sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6303</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6304</span> </span><span class="WHIT">										</span><span class="NAME">jpc.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6305</span> </span><span class="WHIT">										</span><span class="NAME">jpc.targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6306</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6307</span> </span><span class="WHIT">																</span><span class="WHIT">
<span class='line'>6308</span> </span><span class="WHIT">									</span><span class="COMM">// now check beforeDrop.  this will be available only on Endpoints that are setup to</span><span class="WHIT">
<span class='line'>6309</span> </span><span class="WHIT">									</span><span class="COMM">// have a beforeDrop condition (although, secretly, under the hood all Endpoints and </span><span class="WHIT">
<span class='line'>6310</span> </span><span class="WHIT">									</span><span class="COMM">// the Connection have them, because they are on jsPlumbUIComponent.  shhh!), because</span><span class="WHIT">
<span class='line'>6311</span> </span><span class="WHIT">									</span><span class="COMM">// it only makes sense to have it on a target endpoint.</span><span class="WHIT">
<span class='line'>6312</span> </span><span class="WHIT">									</span><span class="NAME">_doContinue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_doContinue</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">self.isDropAllowed</span><span class="PUNC">(</span><span class="NAME">jpc.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc.targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc.scope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6313</span> </span><span class="WHIT">															</span><span class="WHIT">
<span class='line'>6314</span> </span><span class="WHIT">									</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_doContinue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6315</span> </span><span class="WHIT">										</span><span class="COMM">// remove this jpc from the current endpoint</span><span class="WHIT">
<span class='line'>6316</span> </span><span class="WHIT">										</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">detachFromConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6317</span> </span><span class="WHIT">										</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.suspendedEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.detachFromConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6318</span> </span><span class="WHIT">										</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6319</span> </span><span class="WHIT">										</span><span class="NAME">self.addConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6320</span> </span><span class="WHIT">										</span><span class="WHIT">
<span class='line'>6321</span> </span><span class="WHIT">										</span><span class="COMM">// copy our parameters in to the connection:</span><span class="WHIT">
<span class='line'>6322</span> </span><span class="WHIT">										</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.getParameters</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6323</span> </span><span class="WHIT">										</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">aParam</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6324</span> </span><span class="WHIT">											</span><span class="NAME">jpc.setParameter</span><span class="PUNC">(</span><span class="NAME">aParam</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">[</span><span class="NAME">aParam</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6325</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>6326</span> </span><span class="WHIT">										</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">jpc.suspendedEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>6327</span> </span><span class="WHIT">											</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.draggable</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6328</span> </span><span class="WHIT">												</span><span class="NAME">jsPlumb.CurrentLibrary.initDraggable</span><span class="PUNC">(</span><span class="NAME">self.element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragOptions</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6329</span> </span><span class="WHIT">										</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6330</span> </span><span class="WHIT">										</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6331</span> </span><span class="WHIT">											</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">suspendedElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.getElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">suspendedElementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6332</span> </span><span class="WHIT">											</span><span class="COMM">// fire a detach event</span><span class="WHIT">
<span class='line'>6333</span> </span><span class="WHIT">											</span><span class="NAME">fireDetachEvent</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6334</span> </span><span class="WHIT">												</span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">suspendedElement</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.source</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>6335</span> </span><span class="WHIT">												</span><span class="NAME">target</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">suspendedElement</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.target</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6336</span> </span><span class="WHIT">												</span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">suspendedElementId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>6337</span> </span><span class="WHIT">												</span><span class="NAME">targetId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">suspendedElementId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.targetId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6338</span> </span><span class="WHIT">												</span><span class="NAME">sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>6339</span> </span><span class="WHIT">												</span><span class="NAME">targetEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6340</span> </span><span class="WHIT">												</span><span class="NAME">connection</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="WHIT">
<span class='line'>6341</span> </span><span class="WHIT">											</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6342</span> </span><span class="WHIT">										</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6343</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>6344</span> </span><span class="WHIT">										</span><span class="COMM">// finalise will inform the anchor manager and also add to</span><span class="WHIT">
<span class='line'>6345</span> </span><span class="WHIT">										</span><span class="COMM">// connectionsByScope if necessary.</span><span class="WHIT">
<span class='line'>6346</span> </span><span class="WHIT">										</span><span class="NAME">_finaliseConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6347</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6348</span> </span><span class="WHIT">									</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6349</span> </span><span class="WHIT">										</span><span class="COMM">// otherwise just put it back on the endpoint it was on before the drag.</span><span class="WHIT">
<span class='line'>6350</span> </span><span class="WHIT">										</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.suspendedEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">									</span><span class="WHIT">
<span class='line'>6351</span> </span><span class="WHIT">											</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6352</span> </span><span class="WHIT">											</span><span class="NAME">jpc.setHover</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6353</span> </span><span class="WHIT">											</span><span class="NAME">jpc._forceDetach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6354</span> </span><span class="WHIT">											</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6355</span> </span><span class="WHIT">												</span><span class="NAME">jpc.source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6356</span> </span><span class="WHIT">												</span><span class="NAME">jpc.sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6357</span> </span><span class="WHIT">											</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6358</span> </span><span class="WHIT">												</span><span class="NAME">jpc.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6359</span> </span><span class="WHIT">												</span><span class="NAME">jpc.targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.elementId</span><span class="PUNC">;</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6360</span> </span><span class="WHIT">											</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6361</span> </span><span class="WHIT">											</span><span class="NAME">jpc.suspendedEndpoint.addConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6362</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>6363</span> </span><span class="WHIT">											</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6364</span> </span><span class="WHIT">											</span><span class="NAME">jpc.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6365</span> </span><span class="WHIT">											</span><span class="NAME">_currentInstance.repaint</span><span class="PUNC">(</span><span class="NAME">jpc.source.elementId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6366</span> </span><span class="WHIT">											</span><span class="NAME">jpc._forceDetach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6367</span> </span><span class="WHIT">										</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6368</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6369</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>6370</span> </span><span class="WHIT">									</span><span class="NAME">jpc.floatingAnchorIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6371</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6372</span> </span><span class="WHIT">								</span><span class="NAME">_currentInstance.currentlyDragging</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6373</span> </span><span class="WHIT">								</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">floatingConnections</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6374</span> </span><span class="WHIT">								</span><span class="NAME">jpc.suspendedEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6375</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6376</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6377</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>6378</span> </span><span class="WHIT">					</span><span class="NAME">dropOptions</span><span class="PUNC">[</span><span class="NAME">dropEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">dropOptions</span><span class="PUNC">[</span><span class="NAME">dropEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">drop</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6379</span> </span><span class="WHIT">					</span><span class="NAME">dropOptions</span><span class="PUNC">[</span><span class="NAME">overEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">dropOptions</span><span class="PUNC">[</span><span class="NAME">overEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>6380</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">draggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getDragObject</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6381</span> </span><span class="WHIT">							</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"dragId"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6382</span> </span><span class="WHIT">							</span><span class="NAME">_jpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">floatingConnections</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6383</span> </span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>6384</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_jpc</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>6385</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_jpc.floatingAnchorIndex</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_jpc.floatingAnchorIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6386</span> </span><span class="WHIT">							</span><span class="COMM">// here we should fire the 'over' event if we are a target and this is a new connection,</span><span class="WHIT">
<span class='line'>6387</span> </span><span class="WHIT">							</span><span class="COMM">// or we are the same as the floating endpoint.								</span><span class="WHIT">
<span class='line'>6388</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_cont</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.isTarget</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_jpc.floatingAnchorIndex</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_jpc.suspendedEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">self.referenceEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">self.referenceEndpoint.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">_jpc.suspendedEndpoint.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6389</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_cont</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6390</span> </span><span class="WHIT">								</span><span class="NAME">_jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor.over</span><span class="PUNC">(</span><span class="NAME">self.anchor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6391</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>6392</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>6393</span> </span><span class="WHIT">					</span><span class="NAME">dropOptions</span><span class="PUNC">[</span><span class="NAME">outEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">dropOptions</span><span class="PUNC">[</span><span class="NAME">outEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>6394</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">draggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getDragObject</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6395</span> </span><span class="WHIT">							</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"dragId"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6396</span> </span><span class="WHIT">							</span><span class="NAME">_jpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">floatingConnections</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6397</span> </span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>6398</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_jpc</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6399</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_jpc.floatingAnchorIndex</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_jpc.floatingAnchorIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6400</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_cont</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.isTarget</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_jpc.floatingAnchorIndex</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_jpc.suspendedEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">self.referenceEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">self.referenceEndpoint.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">_jpc.suspendedEndpoint.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6401</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_cont</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6402</span> </span><span class="WHIT">								</span><span class="NAME">_jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor.out</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6403</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6404</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6405</span> </span><span class="WHIT">					</span><span class="NAME">jsPlumb.CurrentLibrary.initDroppable</span><span class="PUNC">(</span><span class="NAME">canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropOptions</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isTransient</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6406</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6407</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6408</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>6409</span> </span><span class="WHIT">			</span><span class="COMM">// initialise the endpoint's canvas as a drop target.  this will be ignored if the endpoint is not a target or drag is not supported.</span><span class="WHIT">
<span class='line'>6410</span> </span><span class="WHIT">			</span><span class="NAME">_initDropTarget</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">params._transient</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.anchor.isFloating</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6411</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>6412</span> </span><span class="WHIT">			 </span><span class="COMM">// finally, set type if it was provided</span><span class="WHIT">
<span class='line'>6413</span> </span><span class="WHIT">			 </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.type</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6414</span> </span><span class="WHIT">				</span><span class="NAME">self.addType</span><span class="PUNC">(</span><span class="NAME">params.type</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6415</span> 
<span class='line'>6416</span> </span><span class="COMM">// ***************************** PLACEHOLDERS FOR NATURAL DOCS *************************************************</span><span class="WHIT">
<span class='line'>6417</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>6418</span> 			 * Function: bind
<span class='line'>6419</span> 			 * Bind to an event on the Endpoint.  
<span class='line'>6420</span> 			 * 
<span class='line'>6421</span> 			 * Parameters:
<span class='line'>6422</span> 			 * 	event - the event to bind.  Available events on an Endpoint are:
<span class='line'>6423</span> 			 *         - *click*						:	notification that a Endpoint was clicked.  
<span class='line'>6424</span> 			 *         - *dblclick*						:	notification that a Endpoint was double clicked.
<span class='line'>6425</span> 			 *         - *mouseenter*					:	notification that the mouse is over a Endpoint. 
<span class='line'>6426</span> 			 *         - *mouseexit*					:	notification that the mouse exited a Endpoint.
<span class='line'>6427</span> 			 * 		   - *contextmenu*                  :   notification that the user right-clicked on the Endpoint.
<span class='line'>6428</span> 			 *         
<span class='line'>6429</span> 			 *  callback - function to callback. This function will be passed the Endpoint that caused the event, and also the original event.    
<span class='line'>6430</span> 			 */</span><span class="WHIT">
<span class='line'>6431</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>6432</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>6433</span> 		     * Function: setPaintStyle
<span class='line'>6434</span> 		     * Sets the Endpoint's paint style and then repaints the Endpoint.
<span class='line'>6435</span> 		     * 
<span class='line'>6436</span> 		     * Parameters:
<span class='line'>6437</span> 		     * 	style - Style to use.
<span class='line'>6438</span> 		     */</span><span class="WHIT">
<span class='line'>6439</span> 
<span class='line'>6440</span> </span><span class="WHIT">		     </span><span class="COMM">/*
<span class='line'>6441</span> 		     * Function: getPaintStyle
<span class='line'>6442</span> 		     * Gets the Endpoint's paint style. This is not necessarily the paint style in use at the time;
<span class='line'>6443</span> 		     * this is the paint style for the Endpoint when the mouse it not hovering over it.
<span class='line'>6444</span> 		     */</span><span class="WHIT">
<span class='line'>6445</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>6446</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>6447</span> 		     * Function: setHoverPaintStyle
<span class='line'>6448</span> 		     * Sets the paint style to use when the mouse is hovering over the Endpoint. This is null by default.
<span class='line'>6449</span> 		     * The hover paint style is applied as extensions to the paintStyle; it does not entirely replace
<span class='line'>6450</span> 		     * it.  This is because people will most likely want to change just one thing when hovering, say the
<span class='line'>6451</span> 		     * color for example, but leave the rest of the appearance the same.
<span class='line'>6452</span> 		     * 
<span class='line'>6453</span> 		     * Parameters:
<span class='line'>6454</span> 		     * 	style - Style to use when the mouse is hovering.
<span class='line'>6455</span> 		     *  doNotRepaint - if true, the Endpoint will not be repainted.  useful when setting things up initially.
<span class='line'>6456</span> 		     */</span><span class="WHIT">
<span class='line'>6457</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>6458</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>6459</span> 		     * Function: setHover
<span class='line'>6460</span> 		     * Sets/unsets the hover state of this Endpoint.
<span class='line'>6461</span> 		     * 
<span class='line'>6462</span> 		     * Parameters:
<span class='line'>6463</span> 		     * 	hover - hover state boolean
<span class='line'>6464</span> 		     * 	ignoreAttachedElements - if true, does not notify any attached elements of the change in hover state.  used mostly to avoid infinite loops.
<span class='line'>6465</span> 		     */</span><span class="WHIT">
<span class='line'>6466</span> 
<span class='line'>6467</span> </span><span class="WHIT">		     </span><span class="COMM">/*
<span class='line'>6468</span> 		     * Function: getParameter
<span class='line'>6469</span> 		     * Gets the named parameter; returns null if no parameter with that name is set. Parameters may have been set on the Endpoint in the 'addEndpoint' call, or they may have been set with the setParameter function.
<span class='line'>6470</span> 		     *
<span class='line'>6471</span> 		     * Parameters:
<span class='line'>6472</span> 		     *   key - Parameter name.
<span class='line'>6473</span> 		     */</span><span class="WHIT">
<span class='line'>6474</span> 
<span class='line'>6475</span> </span><span class="WHIT">		     </span><span class="COMM">/*
<span class='line'>6476</span> 		     * Function: setParameter
<span class='line'>6477</span> 		     * Sets the named parameter to the given value.
<span class='line'>6478</span> 		     *
<span class='line'>6479</span> 		     * Parameters:
<span class='line'>6480</span> 		     *   key - Parameter name.
<span class='line'>6481</span> 		     *   value - Parameter value.
<span class='line'>6482</span> 		     */</span><span class="WHIT">
<span class='line'>6483</span> </span><span class="WHIT">			 </span><span class="WHIT">
<span class='line'>6484</span> </span><span class="WHIT">			 </span><span class="COMM">/*
<span class='line'>6485</span> 			 * Property: canvas
<span class='line'>6486</span> 			 * The Endpoint's drawing area.
<span class='line'>6487</span> 			 */</span><span class="WHIT">
<span class='line'>6488</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>6489</span> 			 * Property: connections
<span class='line'>6490</span> 			 * List of Connections this Endpoint is attached to.
<span class='line'>6491</span> 			 */</span><span class="WHIT">
<span class='line'>6492</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>6493</span> 			 * Property: scope
<span class='line'>6494</span> 			 * Scope descriptor for this Endpoint.
<span class='line'>6495</span> 			 */</span><span class="WHIT">
<span class='line'>6496</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>6497</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>6498</span> 			 * Property: overlays
<span class='line'>6499</span> 			 * List of Overlays for this Endpoint.
<span class='line'>6500</span> 			 */</span><span class="WHIT">
<span class='line'>6501</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>6502</span> 			 * Function: addOverlay
<span class='line'>6503</span> 			 * Adds an Overlay to the Endpoint.
<span class='line'>6504</span> 			 * 
<span class='line'>6505</span> 			 * Parameters:
<span class='line'>6506</span> 			 * 	overlay - Overlay to add.
<span class='line'>6507</span> 			 */</span><span class="WHIT">
<span class='line'>6508</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>6509</span> 			 * Function: getOverlay
<span class='line'>6510</span> 			 * Gets an overlay, by ID. Note: by ID.  You would pass an 'id' parameter
<span class='line'>6511</span> 			 * in to the Overlay's constructor arguments, and then use that to retrieve
<span class='line'>6512</span> 			 * it via this method.
<span class='line'>6513</span> 			 */</span><span class="WHIT">
<span class='line'>6514</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>6515</span> 			* Function: getOverlays
<span class='line'>6516</span> 			* Gets all the overlays for this component.
<span class='line'>6517</span> 			*/</span><span class="WHIT">
<span class='line'>6518</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>6519</span> 			 * Function: hideOverlay
<span class='line'>6520</span> 			 * Hides the overlay specified by the given id.
<span class='line'>6521</span> 			 */</span><span class="WHIT">
<span class='line'>6522</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>6523</span> 			 * Function: hideOverlays
<span class='line'>6524</span> 			 * Hides all Overlays
<span class='line'>6525</span> 			 */</span><span class="WHIT">
<span class='line'>6526</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>6527</span> 			 * Function: showOverlay
<span class='line'>6528</span> 			 * Shows the overlay specified by the given id.
<span class='line'>6529</span> 			 */</span><span class="WHIT">
<span class='line'>6530</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>6531</span> 			 * Function: showOverlays
<span class='line'>6532</span> 			 * Shows all Overlays 
<span class='line'>6533</span> 			 */</span><span class="WHIT">
<span class='line'>6534</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>6535</span> 			 * Function: removeAllOverlays
<span class='line'>6536</span> 			 * Removes all overlays from the Endpoint, and then repaints.
<span class='line'>6537</span> 			 */</span><span class="WHIT">
<span class='line'>6538</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>6539</span> 			 * Function: removeOverlay
<span class='line'>6540</span> 			 * Removes an overlay by ID.  Note: by ID.  this is a string you set in the overlay spec.
<span class='line'>6541</span> 			 * Parameters:
<span class='line'>6542</span> 			 * overlayId - id of the overlay to remove.
<span class='line'>6543</span> 			 */</span><span class="WHIT">
<span class='line'>6544</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>6545</span> 			 * Function: removeOverlays
<span class='line'>6546</span> 			 * Removes a set of overlays by ID.  Note: by ID.  this is a string you set in the overlay spec.
<span class='line'>6547</span> 			 * Parameters:
<span class='line'>6548</span> 			 * overlayIds - this function takes an arbitrary number of arguments, each of which is a single overlay id.
<span class='line'>6549</span> 			 */</span><span class="WHIT">
<span class='line'>6550</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>6551</span> 			 * Function: setLabel
<span class='line'>6552</span> 			 * Sets the Endpoint's label.  
<span class='line'>6553</span> 			 * 
<span class='line'>6554</span> 			 * Parameters:
<span class='line'>6555</span> 			 * 	l	- label to set. May be a String, a Function that returns a String, or a params object containing { "label", "labelStyle", "location", "cssClass" }.  Note that this uses innerHTML on the label div, so keep
<span class='line'>6556</span>          * that in mind if you need escaped HTML.
<span class='line'>6557</span> 			 */</span><span class="WHIT">
<span class='line'>6558</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>6559</span> 				Function: getLabel
<span class='line'>6560</span> 				Returns the label text for this Endpoint (or a function if you are labelling with a function).
<span class='line'>6561</span> 				This does not return the overlay itself; this is a convenience method which is a pair with
<span class='line'>6562</span> 				setLabel; together they allow you to add and access a Label Overlay without having to create the
<span class='line'>6563</span> 				Overlay object itself.  For access to the underlying label overlay that jsPlumb has created,
<span class='line'>6564</span> 				use getLabelOverlay.
<span class='line'>6565</span> 			*/</span><span class="WHIT">
<span class='line'>6566</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>6567</span> 				Function: getLabelOverlay
<span class='line'>6568</span> 				Returns the underlying internal label overlay, which will exist if you specified a label on
<span class='line'>6569</span> 				an addEndpoint call, or have called setLabel at any stage.   
<span class='line'>6570</span> 			*/</span><span class="WHIT">
<span class='line'>6571</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>6572</span> </span><span class="COMM">// ***************************** END OF PLACEHOLDERS FOR NATURAL DOCS *************************************************</span><span class="WHIT">
<span class='line'>6573</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>6574</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>6575</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6576</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>6577</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>6578</span> 
<span class='line'>6579</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jsPlumb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">jsPlumbInstance</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6580</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">window</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">window.jsPlumb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6581</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.getInstance</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_defaults</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6582</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">jsPlumbInstance</span><span class="PUNC">(</span><span class="NAME">_defaults</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6583</span> </span><span class="WHIT">		</span><span class="NAME">j.init</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6584</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6585</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>6586</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>6587</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ox</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fnInit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6588</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6589</span> </span><span class="WHIT">			</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6590</span> </span><span class="WHIT">			</span><span class="COMM">//var a = jsPlumb.makeAnchor([ x, y, ox, oy, 0, 0 ], params.elementId, params.jsPlumbInstance);</span><span class="WHIT">
<span class='line'>6591</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.jsPlumbInstance.makeAnchor</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ox</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.jsPlumbInstance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6592</span> </span><span class="WHIT">			</span><span class="NAME">a.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6593</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fnInit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">fnInit</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6594</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6595</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6596</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6597</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>6598</span> 	 * Property: Anchors.TopCenter
<span class='line'>6599</span> 	 * An Anchor that is located at the top center of the element.
<span class='line'>6600</span> 	 */</span><span class="WHIT">
<span class='line'>6601</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"TopCenter"</span><span class="PUNC">]</span><span class="WHIT"> 		</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="PUNC">(</span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"TopCenter"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6602</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>6603</span> 	 * Property: Anchors.BottomCenter
<span class='line'>6604</span> 	 * An Anchor that is located at the bottom center of the element.
<span class='line'>6605</span> 	 */</span><span class="WHIT">
<span class='line'>6606</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"BottomCenter"</span><span class="PUNC">]</span><span class="WHIT"> 	</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="PUNC">(</span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"BottomCenter"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6607</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>6608</span> 	 * Property: Anchors.LeftMiddle
<span class='line'>6609</span> 	 * An Anchor that is located at the left middle of the element.
<span class='line'>6610</span> 	 */</span><span class="WHIT">
<span class='line'>6611</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"LeftMiddle"</span><span class="PUNC">]</span><span class="WHIT"> 		</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"LeftMiddle"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6612</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>6613</span> 	 * Property: Anchors.RightMiddle
<span class='line'>6614</span> 	 * An Anchor that is located at the right middle of the element.
<span class='line'>6615</span> 	 */</span><span class="WHIT">
<span class='line'>6616</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"RightMiddle"</span><span class="PUNC">]</span><span class="WHIT"> 		</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"RightMiddle"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6617</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>6618</span> 	 * Property: Anchors.Center
<span class='line'>6619</span> 	 * An Anchor that is located at the center of the element.
<span class='line'>6620</span> 	 */</span><span class="WHIT">
<span class='line'>6621</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"Center"</span><span class="PUNC">]</span><span class="WHIT"> 			</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="PUNC">(</span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"Center"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6622</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>6623</span> 	 * Property: Anchors.TopRight
<span class='line'>6624</span> 	 * An Anchor that is located at the top right corner of the element.
<span class='line'>6625</span> 	 */</span><span class="WHIT">
<span class='line'>6626</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"TopRight"</span><span class="PUNC">]</span><span class="WHIT"> 		</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"TopRight"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6627</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>6628</span> 	 * Property: Anchors.BottomRight
<span class='line'>6629</span> 	 * An Anchor that is located at the bottom right corner of the element.
<span class='line'>6630</span> 	 */</span><span class="WHIT">
<span class='line'>6631</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"BottomRight"</span><span class="PUNC">]</span><span class="WHIT"> 		</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"BottomRight"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6632</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>6633</span> 	 * Property: Anchors.TopLeft
<span class='line'>6634</span> 	 * An Anchor that is located at the top left corner of the element.
<span class='line'>6635</span> 	 */</span><span class="WHIT">
<span class='line'>6636</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"TopLeft"</span><span class="PUNC">]</span><span class="WHIT"> 			</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"TopLeft"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6637</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>6638</span> 	 * Property: Anchors.BottomLeft
<span class='line'>6639</span> 	 * An Anchor that is located at the bototm left corner of the element.
<span class='line'>6640</span> 	 */</span><span class="WHIT">
<span class='line'>6641</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"BottomLeft"</span><span class="PUNC">]</span><span class="WHIT"> 		</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"BottomLeft"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6642</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>6643</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Defaults.DynamicAnchors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6644</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">params.jsPlumbInstance.makeAnchors</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">"TopCenter"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"RightMiddle"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"BottomCenter"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"LeftMiddle"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.jsPlumbInstance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6645</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6646</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>6647</span> 	 * Property: Anchors.AutoDefault
<span class='line'>6648</span> 	 * Default DynamicAnchors - chooses from TopCenter, RightMiddle, BottomCenter, LeftMiddle.
<span class='line'>6649</span> 	 */</span><span class="WHIT">
<span class='line'>6650</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"AutoDefault"</span><span class="PUNC">]</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>6651</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.jsPlumbInstance.makeDynamicAnchor</span><span class="PUNC">(</span><span class="NAME">jsPlumb.Defaults.DynamicAnchors</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6652</span> </span><span class="WHIT">		</span><span class="NAME">a.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"AutoDefault"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6653</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6654</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6655</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>6656</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>6657</span> 	 * Property: Anchors.Assign
<span class='line'>6658</span> 	 * An Anchor whose location is assigned at connection time, through an AnchorPositionFinder. Used in conjunction
<span class='line'>6659</span> 	 * with the 'makeTarget' function. jsPlumb has two of these - 'Fixed' and 'Grid', and you can also write your own.
<span class='line'>6660</span> 	 */</span><span class="WHIT">
<span class='line'>6661</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"Assign"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="STRN">"Assign"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6662</span> </span><span class="WHIT">		</span><span class="COMM">// find what to use as the "position finder". the user may have supplied a String which represents</span><span class="WHIT">
<span class='line'>6663</span> </span><span class="WHIT">		</span><span class="COMM">// the id of a position finder in jsPlumb.AnchorPositionFinders, or the user may have supplied the</span><span class="WHIT">
<span class='line'>6664</span> </span><span class="WHIT">		</span><span class="COMM">// position finder as a function.  we find out what to use and then set it on the anchor.</span><span class="WHIT">
<span class='line'>6665</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.position</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">"Fixed"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6666</span> </span><span class="WHIT">		</span><span class="NAME">anchor.positionFinder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pf.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">String</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">params.jsPlumbInstance.AnchorPositionFinders</span><span class="PUNC">[</span><span class="NAME">pf</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">pf</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6667</span> </span><span class="WHIT">		</span><span class="COMM">// always set the constructor params; the position finder might need them later (the Grid one does,</span><span class="WHIT">
<span class='line'>6668</span> </span><span class="WHIT">		</span><span class="COMM">// for example)</span><span class="WHIT">
<span class='line'>6669</span> </span><span class="WHIT">		</span><span class="NAME">anchor.constructorParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6670</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6671</span> 
<span class='line'>6672</span> </span><span class="WHIT">	</span><span class="COMM">// Continuous anchor is just curried through to the 'get' method of the continuous anchor</span><span class="WHIT">
<span class='line'>6673</span> </span><span class="WHIT">	</span><span class="COMM">// factory.</span><span class="WHIT">
<span class='line'>6674</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>6675</span> 	 * Property: Anchors.Continuous
<span class='line'>6676</span> 	 * An Anchor that is tracks the other element in the connection, choosing the closest face.
<span class='line'>6677</span> 	 */</span><span class="WHIT">
<span class='line'>6678</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"Continuous"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6679</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">params.jsPlumbInstance.continuousAnchorFactory.get</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6680</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6681</span> 
<span class='line'>6682</span> </span><span class="WHIT">    </span><span class="COMM">// these are the default anchor positions finders, which are used by the makeTarget function.  supply</span><span class="WHIT">
<span class='line'>6683</span> </span><span class="WHIT">    </span><span class="COMM">// a position finder argument to that function allows you to specify where the resulting anchor will</span><span class="WHIT">
<span class='line'>6684</span> </span><span class="WHIT">    </span><span class="COMM">// be located</span><span class="WHIT">
<span class='line'>6685</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.AnchorPositionFinders</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6686</span> </span><span class="WHIT">		</span><span class="STRN">"Fixed"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">es</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6687</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dp.left</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">ep.left</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">es</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dp.top</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">ep.top</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">es</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>6688</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6689</span> </span><span class="WHIT">		</span><span class="STRN">"Grid"</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">es</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6690</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dp.left</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">ep.left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dp.top</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">ep.top</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6691</span> </span><span class="WHIT">				</span><span class="NAME">gx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">es</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.grid</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">gy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">es</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.grid</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6692</span> </span><span class="WHIT">				</span><span class="NAME">mx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">gx</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">my</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">gy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6693</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">mx</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">gx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gx</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">es</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">my</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">gy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gy</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">es</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6694</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6695</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6696</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>6697</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>6698</span> 	 * Property: Anchors.Perimeter
<span class='line'>6699</span> 	 * An Anchor that tracks the perimeter of some shape, approximating it with a given number of dynamically
<span class='line'>6700</span> 	 * positioned locations.
<span class='line'>6701</span> 	 *
<span class='line'>6702</span> 	 * Parameters:
<span class='line'>6703</span> 	 *
<span class='line'>6704</span> 	 * anchorCount  -   optional number of anchors to use to approximate the perimeter. default is 60.
<span class='line'>6705</span> 	 * shape        -   required. the name of the shape. valid values are 'rectangle', 'square', 'ellipse', 'circle', 'triangle' and 'diamond'
<span class='line'>6706</span> 	 * rotation     -   optional rotation, in degrees, to apply. 
<span class='line'>6707</span> 	 */</span><span class="WHIT">
<span class='line'>6708</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"Perimeter"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6709</span> </span><span class="WHIT">		</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6710</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">anchorCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.anchorCount</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">60</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6711</span> </span><span class="WHIT">			</span><span class="NAME">shape</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.shape</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6712</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>6713</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">shape</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">"no shape supplied to Perimeter Anchor type"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>6714</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>6715</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_circle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6716</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">step</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">anchorCount</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">current</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6717</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">anchorCount</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6718</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">current</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6719</span> </span><span class="WHIT">                        </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">current</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">                                </span><span class="WHIT">
<span class='line'>6720</span> </span><span class="WHIT">                    </span><span class="NAME">a.push</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6721</span> </span><span class="WHIT">                    </span><span class="NAME">current</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">step</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6722</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6723</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>6724</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6725</span> </span><span class="WHIT">            </span><span class="NAME">_path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">segments</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6726</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">anchorsPerFace</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchorCount</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">segments.length</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6727</span> </span><span class="WHIT">                    </span><span class="NAME">_computeFace</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fractionalLength</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6728</span> </span><span class="WHIT">                        </span><span class="NAME">anchorsPerFace</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchorCount</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">fractionalLength</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6729</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">anchorsPerFace</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">anchorsPerFace</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6730</span> </span><span class="WHIT">                        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">anchorsPerFace</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6731</span> </span><span class="WHIT">                            </span><span class="NAME">a.push</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>6732</span> </span><span class="WHIT">                                </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6733</span> </span><span class="WHIT">                                </span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6734</span> </span><span class="WHIT">                                </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6735</span> </span><span class="WHIT">                                </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'>6736</span> </span><span class="WHIT">                            </span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6737</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6738</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6739</span> </span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>6740</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">segments.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6741</span> </span><span class="WHIT">                    </span><span class="NAME">_computeFace.apply</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">segments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6742</span> </span><span class="WHIT">														</span><span class="WHIT">
<span class='line'>6743</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>6744</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6745</span> </span><span class="WHIT">			</span><span class="NAME">_shape</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">faces</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">												</span><span class="WHIT">
<span class='line'>6746</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6747</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">faces.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6748</span> </span><span class="WHIT">                    </span><span class="NAME">s.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">faces</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">faces</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">faces</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">faces</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">faces.length</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6749</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6750</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_path</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6751</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6752</span> </span><span class="WHIT">			</span><span class="NAME">_rectangle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6753</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_shape</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>6754</span> </span><span class="WHIT">					</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>6755</span> </span><span class="WHIT">				</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>6756</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6757</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>6758</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_shapes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6759</span> </span><span class="WHIT">			</span><span class="STRN">"circle"</span><span class="PUNC">:</span><span class="NAME">_circle</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6760</span> </span><span class="WHIT">			</span><span class="STRN">"ellipse"</span><span class="PUNC">:</span><span class="NAME">_circle</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6761</span> </span><span class="WHIT">			</span><span class="STRN">"diamond"</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6762</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_shape</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>6763</span> </span><span class="WHIT">						</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>6764</span> </span><span class="WHIT">				</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6765</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6766</span> </span><span class="WHIT">			</span><span class="STRN">"rectangle"</span><span class="PUNC">:</span><span class="NAME">_rectangle</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6767</span> </span><span class="WHIT">			</span><span class="STRN">"square"</span><span class="PUNC">:</span><span class="NAME">_rectangle</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6768</span> </span><span class="WHIT">			</span><span class="STRN">"triangle"</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6769</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_shape</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>6770</span> </span><span class="WHIT">						</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>6771</span> </span><span class="WHIT">				</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>6772</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6773</span> </span><span class="WHIT">			</span><span class="STRN">"path"</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6774</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6775</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6776</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">points.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6777</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">points</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">points</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6778</span> </span><span class="WHIT">                    </span><span class="NAME">tl</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6779</span> </span><span class="WHIT">					</span><span class="NAME">p.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">points</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>6780</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6781</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">p.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6782</span> </span><span class="WHIT">                    </span><span class="NAME">p</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">tl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6783</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6784</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_path</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6785</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6786</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6787</span> </span><span class="WHIT">        </span><span class="NAME">_rotate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">points</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">amountInDegrees</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6788</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">theta</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">amountInDegrees</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">180</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6789</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">points.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6790</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6791</span> </span><span class="WHIT">                    </span><span class="NAME">_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6792</span> </span><span class="WHIT">                    </span><span class="WHIT">
<span class='line'>6793</span> </span><span class="WHIT">                </span><span class="NAME">o.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>6794</span> </span><span class="WHIT">                    </span><span class="NUMB">0.5</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">_x</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">theta</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_y</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">theta</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6795</span> </span><span class="WHIT">                    </span><span class="NUMB">0.5</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">_x</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">theta</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_y</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">theta</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6796</span> </span><span class="WHIT">                    </span><span class="NAME">points</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6797</span> </span><span class="WHIT">                    </span><span class="NAME">points</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>6798</span> </span><span class="WHIT">                </span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6799</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6800</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6801</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6802</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>6803</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_shapes</span><span class="PUNC">[</span><span class="NAME">shape</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">"Shape ["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">shape</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"] is unknown by Perimeter Anchor type"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6804</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>6805</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">da</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_shapes</span><span class="PUNC">[</span><span class="NAME">shape</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6806</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.rotation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">da</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_rotate</span><span class="PUNC">(</span><span class="NAME">da</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.rotation</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6807</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.jsPlumbInstance.makeDynamicAnchor</span><span class="PUNC">(</span><span class="NAME">da</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6808</span> </span><span class="WHIT">		</span><span class="NAME">a.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Perimeter"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6809</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6810</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6811</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6812</span> </span><span class="COMM">/*
<span class='line'>6813</span>  * jsPlumb
<span class='line'>6814</span>  * 
<span class='line'>6815</span>  * Title:jsPlumb 1.3.15
<span class='line'>6816</span>  * 
<span class='line'>6817</span>  * Provides a way to visually connect elements on an HTML page, using either SVG, Canvas
<span class='line'>6818</span>  * elements, or VML.  
<span class='line'>6819</span>  * 
<span class='line'>6820</span>  * This file contains the default Connectors, Endpoint and Overlay definitions.
<span class='line'>6821</span>  *
<span class='line'>6822</span>  * Copyright (c) 2010 - 2012 Simon Porritt (http://jsplumb.org)
<span class='line'>6823</span>  * 
<span class='line'>6824</span>  * http://jsplumb.org
<span class='line'>6825</span>  * http://github.com/sporritt/jsplumb
<span class='line'>6826</span>  * http://code.google.com/p/jsplumb
<span class='line'>6827</span>  * 
<span class='line'>6828</span>  * Dual licensed under the MIT and GPL2 licenses.
<span class='line'>6829</span>  */</span><span class="WHIT">
<span class='line'>6830</span> 
<span class='line'>6831</span> </span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>6832</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>6833</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>6834</span> 	 * 
<span class='line'>6835</span> 	 * Helper class to consume unused mouse events by components that are DOM elements and
<span class='line'>6836</span> 	 * are used by all of the different rendering modes.
<span class='line'>6837</span> 	 * 
<span class='line'>6838</span> 	 */</span><span class="WHIT">
<span class='line'>6839</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.DOMElementComponent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6840</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.jsPlumbUIComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6841</span> </span><span class="WHIT">		</span><span class="COMM">// when render mode is canvas, these functions may be called by the canvas mouse handler.  </span><span class="WHIT">
<span class='line'>6842</span> </span><span class="WHIT">		</span><span class="COMM">// this component is safe to pipe this stuff to /dev/null.</span><span class="WHIT">
<span class='line'>6843</span> </span><span class="WHIT">		</span><span class="NAME">this.mousemove</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>6844</span> </span><span class="WHIT">		</span><span class="NAME">this.dblclick</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>6845</span> </span><span class="WHIT">		</span><span class="NAME">this.click</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>6846</span> </span><span class="WHIT">		</span><span class="NAME">this.mousedown</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>6847</span> </span><span class="WHIT">		</span><span class="NAME">this.mouseup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>6848</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6849</span> </span><span class="WHIT">	                                   </span><span class="WHIT">
<span class='line'>6850</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6851</span>      * Class: Connectors.Straight
<span class='line'>6852</span>      * The Straight connector draws a simple straight line between the two anchor points.  It does not have any constructor parameters.
<span class='line'>6853</span>      */</span><span class="WHIT">
<span class='line'>6854</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Connectors.Straight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6855</span> </span><span class="WHIT">    	</span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Straight"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6856</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6857</span> </span><span class="WHIT">		</span><span class="NAME">currentPoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6858</span> </span><span class="WHIT">		</span><span class="NAME">_m</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_m2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_dx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_dy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_theta</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_theta2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_sy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_ty</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_segment</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6859</span> 
<span class='line'>6860</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>6861</span>          * Computes the new size and position of the canvas.         
<span class='line'>6862</span>          */</span><span class="WHIT">
<span class='line'>6863</span> </span><span class="WHIT">        </span><span class="NAME">this.compute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">minWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6864</span> </span><span class="WHIT">        	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6865</span> </span><span class="WHIT">            </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6866</span> </span><span class="WHIT">            </span><span class="COMM">// these are padding to ensure the whole connector line appears</span><span class="WHIT">
<span class='line'>6867</span> </span><span class="WHIT">            </span><span class="NAME">xo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.45</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">yo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.45</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6868</span> </span><span class="WHIT">            </span><span class="COMM">// these are padding to ensure the whole connector line appears</span><span class="WHIT">
<span class='line'>6869</span> </span><span class="WHIT">            </span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.9</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="PUNC">=</span><span class="NUMB">1.9</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6870</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>6871</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">xo</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6872</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">yo</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6873</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>6874</span> </span><span class="WHIT">            </span><span class="COMM">// minimum size is 2 * line Width if minWidth was not given.</span><span class="WHIT">
<span class='line'>6875</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">calculatedMinWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">minWidth</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6876</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>6877</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">calculatedMinWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>6878</span> </span><span class="WHIT">        		</span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculatedMinWidth</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>6879</span> </span><span class="WHIT">        		</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT">  </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">calculatedMinWidth</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6880</span> </span><span class="WHIT">        		</span><span class="NAME">xo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6881</span> </span><span class="WHIT">        	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6882</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">calculatedMinWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">         </span><span class="WHIT">
<span class='line'>6883</span> </span><span class="WHIT">        		</span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculatedMinWidth</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>6884</span> </span><span class="WHIT">        		</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT">  </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">calculatedMinWidth</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6885</span> </span><span class="WHIT">        		</span><span class="NAME">yo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6886</span> </span><span class="WHIT">        	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6887</span> </span><span class="WHIT">                            </span><span class="WHIT">
<span class='line'>6888</span> </span><span class="WHIT">            </span><span class="NAME">_sx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT">  </span><span class="NAME">xo</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">-</span><span class="NAME">xo</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6889</span> </span><span class="WHIT">            </span><span class="NAME">_sy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">yo</span><span class="PUNC">:</span><span class="NAME">h</span><span class="PUNC">-</span><span class="NAME">yo</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6890</span> </span><span class="WHIT">            </span><span class="NAME">_tx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">-</span><span class="NAME">xo</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">xo</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6891</span> </span><span class="WHIT">            </span><span class="NAME">_ty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">-</span><span class="NAME">yo</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">yo</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6892</span> </span><span class="WHIT">            </span><span class="NAME">currentPoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_sy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_ty</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">                        </span><span class="WHIT">
<span class='line'>6893</span> </span><span class="WHIT">            </span><span class="NAME">_dx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_tx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">_sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_dy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_ty</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">_sy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6894</span> </span><span class="WHIT">			</span><span class="COMM">//_m = _dy / _dx, _m2 = -1 / _m;</span><span class="WHIT">
<span class='line'>6895</span> </span><span class="WHIT">            </span><span class="NAME">_m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.gradient</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">_sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">_sy</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">_tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">_ty</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_m2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">_m</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6896</span> </span><span class="WHIT">			</span><span class="NAME">_b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">_m</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">_sx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">_sy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6897</span> </span><span class="WHIT">			</span><span class="NAME">_theta</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.atan</span><span class="PUNC">(</span><span class="NAME">_m</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">_theta2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.atan</span><span class="PUNC">(</span><span class="NAME">_m2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6898</span> </span><span class="WHIT">            </span><span class="COMM">//_segment = jsPlumbUtil.segment({x:_sx, y:_sy}, {x:_tx, y:_ty});</span><span class="WHIT">
<span class='line'>6899</span> </span><span class="WHIT">            </span><span class="NAME">_length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">_dx</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">_dx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_dy</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">_dy</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6900</span> </span><span class="WHIT">                             </span><span class="WHIT">
<span class='line'>6901</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">currentPoints</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6902</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6903</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>6904</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>6905</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>6906</span>          * returns the point on the connector's path that is 'location' along the length of the path, where 'location' is a decimal from
<span class='line'>6907</span>          * 0 to 1 inclusive. for the straight line connector this is simple maths.  for Bezier, not so much.
<span class='line'>6908</span>          */</span><span class="WHIT">
<span class='line'>6909</span> </span><span class="WHIT">        </span><span class="NAME">this.pointOnPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6910</span> </span><span class="WHIT">        	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6911</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">_sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">_sy</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6912</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6913</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">_tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">_ty</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6914</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6915</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">_length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6916</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.pointOnLine</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">_sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">_sy</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">_tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">_ty</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6917</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6918</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6919</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>6920</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>6921</span>          * returns the gradient of the connector at the given point - which for us is constant.
<span class='line'>6922</span>          */</span><span class="WHIT">
<span class='line'>6923</span> </span><span class="WHIT">        </span><span class="NAME">this.gradientAtPoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">location</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6924</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_m</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6925</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6926</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>6927</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>6928</span>          * returns the point on the connector's path that is 'distance' along the length of the path from 'location', where 
<span class='line'>6929</span>          * 'location' is a decimal from 0 to 1 inclusive, and 'distance' is a number of pixels.
<span class='line'>6930</span>          * this hands off to jsPlumbUtil to do the maths, supplying two points and the distance.
<span class='line'>6931</span>          */</span><span class="WHIT">
<span class='line'>6932</span> </span><span class="WHIT">        </span><span class="NAME">this.pointAlongPathFrom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">distance</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>6933</span> </span><span class="WHIT">        	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.pointOnPath</span><span class="PUNC">(</span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6934</span> </span><span class="WHIT">                </span><span class="NAME">farAwayPoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6935</span> </span><span class="WHIT">                    </span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">_sx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">_tx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">_sx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6936</span> </span><span class="WHIT">                    </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">_sy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">_sy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">_ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>6937</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">_tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">_ty</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6938</span> 
<span class='line'>6939</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.pointOnLine</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">farAwayPoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">distance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6940</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6941</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6942</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>6943</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>6944</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6945</span>      * Class:Connectors.Bezier
<span class='line'>6946</span>      * This Connector draws a Bezier curve with two control points.  You can provide a 'curviness' value which gets applied to jsPlumb's
<span class='line'>6947</span>      * internal voodoo machine and ends up generating locations for the two control points.  See the constructor documentation below.
<span class='line'>6948</span>      */</span><span class="WHIT">
<span class='line'>6949</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>6950</span>      * Function:Constructor
<span class='line'>6951</span>      * 
<span class='line'>6952</span>      * Parameters:
<span class='line'>6953</span>      * 	curviness - How 'curvy' you want the curve to be! This is a directive for the placement of control points, not endpoints of the curve, so your curve does not 
<span class='line'>6954</span>      * actually touch the given point, but it has the tendency to lean towards it.  The larger this value, the greater the curve is pulled from a straight line.
<span class='line'>6955</span>      * Optional; defaults to 150.
<span class='line'>6956</span>      * stub - optional value for a distance to travel from the connector's endpoint before beginning the Bezier curve. defaults to 0.
<span class='line'>6957</span>      * 
<span class='line'>6958</span>      */</span><span class="WHIT">
<span class='line'>6959</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Connectors.Bezier</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6960</span> </span><span class="WHIT">    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6961</span> </span><span class="WHIT">    	</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6962</span> </span><span class="WHIT">    	</span><span class="NAME">this.majorAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.curviness</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">150</span><span class="PUNC">;</span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>6963</span> </span><span class="WHIT">        </span><span class="NAME">this.minorAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6964</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentPoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6965</span> </span><span class="WHIT">        </span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Bezier"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6966</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>6967</span> </span><span class="WHIT">        </span><span class="NAME">this._findControlPoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceAnchorPosition</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetAnchorPosition</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetAnchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6968</span> </span><span class="WHIT">        	</span><span class="COMM">// determine if the two anchors are perpendicular to each other in their orientation.  we swap the control </span><span class="WHIT">
<span class='line'>6969</span> </span><span class="WHIT">        	</span><span class="COMM">// points around if so (code could be tightened up)</span><span class="WHIT">
<span class='line'>6970</span> </span><span class="WHIT">        	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">soo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourceAnchor.getOrientation</span><span class="PUNC">(</span><span class="NAME">sourceEndpoint</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>6971</span> </span><span class="WHIT">        		</span><span class="NAME">too</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">targetAnchor.getOrientation</span><span class="PUNC">(</span><span class="NAME">targetEndpoint</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6972</span> </span><span class="WHIT">        		</span><span class="NAME">perpendicular</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">soo</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">too</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">soo</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">too</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>6973</span> </span><span class="WHIT">            	</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>6974</span> </span><span class="WHIT">            	</span><span class="NAME">ma</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.majorAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mi</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.minorAnchor</span><span class="PUNC">;</span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>6975</span> </span><span class="WHIT">            	</span><span class="WHIT">
<span class='line'>6976</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">perpendicular</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6977</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">soo</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// X</span><span class="WHIT">
<span class='line'>6978</span> </span><span class="WHIT">                    </span><span class="NAME">p.push</span><span class="PUNC">(</span><span class="NAME">sourceAnchorPosition</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">targetAnchorPosition</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">point</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">mi</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">point</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">mi</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6979</span> </span><span class="WHIT">                </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">p.push</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ma</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">soo</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6980</span> </span><span class="WHIT">                                 </span><span class="WHIT">
<span class='line'>6981</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">soo</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// Y</span><span class="WHIT">
<span class='line'>6982</span> </span><span class="WHIT">                	</span><span class="NAME">p.push</span><span class="PUNC">(</span><span class="NAME">sourceAnchorPosition</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">targetAnchorPosition</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">point</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">mi</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">point</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">mi</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6983</span> </span><span class="WHIT">                </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">p.push</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ma</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">too</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6984</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6985</span> </span><span class="WHIT">             </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>6986</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">too</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// X</span><span class="WHIT">
<span class='line'>6987</span> </span><span class="WHIT">                	</span><span class="NAME">p.push</span><span class="PUNC">(</span><span class="NAME">targetAnchorPosition</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sourceAnchorPosition</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">point</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">mi</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">point</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">mi</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6988</span> </span><span class="WHIT">                </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">p.push</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ma</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">too</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6989</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>6990</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">too</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// Y</span><span class="WHIT">
<span class='line'>6991</span> </span><span class="WHIT">                	</span><span class="NAME">p.push</span><span class="PUNC">(</span><span class="NAME">targetAnchorPosition</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sourceAnchorPosition</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">point</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">mi</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">point</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">mi</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6992</span> </span><span class="WHIT">                </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">p.push</span><span class="PUNC">(</span><span class="NAME">point</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ma</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">soo</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6993</span> </span><span class="WHIT">             </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>6994</span> 
<span class='line'>6995</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">;</span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>6996</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>6997</span> 
<span class='line'>6998</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_CP</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_CP2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_ty</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_sy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_canvasX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_canvasY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_w</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_h</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_sStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_sStubY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_tStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_tStubY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>6999</span> 
<span class='line'>7000</span> </span><span class="WHIT">        </span><span class="NAME">this.compute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">minWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7001</span> </span><span class="WHIT">        	</span><span class="NAME">lineWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7002</span> </span><span class="WHIT">            </span><span class="NAME">_w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7003</span> </span><span class="WHIT">            </span><span class="NAME">_h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7004</span> </span><span class="WHIT">            </span><span class="NAME">_canvasX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">lineWidth</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7005</span> </span><span class="WHIT">            </span><span class="NAME">_canvasY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="PUNC">(</span><span class="NAME">lineWidth</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7006</span> </span><span class="WHIT">            </span><span class="NAME">_sx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_w</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lineWidth</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lineWidth</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7007</span> </span><span class="WHIT">            </span><span class="NAME">_sy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_h</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lineWidth</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lineWidth</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7008</span> </span><span class="WHIT">            </span><span class="NAME">_tx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lineWidth</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_w</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lineWidth</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7009</span> </span><span class="WHIT">            </span><span class="NAME">_ty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lineWidth</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_h</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lineWidth</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7010</span> </span><span class="WHIT">                        </span><span class="WHIT">
<span class='line'>7011</span> </span><span class="WHIT">            </span><span class="NAME">_CP</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self._findControlPoint</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">_sx</span><span class="PUNC">,</span><span class="NAME">_sy</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetAnchor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7012</span> </span><span class="WHIT">            </span><span class="NAME">_CP2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self._findControlPoint</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">_tx</span><span class="PUNC">,</span><span class="NAME">_ty</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceAnchor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>7013</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minx1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">_sx</span><span class="PUNC">,</span><span class="NAME">_tx</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">minx2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">_CP</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_CP2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">minx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">minx1</span><span class="PUNC">,</span><span class="NAME">minx2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7014</span> </span><span class="WHIT">            	</span><span class="NAME">maxx1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">_sx</span><span class="PUNC">,</span><span class="NAME">_tx</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxx2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">_CP</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_CP2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">maxx1</span><span class="PUNC">,</span><span class="NAME">maxx2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7015</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>7016</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">maxx</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">_w</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">maxx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7017</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">minx</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7018</span> </span><span class="WHIT">                </span><span class="NAME">_canvasX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">minx</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ox</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">minx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7019</span> </span><span class="WHIT">                </span><span class="NAME">_w</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ox</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">_CP</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ox</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">_sx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ox</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">_tx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">ox</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">_CP2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ox</span><span class="PUNC">;</span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>7020</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>7021</span> 
<span class='line'>7022</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">miny1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">_sy</span><span class="PUNC">,</span><span class="NAME">_ty</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">miny2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">_CP</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_CP2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">miny</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">miny1</span><span class="PUNC">,</span><span class="NAME">miny2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7023</span> </span><span class="WHIT">            	</span><span class="NAME">maxy1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">_sy</span><span class="PUNC">,</span><span class="NAME">_ty</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxy2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">_CP</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_CP2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">maxy1</span><span class="PUNC">,</span><span class="NAME">maxy2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7024</span> </span><span class="WHIT">            	</span><span class="WHIT">
<span class='line'>7025</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">maxy</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">_h</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">maxy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7026</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">miny</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7027</span> </span><span class="WHIT">                </span><span class="NAME">_canvasY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">miny</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">miny</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7028</span> </span><span class="WHIT">                </span><span class="NAME">_h</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oy</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">_CP</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oy</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">_sy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oy</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">_ty</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">oy</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">_CP2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oy</span><span class="PUNC">;</span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>7029</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7030</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>7031</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">minWidth</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_w</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">minWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7032</span> </span><span class="WHIT">            	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">posAdjust</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">minWidth</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">_w</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7033</span> </span><span class="WHIT">        		</span><span class="NAME">_w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">minWidth</span><span class="PUNC">;</span><span class="WHIT">        		</span><span class="WHIT">
<span class='line'>7034</span> </span><span class="WHIT">        		</span><span class="NAME">_canvasX</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">posAdjust</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">_sx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_sx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">posAdjust</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">_tx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_tx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">posAdjust</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">_CP</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">_CP</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">posAdjust</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">_CP2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_CP2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">posAdjust</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7035</span> </span><span class="WHIT">        	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7036</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>7037</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">minWidth</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_h</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">minWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7038</span> </span><span class="WHIT">            	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">posAdjust</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">minWidth</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">_h</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7039</span> </span><span class="WHIT">        		</span><span class="NAME">_h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">minWidth</span><span class="PUNC">;</span><span class="WHIT">        		</span><span class="WHIT">
<span class='line'>7040</span> </span><span class="WHIT">        		</span><span class="NAME">_canvasY</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">posAdjust</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">_sy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_sy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">posAdjust</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">_ty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_ty</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">posAdjust</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">_CP</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">_CP</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">posAdjust</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">_CP2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_CP2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">posAdjust</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7041</span> </span><span class="WHIT">        	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7042</span> 
<span class='line'>7043</span> </span><span class="WHIT">            </span><span class="NAME">currentPoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">_canvasX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_canvasY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_w</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_h</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7044</span> </span><span class="WHIT">                             </span><span class="NAME">_sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_sy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_ty</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7045</span> </span><span class="WHIT">                             </span><span class="NAME">_CP</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_CP</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_CP2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_CP2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7046</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>7047</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">currentPoints</span><span class="PUNC">;</span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>7048</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>7049</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>7050</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_makeCurve</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7051</span> </span><span class="WHIT">        	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>7052</span> </span><span class="WHIT">	        	</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">_sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">_sy</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7053</span> </span><span class="WHIT">	        	</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">_CP</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">_CP</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7054</span> </span><span class="WHIT">	        	</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">_CP2</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">_CP2</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7055</span> </span><span class="WHIT">	        	</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">_tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">_ty</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7056</span> </span><span class="WHIT">         	</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7057</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">     </span><span class="WHIT">
<span class='line'>7058</span> 
<span class='line'>7059</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_translateLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">curve</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7060</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>7061</span> </span><span class="WHIT">                </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsBezier.locationAlongCurveFrom</span><span class="PUNC">(</span><span class="NAME">curve</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7062</span> 
<span class='line'>7063</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7064</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7065</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>7066</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>7067</span>          * returns the point on the connector's path that is 'location' along the length of the path, where 'location' is a decimal from
<span class='line'>7068</span>          * 0 to 1 inclusive. for the straight line connector this is simple maths.  for Bezier, not so much.
<span class='line'>7069</span>          */</span><span class="WHIT">
<span class='line'>7070</span> </span><span class="WHIT">        </span><span class="NAME">this.pointOnPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7071</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_makeCurve</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7072</span> </span><span class="WHIT">            </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_translateLocation</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7073</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsBezier.pointOnCurve</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7074</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7075</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>7076</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>7077</span>          * returns the gradient of the connector at the given point.
<span class='line'>7078</span>          */</span><span class="WHIT">
<span class='line'>7079</span> </span><span class="WHIT">        </span><span class="NAME">this.gradientAtPoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7080</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_makeCurve</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7081</span> </span><span class="WHIT">            </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_translateLocation</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7082</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsBezier.gradientAtPoint</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">        	</span><span class="WHIT">
<span class='line'>7083</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">	              </span><span class="WHIT">
<span class='line'>7084</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>7085</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>7086</span>          * for Bezier curves this method is a little tricky, cos calculating path distance algebraically is notoriously difficult.
<span class='line'>7087</span>          * this method is iterative, jumping forward .05% of the path at a time and summing the distance between this point and the previous
<span class='line'>7088</span>          * one, until the sum reaches 'distance'. the method may turn out to be computationally expensive; we'll see.
<span class='line'>7089</span>          * another drawback of this method is that if the connector gets quite long, .05% of the length of it is not necessarily smaller
<span class='line'>7090</span>          * than the desired distance, in which case the loop returns immediately and the arrow is mis-shapen. so a better strategy might be to
<span class='line'>7091</span>          * calculate the step as a function of distance/distance between endpoints.  
<span class='line'>7092</span>          */</span><span class="WHIT">
<span class='line'>7093</span> </span><span class="WHIT">        </span><span class="NAME">this.pointAlongPathFrom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">distance</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7094</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_makeCurve</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7095</span> </span><span class="WHIT">            </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_translateLocation</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7096</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsBezier.pointAlongCurveFrom</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">distance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7097</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">           </span><span class="WHIT">
<span class='line'>7098</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>7099</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>7100</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>7101</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>7102</span>      * Class: Connectors.Flowchart
<span class='line'>7103</span>      * Provides 'flowchart' connectors, consisting of vertical and horizontal line segments.
<span class='line'>7104</span>      */</span><span class="WHIT">
<span class='line'>7105</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>7106</span>      * Function: Constructor
<span class='line'>7107</span>      * 
<span class='line'>7108</span>      * Parameters:
<span class='line'>7109</span>      * 	stub - minimum length for the stub at each end of the connector. This can be an integer, giving a value for both ends of the connections, 
<span class='line'>7110</span>      * or an array of two integers, giving separate values for each end. The default is an integer with value 30 (pixels). 
<span class='line'>7111</span>      *  gap  - gap to leave between the end of the connector and the element on which the endpoint resides. if you make this larger than stub then you will see some odd looking behaviour.  defaults to 0 pixels.     
<span class='line'>7112</span>      */</span><span class="WHIT">
<span class='line'>7113</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Connectors.Flowchart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7114</span> </span><span class="WHIT">    	</span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Flowchart"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7115</span> </span><span class="WHIT">    	</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7116</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7117</span> </span><span class="WHIT">        	</span><span class="NAME">stub</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.stub</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">params.minStubLength</span><span class="WHIT"> </span><span class="COMM">/* bwds compat. */</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">30</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7118</span> </span><span class="WHIT">            </span><span class="NAME">sourceStub</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.isArray</span><span class="PUNC">(</span><span class="NAME">stub</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">stub</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">stub</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7119</span> </span><span class="WHIT">            </span><span class="NAME">targetStub</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.isArray</span><span class="PUNC">(</span><span class="NAME">stub</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">stub</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">stub</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7120</span> </span><span class="WHIT">            </span><span class="NAME">gap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.gap</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7121</span> </span><span class="WHIT">        	</span><span class="NAME">segments</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7122</span> </span><span class="WHIT">            </span><span class="NAME">totalLength</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7123</span> </span><span class="WHIT">        	</span><span class="NAME">segmentProportions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7124</span> </span><span class="WHIT">        	</span><span class="NAME">segmentProportionalLengths</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7125</span> </span><span class="WHIT">        	</span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7126</span> </span><span class="WHIT">        	</span><span class="NAME">swapX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">swapY</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7127</span> </span><span class="WHIT">            </span><span class="NAME">maxX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">Infinity</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">Infinity</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7128</span> </span><span class="WHIT">            </span><span class="NAME">minX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Infinity</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">minY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Infinity</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7129</span> </span><span class="WHIT">			</span><span class="NAME">grid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.grid</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7130</span> </span><span class="WHIT">			</span><span class="NAME">_gridClamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">inc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">g</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">inc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7131</span> </span><span class="WHIT">			</span><span class="NAME">clampToGrid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dontClampX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dontClampY</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7132</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>7133</span> </span><span class="WHIT">					</span><span class="NAME">dontClampX</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">grid</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_gridClamp</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">grid</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7134</span> </span><span class="WHIT">					</span><span class="NAME">dontClampY</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">grid</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_gridClamp</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">grid</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>7135</span> </span><span class="WHIT">				</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7136</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7137</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>7138</span> 		 * recalculates the points at which the segments begin and end, proportional to the total length travelled
<span class='line'>7139</span> 		 * by all the segments that constitute the connector.   we use this to help with pointOnPath calculations.
<span class='line'>7140</span> 		 */</span><span class="WHIT">
<span class='line'>7141</span> </span><span class="WHIT">		</span><span class="NAME">updateSegmentProportions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">startX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endY</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7142</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">curLoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7143</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">segments.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7144</span> </span><span class="WHIT">				</span><span class="NAME">segmentProportionalLengths</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">segments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">totalLength</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7145</span> </span><span class="WHIT">				</span><span class="NAME">segmentProportions</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">curLoc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">curLoc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">segments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">totalLength</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7146</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7147</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7148</span> </span><span class="WHIT">		</span><span class="NAME">appendSegmentsToPoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7149</span> </span><span class="WHIT">			</span><span class="NAME">points.push</span><span class="PUNC">(</span><span class="NAME">segments.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7150</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">segments.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7151</span> </span><span class="WHIT">				</span><span class="NAME">points.push</span><span class="PUNC">(</span><span class="NAME">segments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7152</span> </span><span class="WHIT">				</span><span class="NAME">points.push</span><span class="PUNC">(</span><span class="NAME">segments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7153</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7154</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7155</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>7156</span> 		 * helper method to add a segment.
<span class='line'>7157</span> 		 */</span><span class="WHIT">
<span class='line'>7158</span> </span><span class="WHIT">		</span><span class="NAME">addSegment</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ty</span><span class="COMM">/*, doGridX, doGridY*/</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7159</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">segments.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sx</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">segments</span><span class="PUNC">[</span><span class="NAME">segments.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7160</span> </span><span class="WHIT">			    </span><span class="NAME">ly</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">segments.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sy</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">segments</span><span class="PUNC">[</span><span class="NAME">segments.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7161</span> </span><span class="WHIT">                </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">lx</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">Infinity</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7162</span> </span><span class="WHIT">				</span><span class="COMM">/*,
<span class='line'>7163</span> 				gridded = clampToGrid(x, y),
<span class='line'>7164</span> 				doGridX = true,
<span class='line'>7165</span> 				doGridY = true;
<span class='line'>7166</span> 				
<span class='line'>7167</span> 			// grid experiment. TODO: have two more params that indicate whether or not to lock to a grid in each
<span class='line'>7168</span> 			// axis. the reason for this is that anchor points wont always be located on the grid, so until a connector
<span class='line'>7169</span> 			// emanating from that anchor has turned a right angle, we can't actually clamp it to a grid for that axis.
<span class='line'>7170</span> 			// so if a line came out horizontally heading left, then it will probably not be clamped in the y axis, but
<span class='line'>7171</span> 			// we can choose to clamp its first corner in the x axis.  the same principle goes for the target anchor.
<span class='line'>7172</span> 			//if (segments.length == 0) {
<span class='line'>7173</span> 			console.log("this is the first segment...if sx == x then do not do grid in X.")
<span class='line'>7174</span> 			doGridX = !(sx == x) && !(tx == x);
<span class='line'>7175</span> 			doGridY = !(sy == y) && !(ty == y);						
<span class='line'>7176</span> 			x = doGridX ? gridded[0] : x;
<span class='line'>7177</span> 			y = doGridY ? gridded[1] : y;
<span class='line'>7178</span> 			*/</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>7179</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>7180</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">lx</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">ly</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">lx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7181</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>7182</span> </span><span class="WHIT">			</span><span class="NAME">segments.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ly</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7183</span> </span><span class="WHIT">            </span><span class="NAME">totalLength</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7184</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>7185</span> </span><span class="WHIT">            </span><span class="NAME">maxX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">maxX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7186</span> </span><span class="WHIT">            </span><span class="NAME">maxY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">maxY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7187</span> </span><span class="WHIT">            </span><span class="NAME">minX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">minX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7188</span> </span><span class="WHIT">            </span><span class="NAME">minY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">minY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7189</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7190</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>7191</span> 		 * returns [segment, proportion of travel in segment, segment index] for the segment 
<span class='line'>7192</span> 		 * that contains the point which is 'location' distance along the entire path, where 
<span class='line'>7193</span> 		 * 'location' is a decimal between 0 and 1 inclusive. in this connector type, paths 
<span class='line'>7194</span> 		 * are made up of a list of segments, each of which contributes some fraction to
<span class='line'>7195</span> 		 * the total length. 
<span class='line'>7196</span>          * From 1.3.10 this also supports the 'absolute' property, which lets us specify a location
<span class='line'>7197</span>          * as the absolute distance in pixels, rather than a proportion of the total path. 
<span class='line'>7198</span> 		 */</span><span class="WHIT">
<span class='line'>7199</span> </span><span class="WHIT">		</span><span class="NAME">findSegmentForLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7200</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7201</span> </span><span class="WHIT">                </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">totalLength</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">totalLength</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">totalLength</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7202</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7203</span> 
<span class='line'>7204</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">segmentProportions.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">inSegmentProportion</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7205</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">segmentProportions.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7206</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">segmentProportions</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7207</span> </span><span class="WHIT">					</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7208</span> </span><span class="WHIT">					</span><span class="NAME">inSegmentProportion</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">segmentProportions</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">segmentProportionalLengths</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">                    </span><span class="WHIT">
<span class='line'>7209</span> </span><span class="WHIT"> 					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7210</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7211</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7212</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">segment</span><span class="PUNC">:</span><span class="NAME">segments</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">proportion</span><span class="PUNC">:</span><span class="NAME">inSegmentProportion</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">:</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7213</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7214</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7215</span> </span><span class="WHIT">		</span><span class="NAME">this.compute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7216</span> </span><span class="WHIT">            </span><span class="NAME">sourceAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">minWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceInfo</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetInfo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7217</span> </span><span class="WHIT">            </span><span class="NAME">segments</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7218</span> </span><span class="WHIT">            </span><span class="NAME">segmentProportions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7219</span> </span><span class="WHIT">            </span><span class="NAME">totalLength</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7220</span> </span><span class="WHIT">            </span><span class="NAME">segmentProportionalLengths</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7221</span> </span><span class="WHIT">            </span><span class="NAME">maxX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">maxY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">Infinity</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7222</span> </span><span class="WHIT">            </span><span class="NAME">minX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">minY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Infinity</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7223</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>7224</span> </span><span class="WHIT">			</span><span class="NAME">self.lineWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7225</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>7226</span> </span><span class="WHIT">            </span><span class="NAME">swapX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7227</span> </span><span class="WHIT">            </span><span class="NAME">swapY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7228</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>7229</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lw</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>7230</span> </span><span class="WHIT">                </span><span class="NAME">sourceOffx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lw</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceStub</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">targetStub</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7231</span> </span><span class="WHIT">                </span><span class="NAME">targetOffx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lw</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetStub</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sourceStub</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">                 </span><span class="WHIT">
<span class='line'>7232</span> </span><span class="WHIT">                </span><span class="NAME">sourceOffy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lw</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceStub</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">targetStub</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7233</span> </span><span class="WHIT">                </span><span class="NAME">targetOffy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lw</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetStub</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sourceStub</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7234</span> </span><span class="WHIT">                </span><span class="NAME">so</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourceAnchor.orientation</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">sourceAnchor.getOrientation</span><span class="PUNC">(</span><span class="NAME">sourceEndpoint</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7235</span> </span><span class="WHIT">                </span><span class="NAME">to</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">targetAnchor.orientation</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">targetAnchor.getOrientation</span><span class="PUNC">(</span><span class="NAME">targetEndpoint</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7236</span> </span><span class="WHIT">                </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">swapX</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7237</span> </span><span class="WHIT">                </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">swapY</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7238</span> </span><span class="WHIT">                </span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sourceOffx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">targetOffx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7239</span> </span><span class="WHIT">                </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sourceOffy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">targetOffy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7240</span> 
<span class='line'>7241</span> </span><span class="WHIT">            </span><span class="COMM">// if either anchor does not have an orientation set, we derive one from their relative</span><span class="WHIT">
<span class='line'>7242</span> </span><span class="WHIT">            </span><span class="COMM">// positions.  we fix the axis to be the one in which the two elements are further apart, and</span><span class="WHIT">
<span class='line'>7243</span> </span><span class="WHIT">            </span><span class="COMM">// point each anchor at the other element.  this is also used when dragging a new connection.</span><span class="WHIT">
<span class='line'>7244</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">so</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">so</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7245</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7246</span> </span><span class="WHIT">                </span><span class="NAME">so</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">to</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7247</span> </span><span class="WHIT">                </span><span class="NAME">so</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7248</span> </span><span class="WHIT">                </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7249</span> </span><span class="WHIT">                </span><span class="NAME">so</span><span class="PUNC">[</span><span class="NAME">oIndex</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7250</span> </span><span class="WHIT">                </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NAME">oIndex</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7251</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7252</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>7253</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>7254</span> 			 this code is unexplained and causes paint errors with continuous anchors sometimes.
<span class='line'>7255</span> 			 commenting it out until i can get to the bottom of it.
<span class='line'>7256</span>             if (w &lt; minWidth) {      
<span class='line'>7257</span>                 sourceOffx += (minWidth - w) / 2;
<span class='line'>7258</span>                 w = minWidth;
<span class='line'>7259</span>             }
<span class='line'>7260</span>             if (h &lt; minWidth) {             
<span class='line'>7261</span>                 sourceOffy += (minWidth - h) / 2;
<span class='line'>7262</span>                 h = minWidth;
<span class='line'>7263</span>             }
<span class='line'>7264</span>             */</span><span class="WHIT">
<span class='line'>7265</span> 
<span class='line'>7266</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">swapX</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">targetOffx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">gap</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">so</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">sourceOffx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gap</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">so</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7267</span> </span><span class="WHIT">                </span><span class="NAME">sy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">swapY</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">targetOffy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gap</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">so</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">sourceOffy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gap</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">so</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7268</span> </span><span class="WHIT">                </span><span class="NAME">tx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">swapX</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sourceOffx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gap</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">targetOffx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gap</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7269</span> </span><span class="WHIT">                </span><span class="NAME">ty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">swapY</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">sourceOffy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gap</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">targetOffy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gap</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7270</span> </span><span class="WHIT">                </span><span class="NAME">startStubX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">so</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">sourceStub</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7271</span> </span><span class="WHIT">                </span><span class="NAME">startStubY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">so</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">sourceStub</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7272</span> </span><span class="WHIT">                </span><span class="NAME">endStubX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">targetStub</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7273</span> </span><span class="WHIT">                </span><span class="NAME">endStubY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ty</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">targetStub</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7274</span> </span><span class="WHIT">                </span><span class="NAME">isXGreaterThanStubTimes2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">sx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">tx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceStub</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">targetStub</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7275</span> </span><span class="WHIT">                </span><span class="NAME">isYGreaterThanStubTimes2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">sy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceStub</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">targetStub</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7276</span> </span><span class="WHIT">                </span><span class="NAME">midx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">startStubX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">endStubX</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">startStubX</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7277</span> </span><span class="WHIT">                </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">startStubY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">endStubY</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">startStubY</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7278</span> </span><span class="WHIT">                </span><span class="NAME">oProduct</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">so</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">so</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7279</span> </span><span class="WHIT">                </span><span class="NAME">opposite</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oProduct</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7280</span> </span><span class="WHIT">                </span><span class="NAME">perpendicular</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oProduct</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7281</span> </span><span class="WHIT">                </span><span class="NAME">orthogonal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oProduct</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7282</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>7283</span> </span><span class="WHIT">            </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourceOffx</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourceOffy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7284</span> </span><span class="WHIT">            </span><span class="NAME">points</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ty</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7285</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">extraPoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">                                        </span><span class="WHIT">
<span class='line'>7286</span> </span><span class="WHIT">                      </span><span class="WHIT">
<span class='line'>7287</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sourceAxis</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">so</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"y"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"x"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7288</span> </span><span class="WHIT">                </span><span class="NAME">anchorOrientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">opposite</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"opposite"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">orthogonal</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"orthogonal"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"perpendicular"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7289</span> </span><span class="WHIT">                </span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.segment</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sy</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ty</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7290</span> </span><span class="WHIT">                </span><span class="NAME">flipSourceSegments</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">so</span><span class="PUNC">[</span><span class="NAME">sourceAxis</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"x"</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7291</span> </span><span class="WHIT">                </span><span class="NAME">flipSegments</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7292</span> </span><span class="WHIT">                    </span><span class="STRN">"x"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7293</span> </span><span class="WHIT">                    </span><span class="STRN">"y"</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>7294</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>7295</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>7296</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">flipSourceSegments</span><span class="PUNC">)</span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>7297</span> </span><span class="WHIT">                </span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">flipSegments</span><span class="PUNC">[</span><span class="NAME">sourceAxis</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">segment</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">                                    </span><span class="WHIT">
<span class='line'>7298</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>7299</span> </span><span class="WHIT">			</span><span class="NAME">addSegment</span><span class="PUNC">(</span><span class="NAME">startStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startStubY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ty</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7300</span> 
<span class='line'>7301</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">findClearedLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">start</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mult</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchorPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimension</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7302</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mult</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">anchorPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dimension</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">sourceStub</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetStub</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7303</span> </span><span class="WHIT">                </span><span class="COMM">//mx = so[0] == 0 ? startStubX + ((1 - sourceAnchor.x) * sourceInfo.width) + stub : startStubX,</span><span class="WHIT">
<span class='line'>7304</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7305</span> 
<span class='line'>7306</span> </span><span class="WHIT">            </span><span class="NAME">lineCalculators</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7307</span> </span><span class="WHIT">                </span><span class="NAME">oppositex</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7308</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceEndpoint.elementId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">targetEndpoint.elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7309</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">startStubY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sourceAnchor.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">sourceInfo.height</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">sourceStub</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetStub</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7310</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">startStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_y</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">endStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_y</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7311</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7312</span> </span><span class="WHIT">                    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isXGreaterThanStubTimes2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7313</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">midx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sy</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">midx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ty</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7314</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>7315</span> </span><span class="WHIT">                    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7316</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">startStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">endStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>7317</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7318</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7319</span> </span><span class="WHIT">                </span><span class="NAME">orthogonalx</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7320</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7321</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">endStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startStubY</span><span class="WHIT">  </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7322</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7323</span> </span><span class="WHIT">                    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7324</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">startStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endStubY</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7325</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7326</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7327</span> </span><span class="WHIT">                </span><span class="NAME">perpendicularx</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>7328</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">my</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ty</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7329</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">                  </span><span class="WHIT">
<span class='line'>7330</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">tx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">sourceStub</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetStub</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>7331</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">endStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startStubY</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>7332</span> </span><span class="WHIT">                        </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>7333</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">startStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startStubY</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">startStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">my</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">endStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">my</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">                                </span><span class="WHIT">
<span class='line'>7334</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>7335</span> </span><span class="WHIT">                    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">                    </span><span class="WHIT">
<span class='line'>7336</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">startStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">my</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">endStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">my</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7337</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7338</span> </span><span class="WHIT">                    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>7339</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">startStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endStubY</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7340</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7341</span> </span><span class="WHIT">                    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>7342</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">tx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">sourceStub</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetStub</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">                    </span><span class="WHIT">
<span class='line'>7343</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">midx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startStubY</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">midx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endStubY</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">                    </span><span class="WHIT">
<span class='line'>7344</span> </span><span class="WHIT">                        </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>7345</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">startStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endStubY</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">                                        </span><span class="WHIT">
<span class='line'>7346</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7347</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7348</span> </span><span class="WHIT">                </span><span class="NAME">oppositey</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7349</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceEndpoint.elementId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">targetEndpoint.elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7350</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">startStubX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sourceAnchor.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">sourceInfo.width</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">sourceStub</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetStub</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7351</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startStubY</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">_x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endStubY</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7352</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7353</span> </span><span class="WHIT">                    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isYGreaterThanStubTimes2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7354</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7355</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>7356</span> </span><span class="WHIT">                    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7357</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">midx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startStubY</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">midx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endStubY</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>7358</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7359</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7360</span> </span><span class="WHIT">                </span><span class="NAME">orthogonaly</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7361</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7362</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">startStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endStubY</span><span class="WHIT">  </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7363</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7364</span> </span><span class="WHIT">                    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7365</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">endStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startStubY</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7366</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7367</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7368</span> </span><span class="WHIT">                </span><span class="NAME">perpendiculary</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>7369</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7370</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">                    </span><span class="WHIT">
<span class='line'>7371</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">tx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">sourceStub</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetStub</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>7372</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">startStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endStubY</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">                    </span><span class="WHIT">
<span class='line'>7373</span> </span><span class="WHIT">                        </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>7374</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">startStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">endStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">                                        </span><span class="WHIT">
<span class='line'>7375</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>7376</span> </span><span class="WHIT">                    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7377</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7378</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">mx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startStubY</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">mx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endStubY</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7379</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7380</span> </span><span class="WHIT">                    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>7381</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">endStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startStubY</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7382</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7383</span> </span><span class="WHIT">                    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>7384</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">ty</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">sourceStub</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetStub</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">                    </span><span class="WHIT">
<span class='line'>7385</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">startStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">endStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">                  </span><span class="WHIT">
<span class='line'>7386</span> </span><span class="WHIT">                        </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>7387</span> </span><span class="WHIT">                            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">endStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startStubY</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">                                    </span><span class="WHIT">
<span class='line'>7388</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7389</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7390</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">                                                 </span><span class="WHIT">
<span class='line'>7391</span> 
<span class='line'>7392</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lineCalculators</span><span class="PUNC">[</span><span class="NAME">anchorOrientation</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sourceAxis</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7393</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7394</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">p.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7395</span> </span><span class="WHIT">                    </span><span class="NAME">addSegment</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ty</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7396</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7397</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">                                                    </span><span class="WHIT">
<span class='line'>7398</span> 
<span class='line'>7399</span> </span><span class="WHIT">            </span><span class="NAME">addSegment</span><span class="PUNC">(</span><span class="NAME">endStubX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endStubY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ty</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7400</span> </span><span class="WHIT">            </span><span class="NAME">addSegment</span><span class="PUNC">(</span><span class="NAME">tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ty</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ty</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7401</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>7402</span> </span><span class="WHIT">            </span><span class="NAME">appendSegmentsToPoints</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7403</span> </span><span class="WHIT">            </span><span class="NAME">updateSegmentProportions</span><span class="PUNC">(</span><span class="NAME">sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ty</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">                        </span><span class="WHIT">
<span class='line'>7404</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>7405</span> </span><span class="WHIT">            </span><span class="COMM">// adjust the max values of the canvas if we have a value that is larger than what we previously set.</span><span class="WHIT">
<span class='line'>7406</span> </span><span class="WHIT">            </span><span class="COMM">// </span><span class="WHIT">
<span class='line'>7407</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">maxY</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">maxY</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lineWidth</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>7408</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">maxX</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">maxX</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lineWidth</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7409</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>7410</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">points</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7411</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7412</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7413</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>7414</span>          * returns the point on the connector's path that is 'location' along the length of the path, where 'location' is a decimal from
<span class='line'>7415</span>          * 0 to 1 inclusive. for this connector we must first figure out which segment the given point lies in, and then compute the x,y position
<span class='line'>7416</span>          * from our knowledge of the segment's start and end points.
<span class='line'>7417</span>          */</span><span class="WHIT">
<span class='line'>7418</span> </span><span class="WHIT">        </span><span class="NAME">this.pointOnPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>7419</span> </span><span class="WHIT">        	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self.pointAlongPathFrom</span><span class="PUNC">(</span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7420</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7421</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>7422</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>7423</span>          * returns the gradient of the connector at the given point; the gradient will be either 0 or Infinity, depending on the direction of the
<span class='line'>7424</span>          * segment the point falls in. segment gradients are calculated in the compute method.  
<span class='line'>7425</span>          */</span><span class="WHIT">
<span class='line'>7426</span> </span><span class="WHIT">        </span><span class="NAME">this.gradientAtPoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7427</span> </span><span class="WHIT">        	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">segments</span><span class="PUNC">[</span><span class="NAME">findSegmentForLocation</span><span class="PUNC">(</span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="STRN">"index"</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7428</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7429</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>7430</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>7431</span>          * returns the point on the connector's path that is 'distance' along the length of the path from 'location', where 
<span class='line'>7432</span>          * 'location' is a decimal from 0 to 1 inclusive, and 'distance' is a number of pixels.  when you consider this concept from the point of view
<span class='line'>7433</span>          * of this connector, it starts to become clear that there's a problem with the overlay paint code: given that this connector makes several
<span class='line'>7434</span>          * 90 degree turns, it's entirely possible that an arrow overlay could be forced to paint itself around a corner, which would look stupid. this is
<span class='line'>7435</span>          * because jsPlumb uses this method (and pointOnPath) so determine the locations of the various points that go to make up an overlay.  a better
<span class='line'>7436</span>          * solution would probably be to just use pointOnPath along with gradientAtPoint, and draw the overlay so that its axis ran along
<span class='line'>7437</span>          * a tangent to the connector.  for straight line connectors this would obviously mean the overlay was painted directly on the connector, since a 
<span class='line'>7438</span>          * tangent to a straight line is the line itself, which is what we want; for this connector, and for beziers, the results would probably be better.  an additional
<span class='line'>7439</span>          * advantage is, of course, that there's less computation involved doing it that way. 
<span class='line'>7440</span>          */</span><span class="WHIT">
<span class='line'>7441</span> </span><span class="WHIT">        </span><span class="NAME">this.pointAlongPathFrom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">distance</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7442</span> </span><span class="WHIT">        	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">findSegmentForLocation</span><span class="PUNC">(</span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">seg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s.segment</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s.proportion</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">segments</span><span class="PUNC">[</span><span class="NAME">s.index</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">segments</span><span class="PUNC">[</span><span class="NAME">s.index</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7443</span> </span><span class="WHIT">        	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">         		</span><span class="WHIT">
<span class='line'>7444</span> </span><span class="WHIT">        		</span><span class="NAME">x</span><span class="WHIT"> 	</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Infinity</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">seg</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">seg</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">seg</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">seg</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">sl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">distance</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">seg</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">sl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">distance</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7445</span> </span><span class="WHIT">        		</span><span class="NAME">y</span><span class="WHIT"> 	</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">seg</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">seg</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">seg</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">seg</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">sl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">distance</span><span class="WHIT">  </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">seg</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">sl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">distance</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7446</span> </span><span class="WHIT">        		</span><span class="NAME">segmentInfo</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT">
<span class='line'>7447</span> </span><span class="WHIT">        	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7448</span> </span><span class="WHIT">        	</span><span class="WHIT">
<span class='line'>7449</span> </span><span class="WHIT">        	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7450</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7451</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7452</span> 
<span class='line'>7453</span> </span><span class="WHIT"> </span><span class="COMM">// ********************************* END OF CONNECTOR TYPES *******************************************************************</span><span class="WHIT">
<span class='line'>7454</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>7455</span> </span><span class="WHIT"> </span><span class="COMM">// ********************************* ENDPOINT TYPES *******************************************************************</span><span class="WHIT">
<span class='line'>7456</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>7457</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>7458</span>      * Class: Endpoints.Dot
<span class='line'>7459</span>      * A round endpoint, with default radius 10 pixels.
<span class='line'>7460</span>      */</span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>7461</span> </span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>7462</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>7463</span> 	 * Function: Constructor
<span class='line'>7464</span> 	 * 
<span class='line'>7465</span> 	 * Parameters:
<span class='line'>7466</span> 	 * 
<span class='line'>7467</span> 	 * 	radius	-	radius of the endpoint.  defaults to 10 pixels.
<span class='line'>7468</span> 	 */</span><span class="WHIT">
<span class='line'>7469</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Endpoints.Dot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7470</span> </span><span class="WHIT">		</span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Dot"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7471</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7472</span> </span><span class="WHIT">		</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>7473</span> </span><span class="WHIT">		</span><span class="NAME">this.radius</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.radius</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7474</span> </span><span class="WHIT">		</span><span class="NAME">this.defaultOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.radius</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7475</span> </span><span class="WHIT">		</span><span class="NAME">this.defaultInnerRadius</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.radius</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>7476</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7477</span> </span><span class="WHIT">		</span><span class="NAME">this.compute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchorPoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectorPaintStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7478</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointStyle.radius</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.radius</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7479</span> </span><span class="WHIT">				</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchorPoint</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7480</span> </span><span class="WHIT">				</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchorPoint</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7481</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7482</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7483</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7484</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>7485</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>7486</span> 	 * Class: Endpoints.Rectangle
<span class='line'>7487</span> 	 * A Rectangular Endpoint, with default size 20x20.
<span class='line'>7488</span> 	 */</span><span class="WHIT">
<span class='line'>7489</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>7490</span> 	 * Function: Constructor
<span class='line'>7491</span> 	 * 
<span class='line'>7492</span> 	 * Parameters:
<span class='line'>7493</span> 	 * 
<span class='line'>7494</span> 	 * 	width	- width of the endpoint. defaults to 20 pixels.
<span class='line'>7495</span> 	 * 	height	- height of the endpoint. defaults to 20 pixels.	
<span class='line'>7496</span> 	 */</span><span class="WHIT">
<span class='line'>7497</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Endpoints.Rectangle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7498</span> </span><span class="WHIT">		</span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Rectangle"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7499</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7500</span> </span><span class="WHIT">		</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7501</span> </span><span class="WHIT">		</span><span class="NAME">this.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.width</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">20</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7502</span> </span><span class="WHIT">		</span><span class="NAME">this.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.height</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">20</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7503</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7504</span> </span><span class="WHIT">		</span><span class="NAME">this.compute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchorPoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectorPaintStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7505</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointStyle.width</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.width</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7506</span> </span><span class="WHIT">				</span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointStyle.height</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.height</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7507</span> </span><span class="WHIT">				</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchorPoint</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">width</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7508</span> </span><span class="WHIT">				</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchorPoint</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7509</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7510</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7511</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7512</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>7513</span> 
<span class='line'>7514</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">DOMElementEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7515</span> </span><span class="WHIT">        </span><span class="NAME">jsPlumb.DOMElementComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7516</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7517</span> 
<span class='line'>7518</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">displayElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">  </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7519</span> </span><span class="WHIT">        </span><span class="NAME">this.getDisplayElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7520</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">displayElements</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7521</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7522</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>7523</span> </span><span class="WHIT">        </span><span class="NAME">this.appendDisplayElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7524</span> </span><span class="WHIT">            </span><span class="NAME">displayElements.push</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7525</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>7526</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7527</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>7528</span> 	 * Class: Endpoints.Image
<span class='line'>7529</span> 	 * Draws an image as the Endpoint.
<span class='line'>7530</span> 	 */</span><span class="WHIT">
<span class='line'>7531</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>7532</span> 	 * Function: Constructor
<span class='line'>7533</span> 	 * 
<span class='line'>7534</span> 	 * Parameters:
<span class='line'>7535</span> 	 * 
<span class='line'>7536</span> 	 * 	src	-	location of the image to use.
<span class='line'>7537</span> 	 */</span><span class="WHIT">
<span class='line'>7538</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Endpoints.Image</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7539</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>7540</span> </span><span class="WHIT">		</span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Image"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7541</span> </span><span class="WHIT">		</span><span class="NAME">DOMElementEndpoint.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7542</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7543</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7544</span> </span><span class="WHIT">			</span><span class="NAME">initialized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7545</span> </span><span class="WHIT">			</span><span class="NAME">deleted</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7546</span> </span><span class="WHIT">			</span><span class="NAME">widthToUse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.width</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7547</span> </span><span class="WHIT">			</span><span class="NAME">heightToUse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.height</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7548</span> </span><span class="WHIT">            </span><span class="NAME">_onload</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7549</span> </span><span class="WHIT">            </span><span class="NAME">_endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.endpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7550</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>7551</span> </span><span class="WHIT">		</span><span class="NAME">this.img</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Image</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7552</span> </span><span class="WHIT">		</span><span class="NAME">self.ready</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7553</span> 
<span class='line'>7554</span> </span><span class="WHIT">		</span><span class="NAME">this.img.onload</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7555</span> </span><span class="WHIT">			</span><span class="NAME">self.ready</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7556</span> </span><span class="WHIT">			</span><span class="NAME">widthToUse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">widthToUse</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.img.width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7557</span> </span><span class="WHIT">			</span><span class="NAME">heightToUse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">heightToUse</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.img.height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7558</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_onload</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7559</span> </span><span class="WHIT">                </span><span class="NAME">_onload</span><span class="PUNC">(</span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7560</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7561</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7562</span> 
<span class='line'>7563</span> </span><span class="WHIT">        </span><span class="COMM">/*
<span class='line'>7564</span>             Function: setImage
<span class='line'>7565</span>             Sets the Image to use in this Endpoint.  
<span class='line'>7566</span> 
<span class='line'>7567</span>             Parameters:
<span class='line'>7568</span>             img         -   may be a URL or an Image object
<span class='line'>7569</span>             onload      -   optional; a callback to execute once the image has loaded.
<span class='line'>7570</span>         */</span><span class="WHIT">
<span class='line'>7571</span> </span><span class="WHIT">        </span><span class="NAME">_endpoint.setImage</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">img</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">onload</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7572</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">img.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">String</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">img</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">img.src</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7573</span> </span><span class="WHIT">            </span><span class="NAME">_onload</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">onload</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7574</span> </span><span class="WHIT">            </span><span class="NAME">self.img.src</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">img</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7575</span> 
<span class='line'>7576</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>7577</span> </span><span class="WHIT">                </span><span class="NAME">self.canvas.setAttribute</span><span class="PUNC">(</span><span class="STRN">"src"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">img</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7578</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7579</span> 
<span class='line'>7580</span> </span><span class="WHIT">        </span><span class="NAME">_endpoint.setImage</span><span class="PUNC">(</span><span class="NAME">params.src</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">params.url</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.onload</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7581</span> 
<span class='line'>7582</span> </span><span class="WHIT">		</span><span class="NAME">this.compute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchorPoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectorPaintStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7583</span> </span><span class="WHIT">			</span><span class="NAME">self.anchorPoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchorPoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7584</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.ready</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">anchorPoint</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">widthToUse</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchorPoint</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">heightToUse</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7585</span> </span><span class="WHIT">									</span><span class="NAME">widthToUse</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">heightToUse</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7586</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7587</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7588</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7589</span> </span><span class="WHIT">		</span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"img"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">initialized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7590</span> </span><span class="WHIT">		</span><span class="NAME">self.canvas.style</span><span class="PUNC">[</span><span class="STRN">"margin"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7591</span> </span><span class="WHIT">		</span><span class="NAME">self.canvas.style</span><span class="PUNC">[</span><span class="STRN">"padding"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7592</span> </span><span class="WHIT">		</span><span class="NAME">self.canvas.style</span><span class="PUNC">[</span><span class="STRN">"outline"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7593</span> </span><span class="WHIT">		</span><span class="NAME">self.canvas.style</span><span class="PUNC">[</span><span class="STRN">"position"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"absolute"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7594</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.cssClass</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">params.cssClass</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7595</span> </span><span class="WHIT">		</span><span class="NAME">self.canvas.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.endpointClass</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7596</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">widthToUse</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.canvas.setAttribute</span><span class="PUNC">(</span><span class="STRN">"width"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">widthToUse</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7597</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">heightToUse</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.canvas.setAttribute</span><span class="PUNC">(</span><span class="STRN">"height"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">heightToUse</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7598</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.appendElement</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7599</span> </span><span class="WHIT">		</span><span class="NAME">self.attachListeners</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7600</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7601</span> </span><span class="WHIT">		</span><span class="NAME">self.cleanup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7602</span> </span><span class="WHIT">			</span><span class="NAME">deleted</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7603</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7604</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7605</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">actuallyPaint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7606</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">deleted</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7607</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">initialized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7608</span> </span><span class="WHIT">					</span><span class="NAME">self.canvas.setAttribute</span><span class="PUNC">(</span><span class="STRN">"src"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.img.src</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7609</span> </span><span class="WHIT">					</span><span class="NAME">self.appendDisplayElement</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7610</span> </span><span class="WHIT">					</span><span class="NAME">initialized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7611</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7612</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.anchorPoint</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">widthToUse</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7613</span> </span><span class="WHIT">					</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.anchorPoint</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">heightToUse</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7614</span> </span><span class="WHIT">				</span><span class="NAME">jsPlumb.sizeCanvas</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">widthToUse</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">heightToUse</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7615</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7616</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7617</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7618</span> </span><span class="WHIT">		</span><span class="NAME">this.paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7619</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.ready</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7620</span> </span><span class="WHIT">    			</span><span class="NAME">actuallyPaint</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7621</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7622</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7623</span> </span><span class="WHIT">				</span><span class="NAME">window.setTimeout</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">    					</span><span class="WHIT">
<span class='line'>7624</span> </span><span class="WHIT">					</span><span class="NAME">self.paint</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7625</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">200</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7626</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7627</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>7628</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7629</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>7630</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>7631</span> 	 * Class: Endpoints.Blank
<span class='line'>7632</span> 	 * An Endpoint that paints nothing (visible) on the screen.  Supports cssClass and hoverClass parameters like all Endpoints.
<span class='line'>7633</span> 	 */</span><span class="WHIT">
<span class='line'>7634</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Endpoints.Blank</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7635</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7636</span> </span><span class="WHIT">		</span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Blank"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7637</span> </span><span class="WHIT">		</span><span class="NAME">DOMElementEndpoint.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7638</span> </span><span class="WHIT">		</span><span class="NAME">this.compute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchorPoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectorPaintStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7639</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">anchorPoint</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchorPoint</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">10</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7640</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7641</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7642</span> </span><span class="WHIT">		</span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7643</span> </span><span class="WHIT">		</span><span class="NAME">self.canvas.style.display</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7644</span> </span><span class="WHIT">		</span><span class="NAME">self.canvas.style.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"1px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7645</span> </span><span class="WHIT">		</span><span class="NAME">self.canvas.style.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"1px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7646</span> </span><span class="WHIT">		</span><span class="NAME">self.canvas.style.background</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"transparent"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7647</span> </span><span class="WHIT">		</span><span class="NAME">self.canvas.style.position</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"absolute"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7648</span> </span><span class="WHIT">		</span><span class="NAME">self.canvas.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb.endpointClass</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7649</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.appendElement</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7650</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7651</span> </span><span class="WHIT">		</span><span class="NAME">this.paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7652</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.sizeCanvas</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>7653</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7654</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7655</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>7656</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>7657</span> 	 * Class: Endpoints.Triangle
<span class='line'>7658</span> 	 * A triangular Endpoint.  
<span class='line'>7659</span> 	 */</span><span class="WHIT">
<span class='line'>7660</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>7661</span> 	 * Function: Constructor
<span class='line'>7662</span> 	 * 
<span class='line'>7663</span> 	 * Parameters:
<span class='line'>7664</span> 	 * 
<span class='line'>7665</span> 	 * 	width	-	width of the triangle's base.  defaults to 55 pixels.
<span class='line'>7666</span> 	 * 	height	-	height of the triangle from base to apex.  defaults to 55 pixels.
<span class='line'>7667</span> 	 */</span><span class="WHIT">
<span class='line'>7668</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Endpoints.Triangle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7669</span> </span><span class="WHIT">		</span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Triangle"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7670</span> </span><span class="WHIT">		</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">  </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7671</span> </span><span class="WHIT">		</span><span class="NAME">params.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.width</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">55</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7672</span> </span><span class="WHIT">		</span><span class="NAME">params.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.height</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">55</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7673</span> </span><span class="WHIT">		</span><span class="NAME">this.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7674</span> </span><span class="WHIT">		</span><span class="NAME">this.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7675</span> </span><span class="WHIT">		</span><span class="NAME">this.compute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchorPoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectorPaintStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7676</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointStyle.width</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.width</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7677</span> </span><span class="WHIT">			</span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointStyle.height</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.height</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7678</span> </span><span class="WHIT">			</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchorPoint</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">width</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7679</span> </span><span class="WHIT">			</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchorPoint</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7680</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7681</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7682</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7683</span> </span><span class="COMM">// ********************************* END OF ENDPOINT TYPES *******************************************************************</span><span class="WHIT">
<span class='line'>7684</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>7685</span> 
<span class='line'>7686</span> </span><span class="COMM">// ********************************* OVERLAY DEFINITIONS ***********************************************************************    </span><span class="WHIT">
<span class='line'>7687</span> 
<span class='line'>7688</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">AbstractOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7689</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">visible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7690</span> </span><span class="WHIT">        </span><span class="NAME">this.isAppendedAtTopLevel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7691</span> </span><span class="WHIT">		</span><span class="NAME">this.component</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.component</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7692</span> </span><span class="WHIT">		</span><span class="NAME">this.loc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.location</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">params.location</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7693</span> </span><span class="WHIT">        </span><span class="NAME">this.endpointLoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.endpointLocation</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">params.endpointLocation</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7694</span> </span><span class="WHIT">		</span><span class="NAME">this.setVisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">val</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7695</span> </span><span class="WHIT">			</span><span class="NAME">visible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">val</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7696</span> </span><span class="WHIT">			</span><span class="NAME">self.component.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7697</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7698</span> </span><span class="WHIT">    	</span><span class="NAME">this.isVisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">visible</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7699</span> </span><span class="WHIT">    	</span><span class="NAME">this.hide</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">self.setVisible</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7700</span> </span><span class="WHIT">    	</span><span class="NAME">this.show</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">self.setVisible</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7701</span> </span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>7702</span> </span><span class="WHIT">    	</span><span class="NAME">this.incrementLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">amount</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7703</span> </span><span class="WHIT">    		</span><span class="NAME">self.loc</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">amount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7704</span> </span><span class="WHIT">    		</span><span class="NAME">self.component.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7705</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7706</span> </span><span class="WHIT">    	</span><span class="NAME">this.setLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7707</span> </span><span class="WHIT">    		</span><span class="NAME">self.loc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7708</span> </span><span class="WHIT">    		</span><span class="NAME">self.component.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7709</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7710</span> </span><span class="WHIT">    	</span><span class="NAME">this.getLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7711</span> </span><span class="WHIT">    		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self.loc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7712</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7713</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7714</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>7715</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>7716</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>7717</span> 	 * Class: Overlays.Arrow
<span class='line'>7718</span> 	 * 
<span class='line'>7719</span> 	 * An arrow overlay, defined by four points: the head, the two sides of the tail, and a 'foldback' point at some distance along the length
<span class='line'>7720</span> 	 * of the arrow that lines from each tail point converge into.  The foldback point is defined using a decimal that indicates some fraction
<span class='line'>7721</span> 	 * of the length of the arrow and has a default value of 0.623.  A foldback point value of 1 would mean that the arrow had a straight line
<span class='line'>7722</span> 	 * across the tail.  
<span class='line'>7723</span> 	 */</span><span class="WHIT">
<span class='line'>7724</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>7725</span> 	 * Function: Constructor
<span class='line'>7726</span> 	 * 
<span class='line'>7727</span> 	 * Parameters:
<span class='line'>7728</span> 	 * 
<span class='line'>7729</span> 	 * 	length - distance in pixels from head to tail baseline. default 20.
<span class='line'>7730</span> 	 * 	width - width in pixels of the tail baseline. default 20.
<span class='line'>7731</span> 	 * 	fillStyle - style to use when filling the arrow.  defaults to "black".
<span class='line'>7732</span> 	 * 	strokeStyle - style to use when stroking the arrow. defaults to null, which means the arrow is not stroked.
<span class='line'>7733</span> 	 * 	lineWidth - line width to use when stroking the arrow. defaults to 1, but only used if strokeStyle is not null.
<span class='line'>7734</span> 	 * 	foldback - distance (as a decimal from 0 to 1 inclusive) along the length of the arrow marking the point the tail points should fold back to.  defaults to 0.623.
<span class='line'>7735</span> 	 * 	location - distance (as a decimal from 0 to 1 inclusive) marking where the arrow should sit on the connector. defaults to 0.5.
<span class='line'>7736</span> 	 * 	direction - indicates the direction the arrow points in. valid values are -1 and 1; 1 is default.
<span class='line'>7737</span> 	 */</span><span class="WHIT">
<span class='line'>7738</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Overlays.Arrow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7739</span> </span><span class="WHIT">		</span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Arrow"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7740</span> </span><span class="WHIT">		</span><span class="NAME">AbstractOverlay.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7741</span> </span><span class="WHIT">        </span><span class="NAME">this.isAppendedAtTopLevel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7742</span> </span><span class="WHIT">		</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7743</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7744</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7745</span> </span><span class="WHIT">    	</span><span class="NAME">this.length</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.length</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">20</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7746</span> </span><span class="WHIT">    	</span><span class="NAME">this.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.width</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">20</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7747</span> </span><span class="WHIT">    	</span><span class="NAME">this.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7748</span> </span><span class="WHIT">    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.direction</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7749</span> </span><span class="WHIT">    	    </span><span class="NAME">paintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.paintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7750</span> </span><span class="WHIT">    	    </span><span class="COMM">// how far along the arrow the lines folding back in come to. default is 62.3%.</span><span class="WHIT">
<span class='line'>7751</span> </span><span class="WHIT">    	    </span><span class="NAME">foldback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.foldback</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0.623</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7752</span> 
<span class='line'>7753</span> </span><span class="WHIT">    	    	</span><span class="WHIT">
<span class='line'>7754</span> </span><span class="WHIT">    	</span><span class="NAME">this.computeMaxSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self.width</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">1.5</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7755</span> </span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>7756</span> </span><span class="WHIT">    	</span><span class="NAME">this.cleanup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// nothing to clean up for Arrows</span><span class="WHIT">
<span class='line'>7757</span> </span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>7758</span> </span><span class="WHIT">    	</span><span class="NAME">this.draw</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">connector</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">currentConnectionPaintStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectorDimensions</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7759</span> 
<span class='line'>7760</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hxy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">txy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tail</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cxy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7761</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">connector.pointAlongPathFrom</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7762</span> 
<span class='line'>7763</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jsPlumbUtil.isString</span><span class="PUNC">(</span><span class="NAME">self.loc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.loc</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.loc</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7764</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">self.loc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7765</span> </span><span class="WHIT">                    </span><span class="NAME">hxy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connector.pointAlongPathFrom</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">self.length</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7766</span> </span><span class="WHIT">                    </span><span class="NAME">mid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connector.pointOnPath</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7767</span> </span><span class="WHIT">                    </span><span class="NAME">txy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.pointOnLine</span><span class="PUNC">(</span><span class="NAME">hxy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7768</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7769</span> </span><span class="WHIT">                </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.loc</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7770</span> </span><span class="WHIT">                    </span><span class="NAME">hxy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connector.pointOnPath</span><span class="PUNC">(</span><span class="NAME">self.loc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7771</span> </span><span class="WHIT">                    </span><span class="NAME">mid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connector.pointAlongPathFrom</span><span class="PUNC">(</span><span class="NAME">self.loc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">                    </span><span class="WHIT">
<span class='line'>7772</span> </span><span class="WHIT">                    </span><span class="NAME">txy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.pointOnLine</span><span class="PUNC">(</span><span class="NAME">hxy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7773</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7774</span> </span><span class="WHIT">                </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.loc</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7775</span> </span><span class="WHIT">                    </span><span class="NAME">txy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connector.pointOnPath</span><span class="PUNC">(</span><span class="NAME">self.loc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7776</span> </span><span class="WHIT">                    </span><span class="NAME">mid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connector.pointAlongPathFrom</span><span class="PUNC">(</span><span class="NAME">self.loc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7777</span> </span><span class="WHIT">                    </span><span class="NAME">hxy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.pointOnLine</span><span class="PUNC">(</span><span class="NAME">txy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7778</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7779</span> </span><span class="WHIT">                </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7780</span> </span><span class="WHIT">    			    </span><span class="NAME">hxy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connector.pointAlongPathFrom</span><span class="PUNC">(</span><span class="NAME">self.loc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">direction</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">self.length</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7781</span> </span><span class="WHIT">                    </span><span class="NAME">mid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connector.pointOnPath</span><span class="PUNC">(</span><span class="NAME">self.loc</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7782</span> </span><span class="WHIT">                    </span><span class="NAME">txy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.pointOnLine</span><span class="PUNC">(</span><span class="NAME">hxy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7783</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7784</span> 
<span class='line'>7785</span> </span><span class="WHIT">                </span><span class="NAME">tail</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.perpendicularLineTo</span><span class="PUNC">(</span><span class="NAME">hxy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">txy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.width</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7786</span> </span><span class="WHIT">                </span><span class="NAME">cxy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.pointOnLine</span><span class="PUNC">(</span><span class="NAME">hxy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">txy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">foldback</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">self.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7787</span> 
<span class='line'>7788</span> </span><span class="WHIT">    			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">hxy.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tail</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tail</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7789</span> </span><span class="WHIT">    				</span><span class="NAME">maxx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">hxy.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tail</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tail</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7790</span> </span><span class="WHIT">    				</span><span class="NAME">miny</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">hxy.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tail</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tail</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7791</span> </span><span class="WHIT">    				</span><span class="NAME">maxy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">hxy.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tail</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tail</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7792</span> </span><span class="WHIT">    			</span><span class="WHIT">
<span class='line'>7793</span> </span><span class="WHIT">    			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">hxy</span><span class="PUNC">:</span><span class="NAME">hxy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tail</span><span class="PUNC">:</span><span class="NAME">tail</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cxy</span><span class="PUNC">:</span><span class="NAME">cxy</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7794</span> </span><span class="WHIT">    			    </span><span class="NAME">strokeStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">paintStyle.strokeStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">currentConnectionPaintStyle.strokeStyle</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7795</span> </span><span class="WHIT">    			    </span><span class="NAME">fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">paintStyle.fillStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">currentConnectionPaintStyle.strokeStyle</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7796</span> </span><span class="WHIT">    			    </span><span class="NAME">lineWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">paintStyle.lineWidth</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">currentConnectionPaintStyle.lineWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7797</span> </span><span class="WHIT">    			</span><span class="WHIT">
<span class='line'>7798</span> </span><span class="WHIT">    			</span><span class="NAME">self.paint</span><span class="PUNC">(</span><span class="NAME">connector</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">strokeStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fillStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectorDimensions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>7799</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>7800</span> </span><span class="WHIT">			    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">minx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">miny</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxy</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7801</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7802</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7803</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7804</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">          </span><span class="WHIT">
<span class='line'>7805</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>7806</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>7807</span>      * Class: Overlays.PlainArrow
<span class='line'>7808</span> 	 * 
<span class='line'>7809</span> 	 * A basic arrow.  This is in fact just one instance of the more generic case in which the tail folds back on itself to some
<span class='line'>7810</span> 	 * point along the length of the arrow: in this case, that foldback point is the full length of the arrow.  so it just does
<span class='line'>7811</span> 	 * a 'call' to Arrow with foldback set appropriately.       
<span class='line'>7812</span> 	 */</span><span class="WHIT">
<span class='line'>7813</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>7814</span>      * Function: Constructor
<span class='line'>7815</span>      * See &lt;Overlays.Arrow> for allowed parameters for this overlay.
<span class='line'>7816</span>      */</span><span class="WHIT">
<span class='line'>7817</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Overlays.PlainArrow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7818</span> </span><span class="WHIT">    	</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>7819</span> </span><span class="WHIT">    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">foldback</span><span class="PUNC">:</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7820</span> </span><span class="WHIT">    	</span><span class="NAME">jsPlumb.Overlays.Arrow.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7821</span> </span><span class="WHIT">    	</span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"PlainArrow"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7822</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7823</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>7824</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>7825</span>      * Class: Overlays.Diamond
<span class='line'>7826</span>      * 
<span class='line'>7827</span> 	 * A diamond. Like PlainArrow, this is a concrete case of the more generic case of the tail points converging on some point...it just
<span class='line'>7828</span> 	 * happens that in this case, that point is greater than the length of the the arrow.    
<span class='line'>7829</span> 	 * 
<span class='line'>7830</span> 	 *      this could probably do with some help with positioning...due to the way it reuses the Arrow paint code, what Arrow thinks is the
<span class='line'>7831</span> 	 *      center is actually 1/4 of the way along for this guy.  but we don't have any knowledge of pixels at this point, so we're kind of
<span class='line'>7832</span> 	 *      stuck when it comes to helping out the Arrow class. possibly we could pass in a 'transpose' parameter or something. the value
<span class='line'>7833</span> 	 *      would be -l/4 in this case - move along one quarter of the total length.
<span class='line'>7834</span> 	 */</span><span class="WHIT">
<span class='line'>7835</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>7836</span>      * Function: Constructor
<span class='line'>7837</span>      * See &lt;Overlays.Arrow> for allowed parameters for this overlay.
<span class='line'>7838</span>      */</span><span class="WHIT">
<span class='line'>7839</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Overlays.Diamond</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7840</span> </span><span class="WHIT">    	</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>7841</span> </span><span class="WHIT">    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.length</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">40</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7842</span> </span><span class="WHIT">    	    </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">length</span><span class="PUNC">:</span><span class="NAME">l</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">foldback</span><span class="PUNC">:</span><span class="NUMB">2</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7843</span> </span><span class="WHIT">    	</span><span class="NAME">jsPlumb.Overlays.Arrow.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7844</span> </span><span class="WHIT">    	</span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Diamond"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7845</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7846</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>7847</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>7848</span> </span><span class="WHIT">	</span><span class="COMM">// abstract superclass for overlays that add an element to the DOM.</span><span class="WHIT">
<span class='line'>7849</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">AbstractDOMOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7850</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.DOMElementComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7851</span> </span><span class="WHIT">    	</span><span class="NAME">AbstractOverlay.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7852</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7853</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">initialised</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7854</span> </span><span class="WHIT">		</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7855</span> </span><span class="WHIT">		</span><span class="NAME">this.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7856</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">div</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7857</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7858</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">makeDiv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7859</span> </span><span class="WHIT">			</span><span class="NAME">div</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.create</span><span class="PUNC">(</span><span class="NAME">params.component</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7860</span> </span><span class="WHIT">			</span><span class="NAME">div</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getDOMElement</span><span class="PUNC">(</span><span class="NAME">div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7861</span> </span><span class="WHIT">			</span><span class="NAME">div.style</span><span class="PUNC">[</span><span class="STRN">"position"</span><span class="PUNC">]</span><span class="WHIT"> 	</span><span class="PUNC">=</span><span class="WHIT"> 	</span><span class="STRN">"absolute"</span><span class="PUNC">;</span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>7862</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"_jsPlumb"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">overlayClass</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7863</span> </span><span class="WHIT">				</span><span class="PUNC">(</span><span class="NAME">self.cssClass</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">self.cssClass</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7864</span> </span><span class="WHIT">				</span><span class="NAME">params.cssClass</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">params.cssClass</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>7865</span> </span><span class="WHIT">			</span><span class="NAME">div.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">	</span><span class="NAME">clazz</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7866</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.appendElement</span><span class="PUNC">(</span><span class="NAME">div</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.component.parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7867</span> </span><span class="WHIT">			</span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"_jsPlumb"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getId</span><span class="PUNC">(</span><span class="NAME">div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7868</span> </span><span class="WHIT">	    	</span><span class="NAME">self.attachListeners</span><span class="PUNC">(</span><span class="NAME">div</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7869</span> </span><span class="WHIT">	    	</span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">div</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7870</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7871</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7872</span> </span><span class="WHIT">		</span><span class="NAME">this.getElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7873</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">div</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7874</span> </span><span class="WHIT">				</span><span class="NAME">makeDiv</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7875</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7876</span> </span><span class="WHIT">    		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">div</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7877</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7878</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7879</span> </span><span class="WHIT">		</span><span class="NAME">this.getDimensions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7880</span> </span><span class="WHIT">    		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getSize</span><span class="PUNC">(</span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">self.getElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7881</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7882</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7883</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cachedDimensions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7884</span> </span><span class="WHIT">			</span><span class="NAME">_getDimensions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">component</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7885</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cachedDimensions</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>7886</span> </span><span class="WHIT">					</span><span class="NAME">cachedDimensions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.getDimensions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7887</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">cachedDimensions</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7888</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7889</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7890</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>7891</span> 		 * Function: clearCachedDimensions
<span class='line'>7892</span> 		 * Clears the cached dimensions for the label. As a performance enhancement, label dimensions are
<span class='line'>7893</span> 		 * cached from 1.3.12 onwards. The cache is cleared when you change the label text, of course, but
<span class='line'>7894</span> 		 * there are other reasons why the text dimensions might change - if you make a change through CSS, for
<span class='line'>7895</span> 		 * example, you might change the font size.  in that case you should explicitly call this method.
<span class='line'>7896</span> 		 */</span><span class="WHIT">
<span class='line'>7897</span> </span><span class="WHIT">		</span><span class="NAME">this.clearCachedDimensions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7898</span> </span><span class="WHIT">			</span><span class="NAME">cachedDimensions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7899</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7900</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7901</span> </span><span class="WHIT">		</span><span class="NAME">this.computeMaxSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7902</span> </span><span class="WHIT">    		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">td</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getDimensions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7903</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">td</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">td</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7904</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7905</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7906</span> </span><span class="WHIT">		</span><span class="COMM">//override setVisible</span><span class="WHIT">
<span class='line'>7907</span> </span><span class="WHIT">    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">osv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.setVisible</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7908</span> </span><span class="WHIT">    	</span><span class="NAME">self.setVisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7909</span> </span><span class="WHIT">    		</span><span class="NAME">osv</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// call superclass</span><span class="WHIT">
<span class='line'>7910</span> </span><span class="WHIT">    		</span><span class="NAME">div.style.display</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"block"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7911</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7912</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7913</span> </span><span class="WHIT">		</span><span class="NAME">this.cleanup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7914</span> </span><span class="WHIT">    		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">div</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.removeElement</span><span class="PUNC">(</span><span class="NAME">div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7915</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7916</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7917</span> </span><span class="WHIT">		</span><span class="NAME">this.paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">component</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">componentDimensions</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7918</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">initialised</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7919</span> </span><span class="WHIT">				</span><span class="NAME">self.getElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7920</span> </span><span class="WHIT">				</span><span class="NAME">component.appendDisplayElement</span><span class="PUNC">(</span><span class="NAME">div</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7921</span> </span><span class="WHIT">				</span><span class="NAME">self.attachListeners</span><span class="PUNC">(</span><span class="NAME">div</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">component</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7922</span> </span><span class="WHIT">				</span><span class="NAME">initialised</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7923</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7924</span> </span><span class="WHIT">			</span><span class="NAME">div.style.left</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">componentDimensions</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.minx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7925</span> </span><span class="WHIT">			</span><span class="NAME">div.style.top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">componentDimensions</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.miny</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>7926</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7927</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>7928</span> </span><span class="WHIT">		</span><span class="NAME">this.draw</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">component</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">currentConnectionPaintStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">componentDimensions</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7929</span> </span><span class="WHIT">	    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">td</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getDimensions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7930</span> </span><span class="WHIT">	    	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">td</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">td.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7931</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cxy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7932</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">component.pointOnPath</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7933</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">loc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.loc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7934</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jsPlumbUtil.isString</span><span class="PUNC">(</span><span class="NAME">self.loc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.loc</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.loc</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7935</span> </span><span class="WHIT">                        </span><span class="NAME">loc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">self.loc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7936</span> </span><span class="WHIT">                        </span><span class="NAME">absolute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7937</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7938</span> </span><span class="WHIT">                    </span><span class="NAME">cxy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">component.pointOnPath</span><span class="PUNC">(</span><span class="NAME">loc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// a connection</span><span class="WHIT">
<span class='line'>7939</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7940</span> </span><span class="WHIT">                </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7941</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">locToUse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.loc.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">self.loc</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">self.endpointLoc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7942</span> </span><span class="WHIT">                    </span><span class="NAME">cxy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">locToUse</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">componentDimensions</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7943</span> </span><span class="WHIT">                            </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">locToUse</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">componentDimensions</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">      </span><span class="WHIT">
<span class='line'>7944</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>7945</span> </span><span class="WHIT">                           </span><span class="WHIT">
<span class='line'>7946</span> </span><span class="WHIT">				</span><span class="NAME">minx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cxy.x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">td</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>7947</span> </span><span class="WHIT">				</span><span class="NAME">miny</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cxy.y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">td</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>7948</span> </span><span class="WHIT">				</span><span class="NAME">self.paint</span><span class="PUNC">(</span><span class="NAME">component</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">minx</span><span class="PUNC">:</span><span class="NAME">minx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">miny</span><span class="PUNC">:</span><span class="NAME">miny</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">td</span><span class="PUNC">:</span><span class="NAME">td</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cxy</span><span class="PUNC">:</span><span class="NAME">cxy</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">componentDimensions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>7949</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">minx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">minx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">td</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">miny</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">miny</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">td</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7950</span> </span><span class="WHIT">        	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7951</span> </span><span class="WHIT">	    	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7952</span> </span><span class="WHIT">	    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7953</span> </span><span class="WHIT">	    </span><span class="WHIT">
<span class='line'>7954</span> </span><span class="WHIT">	    </span><span class="NAME">this.reattachListeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">connector</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7955</span> </span><span class="WHIT">	    	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">div</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7956</span> </span><span class="WHIT">	    		</span><span class="NAME">self.reattachListenersForElement</span><span class="PUNC">(</span><span class="NAME">div</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connector</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7957</span> </span><span class="WHIT">	    	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>7958</span> </span><span class="WHIT">	    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7959</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>7960</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7961</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>7962</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>7963</span>      * Class: Overlays.Custom
<span class='line'>7964</span>      * A Custom overlay. You supply a 'create' function which returns some DOM element, and jsPlumb positions it.
<span class='line'>7965</span>      * The 'create' function is passed a Connection or Endpoint.
<span class='line'>7966</span>      */</span><span class="WHIT">
<span class='line'>7967</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>7968</span>      * Function: Constructor
<span class='line'>7969</span>      * 
<span class='line'>7970</span>      * Parameters:
<span class='line'>7971</span>      * 	create - function for jsPlumb to call that returns a DOM element.
<span class='line'>7972</span>      * 	location - distance (as a decimal from 0 to 1 inclusive) marking where the label should sit on the connector. defaults to 0.5.
<span class='line'>7973</span>      * 	id - optional id to use for later retrieval of this overlay.
<span class='line'>7974</span>      * 	
<span class='line'>7975</span>      */</span><span class="WHIT">
<span class='line'>7976</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Overlays.Custom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>7977</span> </span><span class="WHIT">    	</span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Custom"</span><span class="PUNC">;</span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>7978</span> </span><span class="WHIT">    	</span><span class="NAME">AbstractDOMOverlay.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		    	        		    	    		</span><span class="WHIT">
<span class='line'>7979</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>7980</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>7981</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>7982</span>      * Class: Overlays.Label
<span class='line'>7983</span>      * A Label overlay. For all different renderer types (SVG/Canvas/VML), jsPlumb draws a Label overlay as a styled DIV.  Version 1.3.0 of jsPlumb
<span class='line'>7984</span>      * introduced the ability to set css classes on the label; this is now the preferred way for you to style a label.  The 'labelStyle' parameter
<span class='line'>7985</span>      * is still supported in 1.3.0 but its usage is deprecated.  Under the hood, jsPlumb just turns that object into a bunch of CSS directive that it 
<span class='line'>7986</span>      * puts on the Label's 'style' attribute, so the end result is the same. 
<span class='line'>7987</span>      */</span><span class="WHIT">
<span class='line'>7988</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>7989</span>      * Function: Constructor
<span class='line'>7990</span>      * 
<span class='line'>7991</span>      * Parameters:
<span class='line'>7992</span>      * 	cssClass - optional css class string to append to css class. This string is appended "as-is", so you can of course have multiple classes
<span class='line'>7993</span>      *             defined.  This parameter is preferred to using labelStyle, borderWidth and borderStyle.
<span class='line'>7994</span>      * 	label - the label to paint.  May be a string or a function that returns a string.  Nothing will be painted if your label is null or your
<span class='line'>7995</span>      *         label function returns null.  empty strings _will_ be painted.
<span class='line'>7996</span>      * 	location - distance (as a decimal from 0 to 1 inclusive) marking where the label should sit on the connector. defaults to 0.5.
<span class='line'>7997</span>      * 	id - optional id to use for later retrieval of this overlay.
<span class='line'>7998</span>      * 	
<span class='line'>7999</span>      */</span><span class="WHIT">
<span class='line'>8000</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Overlays.Label</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8001</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>8002</span> </span><span class="WHIT">		</span><span class="NAME">this.labelStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.labelStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.LabelStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8003</span> </span><span class="WHIT">		</span><span class="NAME">this.cssClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.labelStyle</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.labelStyle.cssClass</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8004</span> </span><span class="WHIT">		</span><span class="NAME">params.create</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8005</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8006</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8007</span> </span><span class="WHIT">    	</span><span class="NAME">jsPlumb.Overlays.Custom.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8008</span> </span><span class="WHIT">		</span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"Label"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8009</span> </span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>8010</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">label</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.label</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8011</span> </span><span class="WHIT">            </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">    	    </span><span class="WHIT">
<span class='line'>8012</span> </span><span class="WHIT">            </span><span class="NAME">labelText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8013</span> </span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>8014</span> </span><span class="WHIT">    	</span><span class="COMM">/*
<span class='line'>8015</span>     	 * Function: setLabel
<span class='line'>8016</span>     	 * sets the label's, um, label.  you would think i'd call this function
<span class='line'>8017</span>     	 * 'setText', but you can pass either a Function or a String to this, so
<span class='line'>8018</span>     	 * it makes more sense as 'setLabel'. This uses innerHTML on the label div, so keep
<span class='line'>8019</span>          * that in mind if you need escaped HTML.
<span class='line'>8020</span>     	 */</span><span class="WHIT">
<span class='line'>8021</span> </span><span class="WHIT">    	</span><span class="NAME">this.setLabel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8022</span> </span><span class="WHIT">    		</span><span class="NAME">label</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8023</span> </span><span class="WHIT">    		</span><span class="NAME">labelText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8024</span> </span><span class="WHIT">			</span><span class="NAME">self.clearCachedDimensions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8025</span> </span><span class="WHIT">			</span><span class="NAME">_update</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8026</span> </span><span class="WHIT">    		</span><span class="NAME">self.component.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8027</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8028</span> </span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>8029</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_update</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8030</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">label</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"function"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8031</span> </span><span class="WHIT">    			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">label</span><span class="PUNC">(</span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8032</span> </span><span class="WHIT">    			</span><span class="NAME">self.getElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lt.replace</span><span class="PUNC">(</span><span class="REGX">/\r\n/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"&lt;br/>"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8033</span> </span><span class="WHIT">    		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8034</span> </span><span class="WHIT">    		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8035</span> </span><span class="WHIT">    			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">labelText</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8036</span> </span><span class="WHIT">    				</span><span class="NAME">labelText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">label</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8037</span> </span><span class="WHIT">    				</span><span class="NAME">self.getElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">labelText.replace</span><span class="PUNC">(</span><span class="REGX">/\r\n/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"&lt;br/>"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8038</span> </span><span class="WHIT">    			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8039</span> </span><span class="WHIT">    		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8040</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8041</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8042</span> </span><span class="WHIT">    	</span><span class="NAME">this.getLabel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8043</span> </span><span class="WHIT">    		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">label</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8044</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8045</span> </span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>8046</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">superGD</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDimensions</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8047</span> </span><span class="WHIT">		</span><span class="NAME">this.getDimensions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>8048</span> </span><span class="WHIT">    		</span><span class="NAME">_update</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8049</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">superGD</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8050</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8051</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8052</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8053</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8054</span> 
<span class='line'>8055</span> </span><span class="WHIT"> </span><span class="COMM">// ********************************* END OF OVERLAY DEFINITIONS ***********************************************************************</span><span class="WHIT">
<span class='line'>8056</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>8057</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">/*
<span class='line'>8058</span>  * jsPlumb
<span class='line'>8059</span>  *
<span class='line'>8060</span>  * Title:jsPlumb 1.3.15
<span class='line'>8061</span>  *
<span class='line'>8062</span>  * Provides a way to visually connect elements on an HTML page, using either SVG, Canvas
<span class='line'>8063</span>  * elements, or VML.
<span class='line'>8064</span>  *
<span class='line'>8065</span>  * This file contains the state machine connectors.
<span class='line'>8066</span>  *
<span class='line'>8067</span>  * Thanks to Brainstorm Mobile Solutions for supporting the development of these.
<span class='line'>8068</span>  *
<span class='line'>8069</span>  * Copyright (c) 2010 - 2012 Simon Porritt (simon.porritt@gmail.com)
<span class='line'>8070</span>  *
<span class='line'>8071</span>  * http://jsplumb.org
<span class='line'>8072</span>  * http://github.com/sporritt/jsplumb
<span class='line'>8073</span>  * http://code.google.com/p/jsplumb
<span class='line'>8074</span>  *
<span class='line'>8075</span>  * Dual licensed under the MIT and GPL2 licenses.
<span class='line'>8076</span>  */</span><span class="WHIT">
<span class='line'>8077</span> 
<span class='line'>8078</span> </span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8079</span> 
<span class='line'>8080</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Line</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8081</span> 
<span class='line'>8082</span> </span><span class="WHIT">		</span><span class="NAME">this.m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8083</span> </span><span class="WHIT">		</span><span class="NAME">this.b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.m</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8084</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8085</span> </span><span class="WHIT">		</span><span class="NAME">this.rectIntersect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8086</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">results</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8087</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8088</span> </span><span class="WHIT">			</span><span class="COMM">// 	try top face</span><span class="WHIT">
<span class='line'>8089</span> </span><span class="WHIT">			</span><span class="COMM">// 	the equation of the top face is y = (0 * x) + b; y = b.</span><span class="WHIT">
<span class='line'>8090</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xInt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">this.m</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8091</span> </span><span class="WHIT">			</span><span class="COMM">// test that the X value is in the line's range.</span><span class="WHIT">
<span class='line'>8092</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">xInt</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">xInt</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">results.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">xInt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.m</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">xInt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.b</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8093</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8094</span> </span><span class="WHIT">			</span><span class="COMM">// try right face</span><span class="WHIT">
<span class='line'>8095</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">yInt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.m</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.b</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8096</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">yInt</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">yInt</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">results.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">yInt</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">this.m</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">yInt</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8097</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8098</span> </span><span class="WHIT">			</span><span class="COMM">// 	bottom face</span><span class="WHIT">
<span class='line'>8099</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xInt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">this.m</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8100</span> </span><span class="WHIT">			</span><span class="COMM">// test that the X value is in the line's range.</span><span class="WHIT">
<span class='line'>8101</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">xInt</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">xInt</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">results.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">xInt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.m</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">xInt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.b</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8102</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8103</span> </span><span class="WHIT">			</span><span class="COMM">// try left face</span><span class="WHIT">
<span class='line'>8104</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">yInt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.m</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.b</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8105</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">yInt</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">yInt</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">results.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">yInt</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">this.m</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">yInt</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8106</span> 
<span class='line'>8107</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">results.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8108</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">midx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">results</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">results</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8109</span> </span><span class="WHIT">				</span><span class="NAME">results.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">midx</span><span class="PUNC">,</span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8110</span> </span><span class="WHIT">				</span><span class="COMM">// now calculate the segment inside the rectangle where the midpoint lies.</span><span class="WHIT">
<span class='line'>8111</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xseg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">midx</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8112</span> </span><span class="WHIT">					</span><span class="NAME">yseg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8113</span> </span><span class="WHIT">				</span><span class="NAME">results.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">xseg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">yseg</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8114</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8115</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8116</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8117</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8118</span> 
<span class='line'>8119</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8120</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8121</span> </span><span class="WHIT">	</span><span class="NAME">_segment</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8122</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8123</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8124</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8125</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8126</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8127</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8128</span> </span><span class="WHIT">		</span><span class="COMM">// the control point we will use depends on the faces to which each end of the connection is assigned, specifically whether or not the</span><span class="WHIT">
<span class='line'>8129</span> </span><span class="WHIT">		</span><span class="COMM">// two faces are parallel or perpendicular.  if they are parallel then the control point lies on the midpoint of the axis in which they</span><span class="WHIT">
<span class='line'>8130</span> </span><span class="WHIT">		</span><span class="COMM">// are parellel and varies only in the other axis; this variation is proportional to the distance that the anchor points lie from the</span><span class="WHIT">
<span class='line'>8131</span> </span><span class="WHIT">		</span><span class="COMM">// center of that face.  if the two faces are perpendicular then the control point is at some distance from both the midpoints; the amount and</span><span class="WHIT">
<span class='line'>8132</span> </span><span class="WHIT">		</span><span class="COMM">// direction are dependent on the orientation of the two elements. 'seg', passed in to this method, tells you which segment the target element</span><span class="WHIT">
<span class='line'>8133</span> </span><span class="WHIT">		</span><span class="COMM">// lies in with respect to the source: 1 is top right, 2 is bottom right, 3 is bottom left, 4 is top left.</span><span class="WHIT">
<span class='line'>8134</span> </span><span class="WHIT">		</span><span class="COMM">//</span><span class="WHIT">
<span class='line'>8135</span> </span><span class="WHIT">		</span><span class="COMM">// sourcePos and targetPos are arrays of info about where on the source and target each anchor is located.  their contents are:</span><span class="WHIT">
<span class='line'>8136</span> </span><span class="WHIT">		</span><span class="COMM">//</span><span class="WHIT">
<span class='line'>8137</span> </span><span class="WHIT">		</span><span class="COMM">// 0 - absolute x</span><span class="WHIT">
<span class='line'>8138</span> </span><span class="WHIT">		</span><span class="COMM">// 1 - absolute y</span><span class="WHIT">
<span class='line'>8139</span> </span><span class="WHIT">		</span><span class="COMM">// 2 - proportional x in element (0 is left edge, 1 is right edge)</span><span class="WHIT">
<span class='line'>8140</span> </span><span class="WHIT">		</span><span class="COMM">// 3 - proportional y in element (0 is top edge, 1 is bottom edge)</span><span class="WHIT">
<span class='line'>8141</span> </span><span class="WHIT">		</span><span class="COMM">// 	</span><span class="WHIT">
<span class='line'>8142</span> </span><span class="WHIT">	</span><span class="NAME">_findControlPoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">midx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">segment</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceEdge</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetEdge</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">distance</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">proximityLimit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8143</span> 
<span class='line'>8144</span> </span><span class="WHIT">        </span><span class="COMM">// TODO (maybe)</span><span class="WHIT">
<span class='line'>8145</span> </span><span class="WHIT">        </span><span class="COMM">// - if anchor pos is 0.5, make the control point take into account the relative position of the elements.</span><span class="WHIT">
<span class='line'>8146</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">distance</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">proximityLimit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">midx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8147</span> 
<span class='line'>8148</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8149</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceEdge</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">targetEdge</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">midx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceEdge</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8150</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceEdge</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">targetEdge</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">midx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceEdge</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8151</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">midx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8152</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8153</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8154</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceEdge</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">targetEdge</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">midx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceEdge</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8155</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceEdge</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">targetEdge</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">midx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceEdge</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8156</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">midx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8157</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8158</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8159</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceEdge</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">targetEdge</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">midx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceEdge</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8160</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceEdge</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">targetEdge</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">midx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceEdge</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8161</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">midx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8162</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8163</span> </span><span class="WHIT">        </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8164</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceEdge</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">targetEdge</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">midx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceEdge</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8165</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceEdge</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">targetEdge</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">midx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceEdge</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8166</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">midx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">midy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8167</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8168</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8169</span> 
<span class='line'>8170</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>8171</span>      * Class: Connectors.StateMachine
<span class='line'>8172</span>      * Provides 'state machine' connectors.
<span class='line'>8173</span>      */</span><span class="WHIT">
<span class='line'>8174</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>8175</span> 	 * Function: Constructor
<span class='line'>8176</span> 	 * 
<span class='line'>8177</span> 	 * Parameters:
<span class='line'>8178</span> 	 * curviness -	measure of how "curvy" the connectors will be.  this is translated as the distance that the
<span class='line'>8179</span>      *                Bezier curve's control point is from the midpoint of the straight line connecting the two
<span class='line'>8180</span>      *              endpoints, and does not mean that the connector is this wide.  The Bezier curve never reaches
<span class='line'>8181</span>      *              its control points; they act as gravitational masses. defaults to 10.
<span class='line'>8182</span> 	 * margin	-	distance from element to start and end connectors, in pixels.  defaults to 5.
<span class='line'>8183</span> 	 * proximityLimit  -   sets the distance beneath which the elements are consider too close together to bother
<span class='line'>8184</span> 	 *						with fancy curves. by default this is 80 pixels.
<span class='line'>8185</span> 	 * loopbackRadius	-	the radius of a loopback connector.  optional; defaults to 25.
<span class='line'>8186</span> 	 * showLoopback   -   If set to false this tells the connector that it is ok to paint connections whose source and target is the same element with a connector running through the element. The default value for this is true; the connector always makes a loopback connection loop around the element rather than passing through it.
<span class='line'>8187</span> 	*/</span><span class="WHIT">
<span class='line'>8188</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Connectors.StateMachine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8189</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8190</span> </span><span class="WHIT">		</span><span class="NAME">currentPoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8191</span> </span><span class="WHIT">		</span><span class="NAME">_sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_sy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_ty</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_controlPoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8192</span> </span><span class="WHIT">		</span><span class="NAME">curviness</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.curviness</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8193</span> </span><span class="WHIT">		</span><span class="NAME">margin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.margin</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8194</span> </span><span class="WHIT">		</span><span class="NAME">proximityLimit</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.proximityLimit</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">80</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8195</span> </span><span class="WHIT">		</span><span class="NAME">clockwise</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.orientation</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">params.orientation</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"clockwise"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8196</span> </span><span class="WHIT">		</span><span class="NAME">loopbackRadius</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.loopbackRadius</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">25</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8197</span> </span><span class="WHIT">		</span><span class="NAME">isLoopback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8198</span> </span><span class="WHIT">		</span><span class="NAME">showLoopback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.showLoopback</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8199</span> 
<span class='line'>8200</span> </span><span class="WHIT">		</span><span class="NAME">this.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"StateMachine"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8201</span> </span><span class="WHIT">		</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8202</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8203</span> </span><span class="WHIT">		</span><span class="NAME">this.compute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">minWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8204</span> 
<span class='line'>8205</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8206</span> </span><span class="WHIT">   	 	       	</span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8207</span> </span><span class="WHIT">	   	     	</span><span class="COMM">// these are padding to ensure the whole connector line appears</span><span class="WHIT">
<span class='line'>8208</span> </span><span class="WHIT">   	   	   		</span><span class="NAME">xo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.45</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">yo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.45</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8209</span> </span><span class="WHIT">   		   		</span><span class="COMM">// these are padding to ensure the whole connector line appears</span><span class="WHIT">
<span class='line'>8210</span> </span><span class="WHIT">            	</span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.9</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1.9</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8211</span> </span><span class="WHIT">                </span><span class="COMM">//ensure at least one pixel width</span><span class="WHIT">
<span class='line'>8212</span> </span><span class="WHIT">                </span><span class="NAME">lineWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8213</span> </span><span class="WHIT">            	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">xo</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8214</span> </span><span class="WHIT">        		    </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">yo</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8215</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8216</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">showLoopback</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceEndpoint.elementId</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">targetEndpoint.elementId</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8217</span> </span><span class="WHIT">                            </span><span class="WHIT">
<span class='line'>8218</span> </span><span class="WHIT">                </span><span class="NAME">isLoopback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8219</span> </span><span class="WHIT">                            </span><span class="WHIT">
<span class='line'>8220</span> </span><span class="WHIT">        		</span><span class="NAME">_sx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT">  </span><span class="NAME">xo</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">-</span><span class="NAME">xo</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8221</span> </span><span class="WHIT">            	</span><span class="NAME">_sy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">yo</span><span class="PUNC">:</span><span class="NAME">h</span><span class="PUNC">-</span><span class="NAME">yo</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8222</span> </span><span class="WHIT">            	</span><span class="NAME">_tx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">-</span><span class="NAME">xo</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">xo</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8223</span> </span><span class="WHIT">            	</span><span class="NAME">_ty</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">-</span><span class="NAME">yo</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">yo</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8224</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>8225</span> </span><span class="WHIT">            	</span><span class="COMM">// now adjust for the margin</span><span class="WHIT">
<span class='line'>8226</span> </span><span class="WHIT">            	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_sx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">margin</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8227</span> </span><span class="WHIT">            	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_sx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">margin</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8228</span> </span><span class="WHIT">            	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_sy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">margin</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8229</span> </span><span class="WHIT">            	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_sy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">margin</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8230</span> </span><span class="WHIT">            	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_tx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">margin</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8231</span> </span><span class="WHIT">            	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_tx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">margin</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8232</span> </span><span class="WHIT">            	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_ty</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">margin</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8233</span> </span><span class="WHIT">            	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetPos</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_ty</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">margin</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8234</span> 
<span class='line'>8235</span> </span><span class="WHIT">            	</span><span class="COMM">//</span><span class="WHIT">
<span class='line'>8236</span> </span><span class="WHIT">	            </span><span class="COMM">// these connectors are quadratic bezier curves, having a single control point. if both anchors </span><span class="WHIT">
<span class='line'>8237</span> </span><span class="WHIT">    	        </span><span class="COMM">// are located at 0.5 on their respective faces, the control point is set to the midpoint and you</span><span class="WHIT">
<span class='line'>8238</span> </span><span class="WHIT">        	    </span><span class="COMM">// get a straight line.  this is also the case if the two anchors are within 'proximityLimit', since</span><span class="WHIT">
<span class='line'>8239</span> </span><span class="WHIT">           	 	</span><span class="COMM">// it seems to make good aesthetic sense to do that. outside of that, the control point is positioned </span><span class="WHIT">
<span class='line'>8240</span> </span><span class="WHIT">           	 	</span><span class="COMM">// at 'curviness' pixels away along the normal to the straight line connecting the two anchors.</span><span class="WHIT">
<span class='line'>8241</span> </span><span class="WHIT">	            </span><span class="COMM">// </span><span class="WHIT">
<span class='line'>8242</span> </span><span class="WHIT">   	        	</span><span class="COMM">// there may be two improvements to this.  firstly, we might actually support the notion of avoiding nodes</span><span class="WHIT">
<span class='line'>8243</span> </span><span class="WHIT">            	</span><span class="COMM">// in the UI, or at least making a good effort at doing so.  if a connection would pass underneath some node,</span><span class="WHIT">
<span class='line'>8244</span> </span><span class="WHIT">            	</span><span class="COMM">// for example, we might increase the distance the control point is away from the midpoint in a bid to</span><span class="WHIT">
<span class='line'>8245</span> </span><span class="WHIT">            	</span><span class="COMM">// steer it around that node.  this will work within limits, but i think those limits would also be the likely</span><span class="WHIT">
<span class='line'>8246</span> </span><span class="WHIT">            	</span><span class="COMM">// limits for, once again, aesthetic good sense in the layout of a chart using these connectors.</span><span class="WHIT">
<span class='line'>8247</span> </span><span class="WHIT">            	</span><span class="COMM">//</span><span class="WHIT">
<span class='line'>8248</span> </span><span class="WHIT">            	</span><span class="COMM">// the second possible change is actually two possible changes: firstly, it is possible we should gradually</span><span class="WHIT">
<span class='line'>8249</span> </span><span class="WHIT">            	</span><span class="COMM">// decrease the 'curviness' as the distance between the anchors decreases; start tailing it off to 0 at some</span><span class="WHIT">
<span class='line'>8250</span> </span><span class="WHIT">            	</span><span class="COMM">// point (which should be configurable).  secondly, we might slightly increase the 'curviness' for connectors</span><span class="WHIT">
<span class='line'>8251</span> </span><span class="WHIT">            	</span><span class="COMM">// with respect to how far their anchor is from the center of its respective face. this could either look cool,</span><span class="WHIT">
<span class='line'>8252</span> </span><span class="WHIT">            	</span><span class="COMM">// or stupid, and may indeed work only in a way that is so subtle as to have been a waste of time.</span><span class="WHIT">
<span class='line'>8253</span> </span><span class="WHIT">            	</span><span class="COMM">//</span><span class="WHIT">
<span class='line'>8254</span> 
<span class='line'>8255</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_midx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_sx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_tx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_midy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_sy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>8256</span> </span><span class="WHIT">            	    </span><span class="NAME">m2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">_midx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">_midy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">theta2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.atan</span><span class="PUNC">(</span><span class="NAME">m2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8257</span> </span><span class="WHIT">            	    </span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="PUNC">(</span><span class="NAME">m2</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Infinity</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">m2</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">Infinity</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">curviness</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">theta2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8258</span> </span><span class="WHIT">				    </span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="PUNC">(</span><span class="NAME">m2</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Infinity</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">m2</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">Infinity</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">curviness</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">theta2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8259</span> </span><span class="WHIT">				    </span><span class="NAME">segment</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_segment</span><span class="PUNC">(</span><span class="NAME">_sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_sy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_ty</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8260</span> </span><span class="WHIT">				    </span><span class="NAME">distance</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">_tx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">_sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">_ty</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">_sy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8261</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>8262</span> </span><span class="WHIT">            	</span><span class="COMM">// calculate the control point.  this code will be where we'll put in a rudimentary element avoidance scheme; it</span><span class="WHIT">
<span class='line'>8263</span> </span><span class="WHIT">            	</span><span class="COMM">// will work by extending the control point to force the curve to be, um, curvier.</span><span class="WHIT">
<span class='line'>8264</span> </span><span class="WHIT">				</span><span class="NAME">_controlPoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_findControlPoint</span><span class="PUNC">(</span><span class="NAME">_midx</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8265</span> </span><span class="WHIT">                                                  </span><span class="NAME">_midy</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8266</span> </span><span class="WHIT">                                                  </span><span class="NAME">segment</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8267</span> </span><span class="WHIT">                                                  </span><span class="NAME">sourcePos</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8268</span> </span><span class="WHIT">                                                  </span><span class="NAME">targetPos</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8269</span> </span><span class="WHIT">                                                  </span><span class="NAME">curviness</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curviness</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8270</span> </span><span class="WHIT">                                                  </span><span class="NAME">distance</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8271</span> </span><span class="WHIT">                                                  </span><span class="NAME">proximityLimit</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8272</span> 
<span class='line'>8273</span> </span><span class="WHIT">	            	</span><span class="WHIT">
<span class='line'>8274</span> </span><span class="WHIT">            	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">requiredWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">_controlPoint</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">_sx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">_controlPoint</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">_tx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">_tx</span><span class="PUNC">-</span><span class="NAME">_sx</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">minWidth</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8275</span> </span><span class="WHIT">            		</span><span class="NAME">requiredHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">_controlPoint</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">_sy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">_controlPoint</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">_ty</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">_ty</span><span class="PUNC">-</span><span class="NAME">_sy</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">minWidth</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8276</span> 
<span class='line'>8277</span> </span><span class="WHIT">            	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">requiredWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">      	</span><span class="WHIT">
<span class='line'>8278</span> </span><span class="WHIT">            		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dw</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">requiredWidth</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">;</span><span class="WHIT">            		</span><span class="WHIT">
<span class='line'>8279</span> </span><span class="WHIT">            		</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dw</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8280</span> </span><span class="WHIT">            		</span><span class="NAME">_sx</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dw</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8281</span> </span><span class="WHIT">            		</span><span class="NAME">_tx</span><span class="WHIT">  </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dw</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8282</span> </span><span class="WHIT">            		</span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">requiredWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8283</span> </span><span class="WHIT">                    </span><span class="NAME">_controlPoint</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dw</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8284</span> </span><span class="WHIT">            	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8285</span> </span><span class="WHIT">            	</span><span class="WHIT">
<span class='line'>8286</span> </span><span class="WHIT">            	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">requiredHeight</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8287</span> </span><span class="WHIT">            		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">requiredHeight</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8288</span> </span><span class="WHIT">            		</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dh</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8289</span> </span><span class="WHIT">            		</span><span class="NAME">_sy</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dh</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8290</span> </span><span class="WHIT">            		</span><span class="NAME">_ty</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dh</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8291</span> </span><span class="WHIT">            		</span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">requiredHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8292</span> </span><span class="WHIT">                    </span><span class="NAME">_controlPoint</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dh</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8293</span> </span><span class="WHIT">            	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8294</span> </span><span class="WHIT">            	</span><span class="NAME">currentPoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_sy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_ty</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_controlPoint</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_controlPoint</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">                                        </span><span class="WHIT">
<span class='line'>8295</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8296</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8297</span> </span><span class="WHIT">            	</span><span class="NAME">isLoopback</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8298</span> </span><span class="WHIT">            	</span><span class="COMM">// a loopback connector.  draw an arc from one anchor to the other.</span><span class="WHIT">
<span class='line'>8299</span> </span><span class="WHIT">            	</span><span class="COMM">// i guess we'll do this the same way as the others.  just the control point will be a fair distance away.</span><span class="WHIT">
<span class='line'>8300</span> </span><span class="WHIT">        		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">margin</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourcePos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">margin</span><span class="PUNC">,</span><span class="WHIT"> 				</span><span class="WHIT">
<span class='line'>8301</span> </span><span class="WHIT">					</span><span class="NAME">cx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">loopbackRadius</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8302</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>8303</span> </span><span class="WHIT">				</span><span class="COMM">// canvas sizing stuff, to ensure the whole painted area is visible.</span><span class="WHIT">
<span class='line'>8304</span> </span><span class="WHIT">				</span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">4</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loopbackRadius</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">4</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loopbackRadius</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8305</span> </span><span class="WHIT">				</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">loopbackRadius</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">loopbackRadius</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">loopbackRadius</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">loopbackRadius</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8306</span> </span><span class="WHIT">				</span><span class="NAME">currentPoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cx</span><span class="PUNC">-</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cy</span><span class="PUNC">-</span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loopbackRadius</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clockwise</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="PUNC">-</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="PUNC">-</span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="PUNC">-</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="PUNC">-</span><span class="NAME">y</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8307</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8308</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>8309</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">currentPoints</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8310</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8311</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>8312</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_makeCurve</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8313</span> </span><span class="WHIT">        	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8314</span> </span><span class="WHIT">	        	</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">_tx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">_ty</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8315</span> </span><span class="WHIT">	        	</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">_controlPoint</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">_controlPoint</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8316</span> </span><span class="WHIT">	        	</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">_controlPoint</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">_controlPoint</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">	        	</span><span class="WHIT">
<span class='line'>8317</span> </span><span class="WHIT">	        	</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">_sx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">_sy</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8318</span> </span><span class="WHIT">         	</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8319</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">     </span><span class="WHIT">
<span class='line'>8320</span> 
<span class='line'>8321</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_translateLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">curve</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8322</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>8323</span> </span><span class="WHIT">                </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsBezier.locationAlongCurveFrom</span><span class="PUNC">(</span><span class="NAME">curve</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8324</span> 
<span class='line'>8325</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8326</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8327</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>8328</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>8329</span>          * returns the point on the connector's path that is 'location' along the length of the path, where 'location' is a decimal from
<span class='line'>8330</span>          * 0 to 1 inclusive. for the straight line connector this is simple maths.  for Bezier, not so much.
<span class='line'>8331</span>          */</span><span class="WHIT">
<span class='line'>8332</span> </span><span class="WHIT">        </span><span class="NAME">this.pointOnPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">   </span><span class="WHIT">
<span class='line'>8333</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isLoopback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8334</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8335</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">circumference</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loopbackRadius</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8336</span> </span><span class="WHIT">					</span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">circumference</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8337</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8338</span> 
<span class='line'>8339</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8340</span> </span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>8341</span> </span><span class="COMM">// current points are [ x, y, width, height, center x, center y, radius, clockwise, startx, starty, endx, endy ]				</span><span class="WHIT">
<span class='line'>8342</span> </span><span class="WHIT">				</span><span class="COMM">// so the path length is the circumference of the circle</span><span class="WHIT">
<span class='line'>8343</span> </span><span class="WHIT">				</span><span class="COMM">//var len = 2 * Math.PI * currentPoints[6],</span><span class="WHIT">
<span class='line'>8344</span> </span><span class="WHIT">				</span><span class="COMM">// map 'location' to an angle. 0 is PI/2 when the connector is on the top face; if we</span><span class="WHIT">
<span class='line'>8345</span> </span><span class="WHIT">				</span><span class="COMM">// support other faces it will have to be calculated for each one. 1 is also PI/2.</span><span class="WHIT">
<span class='line'>8346</span> </span><span class="WHIT">				</span><span class="COMM">// 0.5 is -PI/2.</span><span class="WHIT">
<span class='line'>8347</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">startAngle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8348</span> </span><span class="WHIT">					</span><span class="NAME">startX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentPoints</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentPoints</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">startAngle</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8349</span> </span><span class="WHIT">					</span><span class="NAME">startY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentPoints</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentPoints</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">startAngle</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>8350</span> 
<span class='line'>8351</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">startX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">startY</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8352</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>8353</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8354</span> </span><span class="WHIT">        	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8355</span> </span><span class="WHIT">        		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_makeCurve</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8356</span> </span><span class="WHIT">        		</span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_translateLocation</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8357</span> </span><span class="WHIT">	        	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsBezier.pointOnCurve</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8358</span> </span><span class="WHIT">	        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8359</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8360</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>8361</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>8362</span>          * returns the gradient of the connector at the given point.
<span class='line'>8363</span>          */</span><span class="WHIT">
<span class='line'>8364</span> </span><span class="WHIT">        </span><span class="NAME">this.gradientAtPoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8365</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isLoopback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8366</span> </span><span class="WHIT">				</span><span class="COMM">// todo if absolute, location is a proportion of circumference</span><span class="WHIT">
<span class='line'>8367</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8368</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">circumference</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loopbackRadius</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8369</span> </span><span class="WHIT">					</span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">circumference</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8370</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8371</span> 
<span class='line'>8372</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.atan</span><span class="PUNC">(</span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8373</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8374</span> </span><span class="WHIT">        	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8375</span> </span><span class="WHIT">        		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_makeCurve</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8376</span> </span><span class="WHIT">        		</span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_translateLocation</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8377</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsBezier.gradientAtPoint</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8378</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8379</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">	        </span><span class="WHIT">
<span class='line'>8380</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>8381</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>8382</span>          * for Bezier curves this method is a little tricky, cos calculating path distance algebraically is notoriously difficult.
<span class='line'>8383</span>          * this method is iterative, jumping forward .05% of the path at a time and summing the distance between this point and the previous
<span class='line'>8384</span>          * one, until the sum reaches 'distance'. the method may turn out to be computationally expensive; we'll see.
<span class='line'>8385</span>          * another drawback of this method is that if the connector gets quite long, .05% of the length of it is not necessarily smaller
<span class='line'>8386</span>          * than the desired distance, in which case the loop returns immediately and the arrow is mis-shapen. so a better strategy might be to
<span class='line'>8387</span>          * calculate the step as a function of distance/distance between endpoints.  
<span class='line'>8388</span>          */</span><span class="WHIT">
<span class='line'>8389</span> </span><span class="WHIT">        </span><span class="NAME">this.pointAlongPathFrom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">distance</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">        	</span><span class="WHIT">
<span class='line'>8390</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isLoopback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8391</span> 
<span class='line'>8392</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8393</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">circumference</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">loopbackRadius</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8394</span> </span><span class="WHIT">					</span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">circumference</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8395</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8396</span> 
<span class='line'>8397</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8398</span> 
<span class='line'>8399</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">circumference</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">currentPoints</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8400</span> </span><span class="WHIT">					</span><span class="NAME">arcSpan</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">distance</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">circumference</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8401</span> </span><span class="WHIT">					</span><span class="NAME">startAngle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">arcSpan</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8402</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>8403</span> </span><span class="WHIT">					</span><span class="NAME">startX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentPoints</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentPoints</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">startAngle</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8404</span> </span><span class="WHIT">					</span><span class="NAME">startY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">currentPoints</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">currentPoints</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">startAngle</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8405</span> 
<span class='line'>8406</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">startX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">startY</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8407</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8408</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8409</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_makeCurve</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8410</span> </span><span class="WHIT">        		</span><span class="NAME">location</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_translateLocation</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">absolute</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8411</span> </span><span class="WHIT">        		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsBezier.pointAlongCurveFrom</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">location</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">distance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8412</span> </span><span class="WHIT">        	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8413</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">                       </span><span class="WHIT">
<span class='line'>8414</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8415</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8416</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8417</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>8418</span>      * Canvas state machine renderer. 
<span class='line'>8419</span>      */</span><span class="WHIT">
<span class='line'>8420</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Connectors.canvas.StateMachine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">   	 </span><span class="WHIT">
<span class='line'>8421</span> </span><span class="WHIT">    	</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8422</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">drawGuideline</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.drawGuideline</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">avoidSelector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.avoidSelector</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8423</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.Connectors.StateMachine.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8424</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.CanvasConnector.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8425</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8426</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8427</span> </span><span class="WHIT">		</span><span class="NAME">this._paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8428</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>8429</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dimensions.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8430</span> </span><span class="WHIT">		        </span><span class="NAME">self.ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8431</span> </span><span class="WHIT">				</span><span class="NAME">self.ctx.moveTo</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8432</span> </span><span class="WHIT">				</span><span class="NAME">self.ctx.bezierCurveTo</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8433</span> </span><span class="WHIT">				</span><span class="NAME">self.ctx.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">            				</span><span class="WHIT">
<span class='line'>8434</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8435</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8436</span> </span><span class="WHIT">				</span><span class="COMM">// a loopback connector</span><span class="WHIT">
<span class='line'>8437</span> </span><span class="WHIT">				</span><span class="NAME">self.ctx.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8438</span> </span><span class="WHIT">				</span><span class="NAME">self.ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">        	</span><span class="WHIT">
<span class='line'>8439</span> </span><span class="WHIT">	        	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">startAngle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">                     </span><span class="COMM">// Starting point on circle</span><span class="WHIT">
<span class='line'>8440</span> </span><span class="WHIT">	        	</span><span class="NAME">endAngle</span><span class="WHIT">   </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// End point on circle</span><span class="WHIT">
<span class='line'>8441</span> </span><span class="WHIT">	        	</span><span class="NAME">clockwise</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// clockwise or anticlockwise </span><span class="WHIT">
<span class='line'>8442</span> </span><span class="WHIT">	        	</span><span class="NAME">self.ctx.arc</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endAngle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clockwise</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8443</span> </span><span class="WHIT">				</span><span class="NAME">self.ctx.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8444</span> </span><span class="WHIT">				</span><span class="NAME">self.ctx.closePath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8445</span> </span><span class="WHIT">				</span><span class="NAME">self.ctx.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8446</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8447</span> </span><span class="WHIT">	    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">	    </span><span class="WHIT">
<span class='line'>8448</span> </span><span class="WHIT">	    </span><span class="WHIT">
<span class='line'>8449</span> </span><span class="WHIT">	    </span><span class="NAME">this.createGradient</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dim</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8450</span> </span><span class="WHIT">        	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ctx.createLinearGradient</span><span class="PUNC">(</span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8451</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8452</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8453</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>8454</span> </span><span class="WHIT">    </span><span class="COMM">/*
<span class='line'>8455</span>      * SVG State Machine renderer
<span class='line'>8456</span>      */</span><span class="WHIT">
<span class='line'>8457</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Connectors.svg.StateMachine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">   	 </span><span class="WHIT">
<span class='line'>8458</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8459</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.Connectors.StateMachine.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8460</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.SvgConnector.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8461</span> </span><span class="WHIT">		</span><span class="NAME">this.getPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> 	</span><span class="WHIT">
<span class='line'>8462</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>8463</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>8464</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"M "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" C "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>8465</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8466</span> </span><span class="WHIT">				</span><span class="COMM">// loopback</span><span class="WHIT">
<span class='line'>8467</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"M"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" A "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" 0 1,0 "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">-</span><span class="NUMB">4</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>8468</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8469</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">	    	    </span><span class="WHIT">
<span class='line'>8470</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8471</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>8472</span> </span><span class="WHIT">    </span><span class="COMM">/*
<span class='line'>8473</span>      * VML state machine renderer
<span class='line'>8474</span>      */</span><span class="WHIT">
<span class='line'>8475</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Connectors.vml.StateMachine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8476</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.Connectors.StateMachine.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8477</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.VmlConnector.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8478</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.vml.convertValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8479</span> </span><span class="WHIT">		</span><span class="NAME">this.getPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8480</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">10</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8481</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"m"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>8482</span> </span><span class="WHIT">					   </span><span class="STRN">" c"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" e"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8483</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8484</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8485</span> </span><span class="WHIT">				</span><span class="COMM">// loopback</span><span class="WHIT">
<span class='line'>8486</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">left</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8487</span> </span><span class="WHIT">					</span><span class="NAME">top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8488</span> </span><span class="WHIT">					</span><span class="NAME">right</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8489</span> </span><span class="WHIT">					</span><span class="NAME">bottom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8490</span> </span><span class="WHIT">					</span><span class="NAME">posString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">right</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">bottom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8491</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>8492</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"ar "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">posString</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT">
<span class='line'>8493</span> </span><span class="WHIT">						</span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" e"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8494</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>8495</span> </span><span class="WHIT">				 </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8496</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8497</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8498</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8499</span> 
<span class='line'>8500</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8501</span> 
<span class='line'>8502</span> </span><span class="COMM">/*
<span class='line'>8503</span>     	// now for a rudimentary avoidance scheme. TODO: how to set this in a cross-library way?
<span class='line'>8504</span>         //      if (avoidSelector) {
<span class='line'>8505</span> 		//		    var testLine = new Line(sourcePos[0] + _sx,sourcePos[1] + _sy,sourcePos[0] + _tx,sourcePos[1] + _ty);
<span class='line'>8506</span> 		//		    var sel = jsPlumb.getSelector(avoidSelector);
<span class='line'>8507</span> 		//		    for (var i = 0; i &lt; sel.length; i++) {
<span class='line'>8508</span> 		//			    var id = jsPlumb.getId(sel[i]);
<span class='line'>8509</span> 		//			    if (id != sourceEndpoint.elementId && id != targetEndpoint.elementId) {
<span class='line'>8510</span> 		//				    o = jsPlumb.getOffset(id), s = jsPlumb.getSize(id);
<span class='line'>8511</span> //
<span class='line'>8512</span> //						    if (o && s) {
<span class='line'>8513</span> //							    var collision = testLine.rectIntersect(o.left,o.top,s[0],s[1]);
<span class='line'>8514</span> //							    if (collision) {
<span class='line'>8515</span> 								    // set the control point to be a certain distance from the midpoint of the two points that
<span class='line'>8516</span> 								    // the line crosses on the rectangle.
<span class='line'>8517</span> 								    // TODO where will this 75 number come from?
<span class='line'>8518</span> 					//			    _controlX = collision[2][0] + (75 * collision[3][0]);
<span class='line'>8519</span> 				//	/			    _controlY = collision[2][1] + (75 * collision[3][1]);
<span class='line'>8520</span> //							    }
<span class='line'>8521</span> //						    }
<span class='line'>8522</span> 					//  }
<span class='line'>8523</span> 	//			    }
<span class='line'>8524</span>               //}
<span class='line'>8525</span>     */</span><span class="COMM">/*
<span class='line'>8526</span>  * jsPlumb
<span class='line'>8527</span>  * 
<span class='line'>8528</span>  * Title:jsPlumb 1.3.15
<span class='line'>8529</span>  * 
<span class='line'>8530</span>  * Provides a way to visually connect elements on an HTML page, using either SVG, Canvas
<span class='line'>8531</span>  * elements, or VML.  
<span class='line'>8532</span>  * 
<span class='line'>8533</span>  * This file contains the VML renderers.
<span class='line'>8534</span>  *
<span class='line'>8535</span>  * Copyright (c) 2010 - 2012 Simon Porritt (http://jsplumb.org)
<span class='line'>8536</span>  * 
<span class='line'>8537</span>  * http://jsplumb.org
<span class='line'>8538</span>  * http://github.com/sporritt/jsplumb
<span class='line'>8539</span>  * http://code.google.com/p/jsplumb
<span class='line'>8540</span>  * 
<span class='line'>8541</span>  * Dual licensed under the MIT and GPL2 licenses.
<span class='line'>8542</span>  */</span><span class="WHIT">
<span class='line'>8543</span> 
<span class='line'>8544</span> </span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8545</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8546</span> </span><span class="WHIT">	</span><span class="COMM">// http://ajaxian.com/archives/the-vml-changes-in-ie-8</span><span class="WHIT">
<span class='line'>8547</span> </span><span class="WHIT">	</span><span class="COMM">// http://www.nczonline.net/blog/2010/01/19/internet-explorer-8-document-and-browser-modes/</span><span class="WHIT">
<span class='line'>8548</span> </span><span class="WHIT">	</span><span class="COMM">// http://www.louisremi.com/2009/03/30/changes-in-vml-for-ie8-or-what-feature-can-the-ie-dev-team-break-for-you-today/</span><span class="WHIT">
<span class='line'>8549</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8550</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vmlAttributeMap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8551</span> </span><span class="WHIT">		</span><span class="STRN">"stroke-linejoin"</span><span class="PUNC">:</span><span class="STRN">"joinstyle"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8552</span> </span><span class="WHIT">		</span><span class="STRN">"joinstyle"</span><span class="PUNC">:</span><span class="STRN">"joinstyle"</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8553</span> </span><span class="WHIT">		</span><span class="STRN">"endcap"</span><span class="PUNC">:</span><span class="STRN">"endcap"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8554</span> </span><span class="WHIT">		</span><span class="STRN">"miterlimit"</span><span class="PUNC">:</span><span class="STRN">"miterlimit"</span><span class="WHIT">
<span class='line'>8555</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8556</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumbStylesheet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8557</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8558</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">document.createStyleSheet</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">document.namespaces</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>8559</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8560</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ruleClasses</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>8561</span> </span><span class="WHIT">				</span><span class="STRN">".jsplumb_vml"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"jsplumb\\:textbox"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"jsplumb\\:oval"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"jsplumb\\:rect"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>8562</span> </span><span class="WHIT">				</span><span class="STRN">"jsplumb\\:stroke"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"jsplumb\\:shape"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"jsplumb\\:group"</span><span class="WHIT">
<span class='line'>8563</span> </span><span class="WHIT">			</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8564</span> </span><span class="WHIT">			</span><span class="NAME">rule</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"behavior:url(#default#VML);position:absolute;"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8565</span> 
<span class='line'>8566</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumbStylesheet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createStyleSheet</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8567</span> 
<span class='line'>8568</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ruleClasses.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>8569</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumbStylesheet.addRule</span><span class="PUNC">(</span><span class="NAME">ruleClasses</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rule</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8570</span> 
<span class='line'>8571</span> </span><span class="WHIT">		</span><span class="COMM">// in this page it is also mentioned that IE requires the extra arg to the namespace</span><span class="WHIT">
<span class='line'>8572</span> </span><span class="WHIT">		</span><span class="COMM">// http://www.louisremi.com/2009/03/30/changes-in-vml-for-ie8-or-what-feature-can-the-ie-dev-team-break-for-you-today/</span><span class="WHIT">
<span class='line'>8573</span> </span><span class="WHIT">		</span><span class="COMM">// but someone commented saying they didn't need it, and it seems jsPlumb doesnt need it either.</span><span class="WHIT">
<span class='line'>8574</span> </span><span class="WHIT">		</span><span class="COMM">// var iev = document.documentMode;</span><span class="WHIT">
<span class='line'>8575</span> </span><span class="WHIT">		</span><span class="COMM">//if (!iev || iev &lt; 8)</span><span class="WHIT">
<span class='line'>8576</span> </span><span class="WHIT">			</span><span class="NAME">document.namespaces.add</span><span class="PUNC">(</span><span class="STRN">"jsplumb"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"urn:schemas-microsoft-com:vml"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8577</span> </span><span class="WHIT">		</span><span class="COMM">//else</span><span class="WHIT">
<span class='line'>8578</span> </span><span class="WHIT">		</span><span class="COMM">//	document.namespaces.add("jsplumb", "urn:schemas-microsoft-com:vml", "#default#VML");</span><span class="WHIT">
<span class='line'>8579</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8580</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8581</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.vml</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8582</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8583</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1000</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8584</span> 
<span class='line'>8585</span> </span><span class="WHIT">    </span><span class="NAME">_groupMap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8586</span> </span><span class="WHIT">    </span><span class="NAME">_getGroup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">container</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectorClass</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8587</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.getId</span><span class="PUNC">(</span><span class="NAME">container</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8588</span> </span><span class="WHIT">            </span><span class="NAME">g</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_groupMap</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8589</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">g</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8590</span> </span><span class="WHIT">            </span><span class="NAME">g</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="STRN">"group"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">scale</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="STRN">"class"</span><span class="PUNC">:</span><span class="NAME">connectorClass</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8591</span> </span><span class="WHIT">            </span><span class="COMM">//g.style.position=absolute;</span><span class="WHIT">
<span class='line'>8592</span> </span><span class="WHIT">            </span><span class="COMM">//g["coordsize"] = "1000,1000";</span><span class="WHIT">
<span class='line'>8593</span> </span><span class="WHIT">            </span><span class="NAME">g.style.backgroundColor</span><span class="PUNC">=</span><span class="STRN">"red"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8594</span> </span><span class="WHIT">            </span><span class="NAME">_groupMap</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8595</span> </span><span class="WHIT">            </span><span class="NAME">jsPlumb.appendElement</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">container</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// todo if this gets reinstated, remember to use the current jsplumb instance.</span><span class="WHIT">
<span class='line'>8596</span> </span><span class="WHIT">            </span><span class="COMM">//document.body.appendChild(g);</span><span class="WHIT">
<span class='line'>8597</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8598</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8599</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8600</span> </span><span class="WHIT">	</span><span class="NAME">_atts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">atts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8601</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">atts</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>8602</span> </span><span class="WHIT">			</span><span class="COMM">// IE8 fix: setattribute does not work after an element has been added to the dom!</span><span class="WHIT">
<span class='line'>8603</span> </span><span class="WHIT">			</span><span class="COMM">// http://www.louisremi.com/2009/03/30/changes-in-vml-for-ie8-or-what-feature-can-the-ie-dev-team-break-for-you-today/</span><span class="WHIT">
<span class='line'>8604</span> </span><span class="WHIT">			</span><span class="COMM">//o.setAttribute(i, atts[i]);</span><span class="WHIT">
<span class='line'>8605</span> 
<span class='line'>8606</span> </span><span class="WHIT">			</span><span class="COMM">/*There is an additional problem when accessing VML elements by using get/setAttribute. The simple solution is following:
<span class='line'>8607</span> 
<span class='line'>8608</span> 			if (document.documentMode==8) {
<span class='line'>8609</span> 			ele.opacity=1;
<span class='line'>8610</span> 			} else {
<span class='line'>8611</span> 			ele.setAttribute(‘opacity’,1);
<span class='line'>8612</span> 			}
<span class='line'>8613</span> 			*/</span><span class="WHIT">
<span class='line'>8614</span> 
<span class='line'>8615</span> </span><span class="WHIT">			</span><span class="NAME">o</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">atts</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8616</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8617</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8618</span> </span><span class="WHIT">	</span><span class="NAME">_node</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">atts</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_jsPlumb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">deferToJsPlumbContainer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8619</span> </span><span class="WHIT">		</span><span class="NAME">atts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">atts</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8620</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"jsplumb:"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8621</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">deferToJsPlumbContainer</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>8622</span> </span><span class="WHIT">			</span><span class="NAME">_jsPlumb.appendElement</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8623</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>8624</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.CurrentLibrary.appendElement</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8625</span> </span><span class="WHIT">		</span><span class="NAME">o.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">atts</span><span class="PUNC">[</span><span class="STRN">"class"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">atts</span><span class="PUNC">[</span><span class="STRN">"class"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"jsplumb_vml"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8626</span> </span><span class="WHIT">		</span><span class="NAME">_pos</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8627</span> </span><span class="WHIT">		</span><span class="NAME">_atts</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">atts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8628</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8629</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8630</span> </span><span class="WHIT">	</span><span class="NAME">_pos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">zIndex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8631</span> </span><span class="WHIT">		</span><span class="NAME">o.style.left</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8632</span> </span><span class="WHIT">		</span><span class="NAME">o.style.top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8633</span> </span><span class="WHIT">		</span><span class="NAME">o.style.width</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8634</span> </span><span class="WHIT">		</span><span class="NAME">o.style.height</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8635</span> </span><span class="WHIT">		</span><span class="NAME">o.style.position</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"absolute"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8636</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">zIndex</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>8637</span> </span><span class="WHIT">			</span><span class="NAME">o.style.zIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">zIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8638</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8639</span> </span><span class="WHIT">	</span><span class="NAME">_conv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.vml.convertValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8640</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8641</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8642</span> </span><span class="WHIT">	</span><span class="COMM">// tests if the given style is "transparent" and then sets the appropriate opacity node to 0 if so,</span><span class="WHIT">
<span class='line'>8643</span> </span><span class="WHIT">	</span><span class="COMM">// or 1 if not.  TODO in the future, support variable opacity.</span><span class="WHIT">
<span class='line'>8644</span> </span><span class="WHIT">	</span><span class="NAME">_maybeSetOpacity</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">styleToWrite</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">styleToCheck</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">component</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8645</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"transparent"</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">styleToCheck</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>8646</span> </span><span class="WHIT">			</span><span class="NAME">component.setOpacity</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"0.0"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8647</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>8648</span> </span><span class="WHIT">			</span><span class="NAME">component.setOpacity</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"1.0"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8649</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8650</span> </span><span class="WHIT">	</span><span class="NAME">_applyStyles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">component</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_jsPlumb</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8651</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">styleToWrite</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8652</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style.strokeStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8653</span> </span><span class="WHIT">			</span><span class="NAME">styleToWrite</span><span class="PUNC">[</span><span class="STRN">"stroked"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"true"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8654</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">strokeColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.convertStyle</span><span class="PUNC">(</span><span class="NAME">style.strokeStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8655</span> </span><span class="WHIT">			</span><span class="NAME">styleToWrite</span><span class="PUNC">[</span><span class="STRN">"strokecolor"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">strokeColor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8656</span> </span><span class="WHIT">			</span><span class="NAME">_maybeSetOpacity</span><span class="PUNC">(</span><span class="NAME">styleToWrite</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">strokeColor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">component</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8657</span> </span><span class="WHIT">			</span><span class="NAME">styleToWrite</span><span class="PUNC">[</span><span class="STRN">"strokeweight"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style.lineWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8658</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8659</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">styleToWrite</span><span class="PUNC">[</span><span class="STRN">"stroked"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"false"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8660</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8661</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style.fillStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8662</span> </span><span class="WHIT">			</span><span class="NAME">styleToWrite</span><span class="PUNC">[</span><span class="STRN">"filled"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"true"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8663</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fillColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.convertStyle</span><span class="PUNC">(</span><span class="NAME">style.fillStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8664</span> </span><span class="WHIT">			</span><span class="NAME">styleToWrite</span><span class="PUNC">[</span><span class="STRN">"fillcolor"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fillColor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8665</span> </span><span class="WHIT">			</span><span class="NAME">_maybeSetOpacity</span><span class="PUNC">(</span><span class="NAME">styleToWrite</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fillColor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">component</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8666</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8667</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">styleToWrite</span><span class="PUNC">[</span><span class="STRN">"filled"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"false"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8668</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8669</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">[</span><span class="STRN">"dashstyle"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8670</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">component.strokeNode</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8671</span> </span><span class="WHIT">				</span><span class="NAME">component.strokeNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">dashstyle</span><span class="PUNC">:</span><span class="NAME">style</span><span class="PUNC">[</span><span class="STRN">"dashstyle"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_jsPlumb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>8672</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8673</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>8674</span> </span><span class="WHIT">				</span><span class="NAME">component.strokeNode.dashstyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">[</span><span class="STRN">"dashstyle"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8675</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>8676</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">[</span><span class="STRN">"stroke-dasharray"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">[</span><span class="STRN">"lineWidth"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8677</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">[</span><span class="STRN">"stroke-dasharray"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">","</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8678</span> </span><span class="WHIT">			</span><span class="NAME">parts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">[</span><span class="STRN">"stroke-dasharray"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="NAME">sep</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8679</span> </span><span class="WHIT">			</span><span class="NAME">styleToUse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8680</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">parts.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8681</span> </span><span class="WHIT">				</span><span class="NAME">styleToUse</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">style.lineWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8682</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8683</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">component.strokeNode</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8684</span> </span><span class="WHIT">				</span><span class="NAME">component.strokeNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">dashstyle</span><span class="PUNC">:</span><span class="NAME">styleToUse</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_jsPlumb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>8685</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8686</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>8687</span> </span><span class="WHIT">				</span><span class="NAME">component.strokeNode.dashstyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">styleToUse</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8688</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8689</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8690</span> </span><span class="WHIT">		</span><span class="NAME">_atts</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">styleToWrite</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8691</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8692</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>8693</span> 	 * Base class for Vml endpoints and connectors. Extends jsPlumbUIComponent. 
<span class='line'>8694</span> 	 */</span><span class="WHIT">
<span class='line'>8695</span> </span><span class="WHIT">	</span><span class="NAME">VmlComponent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>8696</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8697</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.jsPlumbUIComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8698</span> </span><span class="WHIT">		</span><span class="NAME">this.opacityNodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8699</span> </span><span class="WHIT">			</span><span class="STRN">"stroke"</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8700</span> </span><span class="WHIT">			</span><span class="STRN">"fill"</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="WHIT">
<span class='line'>8701</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8702</span> </span><span class="WHIT">		</span><span class="NAME">this.initOpacityNodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">vml</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8703</span> </span><span class="WHIT">			</span><span class="NAME">self.opacityNodes</span><span class="PUNC">[</span><span class="STRN">"stroke"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">opacity</span><span class="PUNC">:</span><span class="STRN">"0.0"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vml</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8704</span> </span><span class="WHIT">			</span><span class="NAME">self.opacityNodes</span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">opacity</span><span class="PUNC">:</span><span class="STRN">"0.0"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vml</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>8705</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8706</span> </span><span class="WHIT">		</span><span class="NAME">this.setOpacity</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8707</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.opacityNodes</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8708</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">[</span><span class="STRN">"opacity"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8709</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8710</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">displayElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8711</span> </span><span class="WHIT">		</span><span class="NAME">this.getDisplayElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>8712</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">displayElements</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>8713</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8714</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8715</span> </span><span class="WHIT">		</span><span class="NAME">this.appendDisplayElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotAppendToCanvas</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8716</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">doNotAppendToCanvas</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.canvas.parentNode.appendChild</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8717</span> </span><span class="WHIT">			</span><span class="NAME">displayElements.push</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8718</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8719</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8720</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>8721</span> 	 * Base class for Vml connectors. extends VmlComponent.
<span class='line'>8722</span> 	 */</span><span class="WHIT">
<span class='line'>8723</span> </span><span class="WHIT">	</span><span class="NAME">VmlConnector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.VmlConnector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8724</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8725</span> </span><span class="WHIT">		</span><span class="NAME">self.strokeNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8726</span> </span><span class="WHIT">		</span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8727</span> </span><span class="WHIT">		</span><span class="NAME">VmlComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8728</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb.connectorClass</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.cssClass</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">params.cssClass</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8729</span> </span><span class="WHIT">		</span><span class="NAME">this.paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8730</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>8731</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.getPath</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="STRN">"path"</span><span class="PUNC">:</span><span class="NAME">path</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>8732</span> 
<span class='line'>8733</span> </span><span class="WHIT">                </span><span class="COMM">//*</span><span class="WHIT">
<span class='line'>8734</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style.outlineColor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8735</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">outlineWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style.outlineWidth</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8736</span> </span><span class="WHIT">					</span><span class="NAME">outlineStrokeWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style.lineWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">outlineWidth</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8737</span> </span><span class="WHIT">					</span><span class="NAME">outlineStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8738</span> </span><span class="WHIT">						</span><span class="NAME">strokeStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.convertStyle</span><span class="PUNC">(</span><span class="NAME">style.outlineColor</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8739</span> </span><span class="WHIT">						</span><span class="NAME">lineWidth</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">outlineStrokeWidth</span><span class="WHIT">
<span class='line'>8740</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8741</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">aa</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">vmlAttributeMap</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">outlineStyle</span><span class="PUNC">[</span><span class="NAME">aa</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">[</span><span class="NAME">aa</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8742</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>8743</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.bgCanvas</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>8744</span> </span><span class="WHIT">						</span><span class="NAME">p</span><span class="PUNC">[</span><span class="STRN">"class"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8745</span> </span><span class="WHIT">						</span><span class="NAME">p</span><span class="PUNC">[</span><span class="STRN">"coordsize"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8746</span> </span><span class="WHIT">						</span><span class="NAME">self.bgCanvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="STRN">"shape"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.parent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>8747</span> </span><span class="WHIT">						</span><span class="NAME">_pos</span><span class="PUNC">(</span><span class="NAME">self.bgCanvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.getZIndex</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8748</span> </span><span class="WHIT">						</span><span class="NAME">self.appendDisplayElement</span><span class="PUNC">(</span><span class="NAME">self.bgCanvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8749</span> </span><span class="WHIT">						</span><span class="NAME">self.attachListeners</span><span class="PUNC">(</span><span class="NAME">self.bgCanvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>8750</span> </span><span class="WHIT">						</span><span class="NAME">self.initOpacityNodes</span><span class="PUNC">(</span><span class="NAME">self.bgCanvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"stroke"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8751</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8752</span> </span><span class="WHIT">					</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8753</span> </span><span class="WHIT">						</span><span class="NAME">p</span><span class="PUNC">[</span><span class="STRN">"coordsize"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8754</span> </span><span class="WHIT">						</span><span class="NAME">_pos</span><span class="PUNC">(</span><span class="NAME">self.bgCanvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.getZIndex</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8755</span> </span><span class="WHIT">						</span><span class="NAME">_atts</span><span class="PUNC">(</span><span class="NAME">self.bgCanvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8756</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8757</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>8758</span> </span><span class="WHIT">					</span><span class="NAME">_applyStyles</span><span class="PUNC">(</span><span class="NAME">self.bgCanvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">outlineStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8759</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8760</span> </span><span class="WHIT">				</span><span class="COMM">//*/</span><span class="WHIT">
<span class='line'>8761</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>8762</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">										</span><span class="WHIT">
<span class='line'>8763</span> </span><span class="WHIT">					</span><span class="NAME">p</span><span class="PUNC">[</span><span class="STRN">"class"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8764</span> </span><span class="WHIT">					</span><span class="NAME">p</span><span class="PUNC">[</span><span class="STRN">"coordsize"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8765</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.tooltip</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">[</span><span class="STRN">"label"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.tooltip</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8766</span> </span><span class="WHIT">					</span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="STRN">"shape"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.parent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">					                </span><span class="WHIT">
<span class='line'>8767</span> </span><span class="WHIT">                    </span><span class="COMM">//var group = _getGroup(params.parent);                   // test of append everything to a group</span><span class="WHIT">
<span class='line'>8768</span> </span><span class="WHIT">                    </span><span class="COMM">//group.appendChild(self.canvas);                           // sort of works but not exactly;</span><span class="WHIT">
<span class='line'>8769</span> </span><span class="WHIT">					</span><span class="COMM">//params["_jsPlumb"].appendElement(self.canvas, params.parent);    //before introduction of groups</span><span class="WHIT">
<span class='line'>8770</span> 
<span class='line'>8771</span> </span><span class="WHIT">					</span><span class="NAME">self.appendDisplayElement</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">										</span><span class="WHIT">
<span class='line'>8772</span> </span><span class="WHIT">					</span><span class="NAME">self.attachListeners</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>8773</span> </span><span class="WHIT">					</span><span class="NAME">self.initOpacityNodes</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"stroke"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8774</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8775</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8776</span> </span><span class="WHIT">					</span><span class="NAME">p</span><span class="PUNC">[</span><span class="STRN">"coordsize"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8777</span> </span><span class="WHIT">					</span><span class="NAME">_pos</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.getZIndex</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8778</span> </span><span class="WHIT">					</span><span class="NAME">_atts</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8779</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8780</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>8781</span> </span><span class="WHIT">				</span><span class="NAME">_applyStyles</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8782</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8783</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8784</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8785</span> </span><span class="WHIT">		</span><span class="COMM">//self.appendDisplayElement(self.canvas);</span><span class="WHIT">
<span class='line'>8786</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8787</span> </span><span class="WHIT">		</span><span class="NAME">this.reattachListeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8788</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.reattachListenersForElement</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8789</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8790</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8791</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>8792</span> 	 * 
<span class='line'>8793</span> 	 * Base class for Vml Endpoints. extends VmlComponent.
<span class='line'>8794</span> 	 * 
<span class='line'>8795</span> 	 */</span><span class="WHIT">
<span class='line'>8796</span> </span><span class="WHIT">	</span><span class="NAME">VmlEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.VmlEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8797</span> </span><span class="WHIT">		</span><span class="NAME">VmlComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8798</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vml</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opacityStrokeNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">opacityFillNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8799</span> </span><span class="WHIT">		</span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8800</span> </span><span class="WHIT">		</span><span class="NAME">self.canvas.style</span><span class="PUNC">[</span><span class="STRN">"position"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"absolute"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8801</span> 
<span class='line'>8802</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb.endpointClass</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.cssClass</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">params.cssClass</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8803</span> 
<span class='line'>8804</span> </span><span class="WHIT">		</span><span class="COMM">//var group = _getGroup(params.parent);</span><span class="WHIT">
<span class='line'>8805</span> </span><span class="WHIT">        </span><span class="COMM">//group.appendChild(self.canvas);</span><span class="WHIT">
<span class='line'>8806</span> </span><span class="WHIT">		</span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"_jsPlumb"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">appendElement</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8807</span> 
<span class='line'>8808</span> </span><span class="WHIT">        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.tooltip</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.canvas.setAttribute</span><span class="PUNC">(</span><span class="STRN">"label"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.tooltip</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8809</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8810</span> </span><span class="WHIT">		</span><span class="NAME">this.paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8811</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>8812</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>8813</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.sizeCanvas</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8814</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vml</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8815</span> </span><span class="WHIT">				</span><span class="NAME">p</span><span class="PUNC">[</span><span class="STRN">"class"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8816</span> </span><span class="WHIT">				</span><span class="NAME">vml</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.getVml</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>8817</span> </span><span class="WHIT">				</span><span class="NAME">self.attachListeners</span><span class="PUNC">(</span><span class="NAME">vml</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8818</span> 
<span class='line'>8819</span> </span><span class="WHIT">				</span><span class="NAME">self.appendDisplayElement</span><span class="PUNC">(</span><span class="NAME">vml</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8820</span> </span><span class="WHIT">				</span><span class="NAME">self.appendDisplayElement</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8821</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>8822</span> </span><span class="WHIT">				</span><span class="NAME">self.initOpacityNodes</span><span class="PUNC">(</span><span class="NAME">vml</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"fill"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>8823</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8824</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>8825</span> </span><span class="WHIT">				</span><span class="NAME">_pos</span><span class="PUNC">(</span><span class="NAME">vml</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8826</span> </span><span class="WHIT">				</span><span class="NAME">_atts</span><span class="PUNC">(</span><span class="NAME">vml</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8827</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8828</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>8829</span> </span><span class="WHIT">			</span><span class="NAME">_applyStyles</span><span class="PUNC">(</span><span class="NAME">vml</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8830</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8831</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>8832</span> </span><span class="WHIT">		</span><span class="NAME">this.reattachListeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8833</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vml</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.reattachListenersForElement</span><span class="PUNC">(</span><span class="NAME">vml</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8834</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8835</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8836</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8837</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Connectors.vml.Bezier</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8838</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.Connectors.Bezier.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8839</span> </span><span class="WHIT">		</span><span class="NAME">VmlConnector.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8840</span> </span><span class="WHIT">		</span><span class="NAME">this.getPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>8841</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"m"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>8842</span> </span><span class="WHIT">				   </span><span class="STRN">" c"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" e"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8843</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8844</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8845</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8846</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Connectors.vml.Straight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8847</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.Connectors.Straight.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8848</span> </span><span class="WHIT">		</span><span class="NAME">VmlConnector.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8849</span> </span><span class="WHIT">		</span><span class="NAME">this.getPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8850</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"m"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" l"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" e"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8851</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8852</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8853</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8854</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Connectors.vml.Flowchart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8855</span> </span><span class="WHIT">    	</span><span class="NAME">jsPlumb.Connectors.Flowchart.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8856</span> </span><span class="WHIT">		</span><span class="NAME">VmlConnector.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8857</span> </span><span class="WHIT">    	</span><span class="NAME">this.getPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8858</span> </span><span class="WHIT">    		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"m "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" l"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8859</span> </span><span class="WHIT">	        </span><span class="COMM">// loop through extra points</span><span class="WHIT">
<span class='line'>8860</span> </span><span class="WHIT">	        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8861</span> </span><span class="WHIT">	        	</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8862</span> </span><span class="WHIT">	        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8863</span> </span><span class="WHIT">	        </span><span class="COMM">// finally draw a line to the end</span><span class="WHIT">
<span class='line'>8864</span> </span><span class="WHIT">	        </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT">  </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">  </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" e"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8865</span> </span><span class="WHIT">	        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8866</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8867</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8868</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8869</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Endpoints.vml.Dot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8870</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.Endpoints.Dot.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8871</span> </span><span class="WHIT">		</span><span class="NAME">VmlEndpoint.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8872</span> </span><span class="WHIT">		</span><span class="NAME">this.getVml</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">atts</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_jsPlumb</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="STRN">"oval"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">atts</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_jsPlumb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8873</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8874</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8875</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Endpoints.vml.Rectangle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8876</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.Endpoints.Rectangle.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8877</span> </span><span class="WHIT">		</span><span class="NAME">VmlEndpoint.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8878</span> </span><span class="WHIT">		</span><span class="NAME">this.getVml</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">atts</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_jsPlumb</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="STRN">"rect"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">atts</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_jsPlumb</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8879</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8880</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8881</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>8882</span> 	 * VML Image Endpoint is the same as the default image endpoint.
<span class='line'>8883</span> 	 */</span><span class="WHIT">
<span class='line'>8884</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Endpoints.vml.Image</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Endpoints.Image</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8885</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8886</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>8887</span> 	 * placeholder for Blank endpoint in vml renderer.
<span class='line'>8888</span> 	 */</span><span class="WHIT">
<span class='line'>8889</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Endpoints.vml.Blank</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Endpoints.Blank</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8890</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8891</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>8892</span> 	 * VML Label renderer. uses the default label renderer (which adds an element to the DOM)
<span class='line'>8893</span> 	 */</span><span class="WHIT">
<span class='line'>8894</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Overlays.vml.Label</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Overlays.Label</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8895</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8896</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>8897</span> 	 * VML Custom renderer. uses the default Custom renderer (which adds an element to the DOM)
<span class='line'>8898</span> 	 */</span><span class="WHIT">
<span class='line'>8899</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Overlays.vml.Custom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Overlays.Custom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8900</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8901</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">AbstractVmlArrowOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">superclass</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalArgs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8902</span> </span><span class="WHIT">    	</span><span class="NAME">superclass.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8903</span> </span><span class="WHIT">    	</span><span class="NAME">VmlComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8904</span> </span><span class="WHIT">    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8905</span> </span><span class="WHIT">    	</span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>8906</span> </span><span class="WHIT">    	</span><span class="NAME">self.isAppendedAtTopLevel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8907</span> </span><span class="WHIT">    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">getPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectorDimensions</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">    		</span><span class="WHIT">
<span class='line'>8908</span> </span><span class="WHIT">    		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"m "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d.hxy.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d.hxy.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>8909</span> </span><span class="WHIT">    		       </span><span class="STRN">" l "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d.tail</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d.tail</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>8910</span> </span><span class="WHIT">    		       </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d.cxy.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d.cxy.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>8911</span> </span><span class="WHIT">    		       </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d.tail</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_conv</span><span class="PUNC">(</span><span class="NAME">d.tail</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>8912</span> </span><span class="WHIT">    		       </span><span class="STRN">" x e"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8913</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8914</span> </span><span class="WHIT">    	</span><span class="NAME">this.paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">connector</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">strokeStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fillStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectorDimensions</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8915</span> </span><span class="WHIT">    		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8916</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">strokeStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8917</span> </span><span class="WHIT">				</span><span class="NAME">p</span><span class="PUNC">[</span><span class="STRN">"stroked"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"true"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8918</span> </span><span class="WHIT">				</span><span class="NAME">p</span><span class="PUNC">[</span><span class="STRN">"strokecolor"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.convertStyle</span><span class="PUNC">(</span><span class="NAME">strokeStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">    				</span><span class="WHIT">
<span class='line'>8919</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8920</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lineWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">[</span><span class="STRN">"strokeweight"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8921</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fillStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8922</span> </span><span class="WHIT">				</span><span class="NAME">p</span><span class="PUNC">[</span><span class="STRN">"filled"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"true"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8923</span> </span><span class="WHIT">				</span><span class="NAME">p</span><span class="PUNC">[</span><span class="STRN">"fillcolor"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fillStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8924</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8925</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xmin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">d.hxy.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d.tail</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d.tail</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d.cxy.x</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8926</span> </span><span class="WHIT">			</span><span class="NAME">ymin</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">d.hxy.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d.tail</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d.tail</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d.cxy.y</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8927</span> </span><span class="WHIT">			</span><span class="NAME">xmax</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">d.hxy.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d.tail</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d.tail</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d.cxy.x</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8928</span> </span><span class="WHIT">			</span><span class="NAME">ymax</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">d.hxy.y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d.tail</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d.tail</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d.cxy.y</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8929</span> </span><span class="WHIT">			</span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">xmax</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">xmin</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8930</span> </span><span class="WHIT">			</span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">ymax</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">ymin</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>8931</span> </span><span class="WHIT">			</span><span class="NAME">dim</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">xmin</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ymin</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8932</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>8933</span> </span><span class="WHIT">			</span><span class="COMM">// for VML, we create overlays using shapes that have the same dimensions and</span><span class="WHIT">
<span class='line'>8934</span> </span><span class="WHIT">			</span><span class="COMM">// coordsize as their connector - overlays calculate themselves relative to the</span><span class="WHIT">
<span class='line'>8935</span> </span><span class="WHIT">			</span><span class="COMM">// connector (it's how it's been done since the original canvas implementation, because</span><span class="WHIT">
<span class='line'>8936</span> </span><span class="WHIT">			</span><span class="COMM">// for canvas that makes sense).</span><span class="WHIT">
<span class='line'>8937</span> </span><span class="WHIT">			</span><span class="NAME">p</span><span class="PUNC">[</span><span class="STRN">"path"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getPath</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectorDimensions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8938</span> </span><span class="WHIT">			</span><span class="NAME">p</span><span class="PUNC">[</span><span class="STRN">"coordsize"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">connectorDimensions</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">connectorDimensions</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">scale</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8939</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>8940</span> </span><span class="WHIT">			</span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectorDimensions</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8941</span> </span><span class="WHIT">			</span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectorDimensions</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8942</span> </span><span class="WHIT">			</span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectorDimensions</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8943</span> </span><span class="WHIT">			</span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectorDimensions</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8944</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>8945</span> </span><span class="WHIT">    		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8946</span> </span><span class="WHIT">    			</span><span class="COMM">//p["class"] = jsPlumb.overlayClass; // TODO currentInstance?</span><span class="WHIT">
<span class='line'>8947</span> </span><span class="WHIT">				</span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="STRN">"shape"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connector.canvas.parentNode</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connector._jsPlumb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>8948</span> </span><span class="WHIT">				</span><span class="NAME">connector.appendDisplayElement</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8949</span> </span><span class="WHIT">				</span><span class="NAME">self.attachListeners</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connector</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8950</span> </span><span class="WHIT">				</span><span class="NAME">self.attachListeners</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8951</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>8952</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>8953</span> </span><span class="WHIT">				</span><span class="NAME">_pos</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8954</span> </span><span class="WHIT">				</span><span class="NAME">_atts</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8955</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">    		</span><span class="WHIT">
<span class='line'>8956</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8957</span> </span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>8958</span> </span><span class="WHIT">    	</span><span class="NAME">this.reattachListeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8959</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.reattachListenersForElement</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8960</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8961</span> 
<span class='line'>8962</span> </span><span class="WHIT">		</span><span class="NAME">this.cleanup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8963</span> </span><span class="WHIT">    		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.removeElement</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8964</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8965</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8966</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>8967</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Overlays.vml.Arrow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8968</span> </span><span class="WHIT">    	</span><span class="NAME">AbstractVmlArrowOverlay.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">jsPlumb.Overlays.Arrow</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>8969</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8970</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>8971</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Overlays.vml.PlainArrow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8972</span> </span><span class="WHIT">    	</span><span class="NAME">AbstractVmlArrowOverlay.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">jsPlumb.Overlays.PlainArrow</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>8973</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8974</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>8975</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Overlays.vml.Diamond</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>8976</span> </span><span class="WHIT">    	</span><span class="NAME">AbstractVmlArrowOverlay.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">jsPlumb.Overlays.Diamond</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>8977</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>8978</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">/*
<span class='line'>8979</span>  * jsPlumb
<span class='line'>8980</span>  * 
<span class='line'>8981</span>  * Title:jsPlumb 1.3.15
<span class='line'>8982</span>  * 
<span class='line'>8983</span>  * Provides a way to visually connect elements on an HTML page, using either SVG, Canvas
<span class='line'>8984</span>  * elements, or VML.  
<span class='line'>8985</span>  * 
<span class='line'>8986</span>  * This file contains the SVG renderers.
<span class='line'>8987</span>  *
<span class='line'>8988</span>  * Copyright (c) 2010 - 2012 Simon Porritt (http://jsplumb.org)
<span class='line'>8989</span>  * 
<span class='line'>8990</span>  * http://jsplumb.org
<span class='line'>8991</span>  * http://github.com/sporritt/jsplumb
<span class='line'>8992</span>  * http://code.google.com/p/jsplumb
<span class='line'>8993</span>  * 
<span class='line'>8994</span>  * Dual licensed under the MIT and GPL2 licenses.
<span class='line'>8995</span>  */</span><span class="WHIT">
<span class='line'>8996</span> 
<span class='line'>8997</span> </span><span class="COMM">/**
<span class='line'>8998</span>  * SVG support for jsPlumb.
<span class='line'>8999</span>  * 
<span class='line'>9000</span>  * things to investigate:
<span class='line'>9001</span>  * 
<span class='line'>9002</span>  * gradients:  https://developer.mozilla.org/en/svg_in_html_introduction
<span class='line'>9003</span>  * css:http://tutorials.jenkov.com/svg/svg-and-css.html
<span class='line'>9004</span>  * text on a path: http://www.w3.org/TR/SVG/text.html#TextOnAPath
<span class='line'>9005</span>  * pointer events: https://developer.mozilla.org/en/css/pointer-events
<span class='line'>9006</span>  *
<span class='line'>9007</span>  * IE9 hover jquery: http://forum.jquery.com/topic/1-6-2-broke-svg-hover-events
<span class='line'>9008</span>  *
<span class='line'>9009</span>  */</span><span class="WHIT">
<span class='line'>9010</span> </span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9011</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9012</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">svgAttributeMap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9013</span> </span><span class="WHIT">		</span><span class="STRN">"joinstyle"</span><span class="PUNC">:</span><span class="STRN">"stroke-linejoin"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9014</span> </span><span class="WHIT">		</span><span class="STRN">"stroke-linejoin"</span><span class="PUNC">:</span><span class="STRN">"stroke-linejoin"</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9015</span> </span><span class="WHIT">		</span><span class="STRN">"stroke-dashoffset"</span><span class="PUNC">:</span><span class="STRN">"stroke-dashoffset"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9016</span> </span><span class="WHIT">		</span><span class="STRN">"stroke-linecap"</span><span class="PUNC">:</span><span class="STRN">"stroke-linecap"</span><span class="WHIT">
<span class='line'>9017</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9018</span> </span><span class="WHIT">	</span><span class="NAME">STROKE_DASHARRAY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"stroke-dasharray"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9019</span> </span><span class="WHIT">	</span><span class="NAME">DASHSTYLE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"dashstyle"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9020</span> </span><span class="WHIT">	</span><span class="NAME">LINEAR_GRADIENT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"linearGradient"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9021</span> </span><span class="WHIT">	</span><span class="NAME">RADIAL_GRADIENT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"radialGradient"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9022</span> </span><span class="WHIT">	</span><span class="NAME">FILL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"fill"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9023</span> </span><span class="WHIT">	</span><span class="NAME">STOP</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"stop"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9024</span> </span><span class="WHIT">	</span><span class="NAME">STROKE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"stroke"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9025</span> </span><span class="WHIT">	</span><span class="NAME">STROKE_WIDTH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"stroke-width"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9026</span> </span><span class="WHIT">	</span><span class="NAME">STYLE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"style"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9027</span> </span><span class="WHIT">	</span><span class="NAME">NONE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"none"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9028</span> </span><span class="WHIT">	</span><span class="NAME">JSPLUMB_GRADIENT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"jsplumb_gradient_"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9029</span> </span><span class="WHIT">	</span><span class="NAME">LINE_WIDTH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"lineWidth"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9030</span> </span><span class="WHIT">	</span><span class="NAME">ns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9031</span> </span><span class="WHIT">		</span><span class="NAME">svg</span><span class="PUNC">:</span><span class="STRN">"http://www.w3.org/2000/svg"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9032</span> </span><span class="WHIT">		</span><span class="NAME">xhtml</span><span class="PUNC">:</span><span class="STRN">"http://www.w3.org/1999/xhtml"</span><span class="WHIT">
<span class='line'>9033</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9034</span> </span><span class="WHIT">	</span><span class="NAME">_attr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">node</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attributes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9035</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">attributes</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>9036</span> </span><span class="WHIT">			</span><span class="NAME">node.setAttribute</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">attributes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9037</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9038</span> </span><span class="WHIT">	</span><span class="NAME">_node</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attributes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9039</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElementNS</span><span class="PUNC">(</span><span class="NAME">ns.svg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9040</span> </span><span class="WHIT">		</span><span class="NAME">attributes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attributes</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9041</span> </span><span class="WHIT">		</span><span class="NAME">attributes</span><span class="PUNC">[</span><span class="STRN">"version"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"1.1"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9042</span> </span><span class="WHIT">		</span><span class="NAME">attributes</span><span class="PUNC">[</span><span class="STRN">"xmlns"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ns.xhtml</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9043</span> </span><span class="WHIT">		</span><span class="NAME">_attr</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attributes</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9044</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9045</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9046</span> </span><span class="WHIT">	</span><span class="NAME">_pos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"position:absolute;left:"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px;top:"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9047</span> </span><span class="WHIT">	</span><span class="NAME">_clearGradient</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9048</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">parent.childNodes.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9049</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parent.childNodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tagName</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">LINEAR_GRADIENT</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">parent.childNodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">tagName</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">RADIAL_GRADIENT</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>9050</span> </span><span class="WHIT">				</span><span class="NAME">parent.removeChild</span><span class="PUNC">(</span><span class="NAME">parent.childNodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9051</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9052</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9053</span> </span><span class="WHIT">	</span><span class="NAME">_updateGradient</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">uiComponent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9054</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">JSPLUMB_GRADIENT</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">uiComponent._jsPlumb.idstamp</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9055</span> </span><span class="WHIT">		</span><span class="COMM">// first clear out any existing gradient</span><span class="WHIT">
<span class='line'>9056</span> </span><span class="WHIT">		</span><span class="NAME">_clearGradient</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9057</span> </span><span class="WHIT">		</span><span class="COMM">// this checks for an 'offset' property in the gradient, and in the absence of it, assumes</span><span class="WHIT">
<span class='line'>9058</span> </span><span class="WHIT">		</span><span class="COMM">// we want a linear gradient. if it's there, we create a radial gradient.</span><span class="WHIT">
<span class='line'>9059</span> </span><span class="WHIT">		</span><span class="COMM">// it is possible that a more explicit means of defining the gradient type would be</span><span class="WHIT">
<span class='line'>9060</span> </span><span class="WHIT">		</span><span class="COMM">// better. relying on 'offset' means that we can never have a radial gradient that uses</span><span class="WHIT">
<span class='line'>9061</span> </span><span class="WHIT">		</span><span class="COMM">// some default offset, for instance.</span><span class="WHIT">
<span class='line'>9062</span> </span><span class="WHIT">		</span><span class="COMM">// issue 244 suggested the 'gradientUnits' attribute; without this, straight/flowchart connectors with gradients would</span><span class="WHIT">
<span class='line'>9063</span> </span><span class="WHIT">		</span><span class="COMM">// not show gradients when the line was perfectly horizontal or vertical.</span><span class="WHIT">
<span class='line'>9064</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">style.gradient.offset</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9065</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="NAME">LINEAR_GRADIENT</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">gradientUnits</span><span class="PUNC">:</span><span class="STRN">"userSpaceOnUse"</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9066</span> </span><span class="WHIT">			</span><span class="NAME">parent.appendChild</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9067</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9068</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9069</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="NAME">RADIAL_GRADIENT</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9070</span> </span><span class="WHIT">				</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">id</span><span class="WHIT">
<span class='line'>9071</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9072</span> </span><span class="WHIT">			</span><span class="NAME">parent.appendChild</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9073</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9074</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9075</span> </span><span class="WHIT">		</span><span class="COMM">// the svg radial gradient seems to treat stops in the reverse </span><span class="WHIT">
<span class='line'>9076</span> </span><span class="WHIT">		</span><span class="COMM">// order to how canvas does it.  so we want to keep all the maths the same, but</span><span class="WHIT">
<span class='line'>9077</span> </span><span class="WHIT">		</span><span class="COMM">// iterate the actual style declarations in reverse order, if the x indexes are not in order.</span><span class="WHIT">
<span class='line'>9078</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">style.gradient.stops.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9079</span> </span><span class="WHIT">			</span><span class="COMM">// Straight Connectors and Bezier connectors act slightly differently; this code is a bit of a kludge.  but next version of</span><span class="WHIT">
<span class='line'>9080</span> </span><span class="WHIT">			</span><span class="COMM">// jsplumb will be replacing both Straight and Bezier to be generic instances of 'Connector', which has a list of segments.</span><span class="WHIT">
<span class='line'>9081</span> </span><span class="WHIT">			</span><span class="COMM">// so, not too concerned about leaving this in for now.</span><span class="WHIT">
<span class='line'>9082</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">styleToUse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9083</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dimensions.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9084</span> </span><span class="WHIT">				</span><span class="NAME">styleToUse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">style.gradient.stops.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9085</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>9086</span> </span><span class="WHIT">				</span><span class="NAME">styleToUse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">style.gradient.stops.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9087</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">stopColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.convertStyle</span><span class="PUNC">(</span><span class="NAME">style.gradient.stops</span><span class="PUNC">[</span><span class="NAME">styleToUse</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9088</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="NAME">STOP</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="STRN">"offset"</span><span class="PUNC">:</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">style.gradient.stops</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"%"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"stop-color"</span><span class="PUNC">:</span><span class="NAME">stopColor</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9089</span> </span><span class="WHIT">			</span><span class="NAME">g.appendChild</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9090</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9091</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">applyGradientTo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style.strokeStyle</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">STROKE</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">FILL</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9092</span> </span><span class="WHIT">		</span><span class="NAME">node.setAttribute</span><span class="PUNC">(</span><span class="NAME">STYLE</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">applyGradientTo</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">":url(#"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">")"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9093</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9094</span> </span><span class="WHIT">	</span><span class="NAME">_applyStyles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">uiComponent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9095</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9096</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style.gradient</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9097</span> </span><span class="WHIT">			</span><span class="NAME">_updateGradient</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">node</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">uiComponent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9098</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9099</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9100</span> </span><span class="WHIT">			</span><span class="COMM">// make sure we clear any existing gradient</span><span class="WHIT">
<span class='line'>9101</span> </span><span class="WHIT">			</span><span class="NAME">_clearGradient</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9102</span> </span><span class="WHIT">			</span><span class="NAME">node.setAttribute</span><span class="PUNC">(</span><span class="NAME">STYLE</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9103</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9104</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9105</span> </span><span class="WHIT">		</span><span class="NAME">node.setAttribute</span><span class="PUNC">(</span><span class="NAME">FILL</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style.fillStyle</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.convertStyle</span><span class="PUNC">(</span><span class="NAME">style.fillStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NONE</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9106</span> </span><span class="WHIT">		</span><span class="NAME">node.setAttribute</span><span class="PUNC">(</span><span class="NAME">STROKE</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style.strokeStyle</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.convertStyle</span><span class="PUNC">(</span><span class="NAME">style.strokeStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">NONE</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9107</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style.lineWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9108</span> </span><span class="WHIT">			</span><span class="NAME">node.setAttribute</span><span class="PUNC">(</span><span class="NAME">STROKE_WIDTH</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style.lineWidth</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9109</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9110</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9111</span> </span><span class="WHIT">		</span><span class="COMM">// in SVG there is a stroke-dasharray attribute we can set, and its syntax looks like</span><span class="WHIT">
<span class='line'>9112</span> </span><span class="WHIT">		</span><span class="COMM">// the syntax in VML but is actually kind of nasty: values are given in the pixel</span><span class="WHIT">
<span class='line'>9113</span> </span><span class="WHIT">		</span><span class="COMM">// coordinate space, whereas in VML they are multiples of the width of the stroked</span><span class="WHIT">
<span class='line'>9114</span> </span><span class="WHIT">		</span><span class="COMM">// line, which makes a lot more sense.  for that reason, jsPlumb is supporting both</span><span class="WHIT">
<span class='line'>9115</span> </span><span class="WHIT">		</span><span class="COMM">// the native svg 'stroke-dasharray' attribute, and also the 'dashstyle' concept from</span><span class="WHIT">
<span class='line'>9116</span> </span><span class="WHIT">		</span><span class="COMM">// VML, which will be the preferred method.  the code below this converts a dashstyle</span><span class="WHIT">
<span class='line'>9117</span> </span><span class="WHIT">		</span><span class="COMM">// attribute given in terms of stroke width into a pixel representation, by using the</span><span class="WHIT">
<span class='line'>9118</span> </span><span class="WHIT">		</span><span class="COMM">// stroke's lineWidth. </span><span class="WHIT">
<span class='line'>9119</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">[</span><span class="NAME">DASHSTYLE</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">[</span><span class="NAME">LINE_WIDTH</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">style</span><span class="PUNC">[</span><span class="NAME">STROKE_DASHARRAY</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9120</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">[</span><span class="NAME">DASHSTYLE</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">indexOf</span><span class="PUNC">(</span><span class="STRN">","</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">","</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9121</span> </span><span class="WHIT">			</span><span class="NAME">parts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">[</span><span class="NAME">DASHSTYLE</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="NAME">sep</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9122</span> </span><span class="WHIT">			</span><span class="NAME">styleToUse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9123</span> </span><span class="WHIT">			</span><span class="NAME">parts.forEach</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9124</span> </span><span class="WHIT">				</span><span class="NAME">styleToUse</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">style.lineWidth</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9125</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9126</span> </span><span class="WHIT">			</span><span class="NAME">node.setAttribute</span><span class="PUNC">(</span><span class="NAME">STROKE_DASHARRAY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">styleToUse</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9127</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9128</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">[</span><span class="NAME">STROKE_DASHARRAY</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9129</span> </span><span class="WHIT">			</span><span class="NAME">node.setAttribute</span><span class="PUNC">(</span><span class="NAME">STROKE_DASHARRAY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">[</span><span class="NAME">STROKE_DASHARRAY</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9130</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9131</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9132</span> </span><span class="WHIT">		</span><span class="COMM">// extra attributes such as join type, dash offset.</span><span class="WHIT">
<span class='line'>9133</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">svgAttributeMap</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9134</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9135</span> </span><span class="WHIT">				</span><span class="NAME">node.setAttribute</span><span class="PUNC">(</span><span class="NAME">svgAttributeMap</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9136</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9137</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9138</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9139</span> </span><span class="WHIT">	</span><span class="NAME">_decodeFont</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9140</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="REGX">/([0-9].)(p[xt])\s(.*)/</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9141</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bits</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">f.match</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9142</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">size</span><span class="PUNC">:</span><span class="NAME">bits</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">bits</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">font</span><span class="PUNC">:</span><span class="NAME">bits</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9143</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9144</span> </span><span class="WHIT">	</span><span class="NAME">_classManip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">add</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9145</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">classesToAddOrRemove</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">clazz.split</span><span class="PUNC">(</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9146</span> </span><span class="WHIT">			</span><span class="NAME">className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el.className</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9147</span> </span><span class="WHIT">			</span><span class="NAME">curClasses</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">className.baseVal.split</span><span class="PUNC">(</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9148</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9149</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">classesToAddOrRemove.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9150</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">add</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9151</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">curClasses.indexOf</span><span class="PUNC">(</span><span class="NAME">classesToAddOrRemove</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>9152</span> </span><span class="WHIT">					</span><span class="NAME">curClasses.push</span><span class="PUNC">(</span><span class="NAME">classesToAddOrRemove</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9153</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9154</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9155</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curClasses.indexOf</span><span class="PUNC">(</span><span class="NAME">classesToAddOrRemove</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9156</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>9157</span> </span><span class="WHIT">					</span><span class="NAME">curClasses.splice</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9158</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9159</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9160</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9161</span> </span><span class="WHIT">		</span><span class="NAME">el.className.baseVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curClasses.join</span><span class="PUNC">(</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9162</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9163</span> </span><span class="WHIT">	</span><span class="NAME">_addClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9164</span> </span><span class="WHIT">		</span><span class="NAME">_classManip</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9165</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9166</span> </span><span class="WHIT">	</span><span class="NAME">_removeClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9167</span> </span><span class="WHIT">		</span><span class="NAME">_classManip</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9168</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9169</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9170</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>9171</span> 		utility methods for other objects to use.
<span class='line'>9172</span> 	*/</span><span class="WHIT">
<span class='line'>9173</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumbUtil.svg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9174</span> </span><span class="WHIT">		</span><span class="NAME">addClass</span><span class="PUNC">:</span><span class="NAME">_addClass</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9175</span> </span><span class="WHIT">		</span><span class="NAME">removeClass</span><span class="PUNC">:</span><span class="NAME">_removeClass</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9176</span> </span><span class="WHIT">		</span><span class="NAME">node</span><span class="PUNC">:</span><span class="NAME">_node</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9177</span> </span><span class="WHIT">		</span><span class="NAME">attr</span><span class="PUNC">:</span><span class="NAME">_attr</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9178</span> </span><span class="WHIT">		</span><span class="NAME">pos</span><span class="PUNC">:</span><span class="NAME">_pos</span><span class="WHIT">
<span class='line'>9179</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9180</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9181</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>9182</span> 	 * Base class for SVG components.
<span class='line'>9183</span> 	 */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9184</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">SvgComponent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9185</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9186</span> </span><span class="WHIT">		</span><span class="NAME">pointerEventsSpec</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.pointerEventsSpec</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">"all"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9187</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.jsPlumbUIComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.originalArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9188</span> </span><span class="WHIT">		</span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.svg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9189</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9190</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.cssClass</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.originalArgs</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cssClass</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9191</span> </span><span class="WHIT">			</span><span class="NAME">svgParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9192</span> </span><span class="WHIT">				</span><span class="STRN">"style"</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9193</span> </span><span class="WHIT">				</span><span class="STRN">"width"</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9194</span> </span><span class="WHIT">				</span><span class="STRN">"height"</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9195</span> </span><span class="WHIT">				</span><span class="STRN">"pointer-events"</span><span class="PUNC">:</span><span class="NAME">pointerEventsSpec</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9196</span> </span><span class="WHIT">				</span><span class="STRN">"position"</span><span class="PUNC">:</span><span class="STRN">"absolute"</span><span class="WHIT">
<span class='line'>9197</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9198</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.tooltip</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">svgParams</span><span class="PUNC">[</span><span class="STRN">"title"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.tooltip</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9199</span> </span><span class="WHIT">		</span><span class="NAME">self.svg</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="STRN">"svg"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">svgParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9200</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.useDivWrapper</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9201</span> </span><span class="WHIT">			</span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9202</span> </span><span class="WHIT">			</span><span class="NAME">self.canvas.style</span><span class="PUNC">[</span><span class="STRN">"position"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"absolute"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9203</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.sizeCanvas</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9204</span> </span><span class="WHIT">			</span><span class="NAME">self.canvas.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9205</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.tooltip</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.canvas.setAttribute</span><span class="PUNC">(</span><span class="STRN">"title"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.tooltip</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9206</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9207</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9208</span> </span><span class="WHIT">			</span><span class="NAME">_attr</span><span class="PUNC">(</span><span class="NAME">self.svg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="STRN">"class"</span><span class="PUNC">:</span><span class="NAME">clazz</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9209</span> </span><span class="WHIT">			</span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.svg</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9210</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9211</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9212</span> </span><span class="WHIT">		</span><span class="NAME">params._jsPlumb.appendElement</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.originalArgs</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="STRN">"parent"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9213</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.useDivWrapper</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.canvas.appendChild</span><span class="PUNC">(</span><span class="NAME">self.svg</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9214</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9215</span> </span><span class="WHIT">		</span><span class="COMM">// TODO this displayElement stuff is common between all components, across all</span><span class="WHIT">
<span class='line'>9216</span> </span><span class="WHIT">		</span><span class="COMM">// renderers.  would be best moved to jsPlumbUIComponent.</span><span class="WHIT">
<span class='line'>9217</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">displayElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9218</span> </span><span class="WHIT">		</span><span class="NAME">this.getDisplayElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9219</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">displayElements</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9220</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9221</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9222</span> </span><span class="WHIT">		</span><span class="NAME">this.appendDisplayElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9223</span> </span><span class="WHIT">			</span><span class="NAME">displayElements.push</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9224</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9225</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9226</span> </span><span class="WHIT">		</span><span class="NAME">this.paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	   </span><span class="WHIT">
<span class='line'>9227</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9228</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9229</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.useDivWrapper</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9230</span> </span><span class="WHIT">					</span><span class="NAME">jsPlumb.sizeCanvas</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9231</span> </span><span class="WHIT">					</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9232</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9233</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_pos</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9234</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.getZIndex</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">";z-index:"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">self.getZIndex</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">";"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9235</span> </span><span class="WHIT">		    	</span><span class="NAME">_attr</span><span class="PUNC">(</span><span class="NAME">self.svg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9236</span> </span><span class="WHIT">	    			</span><span class="STRN">"style"</span><span class="PUNC">:</span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9237</span> </span><span class="WHIT">	    			</span><span class="STRN">"width"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9238</span> </span><span class="WHIT">	    			</span><span class="STRN">"height"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>9239</span> </span><span class="WHIT">	    		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9240</span> </span><span class="WHIT">		    	</span><span class="NAME">self._paint.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		    			    	</span><span class="WHIT">
<span class='line'>9241</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9242</span> </span><span class="WHIT">	    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9243</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9244</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9245</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>9246</span> 	 * Base class for SVG connectors.
<span class='line'>9247</span> 	 */</span><span class="WHIT">
<span class='line'>9248</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">SvgConnector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.SvgConnector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9249</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9250</span> </span><span class="WHIT">		</span><span class="NAME">SvgComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9251</span> </span><span class="WHIT">			</span><span class="NAME">cssClass</span><span class="PUNC">:</span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"_jsPlumb"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connectorClass</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9252</span> </span><span class="WHIT">			</span><span class="NAME">originalArgs</span><span class="PUNC">:</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9253</span> </span><span class="WHIT">			</span><span class="NAME">pointerEventsSpec</span><span class="PUNC">:</span><span class="STRN">"none"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9254</span> </span><span class="WHIT">			</span><span class="NAME">tooltip</span><span class="PUNC">:</span><span class="NAME">params.tooltip</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9255</span> </span><span class="WHIT">			</span><span class="NAME">_jsPlumb</span><span class="PUNC">:</span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"_jsPlumb"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9256</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9257</span> </span><span class="WHIT">		</span><span class="NAME">this._paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9258</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.getPath</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="STRN">"d"</span><span class="PUNC">:</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">outlineStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">									</span><span class="WHIT">
<span class='line'>9259</span> </span><span class="WHIT">			</span><span class="NAME">a</span><span class="PUNC">[</span><span class="STRN">"pointer-events"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"all"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9260</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9261</span> </span><span class="WHIT">			</span><span class="COMM">// outline style.  actually means drawing an svg object underneath the main one.</span><span class="WHIT">
<span class='line'>9262</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style.outlineColor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9263</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">outlineWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style.outlineWidth</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9264</span> </span><span class="WHIT">				</span><span class="NAME">outlineStrokeWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style.lineWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">outlineWidth</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9265</span> </span><span class="WHIT">				</span><span class="NAME">outlineStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9266</span> </span><span class="WHIT">				</span><span class="NAME">outlineStyle.strokeStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.convertStyle</span><span class="PUNC">(</span><span class="NAME">style.outlineColor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9267</span> </span><span class="WHIT">				</span><span class="NAME">outlineStyle.lineWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">outlineStrokeWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9268</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>9269</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.bgPath</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9270</span> </span><span class="WHIT">					</span><span class="NAME">self.bgPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="STRN">"path"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9271</span> </span><span class="WHIT">			    	</span><span class="NAME">self.svg.appendChild</span><span class="PUNC">(</span><span class="NAME">self.bgPath</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9272</span> </span><span class="WHIT">		    		</span><span class="NAME">self.attachListeners</span><span class="PUNC">(</span><span class="NAME">self.bgPath</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9273</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9274</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9275</span> </span><span class="WHIT">					</span><span class="NAME">_attr</span><span class="PUNC">(</span><span class="NAME">self.bgPath</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9276</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9277</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>9278</span> </span><span class="WHIT">				</span><span class="NAME">_applyStyles</span><span class="PUNC">(</span><span class="NAME">self.svg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.bgPath</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">outlineStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9279</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9280</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9281</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9282</span> </span><span class="WHIT">			</span><span class="COMM">// test - see below</span><span class="WHIT">
<span class='line'>9283</span> </span><span class="WHIT">	    	</span><span class="COMM">//	a["clip-path"]= "url(#testClip)"; </span><span class="WHIT">
<span class='line'>9284</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9285</span> </span><span class="WHIT">	    	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.path</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9286</span> </span><span class="WHIT">		    	</span><span class="NAME">self.path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="STRN">"path"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9287</span> </span><span class="WHIT">		    	</span><span class="NAME">self.svg.appendChild</span><span class="PUNC">(</span><span class="NAME">self.path</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9288</span> </span><span class="WHIT">	    		</span><span class="NAME">self.attachListeners</span><span class="PUNC">(</span><span class="NAME">self.path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	    	</span><span class="WHIT">
<span class='line'>9289</span> </span><span class="WHIT">	    		</span><span class="WHIT">
<span class='line'>9290</span> </span><span class="WHIT">	    		</span><span class="COMM">/*
<span class='line'>9291</span> 	    		this is a test of a clip path.  i'm looking into using one of these to animate a jsplumb connection.
<span class='line'>9292</span> 	    		you could do this by walking along the line, stepping along a little at a time, and setting the clip
<span class='line'>9293</span> 	    		path to extend as far as that point.
<span class='line'>9294</span> 	    		
<span class='line'>9295</span> 	    		self.clip = _node("clipPath", {id:"testClip", clipPathUnits:"objectBoundingBox"});
<span class='line'>9296</span> 	    		self.svg.appendChild(self.clip);
<span class='line'>9297</span> 	    		self.clip.appendChild(_node("rect", {
<span class='line'>9298</span> 	    			x:"0",y:"0",width:"0.5",height:"1" 
<span class='line'>9299</span> 	    		}));
<span class='line'>9300</span> 	    		*/</span><span class="WHIT">
<span class='line'>9301</span> </span><span class="WHIT">	    	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9302</span> </span><span class="WHIT">	    	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9303</span> </span><span class="WHIT">	    		</span><span class="NAME">_attr</span><span class="PUNC">(</span><span class="NAME">self.path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9304</span> </span><span class="WHIT">	    	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9305</span> </span><span class="WHIT">	    		    	</span><span class="WHIT">
<span class='line'>9306</span> </span><span class="WHIT">	    	</span><span class="NAME">_applyStyles</span><span class="PUNC">(</span><span class="NAME">self.svg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9307</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9308</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9309</span> </span><span class="WHIT">		</span><span class="NAME">this.reattachListeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9310</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.bgPath</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.reattachListenersForElement</span><span class="PUNC">(</span><span class="NAME">self.bgPath</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9311</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.path</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.reattachListenersForElement</span><span class="PUNC">(</span><span class="NAME">self.path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9312</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9313</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9314</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9315</span> 
<span class='line'>9316</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>9317</span> 	 * SVG Bezier Connector
<span class='line'>9318</span> 	 */</span><span class="WHIT">
<span class='line'>9319</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Connectors.svg.Bezier</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9320</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.Connectors.Bezier.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9321</span> </span><span class="WHIT">		</span><span class="NAME">SvgConnector.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9322</span> </span><span class="WHIT">		</span><span class="NAME">this.getPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9323</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"M "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>9324</span> </span><span class="WHIT">			</span><span class="NAME">_p</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">" C "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9325</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_p</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9326</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9327</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9328</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9329</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>9330</span> 	 * SVG straight line Connector
<span class='line'>9331</span> 	 */</span><span class="WHIT">
<span class='line'>9332</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Connectors.svg.Straight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9333</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.Connectors.Straight.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9334</span> </span><span class="WHIT">		</span><span class="NAME">SvgConnector.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	    		    </span><span class="WHIT">
<span class='line'>9335</span> </span><span class="WHIT">	    </span><span class="NAME">this.getPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"M "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" L "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">	    </span><span class="WHIT">
<span class='line'>9336</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9337</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9338</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Connectors.svg.Flowchart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9339</span> </span><span class="WHIT">    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9340</span> </span><span class="WHIT">    	</span><span class="NAME">jsPlumb.Connectors.Flowchart.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9341</span> </span><span class="WHIT">		</span><span class="NAME">SvgConnector.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9342</span> </span><span class="WHIT">    	</span><span class="NAME">this.getPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9343</span> </span><span class="WHIT">    		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"M "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9344</span> </span><span class="WHIT">				</span><span class="NAME">lx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9345</span> </span><span class="WHIT">				</span><span class="NAME">ly</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9346</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>9347</span> </span><span class="WHIT">	        </span><span class="COMM">// loop through extra points</span><span class="WHIT">
<span class='line'>9348</span> </span><span class="WHIT">	        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9349</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>9350</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9351</span> </span><span class="WHIT">					</span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>9352</span> </span><span class="WHIT">					</span><span class="NAME">horiz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">lx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">ly</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9353</span> </span><span class="WHIT">					</span><span class="NAME">vert</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">lx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">ly</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9354</span> </span><span class="WHIT">					</span><span class="NAME">multX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">horiz</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9355</span> </span><span class="WHIT">					</span><span class="NAME">multY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vert</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9356</span> </span><span class="WHIT">					</span><span class="NAME">halfStroke</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.lineWidth</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">;</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>9357</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>9358</span> </span><span class="WHIT">				</span><span class="COMM">// previously:</span><span class="WHIT">
<span class='line'>9359</span> </span><span class="WHIT">				</span><span class="COMM">//p = p + " L " + x1 + " " + y1;</span><span class="WHIT">
<span class='line'>9360</span> </span><span class="WHIT">				</span><span class="COMM">//p = p + " M " + x1 + " " + y1;</span><span class="WHIT">
<span class='line'>9361</span> </span><span class="WHIT">									</span><span class="WHIT">
<span class='line'>9362</span> </span><span class="WHIT">				</span><span class="COMM">// now, with support for painting an extra bit at the end each line:</span><span class="WHIT">
<span class='line'>9363</span> </span><span class="WHIT">	        	</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" L "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="PUNC">;</span><span class="WHIT">											</span><span class="WHIT">
<span class='line'>9364</span> </span><span class="WHIT">				</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" L "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">multX</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">halfStroke</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">multY</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">halfStroke</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9365</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>9366</span> </span><span class="WHIT">				</span><span class="NAME">lx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9367</span> </span><span class="WHIT">				</span><span class="NAME">ly</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>9368</span> </span><span class="WHIT">				</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" M "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>9369</span> </span><span class="WHIT">	        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9370</span> </span><span class="WHIT">	        </span><span class="COMM">// finally draw a line to the end</span><span class="WHIT">
<span class='line'>9371</span> </span><span class="WHIT">	        </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT">  </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" L "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">  </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9372</span> </span><span class="WHIT">	        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9373</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9374</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9375</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>9376</span> </span><span class="WHIT">    </span><span class="COMM">/*
<span class='line'>9377</span> 	 * Base class for SVG endpoints.
<span class='line'>9378</span> 	 */</span><span class="WHIT">
<span class='line'>9379</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">SvgEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.SvgEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9380</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9381</span> </span><span class="WHIT">		</span><span class="NAME">SvgComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9382</span> </span><span class="WHIT">			</span><span class="NAME">cssClass</span><span class="PUNC">:</span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"_jsPlumb"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpointClass</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9383</span> </span><span class="WHIT">			</span><span class="NAME">originalArgs</span><span class="PUNC">:</span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9384</span> </span><span class="WHIT">			</span><span class="NAME">pointerEventsSpec</span><span class="PUNC">:</span><span class="STRN">"all"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9385</span> </span><span class="WHIT">			</span><span class="NAME">useDivWrapper</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9386</span> </span><span class="WHIT">			</span><span class="NAME">_jsPlumb</span><span class="PUNC">:</span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"_jsPlumb"</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>9387</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9388</span> </span><span class="WHIT">		</span><span class="NAME">this._paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9389</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9390</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s.outlineColor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9391</span> </span><span class="WHIT">				</span><span class="NAME">s.strokeWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s.outlineWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9392</span> </span><span class="WHIT">				</span><span class="NAME">s.strokeStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.convertStyle</span><span class="PUNC">(</span><span class="NAME">s.outlineColor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9393</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9394</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9395</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.node</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9396</span> </span><span class="WHIT">				</span><span class="NAME">self.node</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.makeNode</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9397</span> </span><span class="WHIT">				</span><span class="NAME">self.svg.appendChild</span><span class="PUNC">(</span><span class="NAME">self.node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9398</span> </span><span class="WHIT">				</span><span class="NAME">self.attachListeners</span><span class="PUNC">(</span><span class="NAME">self.node</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9399</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9400</span> </span><span class="WHIT">			</span><span class="NAME">_applyStyles</span><span class="PUNC">(</span><span class="NAME">self.svg</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.node</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9401</span> </span><span class="WHIT">			</span><span class="NAME">_pos</span><span class="PUNC">(</span><span class="NAME">self.node</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9402</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9403</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9404</span> </span><span class="WHIT">		</span><span class="NAME">this.reattachListeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9405</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.node</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.reattachListenersForElement</span><span class="PUNC">(</span><span class="NAME">self.node</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9406</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9407</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9408</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9409</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>9410</span> 	 * SVG Dot Endpoint
<span class='line'>9411</span> 	 */</span><span class="WHIT">
<span class='line'>9412</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Endpoints.svg.Dot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9413</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.Endpoints.Dot.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9414</span> </span><span class="WHIT">		</span><span class="NAME">SvgEndpoint.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9415</span> </span><span class="WHIT">		</span><span class="NAME">this.makeNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9416</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="STRN">"circle"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9417</span> </span><span class="WHIT">					</span><span class="STRN">"cx"</span><span class="WHIT">	</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9418</span> </span><span class="WHIT">					</span><span class="STRN">"cy"</span><span class="WHIT">	</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9419</span> </span><span class="WHIT">					</span><span class="STRN">"r"</span><span class="WHIT">		</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT">
<span class='line'>9420</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9421</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9422</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9423</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9424</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>9425</span> 	 * SVG Rectangle Endpoint 
<span class='line'>9426</span> 	 */</span><span class="WHIT">
<span class='line'>9427</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Endpoints.svg.Rectangle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9428</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.Endpoints.Rectangle.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9429</span> </span><span class="WHIT">		</span><span class="NAME">SvgEndpoint.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9430</span> </span><span class="WHIT">		</span><span class="NAME">this.makeNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9431</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="STRN">"rect"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9432</span> </span><span class="WHIT">				</span><span class="STRN">"width"</span><span class="PUNC">:</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9433</span> </span><span class="WHIT">				</span><span class="STRN">"height"</span><span class="PUNC">:</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>9434</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9435</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9436</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9437</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9438</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>9439</span> 	 * SVG Image Endpoint is the default image endpoint.
<span class='line'>9440</span> 	 */</span><span class="WHIT">
<span class='line'>9441</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Endpoints.svg.Image</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Endpoints.Image</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9442</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>9443</span> 	 * Blank endpoint in svg renderer is the default Blank endpoint.
<span class='line'>9444</span> 	 */</span><span class="WHIT">
<span class='line'>9445</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Endpoints.svg.Blank</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Endpoints.Blank</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9446</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>9447</span> 	 * Label overlay in svg renderer is the default Label overlay.
<span class='line'>9448</span> 	 */</span><span class="WHIT">
<span class='line'>9449</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Overlays.svg.Label</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Overlays.Label</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9450</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>9451</span> 	 * Custom overlay in svg renderer is the default Custom overlay.
<span class='line'>9452</span> 	 */</span><span class="WHIT">
<span class='line'>9453</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Overlays.svg.Custom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Overlays.Custom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9454</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9455</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">AbstractSvgArrowOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">superclass</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalArgs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9456</span> </span><span class="WHIT">    	</span><span class="NAME">superclass.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9457</span> </span><span class="WHIT">    	</span><span class="NAME">jsPlumb.jsPlumbUIComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9458</span> </span><span class="WHIT">        </span><span class="NAME">this.isAppendedAtTopLevel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9459</span> </span><span class="WHIT">    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9460</span> </span><span class="WHIT">    	</span><span class="NAME">this.paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">connector</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">strokeStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fillStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9461</span> </span><span class="WHIT">    		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">path</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9462</span> </span><span class="WHIT">    			</span><span class="NAME">path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="STRN">"path"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9463</span> </span><span class="WHIT">    				</span><span class="STRN">"pointer-events"</span><span class="PUNC">:</span><span class="STRN">"all"</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9464</span> </span><span class="WHIT">    			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9465</span> </span><span class="WHIT">    			</span><span class="NAME">connector.svg.appendChild</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9466</span> </span><span class="WHIT">    			</span><span class="WHIT">
<span class='line'>9467</span> </span><span class="WHIT">    			</span><span class="NAME">self.attachListeners</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connector</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9468</span> </span><span class="WHIT">    			</span><span class="NAME">self.attachListeners</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9469</span> </span><span class="WHIT">    		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9470</span> </span><span class="WHIT">    		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">originalArgs</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">originalArgs.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">originalArgs</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cssClass</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9471</span> </span><span class="WHIT">    		</span><span class="WHIT">
<span class='line'>9472</span> </span><span class="WHIT">    		</span><span class="NAME">_attr</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9473</span> </span><span class="WHIT">    			</span><span class="STRN">"d"</span><span class="WHIT">		</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">makePath</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9474</span> </span><span class="WHIT">    			</span><span class="STRN">"class"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">clazz</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9475</span> </span><span class="WHIT">    			</span><span class="NAME">stroke</span><span class="WHIT"> 	</span><span class="PUNC">:</span><span class="WHIT"> 	</span><span class="NAME">strokeStyle</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">strokeStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9476</span> </span><span class="WHIT">    			</span><span class="NAME">fill</span><span class="WHIT"> 	</span><span class="PUNC">:</span><span class="WHIT"> 	</span><span class="NAME">fillStyle</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">fillStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT">
<span class='line'>9477</span> </span><span class="WHIT">    		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">    		</span><span class="WHIT">
<span class='line'>9478</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9479</span> </span><span class="WHIT">    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">makePath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9480</span> </span><span class="WHIT">    		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"M"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.hxy.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.hxy.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>9481</span> </span><span class="WHIT">    				</span><span class="STRN">" L"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.tail</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.tail</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9482</span> </span><span class="WHIT">    				</span><span class="STRN">" L"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.cxy.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.cxy.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9483</span> </span><span class="WHIT">    				</span><span class="STRN">" L"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.tail</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.tail</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9484</span> </span><span class="WHIT">    				</span><span class="STRN">" L"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.hxy.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d.hxy.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9485</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9486</span> </span><span class="WHIT">    	</span><span class="NAME">this.reattachListeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9487</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.reattachListenersForElement</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9488</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9489</span> </span><span class="WHIT">		</span><span class="NAME">this.cleanup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9490</span> </span><span class="WHIT">    		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">path</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.removeElement</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9491</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9492</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9493</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>9494</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Overlays.svg.Arrow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9495</span> </span><span class="WHIT">    	</span><span class="NAME">AbstractSvgArrowOverlay.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">jsPlumb.Overlays.Arrow</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>9496</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9497</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>9498</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Overlays.svg.PlainArrow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9499</span> </span><span class="WHIT">    	</span><span class="NAME">AbstractSvgArrowOverlay.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">jsPlumb.Overlays.PlainArrow</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>9500</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9501</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>9502</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Overlays.svg.Diamond</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9503</span> </span><span class="WHIT">    	</span><span class="NAME">AbstractSvgArrowOverlay.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">jsPlumb.Overlays.Diamond</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>9504</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9505</span> 
<span class='line'>9506</span> </span><span class="WHIT">    </span><span class="COMM">// a test</span><span class="WHIT">
<span class='line'>9507</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Overlays.svg.GuideLines</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9508</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">path2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p1_1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p1_2</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9509</span> </span><span class="WHIT">        </span><span class="NAME">jsPlumb.Overlays.GuideLines.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9510</span> </span><span class="WHIT">        </span><span class="NAME">this.paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">connector</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">strokeStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fillStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9511</span> </span><span class="WHIT">    		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">path</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9512</span> </span><span class="WHIT">    			</span><span class="NAME">path</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="STRN">"path"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9513</span> </span><span class="WHIT">    			</span><span class="NAME">connector.svg.appendChild</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9514</span> </span><span class="WHIT">    			</span><span class="NAME">self.attachListeners</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connector</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9515</span> </span><span class="WHIT">    			</span><span class="NAME">self.attachListeners</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9516</span> 
<span class='line'>9517</span> </span><span class="WHIT">                </span><span class="NAME">p1_1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="STRN">"path"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9518</span> </span><span class="WHIT">    			</span><span class="NAME">connector.svg.appendChild</span><span class="PUNC">(</span><span class="NAME">p1_1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9519</span> </span><span class="WHIT">    			</span><span class="NAME">self.attachListeners</span><span class="PUNC">(</span><span class="NAME">p1_1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connector</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9520</span> </span><span class="WHIT">    			</span><span class="NAME">self.attachListeners</span><span class="PUNC">(</span><span class="NAME">p1_1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9521</span> 
<span class='line'>9522</span> </span><span class="WHIT">                </span><span class="NAME">p1_2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_node</span><span class="PUNC">(</span><span class="STRN">"path"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9523</span> </span><span class="WHIT">    			</span><span class="NAME">connector.svg.appendChild</span><span class="PUNC">(</span><span class="NAME">p1_2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9524</span> </span><span class="WHIT">    			</span><span class="NAME">self.attachListeners</span><span class="PUNC">(</span><span class="NAME">p1_2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connector</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9525</span> </span><span class="WHIT">    			</span><span class="NAME">self.attachListeners</span><span class="PUNC">(</span><span class="NAME">p1_2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9526</span> 
<span class='line'>9527</span> </span><span class="WHIT">    		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9528</span> 
<span class='line'>9529</span> </span><span class="WHIT">    		</span><span class="NAME">_attr</span><span class="PUNC">(</span><span class="NAME">path</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9530</span> </span><span class="WHIT">    			</span><span class="STRN">"d"</span><span class="WHIT">		</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">makePath</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9531</span> </span><span class="WHIT">    			</span><span class="NAME">stroke</span><span class="WHIT"> 	</span><span class="PUNC">:</span><span class="WHIT"> 	</span><span class="STRN">"red"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9532</span> </span><span class="WHIT">    			</span><span class="NAME">fill</span><span class="WHIT"> 	</span><span class="PUNC">:</span><span class="WHIT"> 	</span><span class="KEYW">null</span><span class="WHIT">
<span class='line'>9533</span> </span><span class="WHIT">    		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9534</span> 
<span class='line'>9535</span> </span><span class="WHIT">            </span><span class="NAME">_attr</span><span class="PUNC">(</span><span class="NAME">p1_1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9536</span> </span><span class="WHIT">    			</span><span class="STRN">"d"</span><span class="WHIT">		</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">makePath</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9537</span> </span><span class="WHIT">    			</span><span class="NAME">stroke</span><span class="WHIT"> 	</span><span class="PUNC">:</span><span class="WHIT"> 	</span><span class="STRN">"blue"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9538</span> </span><span class="WHIT">    			</span><span class="NAME">fill</span><span class="WHIT"> 	</span><span class="PUNC">:</span><span class="WHIT"> 	</span><span class="KEYW">null</span><span class="WHIT">
<span class='line'>9539</span> </span><span class="WHIT">    		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9540</span> 
<span class='line'>9541</span> </span><span class="WHIT">            </span><span class="NAME">_attr</span><span class="PUNC">(</span><span class="NAME">p1_2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9542</span> </span><span class="WHIT">    			</span><span class="STRN">"d"</span><span class="WHIT">		</span><span class="PUNC">:</span><span class="WHIT">	</span><span class="NAME">makePath</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9543</span> </span><span class="WHIT">    			</span><span class="NAME">stroke</span><span class="WHIT"> 	</span><span class="PUNC">:</span><span class="WHIT"> 	</span><span class="STRN">"green"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9544</span> </span><span class="WHIT">    			</span><span class="NAME">fill</span><span class="WHIT"> 	</span><span class="PUNC">:</span><span class="WHIT"> 	</span><span class="KEYW">null</span><span class="WHIT">
<span class='line'>9545</span> </span><span class="WHIT">    		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9546</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9547</span> 
<span class='line'>9548</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">makePath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9549</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">"M "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d1.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d1.y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT">
<span class='line'>9550</span> </span><span class="WHIT">                   </span><span class="STRN">" L"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d2.x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">","</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">d2.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9551</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9552</span> 
<span class='line'>9553</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9554</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">/*
<span class='line'>9555</span>  * jsPlumb
<span class='line'>9556</span>  * 
<span class='line'>9557</span>  * Title:jsPlumb 1.3.15
<span class='line'>9558</span>  * 
<span class='line'>9559</span>  * Provides a way to visually connect elements on an HTML page, using either SVG, Canvas
<span class='line'>9560</span>  * elements, or VML.  
<span class='line'>9561</span>  * 
<span class='line'>9562</span>  * This file contains the HTML5 canvas renderers.
<span class='line'>9563</span>  *
<span class='line'>9564</span>  * Copyright (c) 2010 - 2012 Simon Porritt (http://jsplumb.org)
<span class='line'>9565</span>  * 
<span class='line'>9566</span>  * http://jsplumb.org
<span class='line'>9567</span>  * http://github.com/sporritt/jsplumb
<span class='line'>9568</span>  * http://code.google.com/p/jsplumb
<span class='line'>9569</span>  * 
<span class='line'>9570</span>  * Dual licensed under the MIT and GPL2 licenses.
<span class='line'>9571</span>  */</span><span class="WHIT">
<span class='line'>9572</span> 
<span class='line'>9573</span> </span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9574</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9575</span> </span><span class="COMM">// ********************************* CANVAS RENDERERS FOR CONNECTORS AND ENDPOINTS *******************************************************************</span><span class="WHIT">
<span class='line'>9576</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9577</span> </span><span class="WHIT">	</span><span class="COMM">// TODO refactor to renderer common script.  put a ref to jsPlumb.sizeCanvas in there too.</span><span class="WHIT">
<span class='line'>9578</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_connectionBeingDragged</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9579</span> </span><span class="WHIT">	    </span><span class="NAME">_hasClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.hasClass</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9580</span> </span><span class="WHIT">	    </span><span class="NAME">_getElementObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9581</span> </span><span class="WHIT">	    </span><span class="NAME">_getOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getOffset</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9582</span> </span><span class="WHIT">	    </span><span class="NAME">_pageXY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getPageXY</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9583</span> </span><span class="WHIT">	    </span><span class="NAME">_clientXY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getClientXY</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9584</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9585</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>9586</span> 	 * Class:CanvasMouseAdapter
<span class='line'>9587</span> 	 * Provides support for mouse events on canvases.  
<span class='line'>9588</span> 	 */</span><span class="WHIT">
<span class='line'>9589</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">CanvasMouseAdapter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9590</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9591</span> </span><span class="WHIT">		</span><span class="NAME">self.overlayPlacements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9592</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.jsPlumbUIComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9593</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumbUtil.EventGenerator.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9594</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>9595</span> 		 * returns whether or not the given event is ojver a painted area of the canvas. 
<span class='line'>9596</span> 		 */</span><span class="WHIT">
<span class='line'>9597</span> </span><span class="WHIT">	    </span><span class="NAME">this._over</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">		    			  		    	</span><span class="WHIT">
<span class='line'>9598</span> </span><span class="WHIT">	    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getOffset</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9599</span> </span><span class="WHIT">	    	</span><span class="NAME">pageXY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_pageXY</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9600</span> </span><span class="WHIT">	    	</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pageXY</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">o.left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pageXY</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">o.top</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9601</span> </span><span class="WHIT">	    	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.canvas.width</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.canvas.height</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9602</span> </span><span class="WHIT">		    	</span><span class="COMM">// first check overlays</span><span class="WHIT">
<span class='line'>9603</span> </span><span class="WHIT">		    	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.overlayPlacements.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9604</span> </span><span class="WHIT">		    		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.overlayPlacements</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9605</span> </span><span class="WHIT">		    		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>9606</span> </span><span class="WHIT">		    			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9607</span> </span><span class="WHIT">		    	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9608</span> </span><span class="WHIT">		    	</span><span class="WHIT">
<span class='line'>9609</span> </span><span class="WHIT">		    	</span><span class="COMM">// then the canvas</span><span class="WHIT">
<span class='line'>9610</span> </span><span class="WHIT">		    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.canvas.getContext</span><span class="PUNC">(</span><span class="STRN">"2d"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getImageData</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9611</span> </span><span class="WHIT">		    	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">d.data</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">d.data</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">d.data</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">d.data</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">		  </span><span class="WHIT">
<span class='line'>9612</span> </span><span class="WHIT">	    	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9613</span> </span><span class="WHIT">	    	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9614</span> </span><span class="WHIT">	    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9615</span> </span><span class="WHIT">	    </span><span class="WHIT">
<span class='line'>9616</span> </span><span class="WHIT">	    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_mouseover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_mouseDown</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_posWhenMouseDown</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_mouseWasDown</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9617</span> </span><span class="WHIT">	    </span><span class="NAME">_nullSafeHasClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9618</span> </span><span class="WHIT">	    	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_hasClass</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9619</span> </span><span class="WHIT">	    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9620</span> </span><span class="WHIT">	    </span><span class="NAME">this.mousemove</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">		    </span><span class="WHIT">
<span class='line'>9621</span> </span><span class="WHIT">	    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pageXY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_pageXY</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clientXY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_clientXY</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">	   </span><span class="WHIT">
<span class='line'>9622</span> </span><span class="WHIT">	    	</span><span class="NAME">ee</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.elementFromPoint</span><span class="PUNC">(</span><span class="NAME">clientXY</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clientXY</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9623</span> </span><span class="WHIT">	    	</span><span class="NAME">eventSourceWasOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_nullSafeHasClass</span><span class="PUNC">(</span><span class="NAME">ee</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"_jsPlumb_overlay"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	    	</span><span class="WHIT">
<span class='line'>9624</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_continue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_connectionBeingDragged</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_nullSafeHasClass</span><span class="PUNC">(</span><span class="NAME">ee</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"_jsPlumb_endpoint"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_nullSafeHasClass</span><span class="PUNC">(</span><span class="NAME">ee</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"_jsPlumb_connector"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9625</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_mouseover</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_continue</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">self._over</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9626</span> </span><span class="WHIT">				</span><span class="NAME">_mouseover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9627</span> </span><span class="WHIT">				</span><span class="NAME">self.fire</span><span class="PUNC">(</span><span class="STRN">"mouseenter"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9628</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9629</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9630</span> </span><span class="WHIT">			</span><span class="COMM">// TODO here there is a remote chance that the overlay the mouse moved onto</span><span class="WHIT">
<span class='line'>9631</span> </span><span class="WHIT">			</span><span class="COMM">// is actually not an overlay for the current component. a more thorough check would</span><span class="WHIT">
<span class='line'>9632</span> </span><span class="WHIT">			</span><span class="COMM">// be to ensure the overlay belonged to the current component.  </span><span class="WHIT">
<span class='line'>9633</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_mouseover</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">self._over</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_continue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">eventSourceWasOverlay</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9634</span> </span><span class="WHIT">				</span><span class="NAME">_mouseover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9635</span> </span><span class="WHIT">				</span><span class="NAME">self.fire</span><span class="PUNC">(</span><span class="STRN">"mouseexit"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>9636</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9637</span> </span><span class="WHIT">			</span><span class="NAME">self.fire</span><span class="PUNC">(</span><span class="STRN">"mousemove"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9638</span> </span><span class="WHIT">	    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9639</span> </span><span class="WHIT">	    		    		    </span><span class="WHIT">
<span class='line'>9640</span> </span><span class="WHIT">	    </span><span class="NAME">this.click</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	    		</span><span class="WHIT">
<span class='line'>9641</span> </span><span class="WHIT">	    	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_mouseover</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">self._over</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_mouseWasDown</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9642</span> </span><span class="WHIT">	    		</span><span class="NAME">self.fire</span><span class="PUNC">(</span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		    	</span><span class="WHIT">
<span class='line'>9643</span> </span><span class="WHIT">	    	</span><span class="NAME">_mouseWasDown</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9644</span> </span><span class="WHIT">	    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9645</span> </span><span class="WHIT">	    </span><span class="WHIT">
<span class='line'>9646</span> </span><span class="WHIT">	    </span><span class="NAME">this.dblclick</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9647</span> </span><span class="WHIT">	    	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_mouseover</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">self._over</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_mouseWasDown</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9648</span> </span><span class="WHIT">	    		</span><span class="NAME">self.fire</span><span class="PUNC">(</span><span class="STRN">"dblclick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		    	</span><span class="WHIT">
<span class='line'>9649</span> </span><span class="WHIT">	    	</span><span class="NAME">_mouseWasDown</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9650</span> </span><span class="WHIT">	    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9651</span> </span><span class="WHIT">	    </span><span class="WHIT">
<span class='line'>9652</span> </span><span class="WHIT">	    </span><span class="NAME">this.mousedown</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9653</span> </span><span class="WHIT">	    	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">self._over</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_mouseDown</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9654</span> </span><span class="WHIT">	    		</span><span class="NAME">_mouseDown</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">	    		</span><span class="WHIT">
<span class='line'>9655</span> </span><span class="WHIT">	    		</span><span class="NAME">_posWhenMouseDown</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getOffset</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9656</span> </span><span class="WHIT">	    		</span><span class="NAME">self.fire</span><span class="PUNC">(</span><span class="STRN">"mousedown"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9657</span> </span><span class="WHIT">	    	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9658</span> </span><span class="WHIT">	    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9659</span> </span><span class="WHIT">	    </span><span class="WHIT">
<span class='line'>9660</span> </span><span class="WHIT">	    </span><span class="NAME">this.mouseup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9661</span> </span><span class="WHIT">	    	</span><span class="NAME">_mouseDown</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9662</span> </span><span class="WHIT">	    	</span><span class="NAME">self.fire</span><span class="PUNC">(</span><span class="STRN">"mouseup"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9663</span> </span><span class="WHIT">	    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9664</span> 
<span class='line'>9665</span> </span><span class="WHIT">        </span><span class="NAME">this.contextmenu</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9666</span> </span><span class="WHIT">          </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_mouseover</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">self._over</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_mouseWasDown</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>9667</span> </span><span class="WHIT">            </span><span class="NAME">self.fire</span><span class="PUNC">(</span><span class="STRN">"contextmenu"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9668</span> </span><span class="WHIT">          </span><span class="NAME">_mouseWasDown</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9669</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9670</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9671</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9672</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_newCanvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9673</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"canvas"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9674</span> </span><span class="WHIT">		</span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"_jsPlumb"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">appendElement</span><span class="PUNC">(</span><span class="NAME">canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9675</span> </span><span class="WHIT">		</span><span class="NAME">canvas.style.position</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"absolute"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9676</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"class"</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">canvas.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"class"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9677</span> </span><span class="WHIT">		</span><span class="COMM">// set an id. if no id on the element and if uuid was supplied it</span><span class="WHIT">
<span class='line'>9678</span> </span><span class="WHIT">		</span><span class="COMM">// will be used, otherwise we'll create one.</span><span class="WHIT">
<span class='line'>9679</span> </span><span class="WHIT">		</span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"_jsPlumb"</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getId</span><span class="PUNC">(</span><span class="NAME">canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.uuid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9680</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.tooltip</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">canvas.setAttribute</span><span class="PUNC">(</span><span class="STRN">"title"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.tooltip</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9681</span> 
<span class='line'>9682</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">canvas</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9683</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9684</span> 
<span class='line'>9685</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">CanvasComponent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9686</span> </span><span class="WHIT">		</span><span class="NAME">CanvasMouseAdapter.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9687</span> 
<span class='line'>9688</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">displayElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9689</span> </span><span class="WHIT">		</span><span class="NAME">this.getDisplayElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">displayElements</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9690</span> </span><span class="WHIT">		</span><span class="NAME">this.appendDisplayElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">displayElements.push</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9691</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9692</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9693</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>9694</span> 	 * Class:CanvasConnector
<span class='line'>9695</span> 	 * Superclass for Canvas Connector renderers.
<span class='line'>9696</span> 	 */</span><span class="WHIT">
<span class='line'>9697</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">CanvasConnector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CanvasConnector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9698</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9699</span> </span><span class="WHIT">		</span><span class="NAME">CanvasComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9700</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9701</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_paintOneStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dim</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9702</span> </span><span class="WHIT">			</span><span class="NAME">self.ctx.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9703</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">self.ctx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9704</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">aStyle.gradient</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9705</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.createGradient</span><span class="PUNC">(</span><span class="NAME">dim</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.ctx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9706</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">aStyle.gradient.stops.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>9707</span> </span><span class="WHIT">					</span><span class="NAME">g.addColorStop</span><span class="PUNC">(</span><span class="NAME">aStyle.gradient.stops</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aStyle.gradient.stops</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9708</span> </span><span class="WHIT">				</span><span class="NAME">self.ctx.strokeStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9709</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9710</span> </span><span class="WHIT">			</span><span class="NAME">self._paint</span><span class="PUNC">(</span><span class="NAME">dim</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9711</span> </span><span class="WHIT">			</span><span class="NAME">self.ctx.restore</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9712</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9713</span> 
<span class='line'>9714</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9715</span> </span><span class="WHIT">		</span><span class="NAME">clazz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb.connectorClass</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.cssClass</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9716</span> </span><span class="WHIT">		</span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_newCanvas</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9717</span> </span><span class="WHIT">			</span><span class="STRN">"class"</span><span class="PUNC">:</span><span class="NAME">clazz</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9718</span> </span><span class="WHIT">			</span><span class="NAME">_jsPlumb</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9719</span> </span><span class="WHIT">			</span><span class="NAME">parent</span><span class="PUNC">:</span><span class="NAME">params.parent</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9720</span> </span><span class="WHIT">			</span><span class="NAME">tooltip</span><span class="PUNC">:</span><span class="NAME">params.tooltip</span><span class="WHIT">
<span class='line'>9721</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9722</span> </span><span class="WHIT">		</span><span class="NAME">self.ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.canvas.getContext</span><span class="PUNC">(</span><span class="STRN">"2d"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9723</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9724</span> </span><span class="WHIT">		</span><span class="NAME">self.appendDisplayElement</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9725</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9726</span> </span><span class="WHIT">		</span><span class="NAME">self.paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dim</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>9727</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">																				</span><span class="WHIT">
<span class='line'>9728</span> </span><span class="WHIT">				</span><span class="NAME">jsPlumb.sizeCanvas</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9729</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.getZIndex</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>9730</span> </span><span class="WHIT">					</span><span class="NAME">self.canvas.style.zIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.getZIndex</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9731</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style.outlineColor</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9732</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">outlineWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style.outlineWidth</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9733</span> </span><span class="WHIT">					</span><span class="NAME">outlineStrokeWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style.lineWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">outlineWidth</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9734</span> </span><span class="WHIT">					</span><span class="NAME">outlineStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9735</span> </span><span class="WHIT">						</span><span class="NAME">strokeStyle</span><span class="PUNC">:</span><span class="NAME">style.outlineColor</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9736</span> </span><span class="WHIT">						</span><span class="NAME">lineWidth</span><span class="PUNC">:</span><span class="NAME">outlineStrokeWidth</span><span class="WHIT">
<span class='line'>9737</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9738</span> </span><span class="WHIT">					</span><span class="NAME">_paintOneStyle</span><span class="PUNC">(</span><span class="NAME">dim</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">outlineStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9739</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9740</span> </span><span class="WHIT">				</span><span class="NAME">_paintOneStyle</span><span class="PUNC">(</span><span class="NAME">dim</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9741</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9742</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>9743</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9744</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9745</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>9746</span> 	 * Class:CanvasEndpoint
<span class='line'>9747</span> 	 * Superclass for Canvas Endpoint renderers.
<span class='line'>9748</span> 	 */</span><span class="WHIT">
<span class='line'>9749</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">CanvasEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9750</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>9751</span> </span><span class="WHIT">		</span><span class="NAME">CanvasComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9752</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb.endpointClass</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.cssClass</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9753</span> </span><span class="WHIT">			</span><span class="NAME">canvasParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9754</span> </span><span class="WHIT">			</span><span class="STRN">"class"</span><span class="PUNC">:</span><span class="NAME">clazz</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9755</span> </span><span class="WHIT">			</span><span class="NAME">_jsPlumb</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9756</span> </span><span class="WHIT">			</span><span class="NAME">parent</span><span class="PUNC">:</span><span class="NAME">params.parent</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9757</span> </span><span class="WHIT">			</span><span class="NAME">tooltip</span><span class="PUNC">:</span><span class="NAME">self.tooltip</span><span class="WHIT">
<span class='line'>9758</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9759</span> </span><span class="WHIT">		</span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_newCanvas</span><span class="PUNC">(</span><span class="NAME">canvasParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9760</span> </span><span class="WHIT">		</span><span class="NAME">self.ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.canvas.getContext</span><span class="PUNC">(</span><span class="STRN">"2d"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9761</span> 
<span class='line'>9762</span> </span><span class="WHIT">		</span><span class="NAME">self.appendDisplayElement</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9763</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9764</span> </span><span class="WHIT">		</span><span class="NAME">this.paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9765</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.sizeCanvas</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9766</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style.outlineColor</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9767</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">outlineWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style.outlineWidth</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9768</span> </span><span class="WHIT">				</span><span class="NAME">outlineStrokeWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style.lineWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">outlineWidth</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9769</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">outlineStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9770</span> </span><span class="WHIT">					</span><span class="NAME">strokeStyle</span><span class="PUNC">:</span><span class="NAME">style.outlineColor</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9771</span> </span><span class="WHIT">					</span><span class="NAME">lineWidth</span><span class="PUNC">:</span><span class="NAME">outlineStrokeWidth</span><span class="WHIT">
<span class='line'>9772</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9773</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9774</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9775</span> </span><span class="WHIT">			</span><span class="NAME">self._paint.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9776</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9777</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9778</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9779</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Endpoints.canvas.Dot</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9780</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.Endpoints.Dot.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9781</span> </span><span class="WHIT">		</span><span class="NAME">CanvasEndpoint.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9782</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9783</span> </span><span class="WHIT">		</span><span class="NAME">parseValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9784</span> </span><span class="WHIT">			</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9785</span> </span><span class="WHIT">			</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9786</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">value.substring</span><span class="PUNC">(</span><span class="NAME">value.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'%'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>9787</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">value.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9788</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9789</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">					    	</span><span class="WHIT">
<span class='line'>9790</span> </span><span class="WHIT">		</span><span class="NAME">calculateAdjustments</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">gradient</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9791</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">offsetAdjustment</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.defaultOffset</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">innerRadius</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.defaultInnerRadius</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9792</span> </span><span class="WHIT">			</span><span class="NAME">gradient.offset</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">offsetAdjustment</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseValue</span><span class="PUNC">(</span><span class="NAME">gradient.offset</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9793</span> </span><span class="WHIT">        	</span><span class="NAME">gradient.innerRadius</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">innerRadius</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseValue</span><span class="PUNC">(</span><span class="NAME">gradient.innerRadius</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9794</span> </span><span class="WHIT">        	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">offsetAdjustment</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">innerRadius</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9795</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9796</span> </span><span class="WHIT">		</span><span class="NAME">this._paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9797</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9798</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.canvas.getContext</span><span class="PUNC">(</span><span class="STRN">'2d'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchor.getOrientation</span><span class="PUNC">(</span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9799</span> </span><span class="WHIT">				</span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">ctx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>9800</span> </span><span class="WHIT">	            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style.gradient</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">            	</span><span class="WHIT">
<span class='line'>9801</span> </span><span class="WHIT">	            	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">adjustments</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateAdjustments</span><span class="PUNC">(</span><span class="NAME">style.gradient</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9802</span> </span><span class="WHIT">	            	</span><span class="NAME">yAdjust</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">adjustments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">adjustments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9803</span> </span><span class="WHIT">	            	</span><span class="NAME">xAdjust</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">adjustments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="WHIT">  </span><span class="NAME">adjustments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9804</span> </span><span class="WHIT">	            	</span><span class="NAME">g</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ctx.createRadialGradient</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">xAdjust</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">yAdjust</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">adjustments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9805</span> </span><span class="WHIT">		            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">style.gradient.stops.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>9806</span> </span><span class="WHIT">		            	</span><span class="NAME">g.addColorStop</span><span class="PUNC">(</span><span class="NAME">style.gradient.stops</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style.gradient.stops</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9807</span> </span><span class="WHIT">		            </span><span class="NAME">ctx.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9808</span> </span><span class="WHIT">	            </span><span class="PUNC">}</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>9809</span> </span><span class="WHIT">				</span><span class="NAME">ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">    		</span><span class="WHIT">
<span class='line'>9810</span> </span><span class="WHIT">				</span><span class="NAME">ctx.arc</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9811</span> </span><span class="WHIT">				</span><span class="NAME">ctx.closePath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>9812</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style.fillStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">style.gradient</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">ctx.fill</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9813</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style.strokeStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">ctx.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9814</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9815</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9816</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9817</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9818</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Endpoints.canvas.Rectangle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9819</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9820</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9821</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.Endpoints.Rectangle.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9822</span> </span><span class="WHIT">		</span><span class="NAME">CanvasEndpoint.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>9823</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9824</span> </span><span class="WHIT">    	</span><span class="NAME">this._paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9825</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>9826</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.canvas.getContext</span><span class="PUNC">(</span><span class="STRN">"2d"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchor.getOrientation</span><span class="PUNC">(</span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9827</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">ctx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9828</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9829</span> </span><span class="WHIT">			</span><span class="COMM">/* canvas gradient */</span><span class="WHIT">
<span class='line'>9830</span> </span><span class="WHIT">		    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style.gradient</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9831</span> </span><span class="WHIT">		    	</span><span class="COMM">// first figure out which direction to run the gradient in (it depends on the orientation of the anchors)</span><span class="WHIT">
<span class='line'>9832</span> </span><span class="WHIT">		    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9833</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">y2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9834</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9835</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9836</span> </span><span class="WHIT">			    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ctx.createLinearGradient</span><span class="PUNC">(</span><span class="NAME">x1</span><span class="PUNC">,</span><span class="NAME">y1</span><span class="PUNC">,</span><span class="NAME">x2</span><span class="PUNC">,</span><span class="NAME">y2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9837</span> </span><span class="WHIT">			    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">style.gradient.stops.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>9838</span> </span><span class="WHIT">	            	</span><span class="NAME">g.addColorStop</span><span class="PUNC">(</span><span class="NAME">style.gradient.stops</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style.gradient.stops</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9839</span> </span><span class="WHIT">	            </span><span class="NAME">ctx.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9840</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9841</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9842</span> </span><span class="WHIT">			</span><span class="NAME">ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9843</span> </span><span class="WHIT">			</span><span class="NAME">ctx.rect</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9844</span> </span><span class="WHIT">			</span><span class="NAME">ctx.closePath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>9845</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style.fillStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">style.gradient</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">ctx.fill</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9846</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style.strokeStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">ctx.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9847</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9848</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9849</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9850</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Endpoints.canvas.Triangle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9851</span> </span><span class="WHIT">	        			</span><span class="WHIT">
<span class='line'>9852</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9853</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.Endpoints.Triangle.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9854</span> </span><span class="WHIT">		</span><span class="NAME">CanvasEndpoint.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9855</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9856</span> </span><span class="WHIT">    	</span><span class="NAME">this._paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>9857</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">    		</span><span class="WHIT">
<span class='line'>9858</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9859</span> </span><span class="WHIT">			</span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.canvas.getContext</span><span class="PUNC">(</span><span class="STRN">'2d'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9860</span> </span><span class="WHIT">			</span><span class="NAME">offsetX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9861</span> </span><span class="WHIT">			</span><span class="NAME">orientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchor.getOrientation</span><span class="PUNC">(</span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9862</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9863</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9864</span> </span><span class="WHIT">				</span><span class="NAME">offsetX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9865</span> </span><span class="WHIT">				</span><span class="NAME">offsetY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9866</span> </span><span class="WHIT">				</span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">180</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9867</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9868</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9869</span> </span><span class="WHIT">				</span><span class="NAME">offsetX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9870</span> </span><span class="WHIT">				</span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">90</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9871</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9872</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9873</span> </span><span class="WHIT">				</span><span class="NAME">offsetY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9874</span> </span><span class="WHIT">				</span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">90</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9875</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9876</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9877</span> </span><span class="WHIT">			</span><span class="NAME">ctx.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style.fillStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9878</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9879</span> </span><span class="WHIT">			</span><span class="NAME">ctx.translate</span><span class="PUNC">(</span><span class="NAME">offsetX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">offsetY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9880</span> </span><span class="WHIT">			</span><span class="NAME">ctx.rotate</span><span class="PUNC">(</span><span class="NAME">angle</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="PUNC">/</span><span class="NUMB">180</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9881</span> 
<span class='line'>9882</span> </span><span class="WHIT">			</span><span class="NAME">ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9883</span> </span><span class="WHIT">			</span><span class="NAME">ctx.moveTo</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9884</span> </span><span class="WHIT">			</span><span class="NAME">ctx.lineTo</span><span class="PUNC">(</span><span class="NAME">width</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9885</span> </span><span class="WHIT">			</span><span class="NAME">ctx.lineTo</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9886</span> </span><span class="WHIT">			</span><span class="NAME">ctx.closePath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9887</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style.fillStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">style.gradient</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">ctx.fill</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9888</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style.strokeStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">ctx.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>9889</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9890</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9891</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9892</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>9893</span> 	 * Canvas Image Endpoint: uses the default version, which creates an &lt;img> tag.
<span class='line'>9894</span> 	 */</span><span class="WHIT">
<span class='line'>9895</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Endpoints.canvas.Image</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Endpoints.Image</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9896</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9897</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>9898</span> 	 * Blank endpoint in all renderers is just the default Blank endpoint.
<span class='line'>9899</span> 	 */</span><span class="WHIT">
<span class='line'>9900</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Endpoints.canvas.Blank</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Endpoints.Blank</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9901</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>9902</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>9903</span>      * Canvas Bezier Connector. Draws a Bezier curve onto a Canvas element.
<span class='line'>9904</span>      */</span><span class="WHIT">
<span class='line'>9905</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Connectors.canvas.Bezier</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9906</span> </span><span class="WHIT">    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9907</span> </span><span class="WHIT">    	</span><span class="NAME">jsPlumb.Connectors.Bezier.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>9908</span> </span><span class="WHIT">    	</span><span class="NAME">CanvasConnector.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9909</span> </span><span class="WHIT">    	</span><span class="NAME">this._paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9910</span> </span><span class="WHIT">        	</span><span class="NAME">self.ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9911</span> </span><span class="WHIT">        	</span><span class="NAME">self.ctx.moveTo</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9912</span> </span><span class="WHIT">        	</span><span class="NAME">self.ctx.bezierCurveTo</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">11</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	            </span><span class="WHIT">
<span class='line'>9913</span> </span><span class="WHIT">        	</span><span class="NAME">self.ctx.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>9914</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9915</span> </span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>9916</span> </span><span class="WHIT">        </span><span class="COMM">// TODO i doubt this handles the case that source and target are swapped.</span><span class="WHIT">
<span class='line'>9917</span> </span><span class="WHIT">        </span><span class="NAME">this.createGradient</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dim</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">swap</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9918</span> </span><span class="WHIT">        	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="COMM">/*(swap) ? self.ctx.createLinearGradient(dim[4], dim[5], dim[6], dim[7]) : */</span><span class="NAME">self.ctx.createLinearGradient</span><span class="PUNC">(</span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9919</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9920</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9921</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>9922</span> </span><span class="WHIT">    </span><span class="COMM">/*
<span class='line'>9923</span>      * Canvas straight line Connector. Draws a straight line onto a Canvas element.
<span class='line'>9924</span>      */</span><span class="WHIT">
<span class='line'>9925</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Connectors.canvas.Straight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">   	 </span><span class="WHIT">
<span class='line'>9926</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9927</span> </span><span class="WHIT">			</span><span class="NAME">segmentMultipliers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9928</span> 
<span class='line'>9929</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumb.Connectors.Straight.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9930</span> </span><span class="WHIT">		</span><span class="NAME">CanvasConnector.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9931</span> </span><span class="WHIT">		</span><span class="NAME">this._paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9932</span> 
<span class='line'>9933</span> </span><span class="WHIT">			</span><span class="NAME">self.ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9934</span> 
<span class='line'>9935</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">style.dashstyle</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">style.dashstyle.split</span><span class="PUNC">(</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>9936</span> </span><span class="WHIT">				</span><span class="COMM">// only a very simple dashed style is supported - having two values, which define the stroke length </span><span class="WHIT">
<span class='line'>9937</span> </span><span class="WHIT">				</span><span class="COMM">// (as a multiple of the stroke width) and then the space length (also as a multiple of stroke width). </span><span class="WHIT">
<span class='line'>9938</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style.dashstyle.split</span><span class="PUNC">(</span><span class="STRN">" "</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9939</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ds.length</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">ds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9940</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dss</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">ds</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">style.lineWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ds</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">style.lineWidth</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9941</span> </span><span class="WHIT">					</span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9942</span> </span><span class="WHIT">					</span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.segment</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9943</span> </span><span class="WHIT">					</span><span class="NAME">sm</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">segmentMultipliers</span><span class="PUNC">[</span><span class="NAME">s</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9944</span> </span><span class="WHIT">					</span><span class="NAME">theta</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.atan</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9945</span> </span><span class="WHIT">					</span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9946</span> </span><span class="WHIT">					</span><span class="NAME">repeats</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dss</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dss</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9947</span> </span><span class="WHIT">					</span><span class="NAME">curPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9948</span> 
<span class='line'>9949</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>9950</span> </span><span class="WHIT">				</span><span class="COMM">// TODO: the question here is why could we not support this in all connector types? it's really</span><span class="WHIT">
<span class='line'>9951</span> </span><span class="WHIT">				</span><span class="COMM">// just a case of going along and asking jsPlumb for the next point on the path a few times, until it</span><span class="WHIT">
<span class='line'>9952</span> </span><span class="WHIT">				</span><span class="COMM">// reaches the end. every type of connector supports that method, after all.  but right now its only the</span><span class="WHIT">
<span class='line'>9953</span> </span><span class="WHIT">				</span><span class="COMM">// bezier connector that gives you back the new location on the path along with the x,y coordinates, which</span><span class="WHIT">
<span class='line'>9954</span> </span><span class="WHIT">				</span><span class="COMM">// we would need. we'd start out at loc=0 and ask for the point along the path that is dss[0] pixels away.</span><span class="WHIT">
<span class='line'>9955</span> </span><span class="WHIT">				</span><span class="COMM">// we then ask for the point that is (dss[0] + dss[1]) pixels away; and from that one we need not just the</span><span class="WHIT">
<span class='line'>9956</span> </span><span class="WHIT">				</span><span class="COMM">// x,y but the location, cos we're gonna plug that location back in in order to find where that dash ends.</span><span class="WHIT">
<span class='line'>9957</span> </span><span class="WHIT">				</span><span class="COMM">//</span><span class="WHIT">
<span class='line'>9958</span> </span><span class="WHIT">				</span><span class="COMM">// it also strikes me that it should be trivial to support arbitrary dash styles (having more or less than two</span><span class="WHIT">
<span class='line'>9959</span> </span><span class="WHIT">				</span><span class="COMM">// entries). you'd just iterate that array using a step size of 2, and generify the (rss[0] + rss[1])</span><span class="WHIT">
<span class='line'>9960</span> </span><span class="WHIT">				</span><span class="COMM">// computation to be sum(rss[0]..rss[n]).</span><span class="WHIT">
<span class='line'>9961</span> 
<span class='line'>9962</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">repeats</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9963</span> </span><span class="WHIT">					</span><span class="NAME">self.ctx.moveTo</span><span class="PUNC">(</span><span class="NAME">curPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9964</span> 
<span class='line'>9965</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nextEndX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">theta</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dss</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">sm</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9966</span> </span><span class="WHIT">						</span><span class="NAME">nextEndY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">theta</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">dss</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">sm</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9967</span> </span><span class="WHIT">						</span><span class="NAME">nextStartX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">theta</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dss</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dss</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">  </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">sm</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>9968</span> </span><span class="WHIT">						</span><span class="NAME">nextStartY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">curPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">theta</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dss</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dss</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">sm</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>9969</span> 
<span class='line'>9970</span> </span><span class="WHIT">					</span><span class="NAME">self.ctx.lineTo</span><span class="PUNC">(</span><span class="NAME">nextEndX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nextEndY</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9971</span> </span><span class="WHIT">					</span><span class="NAME">curPos</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">nextStartX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nextStartY</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>9972</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9973</span> 
<span class='line'>9974</span> </span><span class="WHIT">				</span><span class="COMM">// now draw the last bit</span><span class="WHIT">
<span class='line'>9975</span> </span><span class="WHIT">				</span><span class="NAME">self.ctx.moveTo</span><span class="PUNC">(</span><span class="NAME">curPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9976</span> </span><span class="WHIT">				</span><span class="NAME">self.ctx.lineTo</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>9977</span> 
<span class='line'>9978</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">	        </span><span class="WHIT">
<span class='line'>9979</span> </span><span class="WHIT">	        </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9980</span> </span><span class="WHIT">		        </span><span class="NAME">self.ctx.moveTo</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9981</span> </span><span class="WHIT">	        	</span><span class="NAME">self.ctx.lineTo</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9982</span> </span><span class="WHIT">	        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>9983</span> </span><span class="WHIT">	        	      </span><span class="WHIT">
<span class='line'>9984</span> </span><span class="WHIT">	        </span><span class="NAME">self.ctx.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>9985</span> </span><span class="WHIT">	    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9986</span> </span><span class="WHIT">	    </span><span class="WHIT">
<span class='line'>9987</span> </span><span class="WHIT">	    </span><span class="COMM">// TODO this does not handle the case that src and target are swapped.</span><span class="WHIT">
<span class='line'>9988</span> </span><span class="WHIT">	    </span><span class="NAME">this.createGradient</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dim</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9989</span> </span><span class="WHIT">        	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ctx.createLinearGradient</span><span class="PUNC">(</span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9990</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9991</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9992</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>9993</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Connectors.canvas.Flowchart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9994</span> </span><span class="WHIT">    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9995</span> </span><span class="WHIT">    	</span><span class="NAME">jsPlumb.Connectors.Flowchart.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9996</span> </span><span class="WHIT">		</span><span class="NAME">CanvasConnector.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9997</span> </span><span class="WHIT">    	</span><span class="NAME">this._paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>9998</span> </span><span class="WHIT">	        </span><span class="NAME">self.ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>9999</span> </span><span class="WHIT">	        </span><span class="NAME">self.ctx.moveTo</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10000</span> </span><span class="WHIT">	        </span><span class="COMM">// loop through extra points</span><span class="WHIT">
<span class='line'>10001</span> </span><span class="WHIT">	        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">8</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10002</span> </span><span class="WHIT">	        	</span><span class="NAME">self.ctx.lineTo</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">9</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">10</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">*</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10003</span> </span><span class="WHIT">	        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10004</span> </span><span class="WHIT">	        </span><span class="COMM">// finally draw a line to the end</span><span class="WHIT">
<span class='line'>10005</span> </span><span class="WHIT">	        </span><span class="NAME">self.ctx.lineTo</span><span class="PUNC">(</span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10006</span> </span><span class="WHIT">	        </span><span class="NAME">self.ctx.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10007</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10008</span> </span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>10009</span> </span><span class="WHIT">    	</span><span class="NAME">this.createGradient</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dim</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10010</span> </span><span class="WHIT">        	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ctx.createLinearGradient</span><span class="PUNC">(</span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">6</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="PUNC">[</span><span class="NUMB">7</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10011</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10012</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10013</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>10014</span> </span><span class="COMM">// ********************************* END OF CANVAS RENDERERS *******************************************************************    </span><span class="WHIT">
<span class='line'>10015</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>10016</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Overlays.canvas.Label</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Overlays.Label</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10017</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Overlays.canvas.Custom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Overlays.Custom</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10018</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>10019</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>10020</span>      * a placeholder right now, really just exists to mirror the fact that there are SVG and VML versions of this. 
<span class='line'>10021</span>      */</span><span class="WHIT">
<span class='line'>10022</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">CanvasOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>10023</span> </span><span class="WHIT">    	</span><span class="NAME">jsPlumb.jsPlumbUIComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10024</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10025</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>10026</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">AbstractCanvasArrowOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">superclass</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalArgs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10027</span> </span><span class="WHIT">    	</span><span class="NAME">superclass.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10028</span> </span><span class="WHIT">    	</span><span class="NAME">CanvasOverlay.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10029</span> </span><span class="WHIT">    	</span><span class="NAME">this.paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">connector</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">strokeStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fillStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10030</span> </span><span class="WHIT">    		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ctx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connector.ctx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10031</span> </span><span class="WHIT">    		</span><span class="WHIT">
<span class='line'>10032</span> </span><span class="WHIT">			</span><span class="NAME">ctx.lineWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10033</span> </span><span class="WHIT">			</span><span class="NAME">ctx.beginPath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10034</span> </span><span class="WHIT">			</span><span class="NAME">ctx.moveTo</span><span class="PUNC">(</span><span class="NAME">d.hxy.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d.hxy.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10035</span> </span><span class="WHIT">			</span><span class="NAME">ctx.lineTo</span><span class="PUNC">(</span><span class="NAME">d.tail</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d.tail</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10036</span> </span><span class="WHIT">			</span><span class="NAME">ctx.lineTo</span><span class="PUNC">(</span><span class="NAME">d.cxy.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d.cxy.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10037</span> </span><span class="WHIT">			</span><span class="NAME">ctx.lineTo</span><span class="PUNC">(</span><span class="NAME">d.tail</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d.tail</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10038</span> </span><span class="WHIT">			</span><span class="NAME">ctx.lineTo</span><span class="PUNC">(</span><span class="NAME">d.hxy.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d.hxy.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10039</span> </span><span class="WHIT">			</span><span class="NAME">ctx.closePath</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>10040</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>10041</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">strokeStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10042</span> </span><span class="WHIT">				</span><span class="NAME">ctx.strokeStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">strokeStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10043</span> </span><span class="WHIT">				</span><span class="NAME">ctx.stroke</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10044</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10045</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fillStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10046</span> </span><span class="WHIT">				</span><span class="NAME">ctx.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fillStyle</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>10047</span> </span><span class="WHIT">				</span><span class="NAME">ctx.fill</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10048</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10049</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10050</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>10051</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>10052</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Overlays.canvas.Arrow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10053</span> </span><span class="WHIT">    	</span><span class="NAME">AbstractCanvasArrowOverlay.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">jsPlumb.Overlays.Arrow</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>10054</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10055</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>10056</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Overlays.canvas.PlainArrow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10057</span> </span><span class="WHIT">    	</span><span class="NAME">AbstractCanvasArrowOverlay.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">jsPlumb.Overlays.PlainArrow</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>10058</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10059</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>10060</span> </span><span class="WHIT">    </span><span class="NAME">jsPlumb.Overlays.canvas.Diamond</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10061</span> </span><span class="WHIT">    	</span><span class="NAME">AbstractCanvasArrowOverlay.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">jsPlumb.Overlays.Diamond</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">    	</span><span class="WHIT">
<span class='line'>10062</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10063</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">/*
<span class='line'>10064</span>  * jsPlumb
<span class='line'>10065</span>  * 
<span class='line'>10066</span>  * Title:jsPlumb 1.3.15
<span class='line'>10067</span>  * 
<span class='line'>10068</span>  * Provides a way to visually connect elements on an HTML page, using either SVG, Canvas
<span class='line'>10069</span>  * elements, or VML.  
<span class='line'>10070</span>  * 
<span class='line'>10071</span>  * This file contains the YUI3 adapter.
<span class='line'>10072</span>  *
<span class='line'>10073</span>  * Copyright (c) 2010 - 2012 Simon Porritt (http://jsplumb.org)
<span class='line'>10074</span>  * 
<span class='line'>10075</span>  * http://jsplumb.org
<span class='line'>10076</span>  * http://github.com/sporritt/jsplumb
<span class='line'>10077</span>  * http://code.google.com/p/jsplumb
<span class='line'>10078</span>  * 
<span class='line'>10079</span>  * Dual licensed under the MIT and GPL2 licenses.
<span class='line'>10080</span>  */</span><span class="WHIT">
<span class='line'>10081</span> 
<span class='line'>10082</span> </span><span class="COMM">/**
<span class='line'>10083</span>  * addClass				adds a class to the given element
<span class='line'>10084</span>  * animate				calls the underlying library's animate functionality
<span class='line'>10085</span>  * appendElement		appends a child element to a parent element.
<span class='line'>10086</span>  * bind					binds some event to an element
<span class='line'>10087</span>  * dragEvents			a dictionary of event names
<span class='line'>10088</span>  * extend				extend some js object with another.  probably not overly necessary; jsPlumb could just do this internally.
<span class='line'>10089</span>  * getAttribute			gets some attribute from an element
<span class='line'>10090</span>  * getDragObject		gets the object that is being dragged, by extracting it from the arguments passed to a drag callback
<span class='line'>10091</span>  * getDragScope			gets the drag scope for a given element.
<span class='line'>10092</span>  * getElementObject		turns an id or dom element into an element object of the underlying library's type.
<span class='line'>10093</span>  * getOffset			gets an element's offset
<span class='line'>10094</span>  * getOriginalEvent     gets the original browser event from some wrapper event.
<span class='line'>10095</span>  * getScrollLeft		gets an element's scroll left.  TODO: is this actually used?  will it be?
<span class='line'>10096</span>  * getScrollTop			gets an element's scroll top.  TODO: is this actually used?  will it be?
<span class='line'>10097</span>  * getSize				gets an element's size.
<span class='line'>10098</span>  * getUIPosition		gets the position of some element that is currently being dragged, by extracting it from the arguments passed to a drag callback.
<span class='line'>10099</span>  * initDraggable		initializes an element to be draggable 
<span class='line'>10100</span>  * initDroppable		initializes an element to be droppable
<span class='line'>10101</span>  * isDragSupported		returns whether or not drag is supported for some element.
<span class='line'>10102</span>  * isDropSupported		returns whether or not drop is supported for some element.
<span class='line'>10103</span>  * removeClass			removes a class from a given element.
<span class='line'>10104</span>  * removeElement		removes some element completely from the DOM.
<span class='line'>10105</span>  * setAttribute			sets an attribute on some element.
<span class='line'>10106</span>  * setDraggable			sets whether or not some element should be draggable.
<span class='line'>10107</span>  * setDragScope			sets the drag scope for a given element.
<span class='line'>10108</span>  * setOffset			sets the offset of some element.
<span class='line'>10109</span>  */</span><span class="WHIT">
<span class='line'>10110</span> </span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10111</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>10112</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">Array.prototype.indexOf</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10113</span> </span><span class="WHIT">		</span><span class="NAME">Array.prototype.indexOf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10114</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10115</span> </span><span class="WHIT">	  			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">===</span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10116</span> </span><span class="WHIT">	 		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10117</span> </span><span class="WHIT">	 		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10118</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10119</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10120</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>10121</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10122</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>10123</span> </span><span class="WHIT">	</span><span class="NAME">YUI</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">use</span><span class="PUNC">(</span><span class="STRN">'node'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'dd'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'anim'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'node-event-simulate'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_Y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10124</span> </span><span class="WHIT">		</span><span class="NAME">Y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_Y</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>10125</span> </span><span class="WHIT">		</span><span class="NAME">Y.on</span><span class="PUNC">(</span><span class="STRN">"domready"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">jsPlumb.init</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10126</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10127</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>10128</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>10129</span> 	 * adds the given value to the given list, with the given scope. creates the scoped list
<span class='line'>10130</span> 	 * if necessary.
<span class='line'>10131</span> 	 * used by initDraggable and initDroppable.
<span class='line'>10132</span> 	 */</span><span class="WHIT">
<span class='line'>10133</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_add</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10134</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">scope</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10135</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">l</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10136</span> </span><span class="WHIT">			</span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10137</span> </span><span class="WHIT">			</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">scope</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10138</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10139</span> </span><span class="WHIT">		</span><span class="NAME">l.push</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10140</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>10141</span> </span><span class="WHIT">	</span><span class="NAME">ddEvents</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="STRN">"drag:mouseDown"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"drag:afterMouseDown"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"drag:mouseup"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10142</span> </span><span class="WHIT">	     </span><span class="STRN">"drag:align"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"drag:removeHandle"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"drag:addHandle"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"drag:removeInvalid"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"drag:addInvalid"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10143</span> </span><span class="WHIT">	     </span><span class="STRN">"drag:start"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"drag:end"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"drag:drag"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"drag:over"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"drag:enter"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10144</span> </span><span class="WHIT">	     </span><span class="STRN">"drag:exit"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"drag:drophit"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"drag:dropmiss"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"drop:over"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"drop:enter"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"drop:exit"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"drop:hit"</span><span class="WHIT">	     	               </span><span class="WHIT">
<span class='line'>10145</span> </span><span class="WHIT">	</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>10146</span> </span><span class="WHIT">	</span><span class="NAME">animEvents</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="STRN">"tween"</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>10147</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>10148</span> 	 * helper function to curry callbacks for some element. 
<span class='line'>10149</span> 	 */</span><span class="WHIT">
<span class='line'>10150</span> </span><span class="WHIT">	</span><span class="NAME">_wrapper</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10151</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10152</span> </span><span class="WHIT">			</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10153</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">fn.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10154</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10155</span> </span><span class="WHIT">			</span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10156</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10157</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>10158</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>10159</span> 	 * extracts options from the given options object, leaving out event handlers.
<span class='line'>10160</span> 	 */</span><span class="WHIT">
<span class='line'>10161</span> </span><span class="WHIT">	</span><span class="NAME">_getDDOptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10162</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10163</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ddEvents.indexOf</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10164</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10165</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>10166</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>10167</span> 	 * attaches all event handlers found in options to the given dragdrop object, and registering
<span class='line'>10168</span> 	 * the given el as the element of interest.
<span class='line'>10169</span> 	 */</span><span class="WHIT">
<span class='line'>10170</span> </span><span class="WHIT">	</span><span class="NAME">_attachListeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dd</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eventList</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>10171</span> </span><span class="WHIT">	    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ev</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10172</span> </span><span class="WHIT">	    	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eventList.indexOf</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10173</span> </span><span class="WHIT">	    		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrapper</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">ev</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10174</span> </span><span class="WHIT">	    		</span><span class="NAME">dd.on</span><span class="PUNC">(</span><span class="NAME">ev</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10175</span> </span><span class="WHIT">	    	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10176</span> </span><span class="WHIT">	    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10177</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10178</span> </span><span class="WHIT">	</span><span class="NAME">_droppables</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10179</span> </span><span class="WHIT">	</span><span class="NAME">_droppableOptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10180</span> </span><span class="WHIT">	</span><span class="NAME">_draggablesByScope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10181</span> </span><span class="WHIT">	</span><span class="NAME">_draggablesById</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10182</span> </span><span class="WHIT">	</span><span class="NAME">_droppableScopesById</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10183</span> </span><span class="WHIT">	</span><span class="NAME">_checkHover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">entering</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10184</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10185</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el.get</span><span class="PUNC">(</span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10186</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10187</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_droppableOptions</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10188</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10189</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">[</span><span class="STRN">'hoverClass'</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10190</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">entering</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">el.addClass</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">[</span><span class="STRN">'hoverClass'</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10191</span> </span><span class="WHIT">						</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">el.removeClass</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">[</span><span class="STRN">'hoverClass'</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10192</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10193</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10194</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10195</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10196</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10197</span> </span><span class="WHIT">	</span><span class="NAME">_lastDragObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10198</span> </span><span class="WHIT">	</span><span class="NAME">_extend</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10199</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">o2</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>10200</span> </span><span class="WHIT">			</span><span class="NAME">o1</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">o2</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10201</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10202</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10203</span> </span><span class="WHIT">	</span><span class="NAME">_getAttribute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attributeId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10204</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">el.getAttribute</span><span class="PUNC">(</span><span class="NAME">attributeId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10205</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10206</span> </span><span class="WHIT">	</span><span class="NAME">_getElementObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10207</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10208</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">eee</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10209</span> </span><span class="WHIT">        </span><span class="NAME">eee</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">Y.one</span><span class="PUNC">(</span><span class="STRN">'#'</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">el._node</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">Y.one</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">        </span><span class="WHIT">
<span class='line'>10210</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">eee</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10211</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10212</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>10213</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.CurrentLibrary</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10214</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>10215</span> </span><span class="WHIT">		</span><span class="NAME">addClass</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10216</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">addClass</span><span class="PUNC">(</span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10217</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>10218</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10219</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>10220</span> 		 * animates the given element.
<span class='line'>10221</span> 		 */</span><span class="WHIT">
<span class='line'>10222</span> </span><span class="WHIT">		</span><span class="NAME">animate</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">properties</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10223</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">node</span><span class="PUNC">:</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">to</span><span class="PUNC">:</span><span class="NAME">properties</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>10224</span> </span><span class="WHIT">				</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10225</span> </span><span class="WHIT">			</span><span class="NAME">o</span><span class="PUNC">[</span><span class="STRN">"tween"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.wrap</span><span class="PUNC">(</span><span class="NAME">properties</span><span class="PUNC">[</span><span class="STRN">"tween"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10226</span> </span><span class="WHIT">				</span><span class="COMM">// TODO should use a current instance.</span><span class="WHIT">
<span class='line'>10227</span> </span><span class="WHIT">				</span><span class="NAME">jsPlumb.repaint</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10228</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10229</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Y.Anim</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10230</span> </span><span class="WHIT">			</span><span class="NAME">_attachListeners</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">animEvents</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10231</span> </span><span class="WHIT">			</span><span class="NAME">a.run</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10232</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10233</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10234</span> </span><span class="WHIT">		</span><span class="NAME">appendElement</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">child</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10235</span> </span><span class="WHIT">			</span><span class="NAME">_getElementObject</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">append</span><span class="PUNC">(</span><span class="NAME">child</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>10236</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10237</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10238</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>10239</span> 		 * event binding wrapper.  
<span class='line'>10240</span> 		 */</span><span class="WHIT">
<span class='line'>10241</span> </span><span class="WHIT">		</span><span class="NAME">bind</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10242</span> </span><span class="WHIT">			</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">on</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10243</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10244</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>10245</span> </span><span class="WHIT">		</span><span class="NAME">dragEvents</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10246</span> </span><span class="WHIT">			</span><span class="STRN">"start"</span><span class="PUNC">:</span><span class="STRN">"drag:start"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"stop"</span><span class="PUNC">:</span><span class="STRN">"drag:end"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"drag"</span><span class="PUNC">:</span><span class="STRN">"drag:drag"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"step"</span><span class="PUNC">:</span><span class="STRN">"step"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10247</span> </span><span class="WHIT">			</span><span class="STRN">"over"</span><span class="PUNC">:</span><span class="STRN">"drop:enter"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"out"</span><span class="PUNC">:</span><span class="STRN">"drop:exit"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"drop"</span><span class="PUNC">:</span><span class="STRN">"drop:hit"</span><span class="WHIT">
<span class='line'>10248</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>10249</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>10250</span> </span><span class="WHIT">		</span><span class="NAME">extend</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_extend</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10251</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10252</span> </span><span class="WHIT">		</span><span class="NAME">getAttribute</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10253</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10254</span> </span><span class="WHIT">		</span><span class="NAME">getClientXY</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">eventObject</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10255</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">eventObject.clientX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eventObject.clientY</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10256</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10257</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10258</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>10259</span> 		 * takes the args passed to an event function and returns you an object representing that which is being dragged.
<span class='line'>10260</span> 		 */</span><span class="WHIT">
<span class='line'>10261</span> </span><span class="WHIT">		</span><span class="NAME">getDragObject</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">eventArgs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10262</span> </span><span class="WHIT">			</span><span class="COMM">// this is a workaround for the unfortunate fact that in YUI3, the 'drop:exit' event does</span><span class="WHIT">
<span class='line'>10263</span> </span><span class="WHIT">			</span><span class="COMM">// not contain a reference to the drag that just exited.  single-threaded js to the </span><span class="WHIT">
<span class='line'>10264</span> </span><span class="WHIT">			</span><span class="COMM">// rescue: we'll just keep it for ourselves.</span><span class="WHIT">
<span class='line'>10265</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eventArgs</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">drag</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_lastDragObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">eventArgs</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">drag.el</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10266</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_lastDragObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10267</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10268</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10269</span> </span><span class="WHIT">		</span><span class="NAME">getDragScope</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10270</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10271</span> </span><span class="WHIT">				</span><span class="NAME">dd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_draggablesById</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10272</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">dd.scope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10273</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10274</span> 
<span class='line'>10275</span> </span><span class="WHIT">		</span><span class="NAME">getDropEvent</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10276</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10277</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10278</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10279</span> </span><span class="WHIT">		</span><span class="NAME">getDropScope</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10280</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10281</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_droppableScopesById</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10282</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10283</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10284</span> </span><span class="WHIT">		</span><span class="NAME">getDOMElement</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> 			</span><span class="WHIT">
<span class='line'>10285</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"String"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>10286</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10287</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el._node</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>10288</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">el._node</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10289</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10290</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10291</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10292</span> </span><span class="WHIT">		</span><span class="NAME">getElementObject</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10293</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10294</span> </span><span class="WHIT">		</span><span class="NAME">getOffset</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>10295</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Y.DOM.getXY</span><span class="PUNC">(</span><span class="NAME">el._node</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10296</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NAME">o</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">:</span><span class="NAME">o</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10297</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10298</span> 
<span class='line'>10299</span> </span><span class="WHIT">		</span><span class="NAME">getOriginalEvent</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10300</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e._event</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10301</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10302</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10303</span> </span><span class="WHIT">		</span><span class="NAME">getPageXY</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">eventObject</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10304</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">eventObject.pageX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eventObject.pageY</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10305</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10306</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10307</span> </span><span class="WHIT">		</span><span class="NAME">getParent</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10308</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">get</span><span class="PUNC">(</span><span class="STRN">"parentNode"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10309</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10310</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10311</span> </span><span class="WHIT">		</span><span class="NAME">getScrollLeft</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10312</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>10313</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10314</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10315</span> </span><span class="WHIT">		</span><span class="NAME">getScrollTop</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10316</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10317</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10318</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10319</span> </span><span class="WHIT">		</span><span class="NAME">getSelector</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">spec</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10320</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Y.all</span><span class="PUNC">(</span><span class="NAME">spec</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10321</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">.</span><span class="NAME">_nodes</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">s._nodes</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10322</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10323</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10324</span> </span><span class="WHIT">		</span><span class="NAME">getSize</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10325</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">el._node.offsetWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">el._node.offsetHeight</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10326</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10327</span> 
<span class='line'>10328</span> </span><span class="WHIT">        </span><span class="NAME">getTagName</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10329</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10330</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">e._node</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">e._node.tagName</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10331</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10332</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10333</span> </span><span class="WHIT">		</span><span class="NAME">getUIPosition</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">zoom</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10334</span> </span><span class="WHIT">			</span><span class="NAME">zoom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">zoom</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10335</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">currentTarget.el._node</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10336</span> </span><span class="WHIT">			</span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Y.DOM.getXY</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10337</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NAME">o</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">zoom</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">:</span><span class="NAME">o</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">zoom</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10338</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10339</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10340</span> </span><span class="WHIT">		</span><span class="NAME">hasClass</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10341</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">el.hasClass</span><span class="PUNC">(</span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10342</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10343</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>10344</span> </span><span class="WHIT">		</span><span class="NAME">initDraggable</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isPlumbedComponent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10345</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_opts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getDDOptions</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10346</span> </span><span class="WHIT">				</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10347</span> </span><span class="WHIT">			</span><span class="NAME">_opts.node</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"#"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10348</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Y.DD.Drag</span><span class="PUNC">(</span><span class="NAME">_opts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10349</span> </span><span class="WHIT">			</span><span class="NAME">dd.el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>10350</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>10351</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isPlumbedComponent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10352</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">[</span><span class="STRN">'scope'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.Scope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10353</span> </span><span class="WHIT">				</span><span class="NAME">dd.scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10354</span> </span><span class="WHIT">				</span><span class="NAME">_add</span><span class="PUNC">(</span><span class="NAME">_draggablesByScope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dd</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10355</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10356</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>10357</span> </span><span class="WHIT">			</span><span class="NAME">_draggablesById</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dd</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>10358</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>10359</span> </span><span class="WHIT">			</span><span class="NAME">_attachListeners</span><span class="PUNC">(</span><span class="NAME">dd</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ddEvents</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10360</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10361</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10362</span> </span><span class="WHIT">		</span><span class="NAME">initDroppable</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10363</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_opts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getDDOptions</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10364</span> </span><span class="WHIT">				</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10365</span> </span><span class="WHIT">			</span><span class="NAME">_opts.node</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"#"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>10366</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Y.DD.Drop</span><span class="PUNC">(</span><span class="NAME">_opts</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10367</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>10368</span> </span><span class="WHIT">			</span><span class="NAME">_droppableOptions</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10369</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>10370</span> </span><span class="WHIT">			</span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10371</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">[</span><span class="STRN">'scope'</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.Scope</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>10372</span> </span><span class="WHIT">			</span><span class="NAME">_droppableScopesById</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10373</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>10374</span> </span><span class="WHIT">			</span><span class="NAME">options</span><span class="PUNC">[</span><span class="STRN">"drop:enter"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.wrap</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">[</span><span class="STRN">"drop:enter"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10375</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e.drag.scope</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10376</span> </span><span class="WHIT">				</span><span class="NAME">_checkHover</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10377</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10378</span> </span><span class="WHIT">			</span><span class="NAME">options</span><span class="PUNC">[</span><span class="STRN">"drop:exit"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.wrap</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">[</span><span class="STRN">"drop:exit"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10379</span> </span><span class="WHIT">				</span><span class="NAME">_checkHover</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10380</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10381</span> </span><span class="WHIT">			</span><span class="NAME">options</span><span class="PUNC">[</span><span class="STRN">"drop:hit"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.wrap</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">[</span><span class="STRN">"drop:hit"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10382</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e.drag.scope</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10383</span> </span><span class="WHIT">				</span><span class="NAME">_checkHover</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10384</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10385</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>10386</span> </span><span class="WHIT">			</span><span class="NAME">_attachListeners</span><span class="PUNC">(</span><span class="NAME">dd</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ddEvents</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10387</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10388</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10389</span> </span><span class="WHIT">		</span><span class="NAME">isAlreadyDraggable</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10390</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10391</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">el.hasClass</span><span class="PUNC">(</span><span class="STRN">"yui3-dd-draggable"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10392</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10393</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10394</span> </span><span class="WHIT">		</span><span class="NAME">isDragSupported</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10395</span> </span><span class="WHIT">		</span><span class="NAME">isDropSupported</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">										</span><span class="WHIT">
<span class='line'>10396</span> </span><span class="WHIT">		</span><span class="NAME">removeClass</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>10397</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">removeClass</span><span class="PUNC">(</span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>10398</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10399</span> </span><span class="WHIT">		</span><span class="NAME">removeElement</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">remove</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10400</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10401</span> </span><span class="WHIT">		</span><span class="NAME">setAttribute</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attributeName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attributeValue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10402</span> </span><span class="WHIT">			</span><span class="NAME">el.setAttribute</span><span class="PUNC">(</span><span class="NAME">attributeName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attributeValue</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10403</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10404</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10405</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>10406</span> 		 * sets the draggable state for the given element
<span class='line'>10407</span> 		 */</span><span class="WHIT">
<span class='line'>10408</span> </span><span class="WHIT">		</span><span class="NAME">setDraggable</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">draggable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10409</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10410</span> </span><span class="WHIT">				</span><span class="NAME">dd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_draggablesById</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10411</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dd</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">dd.set</span><span class="PUNC">(</span><span class="STRN">"lock"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">draggable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10412</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10413</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10414</span> </span><span class="WHIT">		</span><span class="NAME">setDragScope</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10415</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10416</span> </span><span class="WHIT">				</span><span class="NAME">dd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_draggablesById</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10417</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dd</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">dd.scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10418</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10419</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10420</span> </span><span class="WHIT">		</span><span class="NAME">setOffset</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10421</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10422</span> </span><span class="WHIT">			</span><span class="NAME">el.set</span><span class="PUNC">(</span><span class="STRN">"top"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o.top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10423</span> </span><span class="WHIT">			</span><span class="NAME">el.set</span><span class="PUNC">(</span><span class="STRN">"left"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o.left</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10424</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10425</span> 
<span class='line'>10426</span> </span><span class="WHIT">        </span><span class="NAME">stopDrag</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10427</span> </span><span class="WHIT">            </span><span class="NAME">Y.DD.DDM.stopDrag</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10428</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10429</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10430</span> </span><span class="WHIT">		</span><span class="NAME">trigger</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10431</span> </span><span class="WHIT">			</span><span class="NAME">originalEvent.stopPropagation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10432</span> </span><span class="WHIT">			</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">simulate</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10433</span> </span><span class="WHIT">				</span><span class="NAME">pageX</span><span class="PUNC">:</span><span class="NAME">originalEvent.pageX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>10434</span> </span><span class="WHIT">				</span><span class="NAME">pageY</span><span class="PUNC">:</span><span class="NAME">originalEvent.pageY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>10435</span> </span><span class="WHIT">				</span><span class="NAME">clientX</span><span class="PUNC">:</span><span class="NAME">originalEvent.clientX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>10436</span> </span><span class="WHIT">				</span><span class="NAME">clientY</span><span class="PUNC">:</span><span class="NAME">originalEvent.clientY</span><span class="WHIT">
<span class='line'>10437</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>10438</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>10439</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>10440</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>10441</span> 		 * event unbinding wrapper.  
<span class='line'>10442</span> 		 */</span><span class="WHIT">
<span class='line'>10443</span> </span><span class="WHIT">		</span><span class="NAME">unbind</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>10444</span> </span><span class="WHIT">			</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">detach</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">callback</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10445</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>10446</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>10447</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="STRN">"undefined"</span><span class="PUNC">==</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">Math.sgn</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">Math.sgn</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">==</span><span class="NAME">a</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">&lt;</span><span class="NAME">a</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">subtract</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">a.x</span><span class="PUNC">-</span><span class="NAME">b.x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">a.y</span><span class="PUNC">-</span><span class="NAME">b.y</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">dotProduct</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a.x</span><span class="PUNC">*</span><span class="NAME">b.x</span><span class="PUNC">+</span><span class="NAME">a.y</span><span class="PUNC">*</span><span class="NAME">b.y</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">square</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">a.x</span><span class="PUNC">*</span><span class="NAME">a.x</span><span class="PUNC">+</span><span class="NAME">a.y</span><span class="PUNC">*</span><span class="NAME">a.y</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">scale</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">a.x</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">a.y</span><span class="PUNC">*</span><span class="NAME">b</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">w</span><span class="PUNC">=</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">2</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">65</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">u</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">b.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">d</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">k</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">l</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0.6</span><span class="PUNC">,</span><span class="NUMB">0.3</span><span class="PUNC">,</span><span class="NUMB">0.1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NUMB">0.4</span><span class="PUNC">,</span><span class="NUMB">0.6</span><span class="PUNC">,</span><span class="NUMB">0.6</span><span class="PUNC">,</span><span class="NUMB">0.4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NUMB">0.1</span><span class="PUNC">,</span><span class="NUMB">0.3</span><span class="PUNC">,</span><span class="NUMB">0.6</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">&lt;=</span><span class="NAME">d</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">g</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">m.subtract</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">&lt;=</span><span class="NAME">d</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="WHIT">
<span class='line'>10448</span> </span><span class="NAME">m.subtract</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">m.scale</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NUMB">3</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">&lt;=</span><span class="NAME">d</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">n</span><span class="PUNC">&lt;=</span><span class="NAME">d</span><span class="PUNC">;</span><span class="NAME">n</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">k</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">k</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">m.dotProduct</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">&lt;=</span><span class="NAME">h</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">i</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">=</span><span class="NAME">parseFloat</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">h</span><span class="PUNC">}</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">&lt;=</span><span class="NAME">d</span><span class="PUNC">+</span><span class="NAME">h</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">-</span><span class="NAME">h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">&lt;=</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">j</span><span class="PUNC">=</span><span class="NAME">g</span><span class="PUNC">-</span><span class="NAME">e</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">+</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">+</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">k</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">*</span><span class="NAME">l</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">b.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">r</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">d</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">m.subtract</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">k</span><span class="PUNC">=</span><span class="NAME">m.square</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">l</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">&lt;</span><span class="NAME">i</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">m.subtract</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">s</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">m.square</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">&lt;</span><span class="NAME">k</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">k</span><span class="PUNC">=</span><span class="NAME">h</span><span class="PUNC">;</span><span class="NAME">l</span><span class="PUNC">=</span><span class="NAME">f</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">m.subtract</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">m.square</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10449</span> </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">&lt;</span><span class="NAME">k</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">k</span><span class="PUNC">=</span><span class="NAME">h</span><span class="PUNC">;</span><span class="NAME">l</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="PUNC">{</span><span class="NAME">location</span><span class="PUNC">:</span><span class="NAME">l</span><span class="PUNC">,</span><span class="NAME">distance</span><span class="PUNC">:</span><span class="NAME">k</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">r</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">k</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">l</span><span class="PUNC">,</span><span class="NAME">e</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">Math.sgn</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">n</span><span class="PUNC">&lt;=</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">n</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">l</span><span class="PUNC">=</span><span class="NAME">Math.sgn</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">n</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">l</span><span class="PUNC">!=</span><span class="NAME">e</span><span class="PUNC">&&</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">l</span><span class="PUNC">}</span><span class="KEYW">switch</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">:</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">:</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">>=</span><span class="NUMB">64</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">f</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">b</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">}</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">b</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">b</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">;</span><span class="NAME">n</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">b</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">b</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">;</span><span class="NAME">l</span><span class="PUNC">=</span><span class="NAME">max_distance_below</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">o</span><span class="PUNC">&lt;</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">o</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">m</span><span class="PUNC">=</span><span class="NAME">i</span><span class="PUNC">*</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">o</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">e</span><span class="PUNC">*</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">o</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">n</span><span class="PUNC">;</span><span class="NAME">m</span><span class="PUNC">></span><span class="NAME">l</span><span class="PUNC">?</span><span class="NAME">l</span><span class="PUNC">=</span><span class="NAME">m</span><span class="PUNC">:</span><span class="NAME">m</span><span class="PUNC">&lt;</span><span class="NAME">max_distance_below</span><span class="PUNC">&&</span><span class="PUNC">(</span><span class="NAME">max_distance_below</span><span class="PUNC">=</span><span class="NAME">m</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">o</span><span class="PUNC">=</span><span class="NAME">e</span><span class="PUNC">;</span><span class="NAME">l</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">-</span><span class="NAME">l</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">o</span><span class="PUNC">*</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">*</span><span class="NAME">o</span><span class="PUNC">-</span><span class="NAME">i</span><span class="PUNC">*</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">o</span><span class="PUNC">=</span><span class="NAME">e</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">n</span><span class="PUNC">-</span><span class="NAME">max_distance_below</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">*</span><span class="WHIT">
<span class='line'>10450</span> </span><span class="NAME">e</span><span class="PUNC">-</span><span class="NAME">o</span><span class="PUNC">*</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">*</span><span class="NAME">o</span><span class="PUNC">-</span><span class="NAME">i</span><span class="PUNC">*</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">e</span><span class="PUNC">&lt;</span><span class="NAME">w</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">b</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">;</span><span class="NAME">k</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">b</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">;</span><span class="NAME">f</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">-</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">k</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">-</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">*</span><span class="NUMB">0</span><span class="PUNC">-</span><span class="NAME">k</span><span class="PUNC">*</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="NAME">s</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">r</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">r</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">k</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">&lt;</span><span class="NAME">a</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">f</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">&lt;</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">f</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">k</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">+</span><span class="NAME">b</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">s</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">&lt;=</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">g</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">&lt;=</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">&lt;=</span><span class="NAME">b</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">g</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="PUNC">(</span><span class="NAME">g</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">g</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">+</span><span class="NAME">f</span><span class="PUNC">*</span><span class="NAME">g</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">g</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">+</span><span class="NAME">f</span><span class="PUNC">*</span><span class="NAME">g</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">}</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">=</span><span class="WHIT">
<span class='line'>10451</span> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">&lt;=</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">g</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">&lt;=</span><span class="NAME">b</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">h</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">g</span><span class="PUNC">[</span><span class="NAME">b</span><span class="PUNC">-</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">[</span><span class="NAME">b</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">v</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">x</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">v</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">&lt;</span><span class="NAME">a.length</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">*</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">d</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">b.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">&lt;</span><span class="NAME">a</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">=</span><span class="PUNC">[</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">a</span><span class="PUNC">-</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">k.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">c</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="NAME">k.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10452</span> </span><span class="NAME">b.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">g</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="NAME">b.push</span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">-</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">v</span><span class="PUNC">[</span><span class="NAME">a</span><span class="PUNC">]</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">x</span><span class="PUNC">(</span><span class="NAME">a.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">&lt;</span><span class="NAME">a.length</span><span class="PUNC">;</span><span class="NAME">g</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">d</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">x</span><span class="PUNC">*</span><span class="NAME">f</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">h</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">y</span><span class="PUNC">*</span><span class="NAME">f</span><span class="PUNC">[</span><span class="NAME">g</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">d</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">h</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">q</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">for</span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">p</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">g</span><span class="PUNC">=</span><span class="NAME">f</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="NAME">h</span><span class="PUNC">&lt;</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">b</span><span class="PUNC">+</span><span class="NUMB">0.005</span><span class="PUNC">*</span><span class="NAME">g</span><span class="PUNC">;</span><span class="NAME">c</span><span class="PUNC">=</span><span class="NAME">p</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">h</span><span class="PUNC">+</span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">c.x</span><span class="PUNC">-</span><span class="NAME">d.x</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">c.y</span><span class="PUNC">-</span><span class="NAME">d.y</span><span class="PUNC">,</span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">c</span><span class="PUNC">}</span><span class="KEYW">return</span><span class="PUNC">{</span><span class="NAME">point</span><span class="PUNC">:</span><span class="NAME">c</span><span class="PUNC">,</span><span class="NAME">location</span><span class="PUNC">:</span><span class="NAME">b</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">p</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">p</span><span class="PUNC">(</span><span class="NAME">a.slice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">a.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">h</span><span class="PUNC">=</span><span class="NAME">d.y</span><span class="PUNC">-</span><span class="NAME">f.y</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">d.x</span><span class="PUNC">-</span><span class="NAME">f.x</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">?</span><span class="NAME">Infinity</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>10453</span> </span><span class="NAME">Math.atan</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">/</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="NAME">window.jsBezier</span><span class="PUNC">=</span><span class="PUNC">{</span><span class="NAME">distanceFromCurve</span><span class="PUNC">:</span><span class="NAME">u</span><span class="PUNC">,</span><span class="NAME">gradientAtPoint</span><span class="PUNC">:</span><span class="NAME">t</span><span class="PUNC">,</span><span class="NAME">gradientAtPointAlongCurveFrom</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">q</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">b.location</span><span class="PUNC">></span><span class="NUMB">1</span><span class="PUNC">)</span><span class="NAME">b.location</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">b.location</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="NAME">b.location</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">t</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b.location</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">nearestPointOnCurve</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">u</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">{</span><span class="NAME">point</span><span class="PUNC">:</span><span class="NAME">s</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">b.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">f.location</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">location</span><span class="PUNC">:</span><span class="NAME">f.location</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">pointOnCurve</span><span class="PUNC">:</span><span class="NAME">p</span><span class="PUNC">,</span><span class="NAME">pointAlongCurveFrom</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">q</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">point</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">perpendicularToCurveAt</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="NAME">b</span><span class="PUNC">=</span><span class="NAME">q</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">t</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b.location</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">d</span><span class="PUNC">=</span><span class="NAME">Math.atan</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">/</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>10454</span> </span><span class="NAME">a</span><span class="PUNC">=</span><span class="NAME">f</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">Math.sin</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">f</span><span class="PUNC">=</span><span class="NAME">f</span><span class="PUNC">/</span><span class="NUMB">2</span><span class="PUNC">*</span><span class="NAME">Math.cos</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="KEYW">return</span><span class="PUNC">[</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">b.point.x</span><span class="PUNC">+</span><span class="NAME">f</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">b.point.y</span><span class="PUNC">+</span><span class="NAME">a</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">b.point.x</span><span class="PUNC">-</span><span class="NAME">f</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">b.point.y</span><span class="PUNC">-</span><span class="NAME">a</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">locationAlongCurveFrom</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">q</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">,</span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">location</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span></pre></body></html>