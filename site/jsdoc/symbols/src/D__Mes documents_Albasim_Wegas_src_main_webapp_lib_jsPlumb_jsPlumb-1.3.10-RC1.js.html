<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="COMM">/*
<span class='line'>  2</span>  * jsPlumb
<span class='line'>  3</span>  * 
<span class='line'>  4</span>  * Title:jsPlumb 1.3.9
<span class='line'>  5</span>  * 
<span class='line'>  6</span>  * Provides a way to visually connect elements on an HTML page, using either SVG, Canvas
<span class='line'>  7</span>  * elements, or VML.  
<span class='line'>  8</span>  * 
<span class='line'>  9</span>  * This file contains the jsPlumb core code.
<span class='line'> 10</span>  *
<span class='line'> 11</span>  * Copyright (c) 2010 - 2012 Simon Porritt (simon.porritt@gmail.com)
<span class='line'> 12</span>  * 
<span class='line'> 13</span>  * http://jsplumb.org
<span class='line'> 14</span>  * http://github.com/sporritt/jsplumb
<span class='line'> 15</span>  * http://code.google.com/p/jsplumb
<span class='line'> 16</span>  * 
<span class='line'> 17</span>  * Dual licensed under the MIT and GPL2 licenses.
<span class='line'> 18</span>  */</span><span class="WHIT">
<span class='line'> 19</span> 
<span class='line'> 20</span> </span><span class="PUNC">;</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 21</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'> 22</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'> 23</span> 	 * Class:jsPlumb
<span class='line'> 24</span> 	 * The jsPlumb engine, registered as a static object in the window.  This object contains all of the methods you will use to
<span class='line'> 25</span> 	 * create and maintain Connections and Endpoints.
<span class='line'> 26</span> 	 */</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'> 27</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'> 28</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">canvasAvailable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'canvas'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getContext</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 29</span> </span><span class="WHIT">		</span><span class="NAME">svgAvailable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">window.SVGAngle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">document.implementation.hasFeature</span><span class="PUNC">(</span><span class="STRN">"http://www.w3.org/TR/SVG11/feature#BasicStructure"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"1.1"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 30</span> </span><span class="WHIT">		</span><span class="COMM">// http://stackoverflow.com/questions/654112/how-do-you-detect-support-for-vml-or-svg-in-a-browser</span><span class="WHIT">
<span class='line'> 31</span> </span><span class="WHIT">		</span><span class="NAME">vmlAvailable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">		    </span><span class="WHIT">
<span class='line'> 32</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">vmlAvailable.vml</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'> 33</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.body.appendChild</span><span class="PUNC">(</span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">'div'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 34</span> </span><span class="WHIT">		        </span><span class="NAME">a.innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'&lt;v:shape id="vml_flag1" adj="1" />'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 35</span> </span><span class="WHIT">		        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">a.firstChild</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 36</span> </span><span class="WHIT">		        </span><span class="NAME">b.style.behavior</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"url(#default#VML)"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 37</span> </span><span class="WHIT">		        </span><span class="NAME">vmlAvailable.vml</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">b.adj</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"object"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 38</span> </span><span class="WHIT">		        </span><span class="NAME">a.parentNode.removeChild</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 39</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 40</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">vmlAvailable.vml</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 41</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 42</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'> 43</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_findWithFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.findWithFunction</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 44</span> </span><span class="WHIT">	</span><span class="NAME">_indexOf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.indexOf</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 45</span> </span><span class="WHIT">    </span><span class="NAME">_removeWithFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.removeWithFunction</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 46</span> </span><span class="WHIT">    </span><span class="NAME">_remove</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.remove</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 47</span> </span><span class="WHIT">    </span><span class="COMM">// TODO support insert index</span><span class="WHIT">
<span class='line'> 48</span> </span><span class="WHIT">    </span><span class="NAME">_addWithFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.addWithFunction</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 49</span> </span><span class="WHIT">    </span><span class="NAME">_addToList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.addToList</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 50</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'> 51</span> 		an isArray function that even works across iframes...see here:
<span class='line'> 52</span> 		
<span class='line'> 53</span> 		http://tobyho.com/2011/01/28/checking-types-in-javascript/
<span class='line'> 54</span> 
<span class='line'> 55</span> 		i was originally using "a.constructor == Array" as a test.
<span class='line'> 56</span> 	*/</span><span class="WHIT">
<span class='line'> 57</span> </span><span class="WHIT">	</span><span class="NAME">_isArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.isArray</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 58</span> </span><span class="WHIT">	</span><span class="NAME">_isString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.isString</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 59</span> </span><span class="WHIT">	</span><span class="NAME">_isObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.isObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 60</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'> 61</span> </span><span class="WHIT">	</span><span class="COMM">// for those browsers that dont have it.  they still don't have it! but at least they won't crash.</span><span class="WHIT">
<span class='line'> 62</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">window.console</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'> 63</span> </span><span class="WHIT">		</span><span class="NAME">window.console</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">time</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timeEnd</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">group</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">groupEnd</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">log</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 64</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'> 65</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_connectionBeingDragged</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 66</span> </span><span class="WHIT">		</span><span class="NAME">_getAttribute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getAttribute</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 67</span> </span><span class="WHIT">		</span><span class="NAME">_setAttribute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attValue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.setAttribute</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attValue</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 68</span> </span><span class="WHIT">		</span><span class="NAME">_addClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.addClass</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 69</span> </span><span class="WHIT">		</span><span class="NAME">_hasClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.hasClass</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 70</span> </span><span class="WHIT">		</span><span class="NAME">_removeClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.removeClass</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 71</span> </span><span class="WHIT">		</span><span class="NAME">_getElementObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 72</span> </span><span class="WHIT">		</span><span class="NAME">_getOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getOffset</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'> 73</span> </span><span class="WHIT">		</span><span class="NAME">_getSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getSize</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 74</span> </span><span class="WHIT">		</span><span class="NAME">_log</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.log</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 75</span> </span><span class="WHIT">		</span><span class="NAME">_group</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.group</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 76</span> </span><span class="WHIT">		</span><span class="NAME">_groupEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.groupEnd</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 77</span> </span><span class="WHIT">		</span><span class="NAME">_time</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.time</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 78</span> </span><span class="WHIT">		</span><span class="NAME">_timeEnd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUtil.timeEnd</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 79</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'> 80</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'> 81</span> 		 * creates a timestamp, using milliseconds since 1970, but as a string.
<span class='line'> 82</span> 		 */</span><span class="WHIT">
<span class='line'> 83</span> </span><span class="WHIT">		</span><span class="NAME">_timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 84</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'> 85</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'> 86</span> 		 * Class:jsPlumbUIComponent
<span class='line'> 87</span> 		 * Abstract superclass for UI components Endpoint and Connection.  Provides the abstraction of paintStyle/hoverPaintStyle,
<span class='line'> 88</span> 		 * and also extends jsPlumbUtil.EventGenerator to provide the bind and fire methods.
<span class='line'> 89</span> 		 */</span><span class="WHIT">
<span class='line'> 90</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumbUIComponent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 91</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'> 92</span> </span><span class="WHIT">				</span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'> 93</span> </span><span class="WHIT">				</span><span class="NAME">_hover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'> 94</span> </span><span class="WHIT">				</span><span class="NAME">parameters</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.parameters</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'> 95</span> </span><span class="WHIT">				</span><span class="NAME">idPrefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.idPrefix</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 96</span> </span><span class="WHIT">				</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">idPrefix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 97</span> </span><span class="WHIT">				</span><span class="NAME">paintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 98</span> </span><span class="WHIT">				</span><span class="NAME">hoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 99</span> 
<span class='line'>100</span> </span><span class="WHIT">			</span><span class="NAME">self._jsPlumb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"_jsPlumb"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>101</span> </span><span class="WHIT">			</span><span class="NAME">self.getId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>102</span> </span><span class="WHIT">			</span><span class="NAME">self.tooltip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.tooltip</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>103</span> </span><span class="WHIT">			</span><span class="NAME">self.hoverClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.hoverClass</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb.Defaults.HoverClass</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.HoverClass</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>104</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>105</span> </span><span class="WHIT">			</span><span class="COMM">// all components can generate events</span><span class="WHIT">
<span class='line'>106</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumbUtil.EventGenerator.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>107</span> </span><span class="WHIT">			</span><span class="COMM">// all components get this clone function.</span><span class="WHIT">
<span class='line'>108</span> </span><span class="WHIT">			</span><span class="COMM">// TODO issue 116 showed a problem with this - it seems 'a' that is in</span><span class="WHIT">
<span class='line'>109</span> </span><span class="WHIT">			</span><span class="COMM">// the clone function's scope is shared by all invocations of it, the classic</span><span class="WHIT">
<span class='line'>110</span> </span><span class="WHIT">			</span><span class="COMM">// JS closure problem.  for now, jsPlumb does a version of this inline where </span><span class="WHIT">
<span class='line'>111</span> </span><span class="WHIT">			</span><span class="COMM">// it used to call clone.  but it would be nice to find some time to look</span><span class="WHIT">
<span class='line'>112</span> </span><span class="WHIT">			</span><span class="COMM">// further at this.</span><span class="WHIT">
<span class='line'>113</span> </span><span class="WHIT">			</span><span class="NAME">this.clone</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>114</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>115</span> </span><span class="WHIT">				</span><span class="NAME">self.constructor.apply</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>116</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>117</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>118</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>119</span> </span><span class="WHIT">			</span><span class="NAME">this.getParameter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">parameters</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>120</span> </span><span class="WHIT">			</span><span class="NAME">this.getParameters</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>121</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">parameters</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>122</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>123</span> </span><span class="WHIT">			</span><span class="NAME">this.setParameter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">parameters</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>124</span> </span><span class="WHIT">			</span><span class="NAME">this.setParameters</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">parameters</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>125</span> </span><span class="WHIT">			</span><span class="NAME">this.overlayPlacements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>126</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>127</span> </span><span class="WHIT">			</span><span class="COMM">// user can supply a beforeDetach callback, which will be executed before a detach</span><span class="WHIT">
<span class='line'>128</span> </span><span class="WHIT">			</span><span class="COMM">// is performed; returning false prevents the detach.</span><span class="WHIT">
<span class='line'>129</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">beforeDetach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.beforeDetach</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>130</span> </span><span class="WHIT">			</span><span class="NAME">this.isDetachAllowed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>131</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb.checkCondition</span><span class="PUNC">(</span><span class="STRN">"beforeDetach"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connection</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>132</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">beforeDetach</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>133</span> </span><span class="WHIT">					</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>134</span> </span><span class="WHIT">						</span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">beforeDetach</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>135</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>136</span> </span><span class="WHIT">					</span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">"jsPlumb: beforeDetach callback failed"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>137</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>138</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>139</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>140</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>141</span> </span><span class="WHIT">			</span><span class="COMM">// user can supply a beforeDrop callback, which will be executed before a dropped</span><span class="WHIT">
<span class='line'>142</span> </span><span class="WHIT">			</span><span class="COMM">// connection is confirmed. user can return false to reject connection.</span><span class="WHIT">
<span class='line'>143</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">beforeDrop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.beforeDrop</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>144</span> </span><span class="WHIT">			</span><span class="NAME">this.isDropAllowed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connection</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>145</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb.checkCondition</span><span class="PUNC">(</span><span class="STRN">"beforeDrop"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>146</span> </span><span class="WHIT">					</span><span class="NAME">sourceId</span><span class="PUNC">:</span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>147</span> </span><span class="WHIT">					</span><span class="NAME">targetId</span><span class="PUNC">:</span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>148</span> </span><span class="WHIT">					</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="NAME">scope</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>149</span> </span><span class="WHIT">					</span><span class="NAME">connection</span><span class="PUNC">:</span><span class="NAME">connection</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>150</span> </span><span class="WHIT">					</span><span class="NAME">dropEndpoint</span><span class="PUNC">:</span><span class="NAME">dropEndpoint</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>151</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>152</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">beforeDrop</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>153</span> </span><span class="WHIT">					</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>154</span> </span><span class="WHIT">						</span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">beforeDrop</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>155</span> </span><span class="WHIT">							</span><span class="NAME">sourceId</span><span class="PUNC">:</span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>156</span> </span><span class="WHIT">							</span><span class="NAME">targetId</span><span class="PUNC">:</span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>157</span> </span><span class="WHIT">							</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="NAME">scope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>158</span> </span><span class="WHIT">							</span><span class="NAME">connection</span><span class="PUNC">:</span><span class="NAME">connection</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>159</span> </span><span class="WHIT">							</span><span class="NAME">dropEndpoint</span><span class="PUNC">:</span><span class="NAME">dropEndpoint</span><span class="WHIT">
<span class='line'>160</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>161</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>162</span> </span><span class="WHIT">					</span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">_log</span><span class="PUNC">(</span><span class="STRN">"jsPlumb: beforeDrop callback failed"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>163</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>164</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>165</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>166</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>167</span> </span><span class="WHIT">			</span><span class="COMM">// helper method to update the hover style whenever it, or paintStyle, changes.</span><span class="WHIT">
<span class='line'>168</span> </span><span class="WHIT">			</span><span class="COMM">// we use paintStyle as the foundation and merge hoverPaintStyle over the</span><span class="WHIT">
<span class='line'>169</span> </span><span class="WHIT">			</span><span class="COMM">// top.</span><span class="WHIT">
<span class='line'>170</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_updateHoverStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>171</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">paintStyle</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">hoverPaintStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>172</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mergedHoverStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>173</span> </span><span class="WHIT">					</span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">mergedHoverStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">paintStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>174</span> </span><span class="WHIT">					</span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">mergedHoverStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hoverPaintStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>175</span> </span><span class="WHIT">					</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">[</span><span class="STRN">"hoverPaintStyle"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>176</span> </span><span class="WHIT">					</span><span class="COMM">// we want the fillStyle of paintStyle to override a gradient, if possible.</span><span class="WHIT">
<span class='line'>177</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mergedHoverStyle.gradient</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">paintStyle.fillStyle</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>178</span> </span><span class="WHIT">						</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">mergedHoverStyle</span><span class="PUNC">[</span><span class="STRN">"gradient"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>179</span> </span><span class="WHIT">					</span><span class="NAME">hoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mergedHoverStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>180</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>181</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>182</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>183</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>184</span> 		     * Sets the paint style and then repaints the element.
<span class='line'>185</span> 		     * 
<span class='line'>186</span> 		     * Parameters:
<span class='line'>187</span> 		     * 	style - Style to use.
<span class='line'>188</span> 		     */</span><span class="WHIT">
<span class='line'>189</span> </span><span class="WHIT">		    </span><span class="NAME">this.setPaintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>190</span> </span><span class="WHIT">		    	</span><span class="NAME">paintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>191</span> </span><span class="WHIT">		    	</span><span class="NAME">self.paintStyleInUse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">paintStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>192</span> </span><span class="WHIT">		    	</span><span class="NAME">_updateHoverStyle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>193</span> </span><span class="WHIT">		    	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>194</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>195</span> 
<span class='line'>196</span> </span><span class="WHIT">		    </span><span class="COMM">/**
<span class='line'>197</span> 		    * Gets the component's paint style.
<span class='line'>198</span> 		    *
<span class='line'>199</span> 		    * Returns:
<span class='line'>200</span> 		    * the component's paint style. if there is no hoverPaintStyle set then this will be the paint style used all the time, otherwise this is the style used when the mouse is not hovering.
<span class='line'>201</span> 		    */</span><span class="WHIT">
<span class='line'>202</span> </span><span class="WHIT">		    </span><span class="NAME">this.getPaintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>203</span> </span><span class="WHIT">		    	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">paintStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>204</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>205</span> </span><span class="WHIT">		    </span><span class="WHIT">
<span class='line'>206</span> </span><span class="WHIT">		    </span><span class="COMM">/*
<span class='line'>207</span> 		     * Sets the paint style to use when the mouse is hovering over the element. This is null by default.
<span class='line'>208</span> 		     * The hover paint style is applied as extensions to the paintStyle; it does not entirely replace
<span class='line'>209</span> 		     * it.  This is because people will most likely want to change just one thing when hovering, say the
<span class='line'>210</span> 		     * color for example, but leave the rest of the appearance the same.
<span class='line'>211</span> 		     * 
<span class='line'>212</span> 		     * Parameters:
<span class='line'>213</span> 		     * 	style - Style to use when the mouse is hovering.
<span class='line'>214</span> 		     *  doNotRepaint - if true, the component will not be repainted.  useful when setting things up initially.
<span class='line'>215</span> 		     */</span><span class="WHIT">
<span class='line'>216</span> </span><span class="WHIT">		    </span><span class="NAME">this.setHoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">style</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">		    	</span><span class="WHIT">
<span class='line'>217</span> </span><span class="WHIT">		    	</span><span class="NAME">hoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>218</span> </span><span class="WHIT">		    	</span><span class="NAME">_updateHoverStyle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>219</span> </span><span class="WHIT">		    	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>220</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>221</span> 
<span class='line'>222</span> </span><span class="WHIT">		    </span><span class="COMM">/**
<span class='line'>223</span> 		    * Gets the component's hover paint style.
<span class='line'>224</span> 		    *
<span class='line'>225</span> 		    * Returns:
<span class='line'>226</span> 		    * the component's hover paint style. may be null.
<span class='line'>227</span> 		    */</span><span class="WHIT">
<span class='line'>228</span> </span><span class="WHIT">		    </span><span class="NAME">this.getHoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>229</span> </span><span class="WHIT">		    	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">hoverPaintStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>230</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>231</span> </span><span class="WHIT">		    </span><span class="WHIT">
<span class='line'>232</span> </span><span class="WHIT">		    </span><span class="COMM">/*
<span class='line'>233</span> 		     * sets/unsets the hover state of this element.
<span class='line'>234</span> 		     * 
<span class='line'>235</span> 		     * Parameters:
<span class='line'>236</span> 		     * 	hover - hover state boolean
<span class='line'>237</span> 		     * 	ignoreAttachedElements - if true, does not notify any attached elements of the change in hover state.  used mostly to avoid infinite loops.
<span class='line'>238</span> 		     */</span><span class="WHIT">
<span class='line'>239</span> </span><span class="WHIT">		    </span><span class="NAME">this.setHover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">hover</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ignoreAttachedElements</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>240</span> </span><span class="WHIT">		    	</span><span class="COMM">// while dragging, we ignore these events.  this keeps the UI from flashing and</span><span class="WHIT">
<span class='line'>241</span> </span><span class="WHIT">		    	</span><span class="COMM">// swishing and whatevering.</span><span class="WHIT">
<span class='line'>242</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">self._jsPlumb.currentlyDragging</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">self._jsPlumb.isHoverSuspended</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>243</span> </span><span class="WHIT">		    </span><span class="WHIT">
<span class='line'>244</span> </span><span class="WHIT">			    	</span><span class="NAME">_hover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">hover</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>245</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.hoverClass</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>246</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">hover</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>247</span> </span><span class="WHIT">							</span><span class="NAME">jpcl.addClass</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.hoverClass</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>248</span> </span><span class="WHIT">						</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>249</span> </span><span class="WHIT">							</span><span class="NAME">jpcl.removeClass</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.hoverClass</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>250</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>251</span> </span><span class="WHIT">		   		 	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">hoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>252</span> </span><span class="WHIT">						</span><span class="NAME">self.paintStyleInUse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">hover</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">hoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">paintStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>253</span> </span><span class="WHIT">						</span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_timestamp</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>254</span> </span><span class="WHIT">						</span><span class="NAME">self.repaint</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>255</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>256</span> </span><span class="WHIT">					</span><span class="COMM">// get the list of other affected elements, if supported by this component.</span><span class="WHIT">
<span class='line'>257</span> </span><span class="WHIT">					</span><span class="COMM">// for a connection, its the endpoints.  for an endpoint, its the connections! surprise.</span><span class="WHIT">
<span class='line'>258</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.getAttachedElements</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">ignoreAttachedElements</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>259</span> </span><span class="WHIT">						</span><span class="NAME">_updateAttachedElements</span><span class="PUNC">(</span><span class="NAME">hover</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_timestamp</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>260</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>261</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>262</span> </span><span class="WHIT">		    </span><span class="WHIT">
<span class='line'>263</span> </span><span class="WHIT">		    </span><span class="NAME">this.isHover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_hover</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>264</span> 
<span class='line'>265</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jpcl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>266</span> </span><span class="WHIT">				</span><span class="NAME">events</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"dblclick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mouseenter"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mouseout"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mousemove"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mousedown"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mouseup"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"contextmenu"</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>267</span> </span><span class="WHIT">				</span><span class="NAME">eventFilters</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="STRN">"mouseout"</span><span class="PUNC">:</span><span class="STRN">"mouseexit"</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>268</span> </span><span class="WHIT">				</span><span class="NAME">bindOne</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>269</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">filteredEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">eventFilters</span><span class="PUNC">[</span><span class="NAME">evt</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>270</span> </span><span class="WHIT">					</span><span class="NAME">jpcl.bind</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ee</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>271</span> </span><span class="WHIT">						</span><span class="NAME">c.fire</span><span class="PUNC">(</span><span class="NAME">filteredEvent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ee</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>272</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>273</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>274</span> </span><span class="WHIT">				</span><span class="NAME">unbindOne</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>275</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">filteredEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">eventFilters</span><span class="PUNC">[</span><span class="NAME">evt</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>276</span> </span><span class="WHIT">					</span><span class="NAME">jpcl.unbind</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>277</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>278</span> </span><span class="WHIT">		    </span><span class="WHIT">
<span class='line'>279</span> </span><span class="WHIT">		    </span><span class="NAME">this.attachListeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>280</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">events.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>281</span> </span><span class="WHIT">					</span><span class="NAME">bindOne</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">events</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 			</span><span class="WHIT">
<span class='line'>282</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>283</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>284</span> </span><span class="WHIT">		    </span><span class="WHIT">
<span class='line'>285</span> </span><span class="WHIT">		    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_updateAttachedElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>286</span> </span><span class="WHIT">		    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">affectedElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.getAttachedElements</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="COMM">// implemented in subclasses</span><span class="WHIT">
<span class='line'>287</span> </span><span class="WHIT">		    	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">affectedElements</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>288</span> </span><span class="WHIT">		    		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">affectedElements.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>289</span> </span><span class="WHIT">		    			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">sourceElement</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">sourceElement</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">affectedElements</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>290</span> </span><span class="WHIT">		    				</span><span class="NAME">affectedElements</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setHover</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="COMM">// tell the attached elements not to inform their own attached elements.</span><span class="WHIT">
<span class='line'>291</span> </span><span class="WHIT">		    		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>292</span> </span><span class="WHIT">		    	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>293</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>294</span> </span><span class="WHIT">		    </span><span class="WHIT">
<span class='line'>295</span> </span><span class="WHIT">		    </span><span class="NAME">this.reattachListenersForElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>296</span> </span><span class="WHIT">			    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>297</span> </span><span class="WHIT">		    		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">events.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>298</span> </span><span class="WHIT">		    			</span><span class="NAME">unbindOne</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">events</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>299</span> </span><span class="WHIT">			    	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arguments.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>300</span> </span><span class="WHIT">		    			</span><span class="NAME">self.attachListeners</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>301</span> </span><span class="WHIT">		    	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>302</span> </span><span class="WHIT">		    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>303</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>304</span> 
<span class='line'>305</span> </span><span class="WHIT">		</span><span class="NAME">overlayCapableJsPlumbUIComponent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>306</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumbUIComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>307</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>308</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>309</span> 			 * Property: overlays
<span class='line'>310</span> 			 * List of Overlays for this component.
<span class='line'>311</span> 			 */</span><span class="WHIT">
<span class='line'>312</span> </span><span class="WHIT">			</span><span class="NAME">this.overlays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>313</span> 
<span class='line'>314</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">processOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>315</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_newOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>316</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isArray</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	</span><span class="COMM">// this is for the shorthand ["Arrow", { width:50 }] syntax</span><span class="WHIT">
<span class='line'>317</span> </span><span class="WHIT">					</span><span class="COMM">// there's also a three arg version:</span><span class="WHIT">
<span class='line'>318</span> </span><span class="WHIT">					</span><span class="COMM">// ["Arrow", { width:50 }, {location:0.7}] </span><span class="WHIT">
<span class='line'>319</span> </span><span class="WHIT">					</span><span class="COMM">// which merges the 3rd arg into the 2nd.</span><span class="WHIT">
<span class='line'>320</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>321</span> </span><span class="WHIT">						</span><span class="COMM">// make a copy of the object so as not to mess up anyone else's reference...</span><span class="WHIT">
<span class='line'>322</span> </span><span class="WHIT">						</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">component</span><span class="PUNC">:</span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_jsPlumb</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>323</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>324</span> </span><span class="WHIT">					</span><span class="NAME">_newOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Overlays</span><span class="PUNC">[</span><span class="NAME">self._jsPlumb.getRenderMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>325</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p.events</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>326</span> </span><span class="WHIT">						</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">p.events</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>327</span> </span><span class="WHIT">							</span><span class="NAME">_newOverlay.bind</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p.events</span><span class="PUNC">[</span><span class="NAME">evt</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>328</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>329</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>330</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>331</span> </span><span class="WHIT">					</span><span class="NAME">_newOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Overlays</span><span class="PUNC">[</span><span class="NAME">self._jsPlumb.getRenderMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">o</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">component</span><span class="PUNC">:</span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_jsPlumb</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>332</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>333</span> </span><span class="WHIT">					</span><span class="NAME">_newOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>334</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">										</span><span class="WHIT">
<span class='line'>335</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>336</span> </span><span class="WHIT">				</span><span class="NAME">self.overlays.push</span><span class="PUNC">(</span><span class="NAME">_newOverlay</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>337</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>338</span> </span><span class="WHIT">			</span><span class="NAME">calculateOverlaysToAdd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>339</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">defaultKeys</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.defaultOverlayKeys</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>340</span> </span><span class="WHIT">					</span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.overlays</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>341</span> </span><span class="WHIT">					</span><span class="NAME">checkKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>342</span> </span><span class="WHIT">						</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb.Defaults</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>343</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>344</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>345</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>346</span> 
<span class='line'>347</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">defaultKeys.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>348</span> </span><span class="WHIT">					</span><span class="NAME">o.unshift.apply</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">checkKey</span><span class="PUNC">(</span><span class="NAME">defaultKeys</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>349</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>350</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>351</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>352</span> 
<span class='line'>353</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_overlays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateOverlaysToAdd</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="COMM">//params.overlays || self._jsPlumb.Defaults.Overlays;</span><span class="WHIT">
<span class='line'>354</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_overlays</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>355</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">_overlays.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>356</span> </span><span class="WHIT">					</span><span class="NAME">processOverlay</span><span class="PUNC">(</span><span class="NAME">_overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>357</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>358</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>359</span> 
<span class='line'>360</span> </span><span class="WHIT">		    </span><span class="COMM">// overlay finder helper method</span><span class="WHIT">
<span class='line'>361</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_getOverlayIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>362</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>363</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.overlays.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>364</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>365</span> </span><span class="WHIT">						</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>366</span> </span><span class="WHIT">						</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>367</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>368</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>369</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>370</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>371</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>372</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>373</span> 			 * Function: addOverlay
<span class='line'>374</span> 			 * Adds an Overlay to the Connection.
<span class='line'>375</span> 			 * 
<span class='line'>376</span> 			 * Parameters:
<span class='line'>377</span> 			 * 	overlay - Overlay to add.
<span class='line'>378</span> 			 */</span><span class="WHIT">
<span class='line'>379</span> </span><span class="WHIT">			</span><span class="NAME">this.addOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">overlay</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>380</span> </span><span class="WHIT">				</span><span class="NAME">processOverlay</span><span class="PUNC">(</span><span class="NAME">overlay</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>381</span> </span><span class="WHIT">				</span><span class="NAME">self.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>382</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>383</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>384</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>385</span> 			 * Function: getOverlay
<span class='line'>386</span> 			 * Gets an overlay, by ID. Note: by ID.  You would pass an 'id' parameter
<span class='line'>387</span> 			 * in to the Overlay's constructor arguments, and then use that to retrieve
<span class='line'>388</span> 			 * it via this method.
<span class='line'>389</span> 			 */</span><span class="WHIT">
<span class='line'>390</span> </span><span class="WHIT">			</span><span class="NAME">this.getOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>391</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getOverlayIndex</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>392</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>393</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>394</span> 
<span class='line'>395</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>396</span> 			* Function:getOverlays
<span class='line'>397</span> 			* Gets all the overlays for this component.
<span class='line'>398</span> 			*/</span><span class="WHIT">
<span class='line'>399</span> </span><span class="WHIT">			</span><span class="NAME">this.getOverlays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>400</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self.overlays</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>401</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>402</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>403</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>404</span> 			 * Function: hideOverlay
<span class='line'>405</span> 			 * Hides the overlay specified by the given id.
<span class='line'>406</span> 			 */</span><span class="WHIT">
<span class='line'>407</span> </span><span class="WHIT">			</span><span class="NAME">this.hideOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>408</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.getOverlay</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>409</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">o.hide</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>410</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>411</span> 
<span class='line'>412</span> </span><span class="WHIT">			</span><span class="NAME">this.hideOverlays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>413</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.overlays.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>414</span> </span><span class="WHIT">					</span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">hide</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>415</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>416</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>417</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>418</span> 			 * Function: showOverlay
<span class='line'>419</span> 			 * Shows the overlay specified by the given id.
<span class='line'>420</span> 			 */</span><span class="WHIT">
<span class='line'>421</span> </span><span class="WHIT">			</span><span class="NAME">this.showOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>422</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.getOverlay</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>423</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">o.show</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>424</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>425</span> 
<span class='line'>426</span> </span><span class="WHIT">			</span><span class="NAME">this.showOverlays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>427</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.overlays.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>428</span> </span><span class="WHIT">					</span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">show</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>429</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>430</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>431</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>432</span> 			 * Function: removeAllOverlays
<span class='line'>433</span> 			 * Removes all overlays from the Connection, and then repaints.
<span class='line'>434</span> 			 */</span><span class="WHIT">
<span class='line'>435</span> </span><span class="WHIT">			</span><span class="NAME">this.removeAllOverlays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>436</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">self.overlays</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>437</span> </span><span class="WHIT">					</span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">cleanup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>438</span> 
<span class='line'>439</span> </span><span class="WHIT">				</span><span class="NAME">self.overlays.splice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.overlays.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>440</span> </span><span class="WHIT">				</span><span class="NAME">self.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>441</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>442</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>443</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>444</span> 			 * Function:removeOverlay
<span class='line'>445</span> 			 * Removes an overlay by ID.  Note: by ID.  this is a string you set in the overlay spec.
<span class='line'>446</span> 			 * Parameters:
<span class='line'>447</span> 			 * overlayId - id of the overlay to remove.
<span class='line'>448</span> 			 */</span><span class="WHIT">
<span class='line'>449</span> </span><span class="WHIT">			</span><span class="NAME">this.removeOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">overlayId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>450</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getOverlayIndex</span><span class="PUNC">(</span><span class="NAME">overlayId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>451</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>452</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>453</span> </span><span class="WHIT">					</span><span class="NAME">o.cleanup</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>454</span> </span><span class="WHIT">					</span><span class="NAME">self.overlays.splice</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>455</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>456</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>457</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>458</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>459</span> 			 * Function:removeOverlays
<span class='line'>460</span> 			 * Removes a set of overlays by ID.  Note: by ID.  this is a string you set in the overlay spec.
<span class='line'>461</span> 			 * Parameters:
<span class='line'>462</span> 			 * overlayIds - this function takes an arbitrary number of arguments, each of which is a single overlay id.
<span class='line'>463</span> 			 */</span><span class="WHIT">
<span class='line'>464</span> </span><span class="WHIT">			</span><span class="NAME">this.removeOverlays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>465</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">arguments.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>466</span> </span><span class="WHIT">					</span><span class="NAME">self.removeOverlay</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>467</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>468</span> 
<span class='line'>469</span> </span><span class="WHIT">			</span><span class="COMM">// this is a shortcut helper method to let people add a label as</span><span class="WHIT">
<span class='line'>470</span> </span><span class="WHIT">			</span><span class="COMM">// overlay.			</span><span class="WHIT">
<span class='line'>471</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_internalLabelOverlayId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"__label"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>472</span> </span><span class="WHIT">			</span><span class="NAME">_makeLabelOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>473</span> 
<span class='line'>474</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>475</span> </span><span class="WHIT">					</span><span class="NAME">cssClass</span><span class="PUNC">:</span><span class="NAME">params.cssClass</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>476</span> </span><span class="WHIT">					</span><span class="NAME">labelStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.labelStyle</span><span class="PUNC">,</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>477</span> </span><span class="WHIT">					</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">_internalLabelOverlayId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>478</span> </span><span class="WHIT">					</span><span class="NAME">component</span><span class="PUNC">:</span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>479</span> </span><span class="WHIT">					</span><span class="NAME">_jsPlumb</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb</span><span class="WHIT">
<span class='line'>480</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>481</span> </span><span class="WHIT">				</span><span class="NAME">mergedParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">_params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>482</span> 
<span class='line'>483</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Overlays</span><span class="PUNC">[</span><span class="NAME">self._jsPlumb.getRenderMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">Label</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">mergedParams</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>484</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>485</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.label</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>486</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">loc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.labelLocation</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.defaultLabelLocation</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>487</span> </span><span class="WHIT">					</span><span class="NAME">labelStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.labelStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self._jsPlumb.Defaults.LabelStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.LabelStyle</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>488</span> </span><span class="WHIT">				</span><span class="NAME">this.overlays.push</span><span class="PUNC">(</span><span class="NAME">_makeLabelOverlay</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>489</span> </span><span class="WHIT">					</span><span class="NAME">label</span><span class="PUNC">:</span><span class="NAME">params.label</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>490</span> </span><span class="WHIT">					</span><span class="NAME">location</span><span class="PUNC">:</span><span class="NAME">loc</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>491</span> </span><span class="WHIT">					</span><span class="NAME">labelStyle</span><span class="PUNC">:</span><span class="NAME">labelStyle</span><span class="WHIT">
<span class='line'>492</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>493</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>494</span> 
<span class='line'>495</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>496</span> 			 * Function: setLabel
<span class='line'>497</span> 			 * Sets the Connection's label.  
<span class='line'>498</span> 			 * 
<span class='line'>499</span> 			 * Parameters:
<span class='line'>500</span> 			 * 	l	- label to set. May be a String, a Function that returns a String, or a params object containing { "label", "labelStyle", "location", "cssClass" }.  Note that this uses innerHTML on the label div, so keep
<span class='line'>501</span>          * that in mind if you need escaped HTML.
<span class='line'>502</span> 			 */</span><span class="WHIT">
<span class='line'>503</span> </span><span class="WHIT">			</span><span class="NAME">this.setLabel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>504</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.getOverlay</span><span class="PUNC">(</span><span class="NAME">_internalLabelOverlayId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>505</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">lo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>506</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">String</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">l.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Function</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">label</span><span class="PUNC">:</span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>507</span> </span><span class="WHIT">					</span><span class="NAME">lo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_makeLabelOverlay</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>508</span> </span><span class="WHIT">					</span><span class="NAME">this.overlays.push</span><span class="PUNC">(</span><span class="NAME">lo</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>509</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>510</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>511</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">String</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">l.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Function</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">lo.setLabel</span><span class="PUNC">(</span><span class="NAME">l</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>512</span> </span><span class="WHIT">					</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>513</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l.label</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">lo.setLabel</span><span class="PUNC">(</span><span class="NAME">l.label</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>514</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l.location</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">lo.setLocation</span><span class="PUNC">(</span><span class="NAME">l.location</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>515</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>516</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>517</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>518</span> </span><span class="WHIT">				</span><span class="NAME">self.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>519</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>520</span> 
<span class='line'>521</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>522</span> 				Function:getLabel
<span class='line'>523</span> 				Returns the label text for this component (or a function if you are labelling with a function).
<span class='line'>524</span> 				This does not return the overlay itself; this is a convenience method which is a pair with
<span class='line'>525</span> 				setLabel; together they allow you to add and access a Label Overlay without having to create the
<span class='line'>526</span> 				Overlay object itself.  For access to the underlying label overlay that jsPlumb has created,
<span class='line'>527</span> 				use getLabelOverlay.
<span class='line'>528</span> 			*/</span><span class="WHIT">
<span class='line'>529</span> </span><span class="WHIT">			</span><span class="NAME">this.getLabel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>530</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.getOverlay</span><span class="PUNC">(</span><span class="NAME">_internalLabelOverlayId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>531</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">lo</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">lo.getLabel</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>532</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>533</span> 
<span class='line'>534</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>535</span> 				Function:getLabelOverlay
<span class='line'>536</span> 				Returns the underlying internal label overlay, which will exist if you specified a label on
<span class='line'>537</span> 				a connect or addEndpoint call, or have called setLabel at any stage.   
<span class='line'>538</span> 			*/</span><span class="WHIT">
<span class='line'>539</span> </span><span class="WHIT">			</span><span class="NAME">this.getLabelOverlay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>540</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self.getOverlay</span><span class="PUNC">(</span><span class="NAME">_internalLabelOverlayId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>541</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>542</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>543</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>544</span> </span><span class="WHIT">		</span><span class="NAME">_bindListeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_hoverFunction</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>545</span> </span><span class="WHIT">        	</span><span class="NAME">obj.bind</span><span class="PUNC">(</span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">_self.fire</span><span class="PUNC">(</span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>546</span> </span><span class="WHIT">			</span><span class="NAME">obj.bind</span><span class="PUNC">(</span><span class="STRN">"dblclick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">_self.fire</span><span class="PUNC">(</span><span class="STRN">"dblclick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>547</span> </span><span class="WHIT">	        </span><span class="NAME">obj.bind</span><span class="PUNC">(</span><span class="STRN">"contextmenu"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">_self.fire</span><span class="PUNC">(</span><span class="STRN">"contextmenu"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>548</span> </span><span class="WHIT">			</span><span class="NAME">obj.bind</span><span class="PUNC">(</span><span class="STRN">"mouseenter"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>549</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_self.isHover</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>550</span> </span><span class="WHIT">	                </span><span class="NAME">_hoverFunction</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>551</span> </span><span class="WHIT">					</span><span class="NAME">_self.fire</span><span class="PUNC">(</span><span class="STRN">"mouseenter"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>552</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>553</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>554</span> </span><span class="WHIT">			</span><span class="NAME">obj.bind</span><span class="PUNC">(</span><span class="STRN">"mouseexit"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>555</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_self.isHover</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>556</span> </span><span class="WHIT">	                </span><span class="NAME">_hoverFunction</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>557</span> </span><span class="WHIT">					</span><span class="NAME">_self.fire</span><span class="PUNC">(</span><span class="STRN">"mouseexit"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>558</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>559</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>560</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>561</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>562</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_jsPlumbInstanceIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>563</span> </span><span class="WHIT">			</span><span class="NAME">getInstanceIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>564</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_jsPlumbInstanceIndex</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>565</span> </span><span class="WHIT">				</span><span class="NAME">_jsPlumbInstanceIndex</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>566</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>567</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>568</span> 
<span class='line'>569</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jsPlumbInstance</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_defaults</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>570</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>571</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>572</span> 		 * Property: Defaults 
<span class='line'>573</span> 		 * 
<span class='line'>574</span> 		 * These are the default settings for jsPlumb.  They are what will be used if you do not supply specific pieces of information 
<span class='line'>575</span> 		 * to the various API calls. A convenient way to implement your own look and feel can be to override these defaults 
<span class='line'>576</span> 		 * by including a script somewhere after the jsPlumb include, but before you make any calls to jsPlumb.
<span class='line'>577</span> 		 * 
<span class='line'>578</span> 		 * Properties:
<span class='line'>579</span> 		 * 	-	*Anchor*				    The default anchor to use for all connections (both source and target). Default is "BottomCenter".
<span class='line'>580</span> 		 * 	-	*Anchors*				    The default anchors to use ([source, target]) for all connections. Defaults are ["BottomCenter", "BottomCenter"].
<span class='line'>581</span> 		 *  -   *ConnectionsDetachable*		Whether or not connections are detachable by default (using the mouse). Defaults to true.
<span class='line'>582</span> 		 *  -   *ConnectionOverlays*		The default overlay definitions for Connections. Defaults to an empty list.
<span class='line'>583</span> 		 * 	-	*Connector*				The default connector definition to use for all connections.  Default is "Bezier".
<span class='line'>584</span> 		 *  -   *Container*				Optional selector or element id that instructs jsPlumb to append elements it creates to a specific element.
<span class='line'>585</span> 		 * 	-	*DragOptions*			The default drag options to pass in to connect, makeTarget and addEndpoint calls. Default is empty.
<span class='line'>586</span> 		 * 	-	*DropOptions*			The default drop options to pass in to connect, makeTarget and addEndpoint calls. Default is empty.
<span class='line'>587</span> 		 * 	-	*Endpoint*				The default endpoint definition to use for all connections (both source and target).  Default is "Dot".
<span class='line'>588</span> 		 *  -   *EndpointOverlays*		The default overlay definitions for Endpoints. Defaults to an empty list.
<span class='line'>589</span> 		 * 	-	*Endpoints*				The default endpoint definitions ([ source, target ]) to use for all connections.  Defaults are ["Dot", "Dot"].
<span class='line'>590</span> 		 * 	-	*EndpointStyle*			The default style definition to use for all endpoints. Default is fillStyle:"#456".
<span class='line'>591</span> 		 * 	-	*EndpointStyles*		The default style definitions ([ source, target ]) to use for all endpoints.  Defaults are empty.
<span class='line'>592</span> 		 * 	-	*EndpointHoverStyle*	The default hover style definition to use for all endpoints. Default is null.
<span class='line'>593</span> 		 * 	-	*EndpointHoverStyles*	The default hover style definitions ([ source, target ]) to use for all endpoints. Defaults are null.
<span class='line'>594</span> 		 * 	-	*HoverPaintStyle*		The default hover style definition to use for all connections. Defaults are null.
<span class='line'>595</span> 		 * 	-	*LabelStyle*			The default style to use for label overlays on connections.
<span class='line'>596</span> 		 * 	-	*LogEnabled*			Whether or not the jsPlumb log is enabled. defaults to false.
<span class='line'>597</span> 		 * 	-	*Overlays*				The default overlay definitions (for both Connections and Endpoint). Defaults to an empty list.
<span class='line'>598</span> 		 * 	-	*MaxConnections*		The default maximum number of connections for an Endpoint.  Defaults to 1.		 
<span class='line'>599</span> 		 * 	-	*PaintStyle*			The default paint style for a connection. Default is line width of 8 pixels, with color "#456".
<span class='line'>600</span> 		 * 	-	*RenderMode*			What mode to use to paint with.  If you're on IE&lt;9, you don't really get to choose this.  You'll just get VML.  Otherwise, the jsPlumb default is to use SVG.
<span class='line'>601</span> 		 * 	-	*Scope*				The default "scope" to use for connections. Scope lets you assign connections to different categories. 
<span class='line'>602</span> 		 */</span><span class="WHIT">
<span class='line'>603</span> </span><span class="WHIT">		</span><span class="NAME">this.Defaults</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>604</span> </span><span class="WHIT">			</span><span class="NAME">Anchor</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"BottomCenter"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>605</span> </span><span class="WHIT">			</span><span class="NAME">Anchors</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>606</span> </span><span class="WHIT">            </span><span class="NAME">ConnectionsDetachable</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>607</span> </span><span class="WHIT">            </span><span class="NAME">ConnectionOverlays</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>608</span> </span><span class="WHIT">            </span><span class="NAME">Connector</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"Bezier"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>609</span> </span><span class="WHIT">			</span><span class="NAME">Container</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>610</span> </span><span class="WHIT">			</span><span class="NAME">DragOptions</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>611</span> </span><span class="WHIT">			</span><span class="NAME">DropOptions</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>612</span> </span><span class="WHIT">			</span><span class="NAME">Endpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"Dot"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>613</span> </span><span class="WHIT">			</span><span class="NAME">EndpointOverlays</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>614</span> </span><span class="WHIT">			</span><span class="NAME">Endpoints</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>615</span> </span><span class="WHIT">			</span><span class="NAME">EndpointStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">fillStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"#456"</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>616</span> </span><span class="WHIT">			</span><span class="NAME">EndpointStyles</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>617</span> </span><span class="WHIT">			</span><span class="NAME">EndpointHoverStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>618</span> </span><span class="WHIT">			</span><span class="NAME">EndpointHoverStyles</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>619</span> </span><span class="WHIT">			</span><span class="NAME">HoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>620</span> </span><span class="WHIT">			</span><span class="NAME">LabelStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">color</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"black"</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>621</span> </span><span class="WHIT">			</span><span class="NAME">LogEnabled</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>622</span> </span><span class="WHIT">			</span><span class="NAME">Overlays</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>623</span> </span><span class="WHIT">			</span><span class="NAME">MaxConnections</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>624</span> </span><span class="WHIT">			</span><span class="NAME">PaintStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">lineWidth</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">8</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">strokeStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"#456"</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>625</span> </span><span class="WHIT">            </span><span class="COMM">//Reattach:false,</span><span class="WHIT">
<span class='line'>626</span> </span><span class="WHIT">			</span><span class="NAME">RenderMode</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"svg"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>627</span> </span><span class="WHIT">			</span><span class="NAME">Scope</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"jsPlumb_DefaultScope"</span><span class="WHIT">
<span class='line'>628</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>629</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_defaults</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">this.Defaults</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_defaults</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>630</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>631</span> </span><span class="WHIT">		</span><span class="NAME">this.logEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Defaults.LogEnabled</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>632</span> 
<span class='line'>633</span> </span><span class="WHIT">		</span><span class="NAME">jsPlumbUtil.EventGenerator.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>634</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>635</span> </span><span class="WHIT">			</span><span class="NAME">_instanceIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">getInstanceIndex</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>636</span> </span><span class="WHIT">			</span><span class="NAME">_bb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.bind</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>637</span> </span><span class="WHIT">			</span><span class="NAME">_initialDefaults</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>638</span> 
<span class='line'>639</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.Defaults</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>640</span> </span><span class="WHIT">			</span><span class="NAME">_initialDefaults</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Defaults</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>641</span> 
<span class='line'>642</span> </span><span class="WHIT">		</span><span class="NAME">this.bind</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>643</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="STRN">"ready"</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">event</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">initialized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>644</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">_bb.apply</span><span class="PUNC">(</span><span class="NAME">_currentInstance</span><span class="PUNC">,</span><span class="PUNC">[</span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>645</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>646</span> 
<span class='line'>647</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>648</span> 			Function: importDefaults
<span class='line'>649</span> 			Imports all the given defaults into this instance of jsPlumb.
<span class='line'>650</span> 		*/</span><span class="WHIT">
<span class='line'>651</span> </span><span class="WHIT">		</span><span class="NAME">_currentInstance.importDefaults</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>652</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>653</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.Defaults</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>654</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>655</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>656</span> 
<span class='line'>657</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>658</span> 			Function:restoreDefaults
<span class='line'>659</span> 			Restores the default settings to "factory" values.
<span class='line'>660</span> 		*/</span><span class="WHIT">
<span class='line'>661</span> </span><span class="WHIT">		</span><span class="NAME">_currentInstance.restoreDefaults</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>662</span> </span><span class="WHIT">			</span><span class="NAME">_currentInstance.Defaults</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_initialDefaults</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>663</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>664</span> 
<span class='line'>665</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">log</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>666</span> </span><span class="WHIT">		</span><span class="NAME">repaintFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>667</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.repaintEverything</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>668</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>669</span> </span><span class="WHIT">		</span><span class="NAME">automaticRepaint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>670</span> </span><span class="WHIT">		</span><span class="NAME">repaintEverything</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>671</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">automaticRepaint</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>672</span> </span><span class="WHIT">				</span><span class="NAME">repaintFunction</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>673</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>674</span> </span><span class="WHIT">		</span><span class="NAME">resizeTimer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>675</span> </span><span class="WHIT">		</span><span class="NAME">initialized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>676</span> </span><span class="WHIT">		</span><span class="NAME">connectionsByScope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>677</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>678</span> 		 * map of element id -> endpoint lists. an element can have an arbitrary
<span class='line'>679</span> 		 * number of endpoints on it, and not all of them have to be connected
<span class='line'>680</span> 		 * to anything.
<span class='line'>681</span> 		 */</span><span class="WHIT">
<span class='line'>682</span> </span><span class="WHIT">		</span><span class="NAME">endpointsByElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>683</span> </span><span class="WHIT">		</span><span class="NAME">endpointsByUUID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>684</span> </span><span class="WHIT">		</span><span class="NAME">offsets</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>685</span> </span><span class="WHIT">		</span><span class="NAME">offsetTimestamps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>686</span> </span><span class="WHIT">		</span><span class="NAME">floatingConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>687</span> </span><span class="WHIT">		</span><span class="NAME">draggableStates</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>688</span> </span><span class="WHIT">		</span><span class="NAME">canvasList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>689</span> </span><span class="WHIT">		</span><span class="NAME">sizes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>690</span> </span><span class="WHIT">		</span><span class="COMM">//listeners = {}, // a map: keys are event types, values are lists of listeners.</span><span class="WHIT">
<span class='line'>691</span> </span><span class="WHIT">		</span><span class="NAME">DEFAULT_SCOPE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Defaults.Scope</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>692</span> </span><span class="WHIT">		</span><span class="NAME">renderMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="COMM">// will be set in init()							</span><span class="WHIT">
<span class='line'>693</span> 
<span class='line'>694</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>695</span> 		 * helper method to add an item to a list, creating the list if it does
<span class='line'>696</span> 		 * not yet exist.
<span class='line'>697</span> 		 */</span><span class="WHIT">
<span class='line'>698</span> </span><span class="WHIT">		</span><span class="NAME">_addToList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">map</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>699</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">map</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>700</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>701</span> </span><span class="WHIT">				</span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>702</span> </span><span class="WHIT">				</span><span class="NAME">map</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>703</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>704</span> </span><span class="WHIT">			</span><span class="NAME">l.push</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>705</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>706</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>707</span> 
<span class='line'>708</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>709</span> 		 * appends an element to some other element, which is calculated as follows:
<span class='line'>710</span> 		 * 
<span class='line'>711</span> 		 * 1. if _currentInstance.Defaults.Container exists, use that element.
<span class='line'>712</span> 		 * 2. if the 'parent' parameter exists, use that.
<span class='line'>713</span> 		 * 3. otherwise just use the document body.
<span class='line'>714</span> 		 * 
<span class='line'>715</span> 		 */</span><span class="WHIT">
<span class='line'>716</span> </span><span class="WHIT">		</span><span class="NAME">_appendElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>717</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_currentInstance.Defaults.Container</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>718</span> </span><span class="WHIT">				</span><span class="NAME">jsPlumb.CurrentLibrary.appendElement</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.Container</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>719</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">parent</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>720</span> </span><span class="WHIT">				</span><span class="NAME">document.body.appendChild</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>721</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>722</span> </span><span class="WHIT">				</span><span class="NAME">jsPlumb.CurrentLibrary.appendElement</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>723</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>724</span> 
<span class='line'>725</span> </span><span class="WHIT">		</span><span class="NAME">_curIdStamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>726</span> </span><span class="WHIT">		</span><span class="NAME">_idstamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_curIdStamp</span><span class="PUNC">++</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>727</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>728</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>729</span> 		 * YUI, for some reason, put the result of a Y.all call into an object that contains
<span class='line'>730</span> 		 * a '_nodes' array, instead of handing back an array-like object like the other
<span class='line'>731</span> 		 * libraries do.
<span class='line'>732</span> 		 */</span><span class="WHIT">
<span class='line'>733</span> </span><span class="WHIT">		</span><span class="NAME">_convertYUICollection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>734</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c._nodes</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">c._nodes</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>735</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>736</span> 
<span class='line'>737</span> </span><span class="WHIT">        </span><span class="NAME">_suspendDrawing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>738</span> </span><span class="WHIT">        </span><span class="COMM">/*
<span class='line'>739</span>         sets whether or not to suspend drawing.  you should use this if you need to connect a whole load of things in one go.
<span class='line'>740</span>         it will save you a lot of time.
<span class='line'>741</span>          */</span><span class="WHIT">
<span class='line'>742</span> </span><span class="WHIT">        </span><span class="NAME">_setSuspendDrawing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">val</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">repaintAfterwards</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>743</span> </span><span class="WHIT">            </span><span class="NAME">_suspendDrawing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">val</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>744</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">repaintAfterwards</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_currentInstance.repaintEverything</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>745</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>746</span> 
<span class='line'>747</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>748</span> 		 * Draws an endpoint and its connections. this is the main entry point into drawing connections as well
<span class='line'>749</span> 		 * as endpoints, since jsPlumb is endpoint-centric under the hood.
<span class='line'>750</span> 		 * 
<span class='line'>751</span> 		 * @param element element to draw (of type library specific element object)
<span class='line'>752</span> 		 * @param ui UI object from current library's event system. optional.
<span class='line'>753</span> 		 * @param timestamp timestamp for this paint cycle. used to speed things up a little by cutting down the amount of offset calculations we do.
<span class='line'>754</span> 		 */</span><span class="WHIT">
<span class='line'>755</span> </span><span class="WHIT">		</span><span class="NAME">_draw</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>756</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_suspendDrawing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>757</span> </span><span class="WHIT">			    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>758</span> </span><span class="WHIT">			    	</span><span class="NAME">repaintEls</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.dragManager.getElementsForDraggable</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			    </span><span class="WHIT">
<span class='line'>759</span> 
<span class='line'>760</span> </span><span class="WHIT">			    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_timestamp</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>761</span> 
<span class='line'>762</span> </span><span class="WHIT">			    </span><span class="NAME">_currentInstance.anchorManager.redraw</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>763</span> 
<span class='line'>764</span> </span><span class="WHIT">			    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">repaintEls</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>765</span> </span><span class="WHIT">				    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">repaintEls</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>766</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.anchorManager.redraw</span><span class="PUNC">(</span><span class="NAME">repaintEls</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">repaintEls</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">offset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			    	</span><span class="WHIT">
<span class='line'>767</span> </span><span class="WHIT">				    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>768</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>769</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>770</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>771</span> 
<span class='line'>772</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>773</span> 		 * executes the given function against the given element if the first
<span class='line'>774</span> 		 * argument is an object, or the list of elements, if the first argument
<span class='line'>775</span> 		 * is a list. the function passed in takes (element, elementId) as
<span class='line'>776</span> 		 * arguments.
<span class='line'>777</span> 		 */</span><span class="WHIT">
<span class='line'>778</span> </span><span class="WHIT">		</span><span class="NAME">_elementProxy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>779</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">retVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>780</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isArray</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>781</span> </span><span class="WHIT">				</span><span class="NAME">retVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>782</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">element.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>783</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>784</span> </span><span class="WHIT">					</span><span class="NAME">retVal.push</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// append return values to what we will return</span><span class="WHIT">
<span class='line'>785</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>786</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>787</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>788</span> </span><span class="WHIT">				</span><span class="NAME">retVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>789</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>790</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">retVal</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>791</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>792</span> 
<span class='line'>793</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>794</span> 		 * gets an Endpoint by uuid.
<span class='line'>795</span> 		 */</span><span class="WHIT">
<span class='line'>796</span> </span><span class="WHIT">		</span><span class="NAME">_getEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">uuid</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">endpointsByUUID</span><span class="PUNC">[</span><span class="NAME">uuid</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>797</span> 
<span class='line'>798</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>799</span> 		 * inits a draggable if it's not already initialised.
<span class='line'>800</span> 		 */</span><span class="WHIT">
<span class='line'>801</span> </span><span class="WHIT">		</span><span class="NAME">_initDraggableIfNecessary</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isDraggable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragOptions</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>802</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">draggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">isDraggable</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">isDraggable</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>803</span> </span><span class="WHIT">				</span><span class="NAME">jpcl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>804</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>805</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpcl.isDragSupported</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">jpcl.isAlreadyDraggable</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>806</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dragOptions</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.DragOptions</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.DragOptions</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>807</span> </span><span class="WHIT">					</span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// make a copy.</span><span class="WHIT">
<span class='line'>808</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dragEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.dragEvents</span><span class="PUNC">[</span><span class="STRN">"drag"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>809</span> </span><span class="WHIT">						</span><span class="NAME">stopEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.dragEvents</span><span class="PUNC">[</span><span class="STRN">"stop"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>810</span> </span><span class="WHIT">						</span><span class="NAME">startEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.dragEvents</span><span class="PUNC">[</span><span class="STRN">"start"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>811</span> 
<span class='line'>812</span> </span><span class="WHIT">					</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">startEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">startEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>813</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.setHoverSuspended</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>814</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>815</span> 
<span class='line'>816</span> </span><span class="WHIT">					</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">dragEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">dragEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>817</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getUIPosition</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>818</span> </span><span class="WHIT">						</span><span class="NAME">_draw</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>819</span> </span><span class="WHIT">						</span><span class="NAME">_addClass</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"jsPlumb_dragged"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>820</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>821</span> </span><span class="WHIT">					</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">stopEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">stopEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>822</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getUIPosition</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>823</span> </span><span class="WHIT">						</span><span class="NAME">_draw</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>824</span> </span><span class="WHIT">						</span><span class="NAME">_removeClass</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"jsPlumb_dragged"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>825</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.setHoverSuspended</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>826</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>827</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// need ID</span><span class="WHIT">
<span class='line'>828</span> </span><span class="WHIT">					</span><span class="NAME">draggableStates</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>829</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">draggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">draggableStates</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>830</span> </span><span class="WHIT">					</span><span class="NAME">options.disabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">draggable</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">draggable</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>831</span> </span><span class="WHIT">					</span><span class="NAME">jpcl.initDraggable</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>832</span> </span><span class="WHIT">					</span><span class="NAME">_currentInstance.dragManager.register</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>833</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>834</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>835</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>836</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>837</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>838</span> 		* prepares a final params object that can be passed to _newConnection, taking into account defaults, events, etc.
<span class='line'>839</span> 		*/</span><span class="WHIT">
<span class='line'>840</span> </span><span class="WHIT">		</span><span class="NAME">_prepareConnectionParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>841</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>842</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">_p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>843</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>844</span> </span><span class="WHIT">			</span><span class="COMM">// hotwire endpoints passed as source or target to sourceEndpoint/targetEndpoint, respectively.</span><span class="WHIT">
<span class='line'>845</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.source</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_p.source.endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_p.sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_p.source</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>846</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.source</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_p.target.endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_p.targetEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_p.target</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>847</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>848</span> </span><span class="WHIT">			</span><span class="COMM">// test for endpoint uuids to connect</span><span class="WHIT">
<span class='line'>849</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.uuids</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>850</span> </span><span class="WHIT">				</span><span class="NAME">_p.sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getEndpoint</span><span class="PUNC">(</span><span class="NAME">params.uuids</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>851</span> </span><span class="WHIT">				</span><span class="NAME">_p.targetEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getEndpoint</span><span class="PUNC">(</span><span class="NAME">params.uuids</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>852</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>853</span> 
<span class='line'>854</span> </span><span class="WHIT">			</span><span class="COMM">// now ensure that if we do have Endpoints already, they're not full.</span><span class="WHIT">
<span class='line'>855</span> </span><span class="WHIT">			</span><span class="COMM">// source:</span><span class="WHIT">
<span class='line'>856</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_p.sourceEndpoint.isFull</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>857</span> </span><span class="WHIT">				</span><span class="NAME">_log</span><span class="PUNC">(</span><span class="NAME">_currentInstance</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"could not add connection; source endpoint is full"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>858</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>859</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>860</span> 
<span class='line'>861</span> </span><span class="WHIT">			</span><span class="COMM">// target:</span><span class="WHIT">
<span class='line'>862</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.targetEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_p.targetEndpoint.isFull</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>863</span> </span><span class="WHIT">				</span><span class="NAME">_log</span><span class="PUNC">(</span><span class="NAME">_currentInstance</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"could not add connection; target endpoint is full"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>864</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>865</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>866</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>867</span> </span><span class="WHIT">			</span><span class="COMM">// copy in any connectorOverlays that were specified on the source endpoint.</span><span class="WHIT">
<span class='line'>868</span> </span><span class="WHIT">			</span><span class="COMM">// it doesnt copy target endpoint overlays.  i'm not sure if we want it to or not.</span><span class="WHIT">
<span class='line'>869</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_p.sourceEndpoint.connectorOverlays</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>870</span> </span><span class="WHIT">				</span><span class="NAME">_p.overlays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_p.overlays</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>871</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">_p.sourceEndpoint.connectorOverlays.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>872</span> </span><span class="WHIT">					</span><span class="NAME">_p.overlays.push</span><span class="PUNC">(</span><span class="NAME">_p.sourceEndpoint.connectorOverlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>873</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>874</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>875</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>876</span> </span><span class="WHIT">			</span><span class="COMM">// tooltip.  params.tooltip takes precedence, then sourceEndpoint.connectorTooltip.</span><span class="WHIT">
<span class='line'>877</span> </span><span class="WHIT">			</span><span class="NAME">_p.tooltip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.tooltip</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>878</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_p.tooltip</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_p.sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_p.sourceEndpoint.connectorTooltip</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>879</span> </span><span class="WHIT">				</span><span class="NAME">_p.tooltip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_p.sourceEndpoint.connectorTooltip</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>880</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>881</span> </span><span class="WHIT">			</span><span class="COMM">// if there's a target specified (which of course there should be), and there is no</span><span class="WHIT">
<span class='line'>882</span> </span><span class="WHIT">			</span><span class="COMM">// target endpoint specified, and 'newConnection' was not set to true, then we check to</span><span class="WHIT">
<span class='line'>883</span> </span><span class="WHIT">			</span><span class="COMM">// see if a prior call to makeTarget has provided us with the specs for the target endpoint, and</span><span class="WHIT">
<span class='line'>884</span> </span><span class="WHIT">			</span><span class="COMM">// we use those if so.  additionally, if the makeTarget call was specified with 'uniqueEndpoint' set</span><span class="WHIT">
<span class='line'>885</span> </span><span class="WHIT">			</span><span class="COMM">// to true, then if that target endpoint has already been created, we re-use it.</span><span class="WHIT">
<span class='line'>886</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.target</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_p.target.endpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_p.targetEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_p.newConnection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>887</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">_p.target</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>888</span> </span><span class="WHIT">					</span><span class="NAME">tep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="NAME">_targetEndpointDefinitions</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>889</span> </span><span class="WHIT">					</span><span class="NAME">existingUniqueEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_targetEndpoints</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>890</span> 
<span class='line'>891</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>892</span> </span><span class="WHIT">					</span><span class="COMM">// if target not enabled, return.</span><span class="WHIT">
<span class='line'>893</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_targetsEnabled</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>894</span> 
<span class='line'>895</span> </span><span class="WHIT">					</span><span class="COMM">// check for max connections??						</span><span class="WHIT">
<span class='line'>896</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">existingUniqueEndpoint</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">existingUniqueEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_currentInstance.addEndpoint</span><span class="PUNC">(</span><span class="NAME">_p.target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>897</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_targetEndpointsUnique</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_targetEndpoints</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>898</span> </span><span class="WHIT">					 </span><span class="NAME">_p.targetEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>899</span> </span><span class="WHIT">					 </span><span class="NAME">newEndpoint._makeTargetCreator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>900</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>901</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>902</span> 
<span class='line'>903</span> </span><span class="WHIT">			</span><span class="COMM">// same thing, but for source.</span><span class="WHIT">
<span class='line'>904</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.source</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_p.source.endpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_p.sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_p.newConnection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>905</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">_p.source</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>906</span> </span><span class="WHIT">					</span><span class="NAME">tep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_sourceEndpointDefinitions</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>907</span> </span><span class="WHIT">					</span><span class="NAME">existingUniqueEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_sourceEndpoints</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>908</span> 
<span class='line'>909</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>910</span> </span><span class="WHIT">					</span><span class="COMM">// if source not enabled, return.					</span><span class="WHIT">
<span class='line'>911</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_sourcesEnabled</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>912</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>913</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">existingUniqueEndpoint</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">existingUniqueEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_currentInstance.addEndpoint</span><span class="PUNC">(</span><span class="NAME">_p.source</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>914</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_sourceEndpointsUnique</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_sourceEndpoints</span><span class="PUNC">[</span><span class="NAME">tid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>915</span> </span><span class="WHIT">					 </span><span class="NAME">_p.sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>916</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>917</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>918</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>919</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_p</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>920</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>921</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>922</span> </span><span class="WHIT">		</span><span class="NAME">_newConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>923</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">connectionFunc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.ConnectionType</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getDefaultConnectionType</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>924</span> </span><span class="WHIT">			    </span><span class="NAME">endpointFunc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.EndpointType</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">Endpoint</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>925</span> </span><span class="WHIT">			    </span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getParent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>926</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>927</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.container</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>928</span> </span><span class="WHIT">				</span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"parent"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.container</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>929</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>930</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.sourceEndpoint</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>931</span> </span><span class="WHIT">					</span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"parent"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.sourceEndpoint.parent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>932</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.source.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>933</span> </span><span class="WHIT">					</span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"parent"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.source.parent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>934</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"parent"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">(</span><span class="NAME">params.source</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>935</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>936</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>937</span> </span><span class="WHIT">			</span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"_jsPlumb"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>938</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">con</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">connectionFunc</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>939</span> </span><span class="WHIT">			</span><span class="NAME">con.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"con_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_idstamp</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>940</span> </span><span class="WHIT">			</span><span class="NAME">_eventFireProxy</span><span class="PUNC">(</span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">con</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>941</span> </span><span class="WHIT">			</span><span class="NAME">_eventFireProxy</span><span class="PUNC">(</span><span class="STRN">"dblclick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"dblclick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">con</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>942</span> </span><span class="WHIT">            </span><span class="NAME">_eventFireProxy</span><span class="PUNC">(</span><span class="STRN">"contextmenu"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"contextmenu"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">con</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>943</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">con</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>944</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>945</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>946</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>947</span> 		* adds the connection to the backing model, fires an event if necessary and then redraws
<span class='line'>948</span> 		*/</span><span class="WHIT">
<span class='line'>949</span> </span><span class="WHIT">		</span><span class="NAME">_finaliseConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>950</span> </span><span class="WHIT">            </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>951</span> </span><span class="WHIT">			</span><span class="COMM">// add to list of connections (by scope).</span><span class="WHIT">
<span class='line'>952</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">jpc.suspendedEndpoint</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>953</span> </span><span class="WHIT">			    </span><span class="NAME">_addToList</span><span class="PUNC">(</span><span class="NAME">connectionsByScope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc.scope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>954</span> </span><span class="WHIT">			</span><span class="COMM">// fire an event</span><span class="WHIT">
<span class='line'>955</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">params.doNotFireConnectionEvent</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">params.fireEvent</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>956</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.fire</span><span class="PUNC">(</span><span class="STRN">"jsPlumbConnection"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>957</span> </span><span class="WHIT">					</span><span class="NAME">connection</span><span class="PUNC">:</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>958</span> </span><span class="WHIT">					</span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.source</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">target</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.target</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>959</span> </span><span class="WHIT">					</span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.targetId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>960</span> </span><span class="WHIT">					</span><span class="NAME">sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>961</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>962</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>963</span> </span><span class="WHIT">            </span><span class="COMM">// always inform the anchor manager</span><span class="WHIT">
<span class='line'>964</span> </span><span class="WHIT">            </span><span class="COMM">// except that if jpc has a suspended endpoint it's not true to say the</span><span class="WHIT">
<span class='line'>965</span> </span><span class="WHIT">            </span><span class="COMM">// connection is new; it has just (possibly) moved. the question is whether</span><span class="WHIT">
<span class='line'>966</span> </span><span class="WHIT">            </span><span class="COMM">// to make that call here or in the anchor manager.  i think perhaps here.</span><span class="WHIT">
<span class='line'>967</span> </span><span class="WHIT">            </span><span class="NAME">_currentInstance.anchorManager.newConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>968</span> </span><span class="WHIT">			</span><span class="COMM">// force a paint</span><span class="WHIT">
<span class='line'>969</span> </span><span class="WHIT">			</span><span class="NAME">_draw</span><span class="PUNC">(</span><span class="NAME">jpc.source</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>970</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>971</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>972</span> </span><span class="WHIT">		</span><span class="NAME">_eventFireProxy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">proxyEvent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>973</span> </span><span class="WHIT">			</span><span class="NAME">obj.bind</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">originalObject</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>974</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.fire</span><span class="PUNC">(</span><span class="NAME">proxyEvent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>975</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>976</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>977</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>978</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>979</span> 		 * for the given endpoint params, returns an appropriate parent element for the UI elements that will be added.
<span class='line'>980</span> 		 * this function is used by _newEndpoint (directly below), and also in the makeSource function in jsPlumb.
<span class='line'>981</span> 		 * 
<span class='line'>982</span> 		 *   the logic is to first look for a "container" member of params, and pass that back if found.  otherwise we
<span class='line'>983</span> 		 *   handoff to the 'getParent' function in the current library.
<span class='line'>984</span> 		 */</span><span class="WHIT">
<span class='line'>985</span> </span><span class="WHIT">		</span><span class="NAME">_getParentFromParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>986</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.container</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>987</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">params.container</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>988</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>989</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getTagName</span><span class="PUNC">(</span><span class="NAME">params.source</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>990</span> </span><span class="WHIT">                    </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getParent</span><span class="PUNC">(</span><span class="NAME">params.source</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>991</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tag</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">tag.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"td"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>992</span> </span><span class="WHIT">                    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getParent</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>993</span> </span><span class="WHIT">                </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>994</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>995</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>996</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>997</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>998</span> 			factory method to prepare a new endpoint.  this should always be used instead of creating Endpoints
<span class='line'>999</span> 			manually, since this method attaches event listeners and an id.
<span class='line'>1000</span> 		*/</span><span class="WHIT">
<span class='line'>1001</span> </span><span class="WHIT">		</span><span class="NAME">_newEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1002</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.EndpointType</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">Endpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1003</span> </span><span class="WHIT">			</span><span class="NAME">params.parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getParentFromParams</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1004</span> </span><span class="WHIT">			</span><span class="NAME">params</span><span class="PUNC">[</span><span class="STRN">"_jsPlumb"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1005</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1006</span> </span><span class="WHIT">			</span><span class="NAME">ep.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"ep_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_idstamp</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1007</span> </span><span class="WHIT">			</span><span class="NAME">_eventFireProxy</span><span class="PUNC">(</span><span class="STRN">"click"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"endpointClick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1008</span> </span><span class="WHIT">			</span><span class="NAME">_eventFireProxy</span><span class="PUNC">(</span><span class="STRN">"dblclick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"endpointDblClick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1009</span> </span><span class="WHIT">            </span><span class="NAME">_eventFireProxy</span><span class="PUNC">(</span><span class="STRN">"contextmenu"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"contextmenu"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1010</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1011</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1012</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1013</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1014</span> 		 * performs the given function operation on all the connections found
<span class='line'>1015</span> 		 * for the given element id; this means we find all the endpoints for
<span class='line'>1016</span> 		 * the given element, and then for each endpoint find the connectors
<span class='line'>1017</span> 		 * connected to it. then we pass each connection in to the given
<span class='line'>1018</span> 		 * function.
<span class='line'>1019</span> 		 */</span><span class="WHIT">
<span class='line'>1020</span> </span><span class="WHIT">		</span><span class="NAME">_operation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1021</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1022</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endpoints</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">endpoints.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1023</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpoints.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1024</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1025</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">retVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">(</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connections</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1026</span> </span><span class="WHIT">						</span><span class="COMM">// if the function passed in returns true, we exit.</span><span class="WHIT">
<span class='line'>1027</span> </span><span class="WHIT">						</span><span class="COMM">// most functions return false.</span><span class="WHIT">
<span class='line'>1028</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">retVal</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1029</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1030</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endpointFunc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="PUNC">(</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1031</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1032</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1033</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1034</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1035</span> 		 * perform an operation on all elements.
<span class='line'>1036</span> 		 */</span><span class="WHIT">
<span class='line'>1037</span> </span><span class="WHIT">		</span><span class="NAME">_operationOnAll</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">func</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1038</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1039</span> </span><span class="WHIT">				</span><span class="NAME">_operation</span><span class="PUNC">(</span><span class="NAME">elId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1040</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1041</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1042</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1043</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1044</span> 		 * helper to remove an element from the DOM.
<span class='line'>1045</span> 		 */</span><span class="WHIT">
<span class='line'>1046</span> </span><span class="WHIT">		</span><span class="NAME">_removeElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1047</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">element.parentNode</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1048</span> </span><span class="WHIT">				</span><span class="NAME">element.parentNode.removeChild</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1049</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1050</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1051</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1052</span> 		 * helper to remove a list of elements from the DOM.
<span class='line'>1053</span> 		 */</span><span class="WHIT">
<span class='line'>1054</span> </span><span class="WHIT">		</span><span class="NAME">_removeElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elements</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1055</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">elements.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1056</span> </span><span class="WHIT">				</span><span class="NAME">_removeElement</span><span class="PUNC">(</span><span class="NAME">elements</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1057</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1058</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1059</span> 		 * Sets whether or not the given element(s) should be draggable,
<span class='line'>1060</span> 		 * regardless of what a particular plumb command may request.
<span class='line'>1061</span> 		 * 
<span class='line'>1062</span> 		 * @param element
<span class='line'>1063</span> 		 *            May be a string, a element objects, or a list of
<span class='line'>1064</span> 		 *            strings/elements.
<span class='line'>1065</span> 		 * @param draggable
<span class='line'>1066</span> 		 *            Whether or not the given element(s) should be draggable.
<span class='line'>1067</span> 		 */</span><span class="WHIT">
<span class='line'>1068</span> </span><span class="WHIT">		</span><span class="NAME">_setDraggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">draggable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1069</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_elementProxy</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1070</span> </span><span class="WHIT">				</span><span class="NAME">draggableStates</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">draggable</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1071</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jsPlumb.CurrentLibrary.isDragSupported</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1072</span> </span><span class="WHIT">					</span><span class="NAME">jsPlumb.CurrentLibrary.setDraggable</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">draggable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1073</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1074</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1075</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1076</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1077</span> 		 * private method to do the business of hiding/showing.
<span class='line'>1078</span> 		 * 
<span class='line'>1079</span> 		 * @param el
<span class='line'>1080</span> 		 *            either Id of the element in question or a library specific
<span class='line'>1081</span> 		 *            object for the element.
<span class='line'>1082</span> 		 * @param state
<span class='line'>1083</span> 		 *            String specifying a value for the css 'display' property
<span class='line'>1084</span> 		 *            ('block' or 'none').
<span class='line'>1085</span> 		 */</span><span class="WHIT">
<span class='line'>1086</span> </span><span class="WHIT">		</span><span class="NAME">_setVisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">alsoChangeEndpoints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1087</span> </span><span class="WHIT">			</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1088</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1089</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">alsoChangeEndpoints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1090</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1091</span> </span><span class="WHIT">					</span><span class="NAME">ep.setVisible</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1092</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1093</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1094</span> </span><span class="WHIT">					</span><span class="NAME">ep.setVisible</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1095</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1096</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1097</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1098</span> </span><span class="WHIT">			</span><span class="NAME">_operation</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1099</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">alsoChangeEndpoints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1100</span> </span><span class="WHIT">					</span><span class="COMM">// this test is necessary because this functionality is new, and i wanted to maintain backwards compatibility.</span><span class="WHIT">
<span class='line'>1101</span> </span><span class="WHIT">					</span><span class="COMM">// this block will only set a connection to be visible if the other endpoint in the connection is also visible.</span><span class="WHIT">
<span class='line'>1102</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oidx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.sourceId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1103</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">oidx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isVisible</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">jpc.setVisible</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1104</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1105</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT">  </span><span class="COMM">// the default behaviour for show, and what always happens for hide, is to just set the visibility without getting clever.</span><span class="WHIT">
<span class='line'>1106</span> </span><span class="WHIT">					</span><span class="NAME">jpc.setVisible</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1107</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1108</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1109</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1110</span> 		 * toggles the draggable state of the given element(s).
<span class='line'>1111</span> 		 * 
<span class='line'>1112</span> 		 * @param el
<span class='line'>1113</span> 		 *            either an id, or an element object, or a list of
<span class='line'>1114</span> 		 *            ids/element objects.
<span class='line'>1115</span> 		 */</span><span class="WHIT">
<span class='line'>1116</span> </span><span class="WHIT">		</span><span class="NAME">_toggleDraggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1117</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_elementProxy</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1118</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">draggableStates</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">draggableStates</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1119</span> </span><span class="WHIT">				</span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">state</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1120</span> </span><span class="WHIT">				</span><span class="NAME">draggableStates</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1121</span> </span><span class="WHIT">				</span><span class="NAME">jsPlumb.CurrentLibrary.setDraggable</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1122</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1123</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1124</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1125</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1126</span> 		 * private method to do the business of toggling hiding/showing.
<span class='line'>1127</span> 		 * 
<span class='line'>1128</span> 		 * @param elId
<span class='line'>1129</span> 		 *            Id of the element in question
<span class='line'>1130</span> 		 */</span><span class="WHIT">
<span class='line'>1131</span> </span><span class="WHIT">		</span><span class="NAME">_toggleVisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">changeEndpoints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1132</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1133</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">changeEndpoints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1134</span> </span><span class="WHIT">				</span><span class="NAME">endpointFunc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1135</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ep.isVisible</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1136</span> </span><span class="WHIT">					</span><span class="NAME">ep.setVisible</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1137</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1138</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1139</span> </span><span class="WHIT">			</span><span class="NAME">_operation</span><span class="PUNC">(</span><span class="NAME">elId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1140</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">state</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.isVisible</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1141</span> </span><span class="WHIT">				</span><span class="NAME">jpc.setVisible</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>1142</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointFunc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1143</span> </span><span class="WHIT">			</span><span class="COMM">// todo this should call _elementProxy, and pass in the</span><span class="WHIT">
<span class='line'>1144</span> </span><span class="WHIT">			</span><span class="COMM">// _operation(elId, f) call as a function. cos _toggleDraggable does</span><span class="WHIT">
<span class='line'>1145</span> </span><span class="WHIT">			</span><span class="COMM">// that.</span><span class="WHIT">
<span class='line'>1146</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1147</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1148</span> 		 * updates the offset and size for a given element, and stores the
<span class='line'>1149</span> 		 * values. if 'offset' is not null we use that (it would have been
<span class='line'>1150</span> 		 * passed in from a drag call) because it's faster; but if it is null,
<span class='line'>1151</span> 		 * or if 'recalc' is true in order to force a recalculation, we get the current values.
<span class='line'>1152</span> 		 */</span><span class="WHIT">
<span class='line'>1153</span> </span><span class="WHIT">		</span><span class="NAME">_updateOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1154</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.recalc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.offset</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.elId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1155</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">recalc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1156</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">offsetTimestamps</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1157</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1158</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1159</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">recalc</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">offset</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="COMM">// if forced repaint or no offset</span><span class="WHIT">
<span class='line'>1160</span> </span><span class="WHIT">											</span><span class="COMM">// available, we recalculate.</span><span class="WHIT">
<span class='line'>1161</span> </span><span class="WHIT">				</span><span class="COMM">// get the current size and offset, and store them</span><span class="WHIT">
<span class='line'>1162</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">elId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1163</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1164</span> </span><span class="WHIT">					</span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getSize</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1165</span> </span><span class="WHIT">					</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getOffset</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1166</span> </span><span class="WHIT">					</span><span class="NAME">offsetTimestamps</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1167</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1168</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1169</span> </span><span class="WHIT">				</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1170</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1171</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">elId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1172</span> </span><span class="WHIT">				    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1173</span> </span><span class="WHIT">					    </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getSize</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1174</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1175</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1176</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1177</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">right</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1178</span> </span><span class="WHIT">				</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">right</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1179</span> </span><span class="WHIT">				</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">bottom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1180</span> </span><span class="WHIT">				</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1181</span> </span><span class="WHIT">				</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1182</span> </span><span class="WHIT">				</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">centerx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1183</span> </span><span class="WHIT">				</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">centery</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>1184</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1185</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1186</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1187</span> 
<span class='line'>1188</span> </span><span class="WHIT">		</span><span class="COMM">// TODO comparison performance</span><span class="WHIT">
<span class='line'>1189</span> </span><span class="WHIT">		</span><span class="NAME">_getCachedData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1190</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1191</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">elId</span><span class="PUNC">:</span><span class="NAME">elId</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1192</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">o</span><span class="PUNC">:</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">:</span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1193</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1194</span> 
<span class='line'>1195</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1196</span> 		 * gets an id for the given element, creating and setting one if
<span class='line'>1197</span> 		 * necessary.  the id is of the form
<span class='line'>1198</span> 		 *
<span class='line'>1199</span> 		 *	jsPlumb_&lt;instance index>_&lt;index in instance>
<span class='line'>1200</span> 		 *
<span class='line'>1201</span> 		 * where "index in instance" is a monotonically increasing integer that starts at 0,
<span class='line'>1202</span> 		 * for each instance.  this method is used not only to assign ids to elements that do not
<span class='line'>1203</span> 		 * have them but also to connections and endpoints.
<span class='line'>1204</span> 		 */</span><span class="WHIT">
<span class='line'>1205</span> </span><span class="WHIT">		</span><span class="NAME">_getId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">uuid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotCreateIfNotFound</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1206</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ele</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1207</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">ele</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1208</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1209</span> </span><span class="WHIT">				</span><span class="COMM">// check if fixed uuid parameter is given</span><span class="WHIT">
<span class='line'>1210</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1211</span> </span><span class="WHIT">					</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uuid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1212</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1213</span> </span><span class="WHIT">					</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"jsPlumb_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_instanceIndex</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_idstamp</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1214</span> </span><span class="WHIT">				</span><span class="NAME">_setAttribute</span><span class="PUNC">(</span><span class="NAME">ele</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1215</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1216</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1217</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1218</span> 
<span class='line'>1219</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1220</span> 		 * wraps one function with another, creating a placeholder for the
<span class='line'>1221</span> 		 * wrapped function if it was null. this is used to wrap the various
<span class='line'>1222</span> 		 * drag/drop event functions - to allow jsPlumb to be notified of
<span class='line'>1223</span> 		 * important lifecycle events without imposing itself on the user's
<span class='line'>1224</span> 		 * drag/drop functionality. TODO: determine whether or not we should
<span class='line'>1225</span> 		 * support an error handler concept, if one of the functions fails.
<span class='line'>1226</span> 		 * 
<span class='line'>1227</span> 		 * @param wrappedFunction original function to wrap; may be null.
<span class='line'>1228</span> 		 * @param newFunction function to wrap the original with.
<span class='line'>1229</span> 		 * @param returnOnThisValue Optional. Indicates that the wrappedFunction should 
<span class='line'>1230</span> 		 * not be executed if the newFunction returns a value matching 'returnOnThisValue'.
<span class='line'>1231</span> 		 * note that this is a simple comparison and only works for primitives right now.
<span class='line'>1232</span> 		 */</span><span class="WHIT">
<span class='line'>1233</span> </span><span class="WHIT">		</span><span class="NAME">_wrap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">wrappedFunction</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newFunction</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">returnOnThisValue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1234</span> </span><span class="WHIT">			</span><span class="NAME">wrappedFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">wrappedFunction</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1235</span> </span><span class="WHIT">			</span><span class="NAME">newFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newFunction</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1236</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1237</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1238</span> </span><span class="WHIT">				</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1239</span> </span><span class="WHIT">					</span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newFunction.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1240</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1241</span> </span><span class="WHIT">					</span><span class="NAME">_log</span><span class="PUNC">(</span><span class="NAME">_currentInstance</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"jsPlumb function failed : "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1242</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1243</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">returnOnThisValue</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">returnOnThisValue</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1244</span> </span><span class="WHIT">					</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1245</span> </span><span class="WHIT">						</span><span class="NAME">wrappedFunction.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1246</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1247</span> </span><span class="WHIT">						</span><span class="NAME">_log</span><span class="PUNC">(</span><span class="NAME">_currentInstance</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"wrapped function failed : "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1248</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1249</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1250</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1251</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1252</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1253</span> 
<span class='line'>1254</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1255</span> 		 * Property: connectorClass 
<span class='line'>1256</span> 		 *   The CSS class to set on Connection elements. This value is a String and can have multiple classes; the entire String is appended as-is.
<span class='line'>1257</span> 		 */</span><span class="WHIT">
<span class='line'>1258</span> </span><span class="WHIT">		</span><span class="NAME">this.connectorClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"_jsPlumb_connector"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1259</span> 
<span class='line'>1260</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1261</span> 		 * Property: endpointClass 
<span class='line'>1262</span> 		 *   The CSS class to set on Endpoint elements. This value is a String and can have multiple classes; the entire String is appended as-is.
<span class='line'>1263</span> 		 */</span><span class="WHIT">
<span class='line'>1264</span> </span><span class="WHIT">		</span><span class="NAME">this.endpointClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"_jsPlumb_endpoint"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1265</span> 
<span class='line'>1266</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1267</span> 		 * Property: overlayClass 
<span class='line'>1268</span> 		 * The CSS class to set on an Overlay that is an HTML element. This value is a String and can have multiple classes; the entire String is appended as-is.
<span class='line'>1269</span> 		 */</span><span class="WHIT">
<span class='line'>1270</span> </span><span class="WHIT">		</span><span class="NAME">this.overlayClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"_jsPlumb_overlay"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1271</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1272</span> </span><span class="WHIT">		</span><span class="NAME">this.Anchors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1273</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1274</span> </span><span class="WHIT">		</span><span class="NAME">this.Connectors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1275</span> </span><span class="WHIT">			</span><span class="STRN">"canvas"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1276</span> </span><span class="WHIT">			</span><span class="STRN">"svg"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1277</span> </span><span class="WHIT">			</span><span class="STRN">"vml"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1278</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1279</span> 
<span class='line'>1280</span> </span><span class="WHIT">		</span><span class="NAME">this.Endpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1281</span> </span><span class="WHIT">			</span><span class="STRN">"canvas"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1282</span> </span><span class="WHIT">			</span><span class="STRN">"svg"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1283</span> </span><span class="WHIT">			</span><span class="STRN">"vml"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1284</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1285</span> 
<span class='line'>1286</span> </span><span class="WHIT">		</span><span class="NAME">this.Overlays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1287</span> </span><span class="WHIT">			</span><span class="STRN">"canvas"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1288</span> </span><span class="WHIT">			</span><span class="STRN">"svg"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1289</span> </span><span class="WHIT">			</span><span class="STRN">"vml"</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1290</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1291</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1292</span> </span><span class="COMM">// ************************ PLACEHOLDER DOC ENTRIES FOR NATURAL DOCS *****************************************</span><span class="WHIT">
<span class='line'>1293</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1294</span> 		 * Function: bind
<span class='line'>1295</span> 		 * Bind to an event on jsPlumb.  
<span class='line'>1296</span> 		 * 
<span class='line'>1297</span> 		 * Parameters:
<span class='line'>1298</span> 		 * 	event - the event to bind.  Available events on jsPlumb are:
<span class='line'>1299</span> 		 *         - *jsPlumbConnection* 			: 	notification that a new Connection was established.  jsPlumb passes the new Connection to the callback.
<span class='line'>1300</span> 		 *         - *jsPlumbConnectionDetached* 	: 	notification that a Connection was detached.  jsPlumb passes the detached Connection to the callback.
<span class='line'>1301</span> 		 *         - *click*						:	notification that a Connection was clicked.  jsPlumb passes the Connection that was clicked to the callback.
<span class='line'>1302</span> 		 *         - *dblclick*						:	notification that a Connection was double clicked.  jsPlumb passes the Connection that was double clicked to the callback.
<span class='line'>1303</span> 		 *         - *endpointClick*				:	notification that an Endpoint was clicked.  jsPlumb passes the Endpoint that was clicked to the callback.
<span class='line'>1304</span> 		 *         - *endpointDblClick*				:	notification that an Endpoint was double clicked.  jsPlumb passes the Endpoint that was double clicked to the callback.
<span class='line'>1305</span> 		 *         - *beforeDrop*					: 	notification that a Connection is about to be dropped. Returning false from this method cancels the drop. jsPlumb passes { sourceId, targetId, scope, connection, dropEndpoint } to your callback. For more information, refer to the jsPlumb documentation.
<span class='line'>1306</span> 		 *         - *beforeDetach*					: 	notification that a Connection is about to be detached. Returning false from this method cancels the detach. jsPlumb passes the Connection to your callback. For more information, refer to the jsPlumb documentation.
<span class='line'>1307</span> 		 *		   - *connectionDrag* 				:   notification that an existing Connection is being dragged. jsPlumb passes the Connection to your callback function.
<span class='line'>1308</span> 		 *         - *connectionDragEnd*            :   notification that the drag of an existing Connection has ended.  jsPlumb passes the Connection to your callback function.
<span class='line'>1309</span> 		 *         
<span class='line'>1310</span> 		 *  callback - function to callback. This function will be passed the Connection/Endpoint that caused the event, and also the original event.    
<span class='line'>1311</span> 		 */</span><span class="WHIT">
<span class='line'>1312</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1313</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1314</span> 		 * Function: unbind
<span class='line'>1315</span> 		 * Clears either all listeners, or listeners for some specific event.
<span class='line'>1316</span> 		 * 
<span class='line'>1317</span> 		 * Parameters:
<span class='line'>1318</span> 		 * 	event	-	optional. constrains the clear to just listeners for this event.
<span class='line'>1319</span> 		 */</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>1320</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1321</span> </span><span class="COMM">// *************** END OF PLACEHOLDER DOC ENTRIES FOR NATURAL DOCS ***********************************************************		</span><span class="WHIT">
<span class='line'>1322</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1323</span> 
<span class='line'>1324</span> </span><span class="COMM">// --------------------------- jsPLumbInstance public API ---------------------------------------------------------</span><span class="WHIT">
<span class='line'>1325</span> 
<span class='line'>1326</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1327</span> 		 Function: addClass
<span class='line'>1328</span> 		 
<span class='line'>1329</span> 		 Helper method to abstract out differences in setting css classes on the different renderer types.
<span class='line'>1330</span> 		*/</span><span class="WHIT">
<span class='line'>1331</span> </span><span class="WHIT">		</span><span class="NAME">this.addClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1332</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.addClass</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1333</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1334</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1335</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1336</span> 		 Function: removeClass
<span class='line'>1337</span> 		 
<span class='line'>1338</span> 		 Helper method to abstract out differences in setting css classes on the different renderer types.
<span class='line'>1339</span> 		*/</span><span class="WHIT">
<span class='line'>1340</span> </span><span class="WHIT">		</span><span class="NAME">this.removeClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1341</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.removeClass</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1342</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1343</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1344</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1345</span> 		 Function: hasClass
<span class='line'>1346</span> 		 
<span class='line'>1347</span> 		 Helper method to abstract out differences in testing for css classes on the different renderer types.
<span class='line'>1348</span> 		*/</span><span class="WHIT">
<span class='line'>1349</span> </span><span class="WHIT">		</span><span class="NAME">this.hasClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1350</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.hasClass</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1351</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1352</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1353</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1354</span> 		  Function: addEndpoint 
<span class='line'>1355</span> 		  	
<span class='line'>1356</span> 		  Adds an &lt;Endpoint> to a given element or elements.
<span class='line'>1357</span> 		  			  
<span class='line'>1358</span> 		  Parameters:
<span class='line'>1359</span> 		   
<span class='line'>1360</span> 		  	el - Element to add the endpoint to. Either an element id, a selector representing some element(s), or an array of either of these. 
<span class='line'>1361</span> 		  	params - Object containing Endpoint constructor arguments.  For more information, see &lt;Endpoint>.
<span class='line'>1362</span> 		  	referenceParams - Object containing more Endpoint constructor arguments; it will be merged with params by jsPlumb.  You would use this if you had some 
<span class='line'>1363</span> 		  					  shared parameters that you wanted to reuse when you added Endpoints to a number of elements. The allowed values in
<span class='line'>1364</span> 		  					  this object are anything that 'params' can contain.  See &lt;Endpoint>.
<span class='line'>1365</span> 		  	 
<span class='line'>1366</span> 		  Returns: 
<span class='line'>1367</span> 		  	The newly created &lt;Endpoint>, if el referred to a single element.  Otherwise, an array of newly created &lt;Endpoint>s. 
<span class='line'>1368</span> 		  	
<span class='line'>1369</span> 		  See Also: 
<span class='line'>1370</span> 		  	&lt;addEndpoints>
<span class='line'>1371</span> 		 */</span><span class="WHIT">
<span class='line'>1372</span> </span><span class="WHIT">		</span><span class="NAME">this.addEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1373</span> </span><span class="WHIT">			</span><span class="NAME">referenceParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1374</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1375</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1376</span> </span><span class="WHIT">			</span><span class="NAME">p.endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.endpoint</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.Endpoint</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.Endpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1377</span> </span><span class="WHIT">			</span><span class="NAME">p.paintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.paintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.EndpointStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.EndpointStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1378</span> </span><span class="WHIT">            </span><span class="COMM">// YUI wrapper</span><span class="WHIT">
<span class='line'>1379</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_convertYUICollection</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1380</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1381</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">results</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">inputs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el.length</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">el.constructor</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">String</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1382</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>1383</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">inputs.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1384</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">inputs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1385</span> </span><span class="WHIT">				</span><span class="NAME">p.source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_el</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1386</span> </span><span class="WHIT">                </span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1387</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_newEndpoint</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1388</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p.parentAnchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">e.parentAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.parentAnchor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1389</span> </span><span class="WHIT">				</span><span class="NAME">_addToList</span><span class="PUNC">(</span><span class="NAME">endpointsByElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1390</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myWH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1391</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">anchorLoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e.anchor.compute</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">myOffset.left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myOffset.top</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myWH</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1392</span> </span><span class="WHIT">				</span><span class="NAME">e.paint</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">anchorLoc</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">anchorLoc</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1393</span> </span><span class="WHIT">				</span><span class="NAME">results.push</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1394</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.dragManager.endpointAdded</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1395</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1396</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1397</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">results.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1398</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1399</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1400</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1401</span> 		  Function: addEndpoints 
<span class='line'>1402</span> 		  Adds a list of &lt;Endpoint>s to a given element or elements.
<span class='line'>1403</span> 		  
<span class='line'>1404</span> 		  Parameters: 
<span class='line'>1405</span> 		  	target - element to add the Endpoint to. Either an element id, a selector representing some element(s), or an array of either of these. 
<span class='line'>1406</span> 		  	endpoints - List of objects containing Endpoint constructor arguments. one Endpoint is created for each entry in this list.  See &lt;Endpoint>'s constructor documentation. 
<span class='line'>1407</span> 			referenceParams - Object containing more Endpoint constructor arguments; it will be merged with params by jsPlumb.  You would use this if you had some shared parameters that you wanted to reuse when you added Endpoints to a number of elements.		  	 
<span class='line'>1408</span> 
<span class='line'>1409</span> 		  Returns: 
<span class='line'>1410</span> 		  	List of newly created &lt;Endpoint>s, one for each entry in the 'endpoints' argument. 
<span class='line'>1411</span> 		  	
<span class='line'>1412</span> 		  See Also:
<span class='line'>1413</span> 		  	&lt;addEndpoint>
<span class='line'>1414</span> 		 */</span><span class="WHIT">
<span class='line'>1415</span> </span><span class="WHIT">		</span><span class="NAME">this.addEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpoints</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1416</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">results</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1417</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpoints.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1418</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.addEndpoint</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1419</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isArray</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1420</span> </span><span class="WHIT">					</span><span class="NAME">Array.prototype.push.apply</span><span class="PUNC">(</span><span class="NAME">results</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1421</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">results.push</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1422</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1423</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1424</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1425</span> 
<span class='line'>1426</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1427</span> 		  Function: animate 
<span class='line'>1428</span> 		  This is a wrapper around the supporting library's animate function; it injects a call to jsPlumb in the 'step' function (creating
<span class='line'>1429</span> 		  the 'step' function if necessary). This only supports the two-arg version of the animate call in jQuery, the one that takes an 'options' object as
<span class='line'>1430</span> 		  the second arg. MooTools has only one method, a two arg one. Which is handy.  YUI has a one-arg method, so jsPlumb merges 'properties' and 'options' together for YUI.
<span class='line'>1431</span> 		   
<span class='line'>1432</span> 		  Parameters: 
<span class='line'>1433</span> 		  	el - Element to animate. Either an id, or a selector representing the element. 
<span class='line'>1434</span> 		  	properties - The 'properties' argument you want passed to the library's animate call. 
<span class='line'>1435</span> 		   	options - The 'options' argument you want passed to the library's animate call.
<span class='line'>1436</span> 		    
<span class='line'>1437</span> 		  Returns: 
<span class='line'>1438</span> 		  	void
<span class='line'>1439</span> 		 */</span><span class="WHIT">
<span class='line'>1440</span> </span><span class="WHIT">		</span><span class="NAME">this.animate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">properties</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1441</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ele</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1442</span> </span><span class="WHIT">			</span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1443</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">stepFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.dragEvents</span><span class="PUNC">[</span><span class="STRN">'step'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1444</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">completeFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.dragEvents</span><span class="PUNC">[</span><span class="STRN">'complete'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1445</span> </span><span class="WHIT">			</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">stepFunction</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">stepFunction</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1446</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.repaint</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1447</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1448</span> 
<span class='line'>1449</span> </span><span class="WHIT">			</span><span class="COMM">// onComplete repaints, just to make sure everything looks good at the end of the animation.</span><span class="WHIT">
<span class='line'>1450</span> </span><span class="WHIT">			</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">completeFunction</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">[</span><span class="NAME">completeFunction</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1451</span> </span><span class="WHIT">					</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1452</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.repaint</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1453</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1454</span> 
<span class='line'>1455</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.CurrentLibrary.animate</span><span class="PUNC">(</span><span class="NAME">ele</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">properties</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1456</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1457</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1458</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1459</span> 		* checks for a listener for the given condition, executing it if found, passing in the given value.
<span class='line'>1460</span> 		* condition listeners would have been attached using "bind" (which is, you could argue, now overloaded, since
<span class='line'>1461</span> 		* firing click events etc is a bit different to what this does).  i thought about adding a "bindCondition"
<span class='line'>1462</span> 		* or something, but decided against it, for the sake of simplicity. jsPlumb will never fire one of these
<span class='line'>1463</span> 		* condition events anyway.
<span class='line'>1464</span> 		*/</span><span class="WHIT">
<span class='line'>1465</span> </span><span class="WHIT">		</span><span class="NAME">this.checkCondition</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">conditionName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1466</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getListener</span><span class="PUNC">(</span><span class="NAME">conditionName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1467</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1468</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">l</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">l.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1469</span> </span><span class="WHIT">				</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1470</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">l.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1471</span> </span><span class="WHIT">						</span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">l</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1472</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1473</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1474</span> </span><span class="WHIT">				</span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1475</span> </span><span class="WHIT">					</span><span class="NAME">_log</span><span class="PUNC">(</span><span class="NAME">_currentInstance</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"cannot check condition ["</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">conditionName</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"]"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1476</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1477</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1478</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1479</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1480</span> 
<span class='line'>1481</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1482</span> 		  Function: connect 
<span class='line'>1483</span> 		  Establishes a &lt;Connection> between two elements (or &lt;Endpoint>s, which are themselves registered to elements).
<span class='line'>1484</span> 		  
<span class='line'>1485</span> 		  Parameters: 
<span class='line'>1486</span> 		    params - Object containing constructor arguments for the Connection. See &lt;Connection>'s constructor documentation.
<span class='line'>1487</span> 		    referenceParams - Optional object containing more constructor arguments for the Connection. Typically you would pass in data that a lot of 
<span class='line'>1488</span> 		    Connections are sharing here, such as connector style etc, and then use the main params for data specific to this Connection.
<span class='line'>1489</span> 		     
<span class='line'>1490</span> 		  Returns: 
<span class='line'>1491</span> 		  	The newly created &lt;Connection>.
<span class='line'>1492</span> 		 */</span><span class="WHIT">
<span class='line'>1493</span> </span><span class="WHIT">		</span><span class="NAME">this.connect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1494</span> </span><span class="WHIT">			</span><span class="COMM">// prepare a final set of parameters to create connection with</span><span class="WHIT">
<span class='line'>1495</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_prepareConnectionParams</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1496</span> </span><span class="WHIT">			</span><span class="COMM">// TODO probably a nicer return value if the connection was not made.  _prepareConnectionParams</span><span class="WHIT">
<span class='line'>1497</span> </span><span class="WHIT">			</span><span class="COMM">// will return null (and log something) if either endpoint was full.  what would be nicer is to </span><span class="WHIT">
<span class='line'>1498</span> </span><span class="WHIT">			</span><span class="COMM">// create a dedicated 'error' object.</span><span class="WHIT">
<span class='line'>1499</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1500</span> </span><span class="WHIT">				</span><span class="COMM">// a connect call will delete its created endpoints on detach, unless otherwise specified.</span><span class="WHIT">
<span class='line'>1501</span> </span><span class="WHIT">				</span><span class="COMM">// this is because the endpoints belong to this connection only, and are no use to</span><span class="WHIT">
<span class='line'>1502</span> </span><span class="WHIT">				</span><span class="COMM">// anyone else, so they hang around like a bad smell.</span><span class="WHIT">
<span class='line'>1503</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.deleteEndpointsOnDetach</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1504</span> </span><span class="WHIT">					</span><span class="NAME">_p.deleteEndpointsOnDetach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1505</span> 
<span class='line'>1506</span> </span><span class="WHIT">				</span><span class="COMM">// create the connection.  it is not yet registered </span><span class="WHIT">
<span class='line'>1507</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_newConnection</span><span class="PUNC">(</span><span class="NAME">_p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1508</span> </span><span class="WHIT">				</span><span class="COMM">// now add it the model, fire an event, and redraw</span><span class="WHIT">
<span class='line'>1509</span> </span><span class="WHIT">				</span><span class="NAME">_finaliseConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>1510</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1511</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1512</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1513</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1514</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1515</span> 		 Function: deleteEndpoint		 
<span class='line'>1516</span> 		 Deletes an Endpoint and removes all Connections it has (which removes the Connections from the other Endpoints involved too)
<span class='line'>1517</span> 		 
<span class='line'>1518</span> 		 Parameters:
<span class='line'>1519</span> 		 	object - either an &lt;Endpoint> object (such as from an addEndpoint call), or a String UUID.
<span class='line'>1520</span> 		 	
<span class='line'>1521</span> 		 Returns:
<span class='line'>1522</span> 		 	void		  
<span class='line'>1523</span> 		 */</span><span class="WHIT">
<span class='line'>1524</span> </span><span class="WHIT">		</span><span class="NAME">this.deleteEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">object</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1525</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">object</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">endpointsByUUID</span><span class="PUNC">[</span><span class="NAME">object</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">object</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1526</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>1527</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">uuid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpoint.getUuid</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1528</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">uuid</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">endpointsByUUID</span><span class="PUNC">[</span><span class="NAME">uuid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>1529</span> </span><span class="WHIT">				</span><span class="NAME">endpoint.detachAll</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>1530</span> </span><span class="WHIT">				</span><span class="NAME">_removeElements</span><span class="PUNC">(</span><span class="NAME">endpoint.endpoint.getDisplayElements</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1531</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.anchorManager.deleteEndpoint</span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1532</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1533</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1534</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endpoints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1535</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1536</span> </span><span class="WHIT">						</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpoints.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1537</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">newEndpoints.push</span><span class="PUNC">(</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1538</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>1539</span> </span><span class="WHIT">						</span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newEndpoints</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1540</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1541</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1542</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.dragManager.endpointDeleted</span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>1543</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">									</span><span class="WHIT">
<span class='line'>1544</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1545</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1546</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1547</span> 		 Function: deleteEveryEndpoint
<span class='line'>1548</span> 		  Deletes every &lt;Endpoint>, and their associated &lt;Connection>s, in this instance of jsPlumb. Does not unregister any event listeners (this is the only difference
<span class='line'>1549</span> between this method and jsPlumb.reset).  
<span class='line'>1550</span> 		  
<span class='line'>1551</span> 		 Returns: 
<span class='line'>1552</span> 		 	void 
<span class='line'>1553</span> 		 */</span><span class="WHIT">
<span class='line'>1554</span> </span><span class="WHIT">		</span><span class="NAME">this.deleteEveryEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1555</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1556</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1557</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endpoints</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">endpoints.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1558</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpoints.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1559</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.deleteEndpoint</span><span class="PUNC">(</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1560</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1561</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1562</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1563</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1564</span> </span><span class="WHIT">			</span><span class="NAME">endpointsByElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1565</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">endpointsByUUID</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1566</span> </span><span class="WHIT">			</span><span class="NAME">endpointsByUUID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1567</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1568</span> 
<span class='line'>1569</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fireDetachEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doFireEvent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1570</span> </span><span class="WHIT">            </span><span class="COMM">// may have been given a connection, or in special cases, an object</span><span class="WHIT">
<span class='line'>1571</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">connType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">_currentInstance.Defaults.ConnectionType</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getDefaultConnectionType</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1572</span> </span><span class="WHIT">                </span><span class="NAME">argIsConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">connType</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1573</span> </span><span class="WHIT">                </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">argIsConnection</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1574</span> </span><span class="WHIT">                    </span><span class="NAME">connection</span><span class="PUNC">:</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1575</span> </span><span class="WHIT">				    </span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.source</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">target</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.target</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1576</span> </span><span class="WHIT">				    </span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.targetId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1577</span> </span><span class="WHIT">				    </span><span class="NAME">sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>1578</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1579</span> 
<span class='line'>1580</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">doFireEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_currentInstance.fire</span><span class="PUNC">(</span><span class="STRN">"jsPlumbConnectionDetached"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1581</span> </span><span class="WHIT">            </span><span class="NAME">_currentInstance.anchorManager.connectionDetached</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1582</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1583</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>1584</span> 			fires an event to indicate an existing connection is being dragged.
<span class='line'>1585</span> 		*/</span><span class="WHIT">
<span class='line'>1586</span> </span><span class="WHIT">		</span><span class="NAME">fireConnectionDraggingEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1587</span> </span><span class="WHIT">			</span><span class="NAME">_currentInstance.fire</span><span class="PUNC">(</span><span class="STRN">"connectionDrag"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1588</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1589</span> </span><span class="WHIT">		</span><span class="NAME">fireConnectionDragStopEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1590</span> </span><span class="WHIT">			</span><span class="NAME">_currentInstance.fire</span><span class="PUNC">(</span><span class="STRN">"connectionDragStop"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1591</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1592</span> 
<span class='line'>1593</span> 
<span class='line'>1594</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1595</span> 		  Function: detach 
<span class='line'>1596</span> 		  Detaches and then removes a &lt;Connection>.  From 1.3.5 this method has been altered to remove support for
<span class='line'>1597</span> 		  specifying Connections by various parameters; you can now pass in a Connection as the first argument and
<span class='line'>1598</span> 		  an optional parameters object as a second argument.  If you need the functionality this method provided
<span class='line'>1599</span> 		  before 1.3.5 then you should use the getConnections method to get the list of Connections to detach, and
<span class='line'>1600</span> 		  then iterate through them, calling this for each one.
<span class='line'>1601</span> 		  		   
<span class='line'>1602</span> 		  Parameters: 
<span class='line'>1603</span> 		    connection  -   the &lt;Connection> to detach
<span class='line'>1604</span> 		    params      -   optional parameters to the detach call.  valid values here are
<span class='line'>1605</span> 		                    fireEvent   :   defaults to false; indicates you want jsPlumb to fire a connection
<span class='line'>1606</span> 		                                    detached event. The thinking behind this is that if you made a programmatic
<span class='line'>1607</span> 		                                    call to detach an event, you probably don't need the callback.
<span class='line'>1608</span> 		                    forceDetach :   defaults to false. allows you to override any beforeDetach listeners that may be registered.
<span class='line'>1609</span> 
<span class='line'>1610</span> 		    Returns: 
<span class='line'>1611</span> 		    	true if successful, false if not.
<span class='line'>1612</span> 		 */</span><span class="WHIT">
<span class='line'>1613</span> </span><span class="WHIT">		</span><span class="NAME">this.detach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1614</span> 
<span class='line'>1615</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1616</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">connType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">_currentInstance.Defaults.ConnectionType</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getDefaultConnectionType</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1617</span> </span><span class="WHIT">                </span><span class="NAME">firstArgIsConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">connType</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1618</span> </span><span class="WHIT">                </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">firstArgIsConnection</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1619</span> </span><span class="WHIT">                </span><span class="NAME">fireEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.fireEvent</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1620</span> </span><span class="WHIT">                </span><span class="NAME">forceDetach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.forceDetach</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1621</span> </span><span class="WHIT">                </span><span class="NAME">connection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">firstArgIsConnection</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">params.connection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1622</span> 
<span class='line'>1623</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1624</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">forceDetach</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">connection.isDetachAllowed</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1625</span> </span><span class="WHIT">                                        </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">connection.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isDetachAllowed</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1626</span> </span><span class="WHIT">                                        </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">connection.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isDetachAllowed</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1627</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">forceDetach</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.checkCondition</span><span class="PUNC">(</span><span class="STRN">"beforeDetach"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connection</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1628</span> </span><span class="WHIT">						    </span><span class="NAME">connection.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">detach</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fireEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// TODO check this param iscorrect for endpoint's detach method</span><span class="WHIT">
<span class='line'>1629</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1630</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1631</span> </span><span class="WHIT">                </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1632</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// a backwards compatibility hack: source should be thought of as 'params' in this case.</span><span class="WHIT">
<span class='line'>1633</span> </span><span class="WHIT">					</span><span class="COMM">// test for endpoint uuids to detach</span><span class="WHIT">
<span class='line'>1634</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.uuids</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1635</span> </span><span class="WHIT">						</span><span class="NAME">_getEndpoint</span><span class="PUNC">(</span><span class="NAME">_p.uuids</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">detachFrom</span><span class="PUNC">(</span><span class="NAME">_getEndpoint</span><span class="PUNC">(</span><span class="NAME">_p.uuids</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fireEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1636</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_p.sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_p.targetEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1637</span> </span><span class="WHIT">						</span><span class="NAME">_p.sourceEndpoint.detachFrom</span><span class="PUNC">(</span><span class="NAME">_p.targetEndpoint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1638</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1639</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">_p.source</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1640</span> </span><span class="WHIT">						    </span><span class="NAME">targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">_p.target</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1641</span> </span><span class="WHIT">						</span><span class="NAME">_operation</span><span class="PUNC">(</span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1642</span> </span><span class="WHIT">						    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">jpc.sourceId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">jpc.targetId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.targetId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">jpc.sourceId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1643</span> </span><span class="WHIT">							    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_currentInstance.checkCondition</span><span class="PUNC">(</span><span class="STRN">"beforeDetach"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1644</span> </span><span class="WHIT">                                    </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">detach</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fireEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1645</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1646</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1647</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1648</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1649</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1650</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1651</span> 
<span class='line'>1652</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1653</span> 		  Function: detachAllConnections
<span class='line'>1654</span> 		  Removes all an element's Connections.
<span class='line'>1655</span> 		   
<span class='line'>1656</span> 		  Parameters:
<span class='line'>1657</span> 		  	el - either the id of the element, or a selector for the element.
<span class='line'>1658</span> 		  	params - optional parameters.  alowed values:
<span class='line'>1659</span> 		  	        fireEvent : defaults to true, whether or not to fire the detach event.
<span class='line'>1660</span> 		  	
<span class='line'>1661</span> 		  Returns: 
<span class='line'>1662</span> 		  	void
<span class='line'>1663</span> 		 */</span><span class="WHIT">
<span class='line'>1664</span> </span><span class="WHIT">		</span><span class="NAME">this.detachAllConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1665</span> </span><span class="WHIT">            </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1666</span> </span><span class="WHIT">            </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1667</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1668</span> </span><span class="WHIT">                </span><span class="NAME">endpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1669</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endpoints</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">endpoints.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1670</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpoints.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1671</span> </span><span class="WHIT">					</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">detachAll</span><span class="PUNC">(</span><span class="NAME">params.fireEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1672</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1673</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1674</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1675</span> 
<span class='line'>1676</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1677</span> 		  Function: detachEveryConnection 
<span class='line'>1678</span> 		  Remove all Connections from all elements, but leaves Endpoints in place.
<span class='line'>1679</span> 
<span class='line'>1680</span> 		  Parameters:
<span class='line'>1681</span> 		    params  - optional params object containing:
<span class='line'>1682</span> 		            fireEvent : whether or not to fire detach events. defaults to true.
<span class='line'>1683</span> 
<span class='line'>1684</span> 		   
<span class='line'>1685</span> 		  Returns: 
<span class='line'>1686</span> 		  	void
<span class='line'>1687</span> 		  	 
<span class='line'>1688</span> 		  See Also:
<span class='line'>1689</span> 		  	&lt;removeEveryEndpoint>
<span class='line'>1690</span> 		 */</span><span class="WHIT">
<span class='line'>1691</span> </span><span class="WHIT">		</span><span class="NAME">this.detachEveryConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1692</span> </span><span class="WHIT">            </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1693</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1694</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1695</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endpoints</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">endpoints.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1696</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpoints.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1697</span> </span><span class="WHIT">						</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">detachAll</span><span class="PUNC">(</span><span class="NAME">params.fireEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1698</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1699</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1700</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1701</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">connectionsByScope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1702</span> </span><span class="WHIT">			</span><span class="NAME">connectionsByScope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1703</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1704</span> 
<span class='line'>1705</span> 
<span class='line'>1706</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1707</span> 		  Function: draggable 
<span class='line'>1708</span> 		  Initialises the draggability of some element or elements.  You should use this instead of your 
<span class='line'>1709</span> 		  library's draggable method so that jsPlumb can setup the appropriate callbacks.  Your 
<span class='line'>1710</span> 		  underlying library's drag method is always called from this method.
<span class='line'>1711</span> 		  
<span class='line'>1712</span> 		  Parameters: 
<span class='line'>1713</span> 		  	el - either an element id, a list of element ids, or a selector. 
<span class='line'>1714</span> 		  	options - options to pass through to the underlying library
<span class='line'>1715</span> 		  	 
<span class='line'>1716</span> 		  Returns: 
<span class='line'>1717</span> 		  	void
<span class='line'>1718</span> 		 */</span><span class="WHIT">		 </span><span class="WHIT">
<span class='line'>1719</span> </span><span class="WHIT">		</span><span class="NAME">this.draggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1720</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">el.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1721</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">el.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1722</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ele</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1723</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ele</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_initDraggableIfNecessary</span><span class="PUNC">(</span><span class="NAME">ele</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1724</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1725</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1726</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el._nodes</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> 	</span><span class="COMM">// TODO this is YUI specific; really the logic should be forced</span><span class="WHIT">
<span class='line'>1727</span> </span><span class="WHIT">				</span><span class="COMM">// into the library adapters (for jquery and mootools aswell)</span><span class="WHIT">
<span class='line'>1728</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">el._nodes.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1729</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ele</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el._nodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1730</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ele</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_initDraggableIfNecessary</span><span class="PUNC">(</span><span class="NAME">ele</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1731</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1732</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1733</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1734</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ele</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1735</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ele</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_initDraggableIfNecessary</span><span class="PUNC">(</span><span class="NAME">ele</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">options</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1736</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1737</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1738</span> 
<span class='line'>1739</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1740</span> 		  Function: extend 
<span class='line'>1741</span> 		  Wraps the underlying library's extend functionality.
<span class='line'>1742</span> 		  
<span class='line'>1743</span> 		  Parameters: 
<span class='line'>1744</span> 		  	o1 - object to extend 
<span class='line'>1745</span> 		  	o2 - object to extend o1 with
<span class='line'>1746</span> 		  	
<span class='line'>1747</span> 		  Returns: 
<span class='line'>1748</span> 		  	o1, extended with all properties from o2.
<span class='line'>1749</span> 		 */</span><span class="WHIT">
<span class='line'>1750</span> </span><span class="WHIT">		</span><span class="NAME">this.extend</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">o1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1751</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.extend</span><span class="PUNC">(</span><span class="NAME">o1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1752</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1753</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1754</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1755</span> 		 * Function: getDefaultEndpointType
<span class='line'>1756</span> 		 * 	Returns the default Endpoint type. Used when someone wants to subclass Endpoint and have jsPlumb return instances of their subclass.
<span class='line'>1757</span> 		 *  you would make a call like this in your class's constructor:
<span class='line'>1758</span> 		 *    jsPlumb.getDefaultEndpointType().apply(this, arguments);
<span class='line'>1759</span> 		 * 
<span class='line'>1760</span> 		 * Returns:
<span class='line'>1761</span> 		 * 	the default Endpoint function used by jsPlumb.
<span class='line'>1762</span> 		 */</span><span class="WHIT">
<span class='line'>1763</span> </span><span class="WHIT">		</span><span class="NAME">this.getDefaultEndpointType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1764</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Endpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1765</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1766</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1767</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1768</span> 		 * Function: getDefaultConnectionType
<span class='line'>1769</span> 		 * 	Returns the default Connection type. Used when someone wants to subclass Connection and have jsPlumb return instances of their subclass.
<span class='line'>1770</span> 		 *  you would make a call like this in your class's constructor:
<span class='line'>1771</span> 		 *    jsPlumb.getDefaultConnectionType().apply(this, arguments);
<span class='line'>1772</span> 		 * 
<span class='line'>1773</span> 		 * Returns:
<span class='line'>1774</span> 		 * 	the default Connection function used by jsPlumb.
<span class='line'>1775</span> 		 */</span><span class="WHIT">
<span class='line'>1776</span> </span><span class="WHIT">		</span><span class="NAME">this.getDefaultConnectionType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1777</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Connection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1778</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1779</span> 
<span class='line'>1780</span> </span><span class="WHIT">		</span><span class="COMM">// helpers for select/selectEndpoints</span><span class="WHIT">
<span class='line'>1781</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_setOperation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">selector</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1782</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">list.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1783</span> </span><span class="WHIT">					</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">func</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1784</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1785</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">selector</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1786</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1787</span> </span><span class="WHIT">			</span><span class="NAME">_getOperation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1788</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">out</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1789</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">list.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>1790</span> </span><span class="WHIT">					</span><span class="NAME">out.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">func</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1791</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1792</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">out</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1793</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1794</span> </span><span class="WHIT">			</span><span class="NAME">setter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">selector</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1795</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1796</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_setOperation</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">selector</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1797</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1798</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1799</span> </span><span class="WHIT">			</span><span class="NAME">getter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1800</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1801</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_getOperation</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1802</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1803</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1804</span> 
<span class='line'>1805</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1806</span> 		 * Function: getConnections 
<span class='line'>1807</span> 		 * Gets all or a subset of connections currently managed by this jsPlumb instance.  If only one scope is passed in to this method,
<span class='line'>1808</span> 		 * the result will be a list of connections having that scope (passing in no scope at all will result in jsPlumb assuming you want the
<span class='line'>1809</span> 		 * default scope).  If multiple scopes are passed in, the return value will be a map of { scope -> [ connection... ] }.
<span class='line'>1810</span> 		 * 
<span class='line'>1811</span> 		 *  Parameters:
<span class='line'>1812</span> 		 *  	scope	-	if the only argument to getConnections is a string, jsPlumb will treat that string as a scope filter, and return a list
<span class='line'>1813</span> 		 *                  of connections that are in the given scope. use '*' for all scopes.
<span class='line'>1814</span> 		 *      options	-	if the argument is a JS object, you can specify a finer-grained filter:
<span class='line'>1815</span> 		 *      
<span class='line'>1816</span> 		 *      		-	*scope* may be a string specifying a single scope, or an array of strings, specifying multiple scopes. Also may have the value '*', indicating any scope.
<span class='line'>1817</span> 		 *      		-	*source* either a string representing an element id, a selector, or an array of ids. Also may have the value '*', indicating any source.  Constrains the result to connections having this/these element(s) as source.
<span class='line'>1818</span> 		 *      		-	*target* either a string representing an element id, a selector, or an array of ids. Also may have the value '*', indicating any target.  Constrains the result to connections having this/these element(s) as target.		 
<span class='line'>1819</span> 		 *		flat    -	return results in a flat array (don't return an object whose keys are scopes and whose values are lists per scope).
<span class='line'>1820</span> 		 * 
<span class='line'>1821</span> 		 */</span><span class="WHIT">
<span class='line'>1822</span> </span><span class="WHIT">		</span><span class="NAME">this.getConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">options</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">flat</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1823</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">options</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1824</span> </span><span class="WHIT">				</span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1825</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">options.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">String</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1826</span> </span><span class="WHIT">				</span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="STRN">"scope"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">options</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1827</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1828</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prepareList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1829</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1830</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1831</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">input</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'string'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1832</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">input</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"*"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">input</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1833</span> </span><span class="WHIT">						</span><span class="NAME">r.push</span><span class="PUNC">(</span><span class="NAME">input</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1834</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1835</span> </span><span class="WHIT">					</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1836</span> </span><span class="WHIT">						</span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">input</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1837</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1838</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1839</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1840</span> </span><span class="WHIT">			</span><span class="NAME">scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">options.scope</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getDefaultScope</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1841</span> </span><span class="WHIT">			</span><span class="NAME">scopes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prepareList</span><span class="PUNC">(</span><span class="NAME">scope</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1842</span> </span><span class="WHIT">			</span><span class="NAME">sources</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prepareList</span><span class="PUNC">(</span><span class="NAME">options.source</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1843</span> </span><span class="WHIT">			</span><span class="NAME">targets</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prepareList</span><span class="PUNC">(</span><span class="NAME">options.target</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1844</span> </span><span class="WHIT">			</span><span class="NAME">filter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1845</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">list</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"*"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1846</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">list.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_indexOf</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1847</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1848</span> </span><span class="WHIT">			</span><span class="NAME">results</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">flat</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">scopes.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1849</span> </span><span class="WHIT">			</span><span class="NAME">_addOne</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">scope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1850</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">flat</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">scopes.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1851</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ss</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">[</span><span class="NAME">scope</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1852</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ss</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1853</span> </span><span class="WHIT">						</span><span class="NAME">ss</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">[</span><span class="NAME">scope</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ss</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1854</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1855</span> </span><span class="WHIT">					</span><span class="NAME">ss.push</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1856</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">results.push</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1857</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1858</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">connectionsByScope</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1859</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">filter</span><span class="PUNC">(</span><span class="NAME">scopes</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1860</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">connectionsByScope</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1861</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectionsByScope</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1862</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">filter</span><span class="PUNC">(</span><span class="NAME">sources</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c.sourceId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">filter</span><span class="PUNC">(</span><span class="NAME">targets</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c.targetId</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1863</span> </span><span class="WHIT">							</span><span class="NAME">_addOne</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1864</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1865</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1866</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1867</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">results</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1868</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1869</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1870</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT">	</span><span class="NAME">_makeConnectionSelectHandler</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1871</span> </span><span class="WHIT">			</span><span class="COMM">//var </span><span class="WHIT">
<span class='line'>1872</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1873</span> </span><span class="WHIT">				</span><span class="COMM">// setters</span><span class="WHIT">
<span class='line'>1874</span> </span><span class="WHIT">				</span><span class="NAME">setHover</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setHover"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>1875</span> </span><span class="WHIT">				</span><span class="NAME">removeAllOverlays</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"removeAllOverlays"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1876</span> </span><span class="WHIT">				</span><span class="NAME">setLabel</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setLabel"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1877</span> </span><span class="WHIT">				</span><span class="NAME">addOverlay</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"addOverlay"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1878</span> </span><span class="WHIT">				</span><span class="NAME">removeOverlay</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"removeOverlay"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1879</span> </span><span class="WHIT">				</span><span class="NAME">removeOverlays</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"removeOverlays"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1880</span> </span><span class="WHIT">				</span><span class="NAME">showOverlay</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"showOverlay"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1881</span> </span><span class="WHIT">				</span><span class="NAME">hideOverlay</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"hideOverlay"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1882</span> </span><span class="WHIT">				</span><span class="NAME">showOverlays</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"showOverlays"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1883</span> </span><span class="WHIT">				</span><span class="NAME">hideOverlays</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"hideOverlays"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1884</span> </span><span class="WHIT">				</span><span class="NAME">setPaintStyle</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setPaintStyle"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1885</span> </span><span class="WHIT">				</span><span class="NAME">setHoverPaintStyle</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setHoverPaintStyle"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>1886</span> </span><span class="WHIT">				</span><span class="NAME">setDetachable</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setDetachable"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1887</span> </span><span class="WHIT">				</span><span class="NAME">setConnector</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setConnector"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1888</span> </span><span class="WHIT">				</span><span class="NAME">setParameter</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setParameter"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1889</span> </span><span class="WHIT">				</span><span class="NAME">setParameters</span><span class="PUNC">:</span><span class="NAME">setter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"setParameters"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1890</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>1891</span> </span><span class="WHIT">				</span><span class="NAME">detach</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1892</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">list.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1893</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.detach</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1894</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>1895</span> 
<span class='line'>1896</span> </span><span class="WHIT">				</span><span class="COMM">// getters</span><span class="WHIT">
<span class='line'>1897</span> </span><span class="WHIT">				</span><span class="NAME">getLabel</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"getLabel"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1898</span> </span><span class="WHIT">				</span><span class="NAME">getOverlay</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"getOverlay"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1899</span> </span><span class="WHIT">				</span><span class="NAME">isHover</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"isHover"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1900</span> </span><span class="WHIT">				</span><span class="NAME">isDetachable</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"isDetachable"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1901</span> </span><span class="WHIT">				</span><span class="NAME">getParameter</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"getParameter"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1902</span> </span><span class="WHIT">				</span><span class="NAME">getParameters</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"getParameters"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1903</span> </span><span class="WHIT">				</span><span class="NAME">getPaintStyle</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"getPaintStyle"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1904</span> </span><span class="WHIT">				</span><span class="NAME">getHoverPaintStyle</span><span class="PUNC">:</span><span class="NAME">getter</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"getHoverPaintStyle"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1905</span> 
<span class='line'>1906</span> </span><span class="WHIT">				</span><span class="COMM">// util</span><span class="WHIT">
<span class='line'>1907</span> </span><span class="WHIT">				</span><span class="NAME">length</span><span class="PUNC">:</span><span class="NAME">list.length</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1908</span> </span><span class="WHIT">				</span><span class="NAME">each</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1909</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">list.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1910</span> </span><span class="WHIT">						</span><span class="NAME">f</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1911</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1912</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1913</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>1914</span> </span><span class="WHIT">				</span><span class="NAME">get</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1915</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1916</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1917</span> 
<span class='line'>1918</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1919</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1920</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>1921</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1922</span> 		* Function: select
<span class='line'>1923</span> 		* Selects a set of Connections, using the filter options from the getConnections method, and returns an object
<span class='line'>1924</span> 		* that allows you to perform an operation on all of the Connections at once. The return value from any of these 
<span class='line'>1925</span> 		* operations is the original list of Connections, allowing operations to be chained (for 'setter' type operations).
<span class='line'>1926</span> 		* 'getter' type operations return an array of values, where each entry is a [Connection, return value] pair.
<span class='line'>1927</span> 		* 
<span class='line'>1928</span> 		* Parameters:
<span class='line'>1929</span> 		*	scope - see getConnections
<span class='line'>1930</span> 		* 	source - see getConnections
<span class='line'>1931</span> 		*	target - see getConnections
<span class='line'>1932</span> 		*
<span class='line'>1933</span> 		* Returns:
<span class='line'>1934</span> 		* A list of Connections on which operations may be executed. 'Setter' type operations can be chained; 'getter' type operations
<span class='line'>1935</span> 		* return an array of [Connection, value] pairs, one entry for each Connection in the list returned. The full list of operations 
<span class='line'>1936</span> 		* is as follows (where not specified, the operation's effect or return value is the same as the corresponding method on Connection) :
<span class='line'>1937</span> 		*	-	setHover								
<span class='line'>1938</span> 		*	-	removeAllOverlays
<span class='line'>1939</span> 		*	-	setLabel
<span class='line'>1940</span> 		*	-	addOverlay
<span class='line'>1941</span> 		*	-	removeOverlay
<span class='line'>1942</span> 		*	-	removeOverlays
<span class='line'>1943</span> 		*	-	showOverlay
<span class='line'>1944</span> 		*	-	hideOverlay
<span class='line'>1945</span> 		*	-	showOverlays
<span class='line'>1946</span> 		*	-	hideOverlays
<span class='line'>1947</span> 		*	-	setPaintStyle
<span class='line'>1948</span> 		*	-	setHoverPaintStyle
<span class='line'>1949</span> 		*	-	setDetachable
<span class='line'>1950</span> 		*	-	setConnector
<span class='line'>1951</span> 		*	-	setParameter
<span class='line'>1952</span> 		*	-	setParameters
<span class='line'>1953</span> 		*   - 	getLabel
<span class='line'>1954</span> 		*	-	getOverlay
<span class='line'>1955</span> 		*	-	isHover
<span class='line'>1956</span> 		*	-	isDetachable
<span class='line'>1957</span> 		*	-	getParameter
<span class='line'>1958</span> 		*	-	getParameters
<span class='line'>1959</span> 		*	-	getPaintStyle
<span class='line'>1960</span> 		*	-	getHoverPaintStyle
<span class='line'>1961</span> 		*	-	detach detaches all the connections in the list. not chainable and does not return anything.
<span class='line'>1962</span> 		*	-	length : returns the length of the list.
<span class='line'>1963</span> 		*	-	get(index) : returns the Connection at 'index' in the list.
<span class='line'>1964</span> 		*	-	each(function(connection)...) : allows you to specify your own function to execute; this function is chainable.
<span class='line'>1965</span> 		*/</span><span class="WHIT">
<span class='line'>1966</span> </span><span class="WHIT">		</span><span class="NAME">this.select</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1967</span> </span><span class="WHIT">			</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1968</span> </span><span class="WHIT">			</span><span class="NAME">params.scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.scope</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">"*"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1969</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getConnections</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1970</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_makeConnectionSelectHandler</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>1971</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1972</span> 
<span class='line'>1973</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1974</span> 		 * Function: getAllConnections
<span class='line'>1975</span> 		 * Gets all connections, as a map of { scope -> [ connection... ] }. 
<span class='line'>1976</span> 		 */</span><span class="WHIT">
<span class='line'>1977</span> </span><span class="WHIT">		</span><span class="NAME">this.getAllConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1978</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">connectionsByScope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1979</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1980</span> 
<span class='line'>1981</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1982</span> 		 * Function: getDefaultScope 
<span class='line'>1983</span> 		 * Gets the default scope for connections and  endpoints. a scope defines a type of endpoint/connection; supplying a
<span class='line'>1984</span> 		 * scope to an endpoint or connection allows you to support different
<span class='line'>1985</span> 		 * types of connections in the same UI. but if you're only interested in
<span class='line'>1986</span> 		 * one type of connection, you don't need to supply a scope. this method
<span class='line'>1987</span> 		 * will probably be used by very few people; it's good for testing
<span class='line'>1988</span> 		 * though.
<span class='line'>1989</span> 		 */</span><span class="WHIT">
<span class='line'>1990</span> </span><span class="WHIT">		</span><span class="NAME">this.getDefaultScope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1991</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">DEFAULT_SCOPE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1992</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1993</span> 
<span class='line'>1994</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>1995</span> 		  Function: getEndpoint 
<span class='line'>1996</span> 		  Gets an Endpoint by UUID
<span class='line'>1997</span> 		   
<span class='line'>1998</span> 		  Parameters: 
<span class='line'>1999</span> 		  	uuid - the UUID for the Endpoint
<span class='line'>2000</span> 		  	 
<span class='line'>2001</span> 		  Returns: 
<span class='line'>2002</span> 		  	Endpoint with the given UUID, null if nothing found.
<span class='line'>2003</span> 		 */</span><span class="WHIT">
<span class='line'>2004</span> </span><span class="WHIT">		</span><span class="NAME">this.getEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2005</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2006</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>2007</span> 		 * Function:getEndpoints
<span class='line'>2008</span> 		 * Gets the list of Endpoints for a given selector, or element id.
<span class='line'>2009</span> 		 * @param el
<span class='line'>2010</span> 		 * @return
<span class='line'>2011</span> 		 */</span><span class="WHIT">
<span class='line'>2012</span> </span><span class="WHIT">		</span><span class="NAME">this.getEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2013</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2014</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2015</span> 
<span class='line'>2016</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2017</span> 		 * Gets an element's id, creating one if necessary. really only exposed
<span class='line'>2018</span> 		 * for the lib-specific functionality to access; would be better to pass
<span class='line'>2019</span> 		 * the current instance into the lib-specific code (even though this is
<span class='line'>2020</span> 		 * a static call. i just don't want to expose it to the public API).
<span class='line'>2021</span> 		 */</span><span class="WHIT">
<span class='line'>2022</span> </span><span class="WHIT">		</span><span class="NAME">this.getId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2023</span> </span><span class="WHIT">		</span><span class="NAME">this.getOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2024</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2025</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">elId</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2026</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2027</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2028</span> </span><span class="WHIT">		</span><span class="NAME">this.getSelector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">spec</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2029</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getSelector</span><span class="PUNC">(</span><span class="NAME">spec</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2030</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2031</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2032</span> </span><span class="WHIT">		</span><span class="NAME">this.getSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2033</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">s</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2034</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">elId</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2035</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2036</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2037</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2038</span> </span><span class="WHIT">		</span><span class="NAME">this.appendElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_appendElement</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2039</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2040</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_hoverSuspended</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2041</span> </span><span class="WHIT">		</span><span class="NAME">this.isHoverSuspended</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_hoverSuspended</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2042</span> </span><span class="WHIT">		</span><span class="NAME">this.setHoverSuspended</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">s</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">_hoverSuspended</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">s</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2043</span> 
<span class='line'>2044</span> </span><span class="WHIT">		</span><span class="NAME">this.isCanvasAvailable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">canvasAvailable</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2045</span> </span><span class="WHIT">		</span><span class="NAME">this.isSVGAvailable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">svgAvailable</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2046</span> </span><span class="WHIT">		</span><span class="NAME">this.isVMLAvailable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">vmlAvailable</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2047</span> 
<span class='line'>2048</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2049</span> 		  Function: hide 
<span class='line'>2050</span> 		  Sets an element's connections to be hidden.
<span class='line'>2051</span> 		  
<span class='line'>2052</span> 		  Parameters: 
<span class='line'>2053</span> 		  	el - either the id of the element, or a selector for the element.
<span class='line'>2054</span> 		  	changeEndpoints - whether not to also hide endpoints on the element. by default this is false.  
<span class='line'>2055</span> 		  	 
<span class='line'>2056</span> 		  Returns: 
<span class='line'>2057</span> 		  	void
<span class='line'>2058</span> 		 */</span><span class="WHIT">
<span class='line'>2059</span> </span><span class="WHIT">		</span><span class="NAME">this.hide</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">changeEndpoints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2060</span> </span><span class="WHIT">			</span><span class="NAME">_setVisible</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"none"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">changeEndpoints</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2061</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2062</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2063</span> </span><span class="WHIT">		</span><span class="COMM">// exposed for other objects to use to get a unique id.</span><span class="WHIT">
<span class='line'>2064</span> </span><span class="WHIT">		</span><span class="NAME">this.idstamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_idstamp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2065</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2066</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>2067</span> 		 * callback from the current library to tell us to prepare ourselves (attach
<span class='line'>2068</span> 		 * mouse listeners etc; can't do that until the library has provided a bind method)
<span class='line'>2069</span> 		 * @return
<span class='line'>2070</span> 		 */</span><span class="WHIT">
<span class='line'>2071</span> </span><span class="WHIT">		</span><span class="NAME">this.init</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2072</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">initialized</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2073</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.setRenderMode</span><span class="PUNC">(</span><span class="NAME">_currentInstance.Defaults.RenderMode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// calling the method forces the capability logic to be run.</span><span class="WHIT">
<span class='line'>2074</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2075</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">bindOne</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">event</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2076</span> </span><span class="WHIT">						</span><span class="NAME">jsPlumb.CurrentLibrary.bind</span><span class="PUNC">(</span><span class="NAME">document</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2077</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_currentInstance.currentlyDragging</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">renderMode</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CANVAS</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2078</span> </span><span class="WHIT">								</span><span class="COMM">// try connections first</span><span class="WHIT">
<span class='line'>2079</span> </span><span class="WHIT">								</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">connectionsByScope</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2080</span> </span><span class="WHIT">					    			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectionsByScope</span><span class="PUNC">[</span><span class="NAME">scope</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2081</span> </span><span class="WHIT">					    			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">c.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2082</span> </span><span class="WHIT">					    				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connector</span><span class="PUNC">[</span><span class="NAME">event</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2083</span> </span><span class="WHIT">					    				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>2084</span> </span><span class="WHIT">					    			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2085</span> </span><span class="WHIT">					    		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2086</span> </span><span class="WHIT">								</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2087</span> </span><span class="WHIT">									</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ee</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">el</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2088</span> </span><span class="WHIT">									</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ee.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2089</span> </span><span class="WHIT">										</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ee</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoint</span><span class="PUNC">[</span><span class="NAME">event</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2090</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2091</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2092</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2093</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2094</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2095</span> </span><span class="WHIT">				</span><span class="NAME">bindOne</span><span class="PUNC">(</span><span class="STRN">"click"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bindOne</span><span class="PUNC">(</span><span class="STRN">"dblclick"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bindOne</span><span class="PUNC">(</span><span class="STRN">"mousemove"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bindOne</span><span class="PUNC">(</span><span class="STRN">"mousedown"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bindOne</span><span class="PUNC">(</span><span class="STRN">"mouseup"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="NAME">bindOne</span><span class="PUNC">(</span><span class="STRN">"contextmenu"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2096</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2097</span> </span><span class="WHIT">				</span><span class="NAME">initialized</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2098</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.fire</span><span class="PUNC">(</span><span class="STRN">"ready"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2099</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2100</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2101</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2102</span> </span><span class="WHIT">		</span><span class="NAME">this.log</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">log</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2103</span> </span><span class="WHIT">		</span><span class="NAME">this.jsPlumbUIComponent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumbUIComponent</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2104</span> 
<span class='line'>2105</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2106</span> 		 * Creates an anchor with the given params.
<span class='line'>2107</span> 		 * 
<span class='line'>2108</span> 		 * 
<span class='line'>2109</span> 		 * Returns: The newly created Anchor.
<span class='line'>2110</span> 		 */</span><span class="WHIT">
<span class='line'>2111</span> </span><span class="WHIT">		</span><span class="NAME">this.makeAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2112</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">arguments.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2113</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">specimen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jsPlumbInstance</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2114</span> </span><span class="WHIT">			</span><span class="COMM">// if it appears to be an anchor already...</span><span class="WHIT">
<span class='line'>2115</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">specimen.compute</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">specimen.getOrientation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">specimen</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">//TODO hazy here about whether it should be added or is already added somehow.</span><span class="WHIT">
<span class='line'>2116</span> </span><span class="WHIT">			</span><span class="COMM">// is it the name of an anchor type?</span><span class="WHIT">
<span class='line'>2117</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">specimen</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2118</span> </span><span class="WHIT">				</span><span class="NAME">newAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">elementId</span><span class="PUNC">:</span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jsPlumbInstance</span><span class="PUNC">:</span><span class="NAME">_currentInstance</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2119</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2120</span> </span><span class="WHIT">			</span><span class="COMM">// is it an array? it will be one of:</span><span class="WHIT">
<span class='line'>2121</span> </span><span class="WHIT">			</span><span class="COMM">// 		an array of [name, params] - this defines a single anchor</span><span class="WHIT">
<span class='line'>2122</span> </span><span class="WHIT">			</span><span class="COMM">//		an array of arrays - this defines some dynamic anchors</span><span class="WHIT">
<span class='line'>2123</span> </span><span class="WHIT">			</span><span class="COMM">//		an array of numbers - this defines a single anchor.				</span><span class="WHIT">
<span class='line'>2124</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isArray</span><span class="PUNC">(</span><span class="NAME">specimen</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2125</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isArray</span><span class="PUNC">(</span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_isString</span><span class="PUNC">(</span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2126</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">specimen.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_isString</span><span class="PUNC">(</span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_isObject</span><span class="PUNC">(</span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2127</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">elementId</span><span class="PUNC">:</span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jsPlumbInstance</span><span class="PUNC">:</span><span class="NAME">_currentInstance</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2128</span> </span><span class="WHIT">						</span><span class="NAME">newAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">pp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2129</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2130</span> </span><span class="WHIT">					</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>2131</span> </span><span class="WHIT">						</span><span class="NAME">newAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DynamicAnchor</span><span class="PUNC">(</span><span class="NAME">specimen</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2132</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2133</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2134</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">anchorParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2135</span> </span><span class="WHIT">						</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2136</span> </span><span class="WHIT">						</span><span class="NAME">orientation</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">specimen.length</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">4</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2137</span> </span><span class="WHIT">						</span><span class="NAME">offsets</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">specimen.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">6</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">specimen</span><span class="PUNC">[</span><span class="NUMB">5</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2138</span> </span><span class="WHIT">						</span><span class="NAME">elementId</span><span class="PUNC">:</span><span class="NAME">elementId</span><span class="WHIT">
<span class='line'>2139</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>2140</span> </span><span class="WHIT">					</span><span class="NAME">newAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Anchor</span><span class="PUNC">(</span><span class="NAME">anchorParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2141</span> </span><span class="WHIT">					</span><span class="NAME">newAnchor.clone</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Anchor</span><span class="PUNC">(</span><span class="NAME">anchorParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">						 					</span><span class="WHIT">
<span class='line'>2142</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2143</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2144</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2145</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">newAnchor.id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">newAnchor.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"anchor_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">_idstamp</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2146</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">newAnchor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2147</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2148</span> 
<span class='line'>2149</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>2150</span> 		 * makes a list of anchors from the given list of types or coords, eg
<span class='line'>2151</span> 		 * ["TopCenter", "RightMiddle", "BottomCenter", [0, 1, -1, -1] ]
<span class='line'>2152</span> 		 */</span><span class="WHIT">
<span class='line'>2153</span> </span><span class="WHIT">		</span><span class="NAME">this.makeAnchors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">types</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jsPlumbInstance</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2154</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2155</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">types.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2156</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">types</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2157</span> </span><span class="WHIT">					</span><span class="NAME">r.push</span><span class="PUNC">(</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="NAME">types</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">elementId</span><span class="PUNC">:</span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jsPlumbInstance</span><span class="PUNC">:</span><span class="NAME">jsPlumbInstance</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2158</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isArray</span><span class="PUNC">(</span><span class="NAME">types</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2159</span> </span><span class="WHIT">					</span><span class="NAME">r.push</span><span class="PUNC">(</span><span class="NAME">_currentInstance.makeAnchor</span><span class="PUNC">(</span><span class="NAME">types</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jsPlumbInstance</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2160</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2161</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2162</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2163</span> 
<span class='line'>2164</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>2165</span> 		 * Makes a dynamic anchor from the given list of anchors (which may be in shorthand notation as strings or dimension arrays, or Anchor
<span class='line'>2166</span> 		 * objects themselves) and the given, optional, anchorSelector function (jsPlumb uses a default if this is not provided; most people will
<span class='line'>2167</span> 		 * not need to provide this - i think). 
<span class='line'>2168</span> 		 */</span><span class="WHIT">
<span class='line'>2169</span> </span><span class="WHIT">		</span><span class="NAME">this.makeDynamicAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchors</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchorSelector</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2170</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DynamicAnchor</span><span class="PUNC">(</span><span class="NAME">anchors</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchorSelector</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2171</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2172</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2173</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>2174</span> 		 * Function: makeTarget
<span class='line'>2175</span> 		 * Makes some DOM element a Connection target, allowing you to drag connections to it
<span class='line'>2176</span> 		 * without having to register any Endpoints on it first.  When a Connection is established,
<span class='line'>2177</span> 		 * the endpoint spec that was passed in to this method is used to create a suitable 
<span class='line'>2178</span> 		 * Endpoint (the default will be used if you do not provide one).
<span class='line'>2179</span> 		 * 
<span class='line'>2180</span> 		 * Parameters:
<span class='line'>2181</span> 		 *  el		-	string id or element selector for the element to make a target.
<span class='line'>2182</span> 		 * 	params	-	JS object containing parameters:
<span class='line'>2183</span> 		 * 	  endpoint	optional.	specification of an endpoint to create when a connection is created.
<span class='line'>2184</span> 		 * 	  scope		optional.   scope for the drop zone.
<span class='line'>2185</span> 		 * 	  dropOptions optional. same stuff as you would pass to dropOptions of an Endpoint definition.
<span class='line'>2186</span> 		 * 	  deleteEndpointsOnDetach  optional, defaults to true. whether or not to delete
<span class='line'>2187</span> 		 *                             any Endpoints created by a connection to this target if
<span class='line'>2188</span> 		 *                             the connection is subsequently detached. this will not 
<span class='line'>2189</span> 		 *                             remove Endpoints that have had more Connections attached
<span class='line'>2190</span> 		 *                             to them after they were created.
<span class='line'>2191</span> 		 *                   	
<span class='line'>2192</span> 		 * 
<span class='line'>2193</span> 		 */</span><span class="WHIT">
<span class='line'>2194</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_targetEndpointDefinitions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2195</span> </span><span class="WHIT">			</span><span class="NAME">_targetEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2196</span> </span><span class="WHIT">			</span><span class="NAME">_targetEndpointsUnique</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2197</span> </span><span class="WHIT">			</span><span class="NAME">_targetMaxConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2198</span> </span><span class="WHIT">			</span><span class="NAME">_setEndpointPaintStylesAndAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">epIndex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2199</span> </span><span class="WHIT">				</span><span class="NAME">ep.paintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ep.paintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2200</span> </span><span class="WHIT">				 				</span><span class="NAME">_currentInstance.Defaults.EndpointStyles</span><span class="PUNC">[</span><span class="NAME">epIndex</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2201</span> </span><span class="WHIT">	                            </span><span class="NAME">_currentInstance.Defaults.EndpointStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2202</span> </span><span class="WHIT">	                            </span><span class="NAME">jsPlumb.Defaults.EndpointStyles</span><span class="PUNC">[</span><span class="NAME">epIndex</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2203</span> </span><span class="WHIT">	                            </span><span class="NAME">jsPlumb.Defaults.EndpointStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2204</span> </span><span class="WHIT">				</span><span class="NAME">ep.hoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ep.hoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2205</span> </span><span class="WHIT">	                           </span><span class="NAME">_currentInstance.Defaults.EndpointHoverStyles</span><span class="PUNC">[</span><span class="NAME">epIndex</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2206</span> </span><span class="WHIT">	                           </span><span class="NAME">_currentInstance.Defaults.EndpointHoverStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2207</span> </span><span class="WHIT">	                           </span><span class="NAME">jsPlumb.Defaults.EndpointHoverStyles</span><span class="PUNC">[</span><span class="NAME">epIndex</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2208</span> </span><span class="WHIT">	                           </span><span class="NAME">jsPlumb.Defaults.EndpointHoverStyle</span><span class="PUNC">;</span><span class="WHIT">                            </span><span class="WHIT">
<span class='line'>2209</span> 
<span class='line'>2210</span> </span><span class="WHIT">				</span><span class="NAME">ep.anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ep.anchor</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2211</span> </span><span class="WHIT">	                      	</span><span class="NAME">_currentInstance.Defaults.Anchors</span><span class="PUNC">[</span><span class="NAME">epIndex</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2212</span> </span><span class="WHIT">	                      	</span><span class="NAME">_currentInstance.Defaults.Anchor</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2213</span> </span><span class="WHIT">	                      	</span><span class="NAME">jsPlumb.Defaults.Anchors</span><span class="PUNC">[</span><span class="NAME">epIndex</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2214</span> </span><span class="WHIT">	                      	</span><span class="NAME">jsPlumb.Defaults.Anchor</span><span class="PUNC">;</span><span class="WHIT">                           </span><span class="WHIT">
<span class='line'>2215</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2216</span> </span><span class="WHIT">				</span><span class="NAME">ep.endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ep.endpoint</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2217</span> </span><span class="WHIT">							  </span><span class="NAME">_currentInstance.Defaults.Endpoints</span><span class="PUNC">[</span><span class="NAME">epIndex</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2218</span> </span><span class="WHIT">							  </span><span class="NAME">_currentInstance.Defaults.Endpoint</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2219</span> </span><span class="WHIT">							  </span><span class="NAME">jsPlumb.Defaults.Endpoints</span><span class="PUNC">[</span><span class="NAME">epIndex</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>2220</span> </span><span class="WHIT">							  </span><span class="NAME">jsPlumb.Defaults.Endpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2221</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2222</span> 
<span class='line'>2223</span> </span><span class="WHIT">		</span><span class="NAME">this.makeTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>2224</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2225</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">_jsPlumb</span><span class="PUNC">:</span><span class="NAME">_currentInstance</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2226</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2227</span> </span><span class="WHIT">			</span><span class="NAME">_setEndpointPaintStylesAndAnchor</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">                                                    </span><span class="WHIT">
<span class='line'>2228</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jpcl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2229</span> </span><span class="WHIT">			    </span><span class="NAME">targetScope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.scope</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.Scope</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2230</span> </span><span class="WHIT">			    </span><span class="NAME">deleteEndpointsOnDetach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">p.deleteEndpointsOnDetach</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2231</span> </span><span class="WHIT">			    </span><span class="NAME">maxConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.maxConnections</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2232</span> </span><span class="WHIT">			</span><span class="NAME">_doOne</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2233</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2234</span> </span><span class="WHIT">				</span><span class="COMM">// get the element's id and store the endpoint definition for it.  jsPlumb.connect calls will look for one of these,</span><span class="WHIT">
<span class='line'>2235</span> </span><span class="WHIT">				</span><span class="COMM">// and use the endpoint definition if found.</span><span class="WHIT">
<span class='line'>2236</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2237</span> </span><span class="WHIT">					</span><span class="NAME">_targetEndpointDefinitions</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2238</span> </span><span class="WHIT">					</span><span class="NAME">_targetEndpointsUnique</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.uniqueEndpoint</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2239</span> </span><span class="WHIT">					</span><span class="NAME">_targetMaxConnections</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">maxConnections</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2240</span> </span><span class="WHIT">					</span><span class="NAME">_targetsEnabled</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2241</span> </span><span class="WHIT">					</span><span class="NAME">proxyComponent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">jsPlumbUIComponent</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>2242</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2243</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dropOptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p.dropOptions</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2244</span> </span><span class="WHIT">				</span><span class="NAME">_drop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2245</span> 
<span class='line'>2246</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getDropEvent</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2247</span> </span><span class="WHIT">						</span><span class="NAME">targetCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.select</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">target</span><span class="PUNC">:</span><span class="NAME">elid</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2248</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>2249</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_targetsEnabled</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_targetMaxConnections</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">targetCount</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">_targetMaxConnections</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2250</span> </span><span class="WHIT">						</span><span class="NAME">console.log</span><span class="PUNC">(</span><span class="STRN">"target element "</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">elid</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" is full."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2251</span> </span><span class="WHIT">						</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2252</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">												</span><span class="WHIT">
<span class='line'>2253</span> 
<span class='line'>2254</span> </span><span class="WHIT">					</span><span class="NAME">_currentInstance.currentlyDragging</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2255</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">draggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">jpcl.getDragObject</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2256</span> </span><span class="WHIT">						</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"dragId"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2257</span> </span><span class="WHIT">						</span><span class="COMM">// restore the original scope if necessary (issue 57)</span><span class="WHIT">
<span class='line'>2258</span> </span><span class="WHIT">						</span><span class="NAME">scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"originalScope"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2259</span> </span><span class="WHIT">						</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">floatingConnections</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2260</span> </span><span class="WHIT">						</span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2261</span> </span><span class="WHIT">						</span><span class="NAME">_endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.endpoint</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p.endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">                                              </span><span class="WHIT">
<span class='line'>2262</span> 
<span class='line'>2263</span> </span><span class="WHIT">					</span><span class="COMM">// unlock the source anchor to allow it to refresh its position if necessary</span><span class="WHIT">
<span class='line'>2264</span> </span><span class="WHIT">					</span><span class="NAME">source.anchor.locked</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2265</span> </span><span class="WHIT">										</span><span class="WHIT">
<span class='line'>2266</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">scope</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">jpcl.setDragScope</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2267</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2268</span> </span><span class="WHIT">					</span><span class="COMM">// check if drop is allowed here.					</span><span class="WHIT">
<span class='line'>2269</span> </span><span class="WHIT">					</span><span class="COMM">//var _continue = jpc.isDropAllowed(jpc.sourceId, _getId(_el), jpc.scope);		</span><span class="WHIT">
<span class='line'>2270</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_continue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">proxyComponent.isDropAllowed</span><span class="PUNC">(</span><span class="NAME">jpc.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc.scope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2271</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2272</span> </span><span class="WHIT">					</span><span class="COMM">// regardless of whether the connection is ok, reconfigure the existing connection to </span><span class="WHIT">
<span class='line'>2273</span> </span><span class="WHIT">					</span><span class="COMM">// point at the current info. we need this to be correct for the detach event that will follow.</span><span class="WHIT">
<span class='line'>2274</span> </span><span class="WHIT">					</span><span class="COMM">// clear the source endpoint from the list to detach. we will detach this connection at this</span><span class="WHIT">
<span class='line'>2275</span> </span><span class="WHIT">					</span><span class="COMM">// point, but we want to keep the source endpoint.  the target is a floating endpoint and should</span><span class="WHIT">
<span class='line'>2276</span> </span><span class="WHIT">					</span><span class="COMM">// be removed.  TODO need to figure out whether this code can result in endpoints kicking around</span><span class="WHIT">
<span class='line'>2277</span> </span><span class="WHIT">					</span><span class="COMM">// when they shouldnt be.  like is this a full detach of a connection?  can it be?</span><span class="WHIT">
<span class='line'>2278</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.endpointsToDeleteOnDetach</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2279</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">jpc.endpointsToDeleteOnDetach</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2280</span> </span><span class="WHIT">							</span><span class="NAME">jpc.endpointsToDeleteOnDetach</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2281</span> </span><span class="WHIT">						</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">jpc.endpointsToDeleteOnDetach</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2282</span> </span><span class="WHIT">							</span><span class="NAME">jpc.endpointsToDeleteOnDetach</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2283</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2284</span> </span><span class="WHIT">					</span><span class="COMM">// reinstate any suspended endpoint; this just puts the connection back into</span><span class="WHIT">
<span class='line'>2285</span> </span><span class="WHIT">					</span><span class="COMM">// a state in which it will report sensible values if someone asks it about</span><span class="WHIT">
<span class='line'>2286</span> </span><span class="WHIT">					</span><span class="COMM">// its target.  we're going to throw this connection away shortly so it doesnt matter</span><span class="WHIT">
<span class='line'>2287</span> </span><span class="WHIT">					</span><span class="COMM">// if we manipulate it a bit.</span><span class="WHIT">
<span class='line'>2288</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.suspendedEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2289</span> </span><span class="WHIT">						</span><span class="NAME">jpc.targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2290</span> </span><span class="WHIT">						</span><span class="NAME">jpc.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getElementObject</span><span class="PUNC">(</span><span class="NAME">jpc.suspendedEndpoint.elementId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2291</span> </span><span class="WHIT">						</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2292</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">																										</span><span class="WHIT">
<span class='line'>2293</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2294</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_continue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2295</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2296</span> </span><span class="WHIT">						</span><span class="COMM">// detach this connection from the source.						</span><span class="WHIT">
<span class='line'>2297</span> </span><span class="WHIT">						</span><span class="NAME">source.detach</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2298</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2299</span> </span><span class="WHIT">						</span><span class="COMM">// make a new Endpoint for the target												</span><span class="WHIT">
<span class='line'>2300</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_targetEndpoints</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.addEndpoint</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2301</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p.uniqueEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_targetEndpoints</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newEndpoint</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// may of course just store what it just pulled out. that's ok.</span><span class="WHIT">
<span class='line'>2302</span> </span><span class="WHIT">						</span><span class="NAME">newEndpoint._makeTargetCreator</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2303</span> </span><span class="WHIT">																</span><span class="WHIT">
<span class='line'>2304</span> </span><span class="WHIT">						</span><span class="COMM">// if the anchor has a 'positionFinder' set, then delegate to that function to find</span><span class="WHIT">
<span class='line'>2305</span> </span><span class="WHIT">						</span><span class="COMM">// out where to locate the anchor.</span><span class="WHIT">
<span class='line'>2306</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">newEndpoint.anchor.positionFinder</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2307</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dropPosition</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getUIPosition</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2308</span> </span><span class="WHIT">							</span><span class="NAME">elPosition</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getOffset</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2309</span> </span><span class="WHIT">							</span><span class="NAME">elSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getSize</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2310</span> </span><span class="WHIT">							</span><span class="NAME">ap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newEndpoint.anchor.positionFinder</span><span class="PUNC">(</span><span class="NAME">dropPosition</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elPosition</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elSize</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newEndpoint.anchor.constructorParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2311</span> </span><span class="WHIT">							</span><span class="NAME">newEndpoint.anchor.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ap</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2312</span> </span><span class="WHIT">							</span><span class="NAME">newEndpoint.anchor.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ap</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2313</span> </span><span class="WHIT">							</span><span class="COMM">// now figure an orientation for it..kind of hard to know what to do actually. probably the best thing i can do is to</span><span class="WHIT">
<span class='line'>2314</span> </span><span class="WHIT">							</span><span class="COMM">// support specifying an orientation in the anchor's spec. if one is not supplied then i will make the orientation </span><span class="WHIT">
<span class='line'>2315</span> </span><span class="WHIT">							</span><span class="COMM">// be what will cause the most natural link to the source: it will be pointing at the source, but it needs to be</span><span class="WHIT">
<span class='line'>2316</span> </span><span class="WHIT">							</span><span class="COMM">// specified in one axis only, and so how to make that choice? i think i will use whichever axis is the one in which</span><span class="WHIT">
<span class='line'>2317</span> </span><span class="WHIT">							</span><span class="COMM">// the target is furthest away from the source.</span><span class="WHIT">
<span class='line'>2318</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2319</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.connect</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2320</span> </span><span class="WHIT">							</span><span class="NAME">source</span><span class="PUNC">:</span><span class="NAME">source</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2321</span> </span><span class="WHIT">							</span><span class="NAME">target</span><span class="PUNC">:</span><span class="NAME">newEndpoint</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2322</span> </span><span class="WHIT">							</span><span class="NAME">scope</span><span class="PUNC">:</span><span class="NAME">scope</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2323</span> </span><span class="WHIT">							</span><span class="NAME">previousConnection</span><span class="PUNC">:</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2324</span> </span><span class="WHIT">							</span><span class="NAME">container</span><span class="PUNC">:</span><span class="NAME">jpc.parent</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2325</span> </span><span class="WHIT">							</span><span class="NAME">deleteEndpointsOnDetach</span><span class="PUNC">:</span><span class="NAME">deleteEndpointsOnDetach</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2326</span> </span><span class="WHIT">							</span><span class="COMM">// 'endpointWillMoveAfterConnection' is set by the makeSource function, and it indicates that the</span><span class="WHIT">
<span class='line'>2327</span> </span><span class="WHIT">							</span><span class="COMM">// given endpoint will actually transfer from the element it is currently attached to to some other</span><span class="WHIT">
<span class='line'>2328</span> </span><span class="WHIT">							</span><span class="COMM">// element after a connection has been established.  in that case, we do not want to fire the</span><span class="WHIT">
<span class='line'>2329</span> </span><span class="WHIT">							</span><span class="COMM">// connection event, since it will have the wrong data in it; makeSource will do it for us.</span><span class="WHIT">
<span class='line'>2330</span> </span><span class="WHIT">							</span><span class="COMM">// this is controlled by the 'parent' parameter on a makeSource call.</span><span class="WHIT">
<span class='line'>2331</span> </span><span class="WHIT">							</span><span class="NAME">doNotFireConnectionEvent</span><span class="PUNC">:</span><span class="NAME">source.endpointWillMoveAfterConnection</span><span class="WHIT">
<span class='line'>2332</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2333</span> 
<span class='line'>2334</span> </span><span class="WHIT">						</span><span class="COMM">// delete the original target endpoint.  but only want to do this if the endpoint was created</span><span class="WHIT">
<span class='line'>2335</span> </span><span class="WHIT">						</span><span class="COMM">// automatically and has no other connections.</span><span class="WHIT">
<span class='line'>2336</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">_makeTargetCreator</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connections.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2337</span> </span><span class="WHIT">							</span><span class="NAME">_currentInstance.deleteEndpoint</span><span class="PUNC">(</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2338</span> 
<span class='line'>2339</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">deleteEndpointsOnDetach</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2340</span> </span><span class="WHIT">							</span><span class="NAME">c.endpointsToDeleteOnDetach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">source</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newEndpoint</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2341</span> 
<span class='line'>2342</span> </span><span class="WHIT">						</span><span class="NAME">c.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2343</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2344</span> </span><span class="WHIT">					</span><span class="COMM">// if not allowed to drop...</span><span class="WHIT">
<span class='line'>2345</span> </span><span class="WHIT">					</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2346</span> </span><span class="WHIT">						</span><span class="COMM">// TODO this code is identical (pretty much) to what happens when a connection</span><span class="WHIT">
<span class='line'>2347</span> </span><span class="WHIT">						</span><span class="COMM">// dragged from a normal endpoint is in this situation. refactor.</span><span class="WHIT">
<span class='line'>2348</span> </span><span class="WHIT">						</span><span class="COMM">// is this an existing connection, and will we reattach?</span><span class="WHIT">
<span class='line'>2349</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.suspendedEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2350</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">source.isReattach</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2351</span> </span><span class="WHIT">								</span><span class="NAME">jpc.setHover</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2352</span> </span><span class="WHIT">								</span><span class="NAME">jpc.floatingAnchorIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2353</span> </span><span class="WHIT">								</span><span class="NAME">jpc.suspendedEndpoint.addConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2354</span> </span><span class="WHIT">								</span><span class="NAME">_currentInstance.repaint</span><span class="PUNC">(</span><span class="NAME">source.elementId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2355</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2356</span> </span><span class="WHIT">							</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>2357</span> </span><span class="WHIT">								</span><span class="NAME">source.detach</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">  </span><span class="COMM">// otherwise, detach the connection and tell everyone about it.</span><span class="WHIT">
<span class='line'>2358</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2359</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>2360</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">														</span><span class="WHIT">
<span class='line'>2361</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2362</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2363</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dropEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.dragEvents</span><span class="PUNC">[</span><span class="STRN">'drop'</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2364</span> </span><span class="WHIT">				</span><span class="NAME">dropOptions</span><span class="PUNC">[</span><span class="STRN">"scope"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dropOptions</span><span class="PUNC">[</span><span class="STRN">"scope"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">targetScope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2365</span> </span><span class="WHIT">				</span><span class="NAME">dropOptions</span><span class="PUNC">[</span><span class="NAME">dropEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">dropOptions</span><span class="PUNC">[</span><span class="NAME">dropEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_drop</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2366</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2367</span> </span><span class="WHIT">				</span><span class="NAME">jpcl.initDroppable</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropOptions</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2368</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2369</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2370</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_convertYUICollection</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2371</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2372</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inputs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el.length</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">el.constructor</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">String</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2373</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>2374</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">inputs.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2375</span> </span><span class="WHIT">				</span><span class="NAME">_doOne</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">inputs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2376</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2377</span> 
<span class='line'>2378</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2379</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2380</span> 
<span class='line'>2381</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2382</span> 		*	Function: unmakeTarget
<span class='line'>2383</span> 		*	Sets the given element to no longer be a connection target.
<span class='line'>2384</span> 		*	Parameters:
<span class='line'>2385</span> 		*	el - either a string id or a selector representing the element.
<span class='line'>2386</span> 		*	Returns:
<span class='line'>2387</span> 		*	The current jsPlumb instance.
<span class='line'>2388</span> 		*/</span><span class="WHIT">
<span class='line'>2389</span> </span><span class="WHIT">		</span><span class="NAME">this.unmakeTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotClearArrays</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2390</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2391</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2392</span> 
<span class='line'>2393</span> </span><span class="WHIT">			</span><span class="COMM">// TODO this is not an exhaustive unmake of a target, since it does not remove the droppable stuff from</span><span class="WHIT">
<span class='line'>2394</span> </span><span class="WHIT">			</span><span class="COMM">// the element.  the effect will be to prevent it form behaving as a target, but it's not completely purged.</span><span class="WHIT">
<span class='line'>2395</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">doNotClearArrays</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2396</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_targetEndpointDefinitions</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2397</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_targetEndpointsUnique</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2398</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_targetMaxConnections</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2399</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_targetsEnabled</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2400</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2401</span> 
<span class='line'>2402</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2403</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2404</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2405</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>2406</span> 		 * helper method to make a list of elements drop targets.
<span class='line'>2407</span> 		 * @param els
<span class='line'>2408</span> 		 * @param params
<span class='line'>2409</span> 		 * @param referenceParams
<span class='line'>2410</span> 		 * @return
<span class='line'>2411</span> 		 */</span><span class="WHIT">
<span class='line'>2412</span> </span><span class="WHIT">		</span><span class="NAME">this.makeTargets</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">els</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2413</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">els.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2414</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.makeTarget</span><span class="PUNC">(</span><span class="NAME">els</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2415</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2416</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2417</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2418</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>2419</span> 		 * Function: makeSource
<span class='line'>2420</span> 		 * Makes some DOM element a Connection source, allowing you to drag connections from it
<span class='line'>2421</span> 		 * without having to register any Endpoints on it first.  When a Connection is established,
<span class='line'>2422</span> 		 * the endpoint spec that was passed in to this method is used to create a suitable 
<span class='line'>2423</span> 		 * Endpoint (the default will be used if you do not provide one).
<span class='line'>2424</span> 		 * 
<span class='line'>2425</span> 		 * Parameters:
<span class='line'>2426</span> 		 *  el		-	string id or element selector for the element to make a source.
<span class='line'>2427</span> 		 * 	params	-	JS object containing parameters:
<span class='line'>2428</span> 		 * 	  endpoint	optional.	specification of an endpoint to create when a connection is created.
<span class='line'>2429</span> 		 * 	  parent	optional.   the element to add Endpoints to when a Connection is established.  if you omit this, 
<span class='line'>2430</span> 		 *                          Endpoints will be added to 'el'.
<span class='line'>2431</span> 		 * 	  scope		optional.   scope for the connections dragged from this element.
<span class='line'>2432</span> 		 * 	  dragOptions optional. same stuff as you would pass to dragOptions of an Endpoint definition.
<span class='line'>2433</span> 		 * 	  deleteEndpointsOnDetach  optional, defaults to false. whether or not to delete
<span class='line'>2434</span> 		 *                             any Endpoints created by a connection from this source if
<span class='line'>2435</span> 		 *                             the connection is subsequently detached. this will not 
<span class='line'>2436</span> 		 *                             remove Endpoints that have had more Connections attached
<span class='line'>2437</span> 		 *                             to them after they were created.
<span class='line'>2438</span> 		 *                   	
<span class='line'>2439</span> 		 * 
<span class='line'>2440</span> 		 */</span><span class="WHIT">
<span class='line'>2441</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_sourceEndpointDefinitions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2442</span> </span><span class="WHIT">			</span><span class="NAME">_sourceEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2443</span> </span><span class="WHIT">			</span><span class="NAME">_sourceEndpointsUnique</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2444</span> </span><span class="WHIT">			</span><span class="NAME">_sourcesEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2445</span> </span><span class="WHIT">			</span><span class="NAME">_sourceTriggers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2446</span> </span><span class="WHIT">			</span><span class="NAME">_targetsEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2447</span> 
<span class='line'>2448</span> </span><span class="WHIT">		</span><span class="NAME">this.makeSource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2449</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2450</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2451</span> </span><span class="WHIT">			</span><span class="NAME">_setEndpointPaintStylesAndAnchor</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">   </span><span class="WHIT">
<span class='line'>2452</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jpcl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary</span><span class="PUNC">,</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>2453</span> </span><span class="WHIT">			</span><span class="NAME">_doOne</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2454</span> </span><span class="WHIT">				</span><span class="COMM">// get the element's id and store the endpoint definition for it.  jsPlumb.connect calls will look for one of these,</span><span class="WHIT">
<span class='line'>2455</span> </span><span class="WHIT">				</span><span class="COMM">// and use the endpoint definition if found.</span><span class="WHIT">
<span class='line'>2456</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2457</span> </span><span class="WHIT">					</span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.parent</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2458</span> </span><span class="WHIT">					</span><span class="NAME">idToRegisterAgainst</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getId</span><span class="PUNC">(</span><span class="NAME">jpcl.getElementObject</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">elid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2459</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2460</span> </span><span class="WHIT">				</span><span class="NAME">_sourceEndpointDefinitions</span><span class="PUNC">[</span><span class="NAME">idToRegisterAgainst</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2461</span> </span><span class="WHIT">				</span><span class="NAME">_sourceEndpointsUnique</span><span class="PUNC">[</span><span class="NAME">idToRegisterAgainst</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.uniqueEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2462</span> </span><span class="WHIT">				</span><span class="NAME">_sourcesEnabled</span><span class="PUNC">[</span><span class="NAME">idToRegisterAgainst</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2463</span> 
<span class='line'>2464</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">stopEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.dragEvents</span><span class="PUNC">[</span><span class="STRN">"stop"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2465</span> </span><span class="WHIT">					</span><span class="NAME">dragEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.dragEvents</span><span class="PUNC">[</span><span class="STRN">"drag"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2466</span> </span><span class="WHIT">					</span><span class="NAME">dragOptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p.dragOptions</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2467</span> </span><span class="WHIT">					</span><span class="NAME">existingDrag</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dragOptions.drag</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2468</span> </span><span class="WHIT">					</span><span class="NAME">existingStop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dragOptions.stop</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2469</span> </span><span class="WHIT">					</span><span class="NAME">ep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2470</span> </span><span class="WHIT">					</span><span class="NAME">endpointAddedButNoDragYet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2471</span> 
<span class='line'>2472</span> </span><span class="WHIT">				</span><span class="COMM">// set scope if its not set in dragOptions but was passed in in params</span><span class="WHIT">
<span class='line'>2473</span> </span><span class="WHIT">				</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="STRN">"scope"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="STRN">"scope"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">p.scope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2474</span> 
<span class='line'>2475</span> </span><span class="WHIT">				</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="NAME">dragEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="NAME">dragEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2476</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">existingDrag</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">existingDrag.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2477</span> </span><span class="WHIT">					</span><span class="NAME">endpointAddedButNoDragYet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2478</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2479</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2480</span> </span><span class="WHIT">				</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="NAME">stopEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="NAME">stopEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> 							</span><span class="WHIT">
<span class='line'>2481</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">existingStop</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">existingStop.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>2482</span> 
<span class='line'>2483</span> </span><span class="WHIT">                    </span><span class="COMM">//_currentlyDown = false;</span><span class="WHIT">
<span class='line'>2484</span> </span><span class="WHIT">					</span><span class="NAME">_currentInstance.currentlyDragging</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2485</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2486</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ep.connections.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2487</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.deleteEndpoint</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2488</span> </span><span class="WHIT">					</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2489</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>2490</span> </span><span class="WHIT">						</span><span class="NAME">jpcl.unbind</span><span class="PUNC">(</span><span class="NAME">ep.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mousedown"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2491</span> </span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>2492</span> </span><span class="WHIT">						</span><span class="COMM">// reset the anchor to the anchor that was initially provided. the one we were using to drag</span><span class="WHIT">
<span class='line'>2493</span> </span><span class="WHIT">						</span><span class="COMM">// the connection was just a placeholder that was located at the place the user pressed the</span><span class="WHIT">
<span class='line'>2494</span> </span><span class="WHIT">						</span><span class="COMM">// mouse button to initiate the drag.</span><span class="WHIT">
<span class='line'>2495</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">anchorDef</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.anchor</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.Anchor</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2496</span> </span><span class="WHIT">							</span><span class="NAME">oldAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ep.anchor</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2497</span> </span><span class="WHIT">							</span><span class="NAME">oldConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ep.connections</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2498</span> 
<span class='line'>2499</span> </span><span class="WHIT">						</span><span class="NAME">ep.anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.makeAnchor</span><span class="PUNC">(</span><span class="NAME">anchorDef</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">																							</span><span class="WHIT">
<span class='line'>2500</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>2501</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p.parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>2502</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getElementObject</span><span class="PUNC">(</span><span class="NAME">p.parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2503</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>2504</span> </span><span class="WHIT">								</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">currentId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ep.elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2505</span> </span><span class="WHIT">											</span><span class="WHIT">
<span class='line'>2506</span> </span><span class="WHIT">								</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">potentialParent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.container</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.Container</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.Container</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2507</span> </span><span class="WHIT">																</span><span class="WHIT">
<span class='line'>2508</span> </span><span class="WHIT">								</span><span class="NAME">ep.setElement</span><span class="PUNC">(</span><span class="NAME">parent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">potentialParent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2509</span> </span><span class="WHIT">								</span><span class="NAME">ep.endpointWillMoveAfterConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">														</span><span class="WHIT">
<span class='line'>2510</span> </span><span class="WHIT">								</span><span class="NAME">_currentInstance.anchorManager.rehomeEndpoint</span><span class="PUNC">(</span><span class="NAME">currentId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">													</span><span class="WHIT">
<span class='line'>2511</span> </span><span class="WHIT">								</span><span class="NAME">oldConnection.previousConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2512</span> </span><span class="WHIT">								</span><span class="COMM">// remove from connectionsByScope</span><span class="WHIT">
<span class='line'>2513</span> </span><span class="WHIT">								</span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">connectionsByScope</span><span class="PUNC">[</span><span class="NAME">oldConnection.scope</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2514</span> </span><span class="WHIT">									</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">oldConnection.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2515</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">										</span><span class="WHIT">
<span class='line'>2516</span> </span><span class="WHIT">								</span><span class="NAME">_currentInstance.anchorManager.connectionDetached</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2517</span> </span><span class="WHIT">									</span><span class="NAME">sourceId</span><span class="PUNC">:</span><span class="NAME">oldConnection.sourceId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2518</span> </span><span class="WHIT">									</span><span class="NAME">targetId</span><span class="PUNC">:</span><span class="NAME">oldConnection.targetId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2519</span> </span><span class="WHIT">									</span><span class="NAME">connection</span><span class="PUNC">:</span><span class="NAME">oldConnection</span><span class="WHIT">
<span class='line'>2520</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">											</span><span class="WHIT">
<span class='line'>2521</span> </span><span class="WHIT">								</span><span class="NAME">_finaliseConnection</span><span class="PUNC">(</span><span class="NAME">oldConnection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2522</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2523</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>2524</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>2525</span> </span><span class="WHIT">						</span><span class="NAME">ep.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2526</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.repaint</span><span class="PUNC">(</span><span class="NAME">ep.elementId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">																		</span><span class="WHIT">
<span class='line'>2527</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.repaint</span><span class="PUNC">(</span><span class="NAME">oldConnection.targetId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2528</span> 
<span class='line'>2529</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2530</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2531</span> </span><span class="WHIT">				</span><span class="COMM">// when the user presses the mouse, add an Endpoint, if we are enabled.</span><span class="WHIT">
<span class='line'>2532</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mouseDownListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2533</span> 
<span class='line'>2534</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_sourcesEnabled</span><span class="PUNC">[</span><span class="NAME">idToRegisterAgainst</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2535</span> 
<span class='line'>2536</span> </span><span class="WHIT">					</span><span class="COMM">// make sure we have the latest offset for this div </span><span class="WHIT">
<span class='line'>2537</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myOffsetInfo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">elId</span><span class="PUNC">:</span><span class="NAME">elid</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2538</span> 
<span class='line'>2539</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">e.pageX</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">e.page.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">myOffsetInfo.left</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">myOffsetInfo.width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2540</span> </span><span class="WHIT">					    </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">e.pageY</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">e.page.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">myOffsetInfo.top</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">myOffsetInfo.height</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2541</span> </span><span class="WHIT">					    </span><span class="NAME">parentX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2542</span> </span><span class="WHIT">					    </span><span class="NAME">parentY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2543</span> </span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>2544</span> </span><span class="WHIT">					</span><span class="COMM">// if there is a parent, the endpoint will actually be added to it now, rather than the div</span><span class="WHIT">
<span class='line'>2545</span> </span><span class="WHIT">					</span><span class="COMM">// that was the source.  in that case, we have to adjust the anchor position so it refers to</span><span class="WHIT">
<span class='line'>2546</span> </span><span class="WHIT">					</span><span class="COMM">// the parent.</span><span class="WHIT">
<span class='line'>2547</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p.parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2548</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pEl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">p.parent</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2549</span> </span><span class="WHIT">							</span><span class="NAME">pId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">pEl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2550</span> </span><span class="WHIT">						</span><span class="NAME">myOffsetInfo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">elId</span><span class="PUNC">:</span><span class="NAME">pId</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2551</span> </span><span class="WHIT">						</span><span class="NAME">parentX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">e.pageX</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">e.page.x</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">myOffsetInfo.left</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">myOffsetInfo.width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2552</span> </span><span class="WHIT">					    </span><span class="NAME">parentY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">e.pageY</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">e.page.y</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">myOffsetInfo.top</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">myOffsetInfo.height</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2553</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">											</span><span class="WHIT">
<span class='line'>2554</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2555</span> </span><span class="WHIT">					</span><span class="COMM">// we need to override the anchor in here, and force 'isSource', but we don't want to mess with</span><span class="WHIT">
<span class='line'>2556</span> </span><span class="WHIT">					</span><span class="COMM">// the params passed in, because after a connection is established we're going to reset the endpoint</span><span class="WHIT">
<span class='line'>2557</span> </span><span class="WHIT">					</span><span class="COMM">// to have the anchor we were given.</span><span class="WHIT">
<span class='line'>2558</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tempEndpointParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2559</span> </span><span class="WHIT">					</span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">tempEndpointParams</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2560</span> </span><span class="WHIT">					</span><span class="NAME">tempEndpointParams.isSource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2561</span> </span><span class="WHIT">					</span><span class="NAME">tempEndpointParams.anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2562</span> </span><span class="WHIT">					</span><span class="NAME">tempEndpointParams.parentAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">parentX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parentY</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2563</span> </span><span class="WHIT">					</span><span class="NAME">tempEndpointParams.dragOptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dragOptions</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2564</span> </span><span class="WHIT">					</span><span class="COMM">// if a parent was given we need to turn that into a "container" argument.  this is, by default,</span><span class="WHIT">
<span class='line'>2565</span> </span><span class="WHIT">					</span><span class="COMM">// the parent of the element we will move to, so parent of p.parent in this case.  however, if</span><span class="WHIT">
<span class='line'>2566</span> </span><span class="WHIT">					</span><span class="COMM">// the user has specified a 'container' on the endpoint definition or on </span><span class="WHIT">
<span class='line'>2567</span> </span><span class="WHIT">					</span><span class="COMM">// the defaults, we should use that.</span><span class="WHIT">
<span class='line'>2568</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p.parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2569</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">potentialParent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tempEndpointParams.container</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.Container</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.Container</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2570</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">potentialParent</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2571</span> </span><span class="WHIT">							</span><span class="NAME">tempEndpointParams.container</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">potentialParent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2572</span> </span><span class="WHIT">						</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>2573</span> </span><span class="WHIT">							</span><span class="NAME">tempEndpointParams.container</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getParent</span><span class="PUNC">(</span><span class="NAME">p.parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2574</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2575</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2576</span> </span><span class="WHIT">					</span><span class="NAME">ep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.addEndpoint</span><span class="PUNC">(</span><span class="NAME">elid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tempEndpointParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2577</span> 
<span class='line'>2578</span> </span><span class="WHIT">					</span><span class="NAME">endpointAddedButNoDragYet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2579</span> </span><span class="WHIT">					</span><span class="COMM">// we set this to prevent connections from firing attach events before this function has had a chance</span><span class="WHIT">
<span class='line'>2580</span> </span><span class="WHIT">					</span><span class="COMM">// to move the endpoint.</span><span class="WHIT">
<span class='line'>2581</span> </span><span class="WHIT">					</span><span class="NAME">ep.endpointWillMoveAfterConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.parent</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2582</span> </span><span class="WHIT">					</span><span class="NAME">ep.endpointWillMoveTo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.parent</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">jpcl.getElementObject</span><span class="PUNC">(</span><span class="NAME">p.parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2583</span> 
<span class='line'>2584</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_delTempEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2585</span> </span><span class="WHIT">						</span><span class="COMM">// this mouseup event is fired only if no dragging occurred, by jquery and yui, but for mootools</span><span class="WHIT">
<span class='line'>2586</span> </span><span class="WHIT">						</span><span class="COMM">// it is fired even if dragging has occurred, in which case we would blow away a perfectly</span><span class="WHIT">
<span class='line'>2587</span> </span><span class="WHIT">						</span><span class="COMM">// legitimate endpoint, were it not for this check.  the flag is set after adding an</span><span class="WHIT">
<span class='line'>2588</span> </span><span class="WHIT">						</span><span class="COMM">// endpoint and cleared in a drag listener we set in the dragOptions above.</span><span class="WHIT">
<span class='line'>2589</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">endpointAddedButNoDragYet</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2590</span> </span><span class="WHIT">							</span><span class="NAME">_currentInstance.deleteEndpoint</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2591</span> </span><span class="WHIT">                        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2592</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2593</span> 
<span class='line'>2594</span> </span><span class="WHIT">					</span><span class="NAME">_currentInstance.registerListener</span><span class="PUNC">(</span><span class="NAME">ep.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mouseup"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_delTempEndpoint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2595</span> </span><span class="WHIT">                    </span><span class="NAME">_currentInstance.registerListener</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mouseup"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_delTempEndpoint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2596</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>2597</span> </span><span class="WHIT">					</span><span class="COMM">// and then trigger its mousedown event, which will kick off a drag, which will start dragging</span><span class="WHIT">
<span class='line'>2598</span> </span><span class="WHIT">					</span><span class="COMM">// a new connection from this endpoint.</span><span class="WHIT">
<span class='line'>2599</span> </span><span class="WHIT">					</span><span class="NAME">jpcl.trigger</span><span class="PUNC">(</span><span class="NAME">ep.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mousedown"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2600</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2601</span> </span><span class="WHIT">               </span><span class="WHIT">
<span class='line'>2602</span> </span><span class="WHIT">                </span><span class="COMM">// register this on jsPlumb so that it can be cleared by a reset.</span><span class="WHIT">
<span class='line'>2603</span> </span><span class="WHIT">                </span><span class="NAME">_currentInstance.registerListener</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mousedown"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mouseDownListener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2604</span> </span><span class="WHIT">                </span><span class="NAME">_sourceTriggers</span><span class="PUNC">[</span><span class="NAME">elid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mouseDownListener</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2605</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2606</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2607</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_convertYUICollection</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2608</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2609</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">inputs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el.length</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">el.constructor</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">String</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2610</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>2611</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">inputs.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2612</span> </span><span class="WHIT">				</span><span class="NAME">_doOne</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">inputs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2613</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2614</span> 
<span class='line'>2615</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2616</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2617</span> 
<span class='line'>2618</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>2619</span> 		*	Function: unmakeSource
<span class='line'>2620</span> 		*	Sets the given element to no longer be a connection source.
<span class='line'>2621</span> 		*	Parameters:
<span class='line'>2622</span> 		*	el - either a string id or a selector representing the element.
<span class='line'>2623</span> 		*	Returns:
<span class='line'>2624</span> 		*	The current jsPlumb instance.
<span class='line'>2625</span> 		*/</span><span class="WHIT">
<span class='line'>2626</span> </span><span class="WHIT">		</span><span class="NAME">this.unmakeSource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotClearArrays</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2627</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2628</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2629</span> </span><span class="WHIT">				</span><span class="NAME">mouseDownListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_sourceTriggers</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2630</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2631</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mouseDownListener</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2632</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.unregisterListener</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mousedown"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mouseDownListener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2633</span> 
<span class='line'>2634</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">doNotClearArrays</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2635</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_sourceEndpointDefinitions</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2636</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_sourceEndpointsUnique</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2637</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_sourcesEnabled</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2638</span> </span><span class="WHIT">				</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_sourceTriggers</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2639</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2640</span> 
<span class='line'>2641</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2642</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2643</span> 
<span class='line'>2644</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2645</span> 		*	Function: unmakeEverySource
<span class='line'>2646</span> 		*	Resets all elements in this instance of jsPlumb so that none of them are connection sources.
<span class='line'>2647</span> 		*	Returns:
<span class='line'>2648</span> 		*	The current jsPlumb instance.
<span class='line'>2649</span> 		*/</span><span class="WHIT">
<span class='line'>2650</span> </span><span class="WHIT">		</span><span class="NAME">this.unmakeEverySource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2651</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">_sourcesEnabled</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2652</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.unmakeSource</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2653</span> 
<span class='line'>2654</span> </span><span class="WHIT">			</span><span class="NAME">_sourceEndpointDefinitions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2655</span> </span><span class="WHIT">			</span><span class="NAME">_sourceEndpointsUnique</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2656</span> </span><span class="WHIT">			</span><span class="NAME">_sourcesEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2657</span> </span><span class="WHIT">			</span><span class="NAME">_sourceTriggers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2658</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2659</span> 
<span class='line'>2660</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2661</span> 		*	Function: unmakeEveryTarget
<span class='line'>2662</span> 		*	Resets all elements in this instance of jsPlumb so that none of them are connection targets.
<span class='line'>2663</span> 		*	Returns:
<span class='line'>2664</span> 		*	The current jsPlumb instance.
<span class='line'>2665</span> 		*/</span><span class="WHIT">
<span class='line'>2666</span> </span><span class="WHIT">		</span><span class="NAME">this.unmakeEveryTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2667</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">_targetsEnabled</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2668</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.unmakeTarget</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2669</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2670</span> </span><span class="WHIT">			</span><span class="NAME">_targetEndpointDefinitions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2671</span> </span><span class="WHIT">			</span><span class="NAME">_targetEndpointsUnique</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2672</span> </span><span class="WHIT">			</span><span class="NAME">_targetMaxConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2673</span> </span><span class="WHIT">			</span><span class="NAME">_targetsEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2674</span> 
<span class='line'>2675</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2676</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2677</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2678</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2679</span> 		 * Function: makeSources
<span class='line'>2680</span> 		 * Makes all elements in some array or a selector connection sources.
<span class='line'>2681</span> 		 * Parameters:
<span class='line'>2682</span> 		 * 	els 	- 	either an array of ids or a selector
<span class='line'>2683</span> 		 *  params  -   parameters to configure each element as a source with
<span class='line'>2684</span> 		 *  referenceParams - extra parameters to configure each element as a source with.
<span class='line'>2685</span> 		 *
<span class='line'>2686</span> 		 * Returns:
<span class='line'>2687</span> 		 * The current jsPlumb instance.
<span class='line'>2688</span> 		 */</span><span class="WHIT">
<span class='line'>2689</span> </span><span class="WHIT">		</span><span class="NAME">this.makeSources</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">els</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2690</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">els.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2691</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.makeSource</span><span class="PUNC">(</span><span class="NAME">els</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2692</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2693</span> 
<span class='line'>2694</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2695</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2696</span> 
<span class='line'>2697</span> </span><span class="WHIT">		</span><span class="COMM">// does the work of setting a source enabled or disabled.</span><span class="WHIT">
<span class='line'>2698</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_setEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">toggle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2699</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"source"</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_sourcesEnabled</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_targetsEnabled</span><span class="PUNC">;</span><span class="WHIT">									</span><span class="WHIT">
<span class='line'>2700</span> 
<span class='line'>2701</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isString</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">el</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">toggle</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">el</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2702</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2703</span> </span><span class="WHIT">				</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_convertYUICollection</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2704</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">el.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2705</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">_el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2706</span> </span><span class="WHIT">					</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">toggle</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2707</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2708</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>2709</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2710</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2711</span> 
<span class='line'>2712</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2713</span> 			Function: setSourceEnabled
<span class='line'>2714</span> 			Sets the enabled state of one or more elements that were previously made a connection source with the makeSource
<span class='line'>2715</span> 			method.
<span class='line'>2716</span> 
<span class='line'>2717</span> 			Parameters:
<span class='line'>2718</span> 				el 	- 	either a string representing some element's id, or an array of ids, or a selector.
<span class='line'>2719</span> 				state - true to enable the element(s), false to disable it.
<span class='line'>2720</span> 
<span class='line'>2721</span> 			Returns:
<span class='line'>2722</span> 			The current jsPlumb instance.
<span class='line'>2723</span> 		*/</span><span class="WHIT">
<span class='line'>2724</span> </span><span class="WHIT">		</span><span class="NAME">this.setSourceEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2725</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_setEnabled</span><span class="PUNC">(</span><span class="STRN">"source"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2726</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2727</span> 
<span class='line'>2728</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2729</span> 		*	Function: toggleSourceEnabled
<span class='line'>2730</span> 		*	Toggles the source enabled state of the given element or elements.
<span class='line'>2731</span> 		*
<span class='line'>2732</span> 		* 	Parameters:
<span class='line'>2733</span> 		*		el 	- 	either a string representing some element's id, or an array of ids, or a selector.
<span class='line'>2734</span> 		*		state - true to enable the element(s), false to disable it.
<span class='line'>2735</span> 		*
<span class='line'>2736</span> 		*	Returns:
<span class='line'>2737</span> 		*	The current enabled state of the source.
<span class='line'>2738</span> 		*/</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>2739</span> </span><span class="WHIT">		</span><span class="NAME">this.toggleSourceEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2740</span> </span><span class="WHIT">			</span><span class="NAME">_setEnabled</span><span class="PUNC">(</span><span class="STRN">"source"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>2741</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance.isSourceEnabled</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2742</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2743</span> 
<span class='line'>2744</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2745</span> 		*	Function: isSource
<span class='line'>2746</span> 		*	Returns whether or not the given element is registered as a connection source.
<span class='line'>2747</span> 		*
<span class='line'>2748</span> 		*	Parameters:
<span class='line'>2749</span> 		*		el 	- 	either a string id, or a selector representing a single element.
<span class='line'>2750</span> 		*
<span class='line'>2751</span> 		*	Returns:
<span class='line'>2752</span> 		*	True if source, false if not.
<span class='line'>2753</span> 		*/</span><span class="WHIT">
<span class='line'>2754</span> </span><span class="WHIT">		</span><span class="NAME">this.isSource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2755</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2756</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_sourcesEnabled</span><span class="PUNC">[</span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2757</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2758</span> 
<span class='line'>2759</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2760</span> 		*	Function: isSourceEnabled
<span class='line'>2761</span> 		*	Returns whether or not the given connection source is enabled.
<span class='line'>2762</span> 		*
<span class='line'>2763</span> 		*	Parameters:
<span class='line'>2764</span> 		*	el 	- 	either a string id, or a selector representing a single element.
<span class='line'>2765</span> 		*
<span class='line'>2766</span> 		*	Returns:
<span class='line'>2767</span> 		*	True if enabled, false if not.
<span class='line'>2768</span> 		*/</span><span class="WHIT">
<span class='line'>2769</span> </span><span class="WHIT">		</span><span class="NAME">this.isSourceEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2770</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2771</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_sourcesEnabled</span><span class="PUNC">[</span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2772</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2773</span> 
<span class='line'>2774</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2775</span> 		*	Function: setTargetEnabled
<span class='line'>2776</span> 		*	Sets the enabled state of one or more elements that were previously made a connection target with the makeTarget method.
<span class='line'>2777</span> 		*	method.
<span class='line'>2778</span> 		*
<span class='line'>2779</span> 		*	Parameters:
<span class='line'>2780</span> 		*		el 	- 	either a string representing some element's id, or an array of ids, or a selector.
<span class='line'>2781</span> 		*		state - true to enable the element(s), false to disable it.
<span class='line'>2782</span> 		*
<span class='line'>2783</span> 		*	Returns:
<span class='line'>2784</span> 		*	The current jsPlumb instance.
<span class='line'>2785</span> 		*/</span><span class="WHIT">
<span class='line'>2786</span> </span><span class="WHIT">		</span><span class="NAME">this.setTargetEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2787</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_setEnabled</span><span class="PUNC">(</span><span class="STRN">"target"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2788</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2789</span> 
<span class='line'>2790</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2791</span> 		*	Function: toggleTargetEnabled
<span class='line'>2792</span> 		*	Toggles the target enabled state of the given element or elements.
<span class='line'>2793</span> 		*
<span class='line'>2794</span> 		*	Parameters:
<span class='line'>2795</span> 		*		el 	- 	either a string representing some element's id, or an array of ids, or a selector.
<span class='line'>2796</span> 		*		state - true to enable the element(s), false to disable it.
<span class='line'>2797</span> 		*
<span class='line'>2798</span> 		*	Returns:
<span class='line'>2799</span> 		*	The current enabled state of the target.
<span class='line'>2800</span> 		*/</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>2801</span> </span><span class="WHIT">		</span><span class="NAME">this.toggleTargetEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2802</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_setEnabled</span><span class="PUNC">(</span><span class="STRN">"target"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>2803</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance.isTargetEnabled</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2804</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2805</span> 
<span class='line'>2806</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2807</span> 			Function: isTarget
<span class='line'>2808</span> 			Returns whether or not the given element is registered as a connection target.
<span class='line'>2809</span> 
<span class='line'>2810</span> 			Parameters:
<span class='line'>2811</span> 				el 	- 	either a string id, or a selector representing a single element.
<span class='line'>2812</span> 
<span class='line'>2813</span> 			Returns:
<span class='line'>2814</span> 			True if source, false if not.
<span class='line'>2815</span> 		*/</span><span class="WHIT">
<span class='line'>2816</span> </span><span class="WHIT">		</span><span class="NAME">this.isTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2817</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2818</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_targetsEnabled</span><span class="PUNC">[</span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2819</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2820</span> 
<span class='line'>2821</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2822</span> 			Function: isTargetEnabled
<span class='line'>2823</span> 			Returns whether or not the given connection target is enabled.
<span class='line'>2824</span> 
<span class='line'>2825</span> 			Parameters:
<span class='line'>2826</span> 				el 	- 	either a string id, or a selector representing a single element.
<span class='line'>2827</span> 
<span class='line'>2828</span> 			Returns:
<span class='line'>2829</span> 			True if enabled, false if not.
<span class='line'>2830</span> 		*/</span><span class="WHIT">
<span class='line'>2831</span> </span><span class="WHIT">		</span><span class="NAME">this.isTargetEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2832</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2833</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_targetsEnabled</span><span class="PUNC">[</span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2834</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2835</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2836</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2837</span> 		  Function: ready
<span class='line'>2838</span> 		  Helper method to bind a function to jsPlumb's ready event.
<span class='line'>2839</span> 		 */</span><span class="WHIT">
<span class='line'>2840</span> </span><span class="WHIT">		</span><span class="NAME">this.ready</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2841</span> </span><span class="WHIT">			</span><span class="NAME">_currentInstance.bind</span><span class="PUNC">(</span><span class="STRN">"ready"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2842</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2843</span> 
<span class='line'>2844</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2845</span> 		  Function: repaint 
<span class='line'>2846</span> 		  Repaints an element and its connections. This method gets new sizes for the elements before painting anything.
<span class='line'>2847</span> 		  
<span class='line'>2848</span> 		  Parameters: 
<span class='line'>2849</span> 		  	el - either the id of the element or a selector representing the element.
<span class='line'>2850</span> 		  	 
<span class='line'>2851</span> 		  Returns: 
<span class='line'>2852</span> 		  	void
<span class='line'>2853</span> 		  	 
<span class='line'>2854</span> 		  See Also: 
<span class='line'>2855</span> 		  	&lt;repaintEverything>
<span class='line'>2856</span> 		 */</span><span class="WHIT">
<span class='line'>2857</span> </span><span class="WHIT">		</span><span class="NAME">this.repaint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2858</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_processElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">_draw</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2859</span> </span><span class="WHIT">			</span><span class="COMM">// support both lists...</span><span class="WHIT">
<span class='line'>2860</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'object'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2861</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">el.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_processElement</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			 </span><span class="WHIT">
<span class='line'>2862</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="COMM">// ...and single strings.</span><span class="WHIT">
<span class='line'>2863</span> </span><span class="WHIT">				</span><span class="NAME">_processElement</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2864</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2865</span> 
<span class='line'>2866</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2867</span> 		  Function: repaintEverything 
<span class='line'>2868</span> 		  Repaints all connections.
<span class='line'>2869</span> 		   
<span class='line'>2870</span> 		  Returns: 
<span class='line'>2871</span> 		  	void
<span class='line'>2872</span> 		  	
<span class='line'>2873</span> 		  See Also: 
<span class='line'>2874</span> 		  	&lt;repaint>
<span class='line'>2875</span> 		 */</span><span class="WHIT">
<span class='line'>2876</span> </span><span class="WHIT">		</span><span class="NAME">this.repaintEverything</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2877</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2878</span> </span><span class="WHIT">				</span><span class="NAME">_draw</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">elId</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2879</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2880</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2881</span> 
<span class='line'>2882</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2883</span> 		  Function: removeAllEndpoints 
<span class='line'>2884</span> 		  Removes all Endpoints associated with a given element. Also removes all Connections associated with each Endpoint it removes.
<span class='line'>2885</span> 		  
<span class='line'>2886</span> 		  Parameters: 
<span class='line'>2887</span> 		  	el - either an element id, or a selector for an element.
<span class='line'>2888</span> 		  	 
<span class='line'>2889</span> 		  Returns: 
<span class='line'>2890</span> 		  	void
<span class='line'>2891</span> 		  	 
<span class='line'>2892</span> 		  See Also: 
<span class='line'>2893</span> 		  	&lt;removeEndpoint>
<span class='line'>2894</span> 		 */</span><span class="WHIT">
<span class='line'>2895</span> </span><span class="WHIT">		</span><span class="NAME">this.removeAllEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2896</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2897</span> </span><span class="WHIT">			    </span><span class="NAME">ebe</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2898</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ebe</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2899</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ebe.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2900</span> </span><span class="WHIT">					</span><span class="NAME">_currentInstance.deleteEndpoint</span><span class="PUNC">(</span><span class="NAME">ebe</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2901</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2902</span> </span><span class="WHIT">			</span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2903</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2904</span> 
<span class='line'>2905</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2906</span> 		  Removes every Endpoint in this instance of jsPlumb.		   		  		  		  
<span class='line'>2907</span> 		  @deprecated use deleteEveryEndpoint instead
<span class='line'>2908</span> 		 */</span><span class="WHIT">
<span class='line'>2909</span> </span><span class="WHIT">		</span><span class="NAME">this.removeEveryEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.deleteEveryEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2910</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2911</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2912</span> 		  Removes the given Endpoint from the given element.		  		  
<span class='line'>2913</span> 		  @deprecated Use jsPlumb.deleteEndpoint instead (and note you dont need to supply the element. it's irrelevant).
<span class='line'>2914</span> 		 */</span><span class="WHIT">
<span class='line'>2915</span> </span><span class="WHIT">		</span><span class="NAME">this.removeEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2916</span> </span><span class="WHIT">			</span><span class="NAME">_currentInstance.deleteEndpoint</span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2917</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2918</span> 
<span class='line'>2919</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_registeredListeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2920</span> </span><span class="WHIT">            </span><span class="NAME">_unbindRegisteredListeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2921</span> </span><span class="WHIT">                </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">_registeredListeners</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2922</span> </span><span class="WHIT">                    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">_registeredListeners</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2923</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">info</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_registeredListeners</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2924</span> </span><span class="WHIT">                        </span><span class="NAME">jsPlumb.CurrentLibrary.unbind</span><span class="PUNC">(</span><span class="NAME">info.el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">info.event</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">info.listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2925</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2926</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2927</span> </span><span class="WHIT">                </span><span class="NAME">_registeredListeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2928</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2929</span> 
<span class='line'>2930</span> </span><span class="WHIT">        </span><span class="COMM">// internal register listener method.  gives us a hook to clean things up</span><span class="WHIT">
<span class='line'>2931</span> </span><span class="WHIT">        </span><span class="COMM">// with if the user calls jsPlumb.reset.</span><span class="WHIT">
<span class='line'>2932</span> </span><span class="WHIT">        </span><span class="NAME">this.registerListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2933</span> </span><span class="WHIT">            </span><span class="NAME">jsPlumb.CurrentLibrary.bind</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2934</span> </span><span class="WHIT">            </span><span class="NAME">_addToList</span><span class="PUNC">(</span><span class="NAME">_registeredListeners</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">el</span><span class="PUNC">:</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">event</span><span class="PUNC">:</span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">:</span><span class="NAME">listener</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2935</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2936</span> 
<span class='line'>2937</span> </span><span class="WHIT">        </span><span class="NAME">this.unregisterListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2938</span> </span><span class="WHIT">        	</span><span class="NAME">jsPlumb.CurrentLibrary.unbind</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2939</span> </span><span class="WHIT">        	</span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">_registeredListeners</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2940</span> </span><span class="WHIT">        		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">rl.type</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">rl.listener</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2941</span> </span><span class="WHIT">        	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2942</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2943</span> 
<span class='line'>2944</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2945</span> 		  Function:reset 
<span class='line'>2946</span> 		  Removes all endpoints and connections and clears the listener list. To keep listeners call jsPlumb.deleteEveryEndpoint instead of this.
<span class='line'>2947</span> 		 */</span><span class="WHIT">
<span class='line'>2948</span> </span><span class="WHIT">		</span><span class="NAME">this.reset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>2949</span> </span><span class="WHIT">			</span><span class="NAME">_currentInstance.deleteEveryEndpoint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2950</span> </span><span class="WHIT">			</span><span class="NAME">_currentInstance.unbind</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2951</span> </span><span class="WHIT">			</span><span class="NAME">_targetEndpointDefinitions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2952</span> </span><span class="WHIT">			</span><span class="NAME">_targetEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2953</span> </span><span class="WHIT">			</span><span class="NAME">_targetEndpointsUnique</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2954</span> </span><span class="WHIT">			</span><span class="NAME">_targetMaxConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2955</span> </span><span class="WHIT">			</span><span class="NAME">_sourceEndpointDefinitions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2956</span> </span><span class="WHIT">			</span><span class="NAME">_sourceEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2957</span> </span><span class="WHIT">			</span><span class="NAME">_sourceEndpointsUnique</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2958</span> </span><span class="WHIT">            </span><span class="NAME">_unbindRegisteredListeners</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2959</span> </span><span class="WHIT">            </span><span class="NAME">_currentInstance.anchorManager.reset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2960</span> </span><span class="WHIT">            </span><span class="NAME">_currentInstance.dragManager.reset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2961</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2962</span> 
<span class='line'>2963</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2964</span> 		  Function: setAutomaticRepaint 
<span class='line'>2965</span> 		  Sets/unsets automatic repaint on window resize.
<span class='line'>2966</span> 		   
<span class='line'>2967</span> 		  Parameters: 
<span class='line'>2968</span> 		  	value - whether or not to automatically repaint when the window is resized.
<span class='line'>2969</span> 		  	 
<span class='line'>2970</span> 		  Returns: void
<span class='line'>2971</span> 		 *
<span class='line'>2972</span> 		this.setAutomaticRepaint = function(value) {
<span class='line'>2973</span> 			automaticRepaint = value;
<span class='line'>2974</span> 		};*/</span><span class="WHIT">
<span class='line'>2975</span> 
<span class='line'>2976</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2977</span> 		 * Function: setDefaultScope 
<span class='line'>2978</span> 		 * Sets the default scope for Connections and Endpoints. A scope defines a type of Endpoint/Connection; supplying a
<span class='line'>2979</span> 		 * scope to an Endpoint or Connection allows you to support different
<span class='line'>2980</span> 		 * types of Connections in the same UI.  If you're only interested in
<span class='line'>2981</span> 		 * one type of Connection, you don't need to supply a scope. This method
<span class='line'>2982</span> 		 * will probably be used by very few people; it just instructs jsPlumb
<span class='line'>2983</span> 		 * to use a different key for the default scope.
<span class='line'>2984</span> 		 * 
<span class='line'>2985</span> 		 * Parameters:
<span class='line'>2986</span> 		 * 	scope - scope to set as default.
<span class='line'>2987</span> 		 */</span><span class="WHIT">
<span class='line'>2988</span> </span><span class="WHIT">		</span><span class="NAME">this.setDefaultScope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">scope</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2989</span> </span><span class="WHIT">			</span><span class="NAME">DEFAULT_SCOPE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2990</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2991</span> 
<span class='line'>2992</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>2993</span> 		 * Function: setDraggable 
<span class='line'>2994</span> 		 * Sets whether or not a given element is
<span class='line'>2995</span> 		 * draggable, regardless of what any jsPlumb command may request.
<span class='line'>2996</span> 		 * 
<span class='line'>2997</span> 		 * Parameters: 
<span class='line'>2998</span> 		 * 	el - either the id for the element, or a selector representing the element.
<span class='line'>2999</span> 		 *  
<span class='line'>3000</span> 		 * Returns: 
<span class='line'>3001</span> 		 * 	void
<span class='line'>3002</span> 		 */</span><span class="WHIT">
<span class='line'>3003</span> </span><span class="WHIT">		</span><span class="NAME">this.setDraggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_setDraggable</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3004</span> 
<span class='line'>3005</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3006</span> 		* Function: setId
<span class='line'>3007</span> 		* Changes the id of some element, adjusting all connections and endpoints
<span class='line'>3008</span> 		*
<span class='line'>3009</span> 		* Parameters:
<span class='line'>3010</span> 		* el - a selector, a DOM element, or a string. 
<span class='line'>3011</span> 		* newId - string.
<span class='line'>3012</span> 		*/</span><span class="WHIT">
<span class='line'>3013</span> </span><span class="WHIT">		</span><span class="NAME">this.setId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotSetAttribute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3014</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3015</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">String</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3016</span> </span><span class="WHIT">				</span><span class="NAME">sConns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getConnections</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">source</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">:</span><span class="STRN">'*'</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3017</span> </span><span class="WHIT">				</span><span class="NAME">tConns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getConnections</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">target</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">:</span><span class="STRN">'*'</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3018</span> 
<span class='line'>3019</span> </span><span class="WHIT">			</span><span class="NAME">newId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3020</span> </span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>3021</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">doNotSetAttribute</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3022</span> </span><span class="WHIT">				</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3023</span> </span><span class="WHIT">				</span><span class="NAME">jsPlumb.CurrentLibrary.setAttribute</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3024</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3025</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3026</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getElementObject</span><span class="PUNC">(</span><span class="NAME">newId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3027</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3028</span> 
<span class='line'>3029</span> </span><span class="WHIT">			</span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">newId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3030</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">newId</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3031</span> </span><span class="WHIT">				</span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">newId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">elementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3032</span> </span><span class="WHIT">				</span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">newId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3033</span> </span><span class="WHIT">				</span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">newId</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor.elementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3034</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3035</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3036</span> 
<span class='line'>3037</span> </span><span class="WHIT">			</span><span class="NAME">_currentInstance.anchorManager.changeId</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3038</span> 
<span class='line'>3039</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_conns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">epIdx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3040</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">list.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3041</span> </span><span class="WHIT">					</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">epIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">elementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3042</span> </span><span class="WHIT">					</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">epIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3043</span> </span><span class="WHIT">					</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">type</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"Id"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3044</span> </span><span class="WHIT">					</span><span class="NAME">list</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">type</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3045</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3046</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3047</span> </span><span class="WHIT">			</span><span class="NAME">_conns</span><span class="PUNC">(</span><span class="NAME">sConns</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"source"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3048</span> </span><span class="WHIT">			</span><span class="NAME">_conns</span><span class="PUNC">(</span><span class="NAME">tConns</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"target"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3049</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3050</span> 
<span class='line'>3051</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3052</span> 		* Function: setIdChanged
<span class='line'>3053</span> 		* Notify jsPlumb that the element with oldId has had its id changed to newId.
<span class='line'>3054</span> 		*/</span><span class="WHIT">
<span class='line'>3055</span> </span><span class="WHIT">		</span><span class="NAME">this.setIdChanged</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">oldId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3056</span> </span><span class="WHIT">			</span><span class="NAME">_currentInstance.setId</span><span class="PUNC">(</span><span class="NAME">oldId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3057</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3058</span> 
<span class='line'>3059</span> </span><span class="WHIT">		</span><span class="NAME">this.setDebugLog</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">debugLog</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3060</span> </span><span class="WHIT">			</span><span class="NAME">log</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">debugLog</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3061</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3062</span> 
<span class='line'>3063</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3064</span> 		 * Function: setRepaintFunction 
<span class='line'>3065</span> 		 * 	Sets the function to fire when the window size has changed and a repaint was fired. 
<span class='line'>3066</span> 		 * 
<span class='line'>3067</span> 		 * Parameters: 
<span class='line'>3068</span> 		 * 	f - Function to execute.
<span class='line'>3069</span> 		 *  
<span class='line'>3070</span> 		 * Returns: void
<span class='line'>3071</span> 		 */</span><span class="WHIT">
<span class='line'>3072</span> </span><span class="WHIT">		</span><span class="NAME">this.setRepaintFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">f</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3073</span> </span><span class="WHIT">			</span><span class="NAME">repaintFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3074</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3075</span> 
<span class='line'>3076</span> </span><span class="WHIT">        </span><span class="COMM">/*
<span class='line'>3077</span>          * Function: setSuspendDrawing
<span class='line'>3078</span>          * Suspends drawing operations.  This can be used when you have a lot of connections to make or endpoints to register;
<span class='line'>3079</span>          * it will save you a lot of time.
<span class='line'>3080</span>          */</span><span class="WHIT">
<span class='line'>3081</span> </span><span class="WHIT">        </span><span class="NAME">this.setSuspendDrawing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_setSuspendDrawing</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3082</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3083</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3084</span> 		 * Constant for use with the setRenderMode method
<span class='line'>3085</span> 		 */</span><span class="WHIT">
<span class='line'>3086</span> </span><span class="WHIT">		</span><span class="NAME">this.CANVAS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"canvas"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3087</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3088</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3089</span> 		 * Constant for use with the setRenderMode method
<span class='line'>3090</span> 		 */</span><span class="WHIT">
<span class='line'>3091</span> </span><span class="WHIT">		</span><span class="NAME">this.SVG</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"svg"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3092</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3093</span> </span><span class="WHIT">		</span><span class="NAME">this.VML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"vml"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3094</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3095</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3096</span> 		 * Function: setRenderMode
<span class='line'>3097</span> 		 * Sets render mode: jsPlumb.CANVAS, jsPlumb.SVG or jsPlumb.VML.  jsPlumb will fall back to VML if it determines that
<span class='line'>3098</span> 		 * what you asked for is not supported (and that VML is).  If you asked for VML but the browser does
<span class='line'>3099</span> 		 * not support it, jsPlumb uses SVG.  
<span class='line'>3100</span> 		 * 
<span class='line'>3101</span> 		 * Returns:
<span class='line'>3102</span> 		 * the render mode that jsPlumb set, which of course may be different from that requested.
<span class='line'>3103</span> 		 */</span><span class="WHIT">
<span class='line'>3104</span> </span><span class="WHIT">		</span><span class="NAME">this.setRenderMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">mode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3105</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3106</span> </span><span class="WHIT">				</span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">mode.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3107</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3108</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3109</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CANVAS</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">jsPlumb.SVG</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">jsPlumb.VML</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">throw</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Error</span><span class="PUNC">(</span><span class="STRN">"render mode must be one of jsPlumb.CANVAS, jsPlumb.SVG or jsPlumb.VML"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3110</span> </span><span class="WHIT">			</span><span class="COMM">// now test we actually have the capability to do this.						</span><span class="WHIT">
<span class='line'>3111</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">jsPlumb.SVG</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3112</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">svgAvailable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">renderMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.SVG</span><span class="WHIT">
<span class='line'>3113</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">canvasAvailable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">renderMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CANVAS</span><span class="WHIT">
<span class='line'>3114</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vmlAvailable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">renderMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.VML</span><span class="WHIT">
<span class='line'>3115</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3116</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mode</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CANVAS</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">canvasAvailable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">renderMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CANVAS</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3117</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">vmlAvailable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">renderMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.VML</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3118</span> 
<span class='line'>3119</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">renderMode</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3120</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3121</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3122</span> </span><span class="WHIT">		</span><span class="NAME">this.getRenderMode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">renderMode</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3123</span> 
<span class='line'>3124</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3125</span> 		 * Function: show 
<span class='line'>3126</span> 		 * Sets an element's connections to be visible.
<span class='line'>3127</span> 		 * 
<span class='line'>3128</span> 		 * Parameters: 
<span class='line'>3129</span> 		 * 	el - either the id of the element, or a selector for the element.
<span class='line'>3130</span> 		 *  changeEndpoints - whether or not to also change the visible state of the endpoints on the element.  this also has a bearing on
<span class='line'>3131</span> 		 *  other connections on those endpoints: if their other endpoint is also visible, the connections are made visible.  
<span class='line'>3132</span> 		 *  
<span class='line'>3133</span> 		 * Returns: 
<span class='line'>3134</span> 		 * 	void
<span class='line'>3135</span> 		 */</span><span class="WHIT">
<span class='line'>3136</span> </span><span class="WHIT">		</span><span class="NAME">this.show</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">changeEndpoints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3137</span> </span><span class="WHIT">			</span><span class="NAME">_setVisible</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"block"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">changeEndpoints</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3138</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3139</span> 
<span class='line'>3140</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3141</span> 		 * Function: sizeCanvas 
<span class='line'>3142</span> 		 * Helper to size a canvas. You would typically use
<span class='line'>3143</span> 		 * this when writing your own Connector or Endpoint implementation.
<span class='line'>3144</span> 		 * 
<span class='line'>3145</span> 		 * Parameters: 
<span class='line'>3146</span> 		 * 	x - [int] x position for the Canvas origin 
<span class='line'>3147</span> 		 * 	y - [int] y position for the Canvas origin 
<span class='line'>3148</span> 		 * 	w - [int] width of the canvas 
<span class='line'>3149</span> 		 * 	h - [int] height of the canvas
<span class='line'>3150</span> 		 *  
<span class='line'>3151</span> 		 * Returns: 
<span class='line'>3152</span> 		 * 	void
<span class='line'>3153</span> 		 */</span><span class="WHIT">
<span class='line'>3154</span> </span><span class="WHIT">		</span><span class="NAME">this.sizeCanvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3155</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">canvas</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3156</span> </span><span class="WHIT">				</span><span class="NAME">canvas.style.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3157</span> </span><span class="WHIT">				</span><span class="NAME">canvas.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3158</span> </span><span class="WHIT">				</span><span class="NAME">canvas.style.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3159</span> </span><span class="WHIT">				</span><span class="NAME">canvas.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">w</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3160</span> </span><span class="WHIT">				</span><span class="NAME">canvas.style.left</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3161</span> </span><span class="WHIT">				</span><span class="NAME">canvas.style.top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3162</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3163</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3164</span> 
<span class='line'>3165</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>3166</span> 		 * gets some test hooks. nothing writable.
<span class='line'>3167</span> 		 */</span><span class="WHIT">
<span class='line'>3168</span> </span><span class="WHIT">		</span><span class="NAME">this.getTestHarness</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3169</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3170</span> </span><span class="WHIT">				</span><span class="NAME">endpointsByElement</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>3171</span> </span><span class="WHIT">				</span><span class="NAME">endpointCount</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3172</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3173</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">e.length</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3174</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3175</span> </span><span class="WHIT">				</span><span class="NAME">connectionCount</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">scope</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3176</span> </span><span class="WHIT">					</span><span class="NAME">scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">DEFAULT_SCOPE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3177</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectionsByScope</span><span class="PUNC">[</span><span class="NAME">scope</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3178</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">c.length</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3179</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3180</span> </span><span class="WHIT">				</span><span class="COMM">//findIndex : _findIndex,</span><span class="WHIT">
<span class='line'>3181</span> </span><span class="WHIT">				</span><span class="NAME">getId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3182</span> </span><span class="WHIT">				</span><span class="NAME">makeAnchor</span><span class="PUNC">:</span><span class="NAME">self.makeAnchor</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3183</span> </span><span class="WHIT">				</span><span class="NAME">makeDynamicAnchor</span><span class="PUNC">:</span><span class="NAME">self.makeDynamicAnchor</span><span class="WHIT">
<span class='line'>3184</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3185</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3186</span> 
<span class='line'>3187</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>3188</span> 		 * Toggles visibility of an element's connections. kept for backwards
<span class='line'>3189</span> 		 * compatibility
<span class='line'>3190</span> 		 */</span><span class="WHIT">
<span class='line'>3191</span> </span><span class="WHIT">		</span><span class="NAME">this.toggle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_toggleVisible</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3192</span> 
<span class='line'>3193</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3194</span> 		 * Function: toggleVisible 
<span class='line'>3195</span> 		 * Toggles visibility of an element's Connections.
<span class='line'>3196</span> 		 *  
<span class='line'>3197</span> 		 * Parameters: 
<span class='line'>3198</span> 		 * 	el - either the element's id, or a selector representing the element.
<span class='line'>3199</span> 		 *  changeEndpoints - whether or not to also toggle the endpoints on the element.
<span class='line'>3200</span> 		 *  
<span class='line'>3201</span> 		 * Returns: 
<span class='line'>3202</span> 		 * 	void, but should be updated to return the current state
<span class='line'>3203</span> 		 */</span><span class="WHIT">
<span class='line'>3204</span> </span><span class="WHIT">		</span><span class="COMM">// TODO: update this method to return the current state.</span><span class="WHIT">
<span class='line'>3205</span> </span><span class="WHIT">		</span><span class="NAME">this.toggleVisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_toggleVisible</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3206</span> 
<span class='line'>3207</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3208</span> 		 * Function: toggleDraggable 
<span class='line'>3209</span> 		 * Toggles draggability (sic?) of an element's Connections.
<span class='line'>3210</span> 		 *  
<span class='line'>3211</span> 		 * Parameters: 
<span class='line'>3212</span> 		 * 	el - either the element's id, or a selector representing the element.
<span class='line'>3213</span> 		 *  
<span class='line'>3214</span> 		 * Returns: 
<span class='line'>3215</span> 		 * 	The current draggable state.
<span class='line'>3216</span> 		 */</span><span class="WHIT">
<span class='line'>3217</span> </span><span class="WHIT">		</span><span class="NAME">this.toggleDraggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_toggleDraggable</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3218</span> 
<span class='line'>3219</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3220</span> 		 * Function: unload 
<span class='line'>3221</span> 		 * Unloads jsPlumb, deleting all storage. You should call this from an onunload attribute on the &lt;body> element. 
<span class='line'>3222</span> 		 * 
<span class='line'>3223</span> 		 * Returns:
<span class='line'>3224</span> 		 * 	void
<span class='line'>3225</span> 		 */</span><span class="WHIT">
<span class='line'>3226</span> </span><span class="WHIT">		</span><span class="NAME">this.unload</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3227</span> </span><span class="WHIT">			</span><span class="COMM">// this used to do something, but it turns out that what it did was nothing.</span><span class="WHIT">
<span class='line'>3228</span> </span><span class="WHIT">			</span><span class="COMM">// now it exists only for backwards compatibility.</span><span class="WHIT">
<span class='line'>3229</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3230</span> 
<span class='line'>3231</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>3232</span> 		 * Helper method to wrap an existing function with one of
<span class='line'>3233</span> 		 * your own. This is used by the various implementations to wrap event
<span class='line'>3234</span> 		 * callbacks for drag/drop etc; it allows jsPlumb to be transparent in
<span class='line'>3235</span> 		 * its handling of these things. If a user supplies their own event
<span class='line'>3236</span> 		 * callback, for anything, it will always be called. 
<span class='line'>3237</span> 		 */</span><span class="WHIT">
<span class='line'>3238</span> </span><span class="WHIT">		</span><span class="NAME">this.wrap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3239</span> </span><span class="WHIT">		</span><span class="NAME">this.addListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.bind</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3240</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3241</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">adjustForParentOffsetAndScroll</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">xy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3242</span> 
<span class='line'>3243</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">offsetParent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3244</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el.tagName.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"svg"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">el.parentNode</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3245</span> </span><span class="WHIT">				</span><span class="NAME">offsetParent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el.parentNode</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3246</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3247</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el.offsetParent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3248</span> </span><span class="WHIT">				</span><span class="NAME">offsetParent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el.offsetParent</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>3249</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3250</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">offsetParent</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3251</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">po</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetParent.tagName.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"body"</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">top</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_getOffset</span><span class="PUNC">(</span><span class="NAME">offsetParent</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3252</span> </span><span class="WHIT">					</span><span class="NAME">so</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetParent.tagName.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"body"</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">top</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NAME">offsetParent.scrollLeft</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">:</span><span class="NAME">offsetParent.scrollTop</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>3253</span> 
<span class='line'>3254</span> 
<span class='line'>3255</span> </span><span class="WHIT">				</span><span class="COMM">// i thought it might be cool to do this:</span><span class="WHIT">
<span class='line'>3256</span> </span><span class="WHIT">				</span><span class="COMM">//	lastReturnValue[0] = lastReturnValue[0] - offsetParent.offsetLeft + offsetParent.scrollLeft;</span><span class="WHIT">
<span class='line'>3257</span> </span><span class="WHIT">				</span><span class="COMM">//	lastReturnValue[1] = lastReturnValue[1] - offsetParent.offsetTop + offsetParent.scrollTop;					</span><span class="WHIT">
<span class='line'>3258</span> </span><span class="WHIT">				</span><span class="COMM">// but i think it ignores margins.  my reasoning was that it's quicker to not hand off to some underlying					</span><span class="WHIT">
<span class='line'>3259</span> </span><span class="WHIT">				</span><span class="COMM">// library.</span><span class="WHIT">
<span class='line'>3260</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3261</span> </span><span class="WHIT">				</span><span class="NAME">result</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">po.left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">so.left</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3262</span> </span><span class="WHIT">				</span><span class="NAME">result</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">po.top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">so.top</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3263</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3264</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3265</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3266</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3267</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3268</span> 
<span class='line'>3269</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>3270</span> 		 * Anchors model a position on some element at which an Endpoint may be located.  They began as a first class citizen of jsPlumb, ie. a user
<span class='line'>3271</span> 		 * was required to create these themselves, but over time this has been replaced by the concept of referring to them either by name (eg. "TopMiddle"),
<span class='line'>3272</span> 		 * or by an array describing their coordinates (eg. [ 0, 0.5, 0, -1 ], which is the same as "TopMiddle").  jsPlumb now handles all of the
<span class='line'>3273</span> 		 * creation of Anchors without user intervention.
<span class='line'>3274</span> 		 */</span><span class="WHIT">
<span class='line'>3275</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3276</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3277</span> </span><span class="WHIT">			</span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.x</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3278</span> </span><span class="WHIT">			</span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.y</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3279</span> </span><span class="WHIT">			</span><span class="NAME">this.elementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3280</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.orientation</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3281</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lastTimestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lastReturnValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3282</span> </span><span class="WHIT">			</span><span class="NAME">this.offsets</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.offsets</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3283</span> </span><span class="WHIT">			</span><span class="NAME">self.timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3284</span> </span><span class="WHIT">			</span><span class="NAME">this.compute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3285</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.xy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.wh</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.timestamp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3286</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3287</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">self.timestamp</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3288</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">lastReturnValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3289</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3290</span> </span><span class="WHIT">				</span><span class="NAME">lastReturnValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.x</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">self.offsets</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.y</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">self.offsets</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3291</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3292</span> </span><span class="WHIT">				</span><span class="COMM">// adjust loc if there is an offsetParent</span><span class="WHIT">
<span class='line'>3293</span> </span><span class="WHIT">				</span><span class="NAME">lastReturnValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">adjustForParentOffsetAndScroll</span><span class="PUNC">(</span><span class="NAME">lastReturnValue</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element.canvas</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3294</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3295</span> </span><span class="WHIT">				</span><span class="NAME">self.timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3296</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">lastReturnValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3297</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3298</span> 
<span class='line'>3299</span> </span><span class="WHIT">			</span><span class="NAME">this.getOrientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3300</span> 
<span class='line'>3301</span> </span><span class="WHIT">			</span><span class="NAME">this.equals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3302</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3303</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ao</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchor.getOrientation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3304</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getOrientation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3305</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">anchor.x</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">anchor.y</span><span class="WHIT">
<span class='line'>3306</span> </span><span class="WHIT">						</span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.offsets</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">anchor.offsets</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>3307</span> </span><span class="WHIT">						</span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.offsets</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">anchor.offsets</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>3308</span> </span><span class="WHIT">						</span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">ao</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">ao</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3309</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3310</span> 
<span class='line'>3311</span> </span><span class="WHIT">			</span><span class="NAME">this.getCurrentLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">lastReturnValue</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3312</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3313</span> 
<span class='line'>3314</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>3315</span> 		 * An Anchor that floats. its orientation is computed dynamically from
<span class='line'>3316</span> 		 * its position relative to the anchor it is floating relative to.  It is used when creating 
<span class='line'>3317</span> 		 * a connection through drag and drop.
<span class='line'>3318</span> 		 * 
<span class='line'>3319</span> 		 * TODO FloatingAnchor could totally be refactored to extend Anchor just slightly.
<span class='line'>3320</span> 		 */</span><span class="WHIT">
<span class='line'>3321</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">FloatingAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3322</span> 
<span class='line'>3323</span> </span><span class="WHIT">			</span><span class="COMM">// this is the anchor that this floating anchor is referenced to for</span><span class="WHIT">
<span class='line'>3324</span> </span><span class="WHIT">			</span><span class="COMM">// purposes of calculating the orientation.</span><span class="WHIT">
<span class='line'>3325</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ref</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.reference</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3326</span> </span><span class="WHIT">			</span><span class="COMM">// the canvas this refers to.</span><span class="WHIT">
<span class='line'>3327</span> </span><span class="WHIT">			</span><span class="NAME">refCanvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.referenceCanvas</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3328</span> </span><span class="WHIT">			</span><span class="NAME">size</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getSize</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">refCanvas</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3329</span> 
<span class='line'>3330</span> </span><span class="WHIT">			</span><span class="COMM">// these are used to store the current relative position of our</span><span class="WHIT">
<span class='line'>3331</span> </span><span class="WHIT">			</span><span class="COMM">// anchor wrt the reference anchor. they only indicate</span><span class="WHIT">
<span class='line'>3332</span> </span><span class="WHIT">			</span><span class="COMM">// direction, so have a value of 1 or -1 (or, very rarely, 0). these</span><span class="WHIT">
<span class='line'>3333</span> </span><span class="WHIT">			</span><span class="COMM">// values are written by the compute method, and read</span><span class="WHIT">
<span class='line'>3334</span> </span><span class="WHIT">			</span><span class="COMM">// by the getOrientation method.</span><span class="WHIT">
<span class='line'>3335</span> </span><span class="WHIT">			</span><span class="NAME">xDir</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">yDir</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3336</span> </span><span class="WHIT">			</span><span class="COMM">// temporary member used to store an orientation when the floating</span><span class="WHIT">
<span class='line'>3337</span> </span><span class="WHIT">			</span><span class="COMM">// anchor is hovering over another anchor.</span><span class="WHIT">
<span class='line'>3338</span> </span><span class="WHIT">			</span><span class="NAME">orientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3339</span> </span><span class="WHIT">			</span><span class="NAME">_lastResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3340</span> 
<span class='line'>3341</span> </span><span class="WHIT">			</span><span class="COMM">// set these to 0 each; they are used by certain types of connectors in the loopback case,</span><span class="WHIT">
<span class='line'>3342</span> </span><span class="WHIT">			</span><span class="COMM">// when the connector is trying to clear the element it is on. but for floating anchor it's not</span><span class="WHIT">
<span class='line'>3343</span> </span><span class="WHIT">			</span><span class="COMM">// very important.</span><span class="WHIT">
<span class='line'>3344</span> </span><span class="WHIT">			</span><span class="NAME">this.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">this.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3345</span> 
<span class='line'>3346</span> </span><span class="WHIT">			</span><span class="NAME">this.isFloating</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3347</span> 
<span class='line'>3348</span> </span><span class="WHIT">			</span><span class="NAME">this.compute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3349</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.xy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.element</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3350</span> </span><span class="WHIT">				</span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">size</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// return origin of the element. we may wish to improve this so that any object can be the drag proxy.</span><span class="WHIT">
<span class='line'>3351</span> </span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>3352</span> </span><span class="WHIT">				</span><span class="COMM">// adjust loc if there is an offsetParent</span><span class="WHIT">
<span class='line'>3353</span> </span><span class="WHIT">				</span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">adjustForParentOffsetAndScroll</span><span class="PUNC">(</span><span class="NAME">result</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element.canvas</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3354</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3355</span> </span><span class="WHIT">				</span><span class="NAME">_lastResult</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3356</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3357</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3358</span> 
<span class='line'>3359</span> </span><span class="WHIT">			</span><span class="NAME">this.getOrientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3360</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">orientation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3361</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3362</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ref.getOrientation</span><span class="PUNC">(</span><span class="NAME">_endpoint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3363</span> </span><span class="WHIT">					</span><span class="COMM">// here we take into account the orientation of the other</span><span class="WHIT">
<span class='line'>3364</span> </span><span class="WHIT">					</span><span class="COMM">// anchor: if it declares zero for some direction, we declare zero too. this might not be the most awesome. perhaps we can come</span><span class="WHIT">
<span class='line'>3365</span> </span><span class="WHIT">					</span><span class="COMM">// up with a better way. it's just so that the line we draw looks like it makes sense. maybe this wont make sense.</span><span class="WHIT">
<span class='line'>3366</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">xDir</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3367</span> </span><span class="WHIT">							</span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">yDir</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3368</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3369</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3370</span> 
<span class='line'>3371</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>3372</span> 			 * notification the endpoint associated with this anchor is hovering
<span class='line'>3373</span> 			 * over another anchor; we want to assume that anchor's orientation
<span class='line'>3374</span> 			 * for the duration of the hover.
<span class='line'>3375</span> 			 */</span><span class="WHIT">
<span class='line'>3376</span> </span><span class="WHIT">			</span><span class="NAME">this.over</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3377</span> </span><span class="WHIT">				</span><span class="NAME">orientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchor.getOrientation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3378</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3379</span> 
<span class='line'>3380</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>3381</span> 			 * notification the endpoint associated with this anchor is no
<span class='line'>3382</span> 			 * longer hovering over another anchor; we should resume calculating
<span class='line'>3383</span> 			 * orientation as we normally do.
<span class='line'>3384</span> 			 */</span><span class="WHIT">
<span class='line'>3385</span> </span><span class="WHIT">			</span><span class="NAME">this.out</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3386</span> 
<span class='line'>3387</span> </span><span class="WHIT">			</span><span class="NAME">this.getCurrentLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_lastResult</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3388</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3389</span> 
<span class='line'>3390</span> </span><span class="WHIT">		</span><span class="COMM">/* 
<span class='line'>3391</span> 		 * A DynamicAnchor is an Anchor that contains a list of other Anchors, which it cycles
<span class='line'>3392</span> 		 * through at compute time to find the one that is located closest to
<span class='line'>3393</span> 		 * the center of the target element, and returns that Anchor's compute
<span class='line'>3394</span> 		 * method result. this causes endpoints to follow each other with
<span class='line'>3395</span> 		 * respect to the orientation of their target elements, which is a useful
<span class='line'>3396</span> 		 * feature for some applications.
<span class='line'>3397</span> 		 * 
<span class='line'>3398</span> 		 */</span><span class="WHIT">
<span class='line'>3399</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">DynamicAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchors</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchorSelector</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3400</span> </span><span class="WHIT">			</span><span class="NAME">this.isSelective</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3401</span> </span><span class="WHIT">			</span><span class="NAME">this.isDynamic</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3402</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_anchors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3403</span> </span><span class="WHIT">			</span><span class="NAME">_convert</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3404</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">anchor.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Anchor</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_currentInstance.makeAnchor</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3405</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3406</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">anchors.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3407</span> </span><span class="WHIT">				</span><span class="NAME">_anchors</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_convert</span><span class="PUNC">(</span><span class="NAME">anchors</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3408</span> </span><span class="WHIT">			</span><span class="NAME">this.addAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">_anchors.push</span><span class="PUNC">(</span><span class="NAME">_convert</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3409</span> </span><span class="WHIT">			</span><span class="NAME">this.getAnchors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_anchors</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3410</span> </span><span class="WHIT">			</span><span class="NAME">this.locked</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3411</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_curAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_anchors.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_anchors</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3412</span> </span><span class="WHIT">				</span><span class="NAME">_curIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_anchors.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3413</span> </span><span class="WHIT">				</span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3414</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3415</span> </span><span class="WHIT">				</span><span class="COMM">// helper method to calculate the distance between the centers of the two elements.</span><span class="WHIT">
<span class='line'>3416</span> </span><span class="WHIT">				</span><span class="NAME">_distance</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3417</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ax</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">anchor.x</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">anchor.y</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3418</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">Math.sqrt</span><span class="PUNC">(</span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">cx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">ax</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.pow</span><span class="PUNC">(</span><span class="NAME">cy</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">ay</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3419</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3420</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3421</span> </span><span class="WHIT">			</span><span class="COMM">// default method uses distance between element centers.  you can provide your own method in the dynamic anchor</span><span class="WHIT">
<span class='line'>3422</span> </span><span class="WHIT">			</span><span class="COMM">// constructor (and also to jsPlumb.makeDynamicAnchor). the arguments to it are four arrays: </span><span class="WHIT">
<span class='line'>3423</span> </span><span class="WHIT">			</span><span class="COMM">// xy - xy loc of the anchor's element</span><span class="WHIT">
<span class='line'>3424</span> </span><span class="WHIT">			</span><span class="COMM">// wh - anchor's element's dimensions</span><span class="WHIT">
<span class='line'>3425</span> </span><span class="WHIT">			</span><span class="COMM">// txy - xy loc of the element of the other anchor in the connection</span><span class="WHIT">
<span class='line'>3426</span> </span><span class="WHIT">			</span><span class="COMM">// twh - dimensions of the element of the other anchor in the connection.</span><span class="WHIT">
<span class='line'>3427</span> </span><span class="WHIT">			</span><span class="COMM">// anchors - the list of selectable anchors</span><span class="WHIT">
<span class='line'>3428</span> </span><span class="WHIT">			</span><span class="NAME">_anchorSelector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchorSelector</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">xy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">txy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">twh</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchors</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3429</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">txy</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">twh</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">txy</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">twh</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3430</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">minDist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Infinity</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3431</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">anchors.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3432</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_distance</span><span class="PUNC">(</span><span class="NAME">anchors</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3433</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">minDist</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3434</span> </span><span class="WHIT">						</span><span class="NAME">minIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3435</span> </span><span class="WHIT">						</span><span class="NAME">minDist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3436</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3437</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3438</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">anchors</span><span class="PUNC">[</span><span class="NAME">minIdx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3439</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3440</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3441</span> </span><span class="WHIT">			</span><span class="NAME">this.compute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3442</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.xy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.wh</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">txy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.txy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">twh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.twh</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3443</span> </span><span class="WHIT">				</span><span class="COMM">// if anchor is locked or an opposite element was not given, we</span><span class="WHIT">
<span class='line'>3444</span> </span><span class="WHIT">				</span><span class="COMM">// maintain our state. anchor will be locked</span><span class="WHIT">
<span class='line'>3445</span> </span><span class="WHIT">				</span><span class="COMM">// if it is the source of a drag and drop.</span><span class="WHIT">
<span class='line'>3446</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.locked</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">txy</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">twh</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3447</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_curAnchor.compute</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3448</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>3449</span> </span><span class="WHIT">					</span><span class="NAME">params.timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// otherwise clear this, i think. we want the anchor to compute.</span><span class="WHIT">
<span class='line'>3450</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3451</span> </span><span class="WHIT">				</span><span class="NAME">_curAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_anchorSelector</span><span class="PUNC">(</span><span class="NAME">xy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">txy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">twh</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_anchors</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3452</span> </span><span class="WHIT">				</span><span class="NAME">self.x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curAnchor.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3453</span> </span><span class="WHIT">				</span><span class="NAME">self.y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curAnchor.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3454</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3455</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_curAnchor.compute</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3456</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3457</span> 
<span class='line'>3458</span> </span><span class="WHIT">			</span><span class="NAME">this.getCurrentLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3459</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_curAnchor</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_curAnchor.getCurrentLocation</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3460</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3461</span> 
<span class='line'>3462</span> </span><span class="WHIT">			</span><span class="NAME">this.getOrientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_curAnchor</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_curAnchor.getOrientation</span><span class="PUNC">(</span><span class="NAME">_endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3463</span> </span><span class="WHIT">			</span><span class="NAME">this.over</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_curAnchor</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_curAnchor.over</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3464</span> </span><span class="WHIT">			</span><span class="NAME">this.out</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_curAnchor</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_curAnchor.out</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3465</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3466</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3467</span> </span><span class="WHIT">	</span><span class="COMM">/*
<span class='line'>3468</span> 	manages anchors for all elements.
<span class='line'>3469</span> 	*/</span><span class="WHIT">
<span class='line'>3470</span> </span><span class="WHIT">	</span><span class="COMM">// "continuous" anchors: anchors that pick their location based on how many connections the given element has.</span><span class="WHIT">
<span class='line'>3471</span> </span><span class="WHIT">	</span><span class="COMM">// this requires looking at a lot more elements than normal - anything that has had a Continuous anchor applied has</span><span class="WHIT">
<span class='line'>3472</span> </span><span class="WHIT">	</span><span class="COMM">// to be recalculated.  so this manager is used as a reference point.  the first time, with a new timestamp, that</span><span class="WHIT">
<span class='line'>3473</span> </span><span class="WHIT">	</span><span class="COMM">// a continuous anchor is asked to compute, it calls this guy.  or maybe, even, this guy gets called somewhere else</span><span class="WHIT">
<span class='line'>3474</span> </span><span class="WHIT">	</span><span class="COMM">// and compute only ever returns pre-computed values.  either way, this is the central point, and we want it to</span><span class="WHIT">
<span class='line'>3475</span> </span><span class="WHIT">	</span><span class="COMM">// be called as few times as possible.</span><span class="WHIT">
<span class='line'>3476</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">continuousAnchors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3477</span> </span><span class="WHIT">        </span><span class="NAME">continuousAnchorLocations</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3478</span> </span><span class="WHIT">	    </span><span class="NAME">continuousAnchorOrientations</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3479</span> </span><span class="WHIT">	    </span><span class="NAME">Orientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">HORIZONTAL</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"horizontal"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">VERTICAL</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"vertical"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">DIAGONAL</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"diagonal"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">IDENTITY</span><span class="PUNC">:</span><span class="STRN">"identity"</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3480</span> </span><span class="WHIT">    </span><span class="WHIT">
<span class='line'>3481</span> </span><span class="WHIT">	</span><span class="COMM">// TODO this functions uses a crude method of determining orientation between two elements.</span><span class="WHIT">
<span class='line'>3482</span> </span><span class="WHIT">	</span><span class="COMM">// 'diagonal' should be chosen when the angle of the line between the two centers is around</span><span class="WHIT">
<span class='line'>3483</span> </span><span class="WHIT">	</span><span class="COMM">// one of 45, 135, 225 and 315 degrees. maybe +- 15 degrees.</span><span class="WHIT">
<span class='line'>3484</span> </span><span class="WHIT">	</span><span class="NAME">calculateOrientation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sd</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">td</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3485</span> 
<span class='line'>3486</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3487</span> </span><span class="WHIT">			</span><span class="NAME">orientation</span><span class="PUNC">:</span><span class="NAME">Orientation.IDENTITY</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3488</span> </span><span class="WHIT">			</span><span class="NAME">a</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="STRN">"top"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"top"</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>3489</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3490</span> 
<span class='line'>3491</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">theta</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.atan2</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">td.centery</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sd.centery</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">td.centerx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sd.centerx</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3492</span> </span><span class="WHIT">		    </span><span class="NAME">theta2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.atan2</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">sd.centery</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">td.centery</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sd.centerx</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">td.centerx</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3493</span> </span><span class="WHIT">		    </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">sd.left</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">td.left</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sd.right</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">td.left</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sd.left</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">td.right</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sd.right</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">td.right</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>3494</span> </span><span class="WHIT">			    </span><span class="PUNC">(</span><span class="NAME">sd.left</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">td.left</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sd.right</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">td.right</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">td.left</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">sd.left</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">td.right</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">sd.right</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3495</span> </span><span class="WHIT">		    </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">sd.top</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">td.top</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sd.bottom</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">td.top</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sd.top</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">td.bottom</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sd.bottom</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">td.bottom</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT">
<span class='line'>3496</span> </span><span class="WHIT">			    </span><span class="PUNC">(</span><span class="NAME">sd.top</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">td.top</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sd.bottom</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">td.bottom</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">td.top</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">sd.top</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">td.bottom</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">sd.bottom</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3497</span> 
<span class='line'>3498</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3499</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rls</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rrs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sortValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3500</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">td.left</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">sd.left</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">td.top</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">sd.top</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3501</span> </span><span class="WHIT">				</span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"top"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3502</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">td.left</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">sd.left</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">sd.top</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">td.top</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3503</span> </span><span class="WHIT">				</span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="STRN">"top"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3504</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">td.left</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sd.left</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">td.top</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sd.top</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3505</span> </span><span class="WHIT">				</span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="STRN">"top"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3506</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">td.left</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">sd.left</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">td.top</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">sd.top</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3507</span> </span><span class="WHIT">				</span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"top"</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3508</span> 
<span class='line'>3509</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">:</span><span class="NAME">Orientation.DIAGONAL</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">:</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">theta</span><span class="PUNC">:</span><span class="NAME">theta</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">theta2</span><span class="PUNC">:</span><span class="NAME">theta2</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3510</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3511</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3512</span> </span><span class="WHIT">			</span><span class="NAME">orientation</span><span class="PUNC">:</span><span class="NAME">Orientation.HORIZONTAL</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3513</span> </span><span class="WHIT">			</span><span class="NAME">a</span><span class="PUNC">:</span><span class="NAME">sd.top</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">td.top</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"bottom"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"top"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"top"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"bottom"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3514</span> </span><span class="WHIT">			</span><span class="NAME">theta</span><span class="PUNC">:</span><span class="NAME">theta</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">theta2</span><span class="PUNC">:</span><span class="NAME">theta2</span><span class="WHIT">
<span class='line'>3515</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3516</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3517</span> </span><span class="WHIT">			</span><span class="NAME">orientation</span><span class="PUNC">:</span><span class="NAME">Orientation.VERTICAL</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3518</span> </span><span class="WHIT">			</span><span class="NAME">a</span><span class="PUNC">:</span><span class="NAME">sd.left</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">td.left</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3519</span> </span><span class="WHIT">			</span><span class="NAME">theta</span><span class="PUNC">:</span><span class="NAME">theta</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">theta2</span><span class="PUNC">:</span><span class="NAME">theta2</span><span class="WHIT">
<span class='line'>3520</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3521</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3522</span> </span><span class="WHIT">	</span><span class="NAME">placeAnchorsOnLine</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">desc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementDimensions</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementPosition</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3523</span> </span><span class="WHIT">					</span><span class="NAME">connections</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">horizontal</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherMultiplier</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">reverse</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3524</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">step</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elementDimensions</span><span class="PUNC">[</span><span class="NAME">horizontal</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">connections.length</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3525</span> 
<span class='line'>3526</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">connections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3527</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">step</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">other</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">otherMultiplier</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">elementDimensions</span><span class="PUNC">[</span><span class="NAME">horizontal</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3528</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">reverse</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3529</span> </span><span class="WHIT">			  </span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elementDimensions</span><span class="PUNC">[</span><span class="NAME">horizontal</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">val</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3530</span> 
<span class='line'>3531</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">horizontal</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">other</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elementPosition</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NAME">xp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">elementDimensions</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3532</span> </span><span class="WHIT">			 	</span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">horizontal</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">other</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">val</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">elementPosition</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">yp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">elementDimensions</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3533</span> 
<span class='line'>3534</span> </span><span class="WHIT">			</span><span class="NAME">a.push</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">yp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3535</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3536</span> 
<span class='line'>3537</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3538</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3539</span> </span><span class="WHIT">	</span><span class="NAME">standardEdgeSort</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3540</span> </span><span class="WHIT">	</span><span class="NAME">currySort</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">reverseAngles</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3541</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3542</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3543</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">reverseAngles</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3544</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3545</span> </span><span class="WHIT">					</span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3546</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>3547</span> </span><span class="WHIT">					</span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3548</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3549</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3550</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3551</span> </span><span class="WHIT">					</span><span class="NAME">r</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3552</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>3553</span> </span><span class="WHIT">					</span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3554</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3555</span> </span><span class="WHIT">            </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3556</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3557</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3558</span> </span><span class="WHIT">	</span><span class="NAME">leftSort</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3559</span> </span><span class="WHIT">		</span><span class="COMM">// first get adjusted values</span><span class="WHIT">
<span class='line'>3560</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3561</span> </span><span class="WHIT">		</span><span class="NAME">p2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3562</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p1</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">p2</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3563</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3564</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3565</span> </span><span class="WHIT">	</span><span class="NAME">edgeSortFunctions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3566</span> </span><span class="WHIT">		</span><span class="STRN">"top"</span><span class="PUNC">:</span><span class="NAME">standardEdgeSort</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3567</span> </span><span class="WHIT">		</span><span class="STRN">"right"</span><span class="PUNC">:</span><span class="NAME">currySort</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3568</span> </span><span class="WHIT">		</span><span class="STRN">"bottom"</span><span class="PUNC">:</span><span class="NAME">currySort</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3569</span> </span><span class="WHIT">		</span><span class="STRN">"left"</span><span class="PUNC">:</span><span class="NAME">leftSort</span><span class="WHIT">
<span class='line'>3570</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3571</span> </span><span class="WHIT">    </span><span class="NAME">_sortHelper</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_array</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_fn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3572</span> </span><span class="WHIT">      </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_array.sort</span><span class="PUNC">(</span><span class="NAME">_fn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3573</span> </span><span class="WHIT">    </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3574</span> </span><span class="WHIT">	</span><span class="NAME">placeAnchors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_anchorLists</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3575</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sO</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3576</span> </span><span class="WHIT">		</span><span class="NAME">placeSomeAnchors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">desc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementDimensions</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementPosition</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">unsortedConnections</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isHorizontal</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherMultiplier</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3577</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">unsortedConnections.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3578</span> </span><span class="WHIT">			    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_sortHelper</span><span class="PUNC">(</span><span class="NAME">unsortedConnections</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">edgeSortFunctions</span><span class="PUNC">[</span><span class="NAME">desc</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// puts them in order based on the target element's pos on screen			    </span><span class="WHIT">
<span class='line'>3579</span> </span><span class="WHIT">				    </span><span class="NAME">reverse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">desc</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"right"</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">desc</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"top"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3580</span> </span><span class="WHIT">				    </span><span class="NAME">anchors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">placeAnchorsOnLine</span><span class="PUNC">(</span><span class="NAME">desc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementDimensions</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3581</span> </span><span class="WHIT">											 </span><span class="NAME">elementPosition</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sc</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3582</span> </span><span class="WHIT">											 </span><span class="NAME">isHorizontal</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherMultiplier</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">reverse</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3583</span> 
<span class='line'>3584</span> </span><span class="WHIT">			    </span><span class="COMM">// takes a computed anchor position and adjusts it for parent offset and scroll, then stores it.</span><span class="WHIT">
<span class='line'>3585</span> </span><span class="WHIT">			    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_setAnchorLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchorPos</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3586</span> </span><span class="WHIT">				    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">adjustForParentOffsetAndScroll</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">anchorPos</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchorPos</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpoint.canvas</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3587</span> </span><span class="WHIT">				    </span><span class="NAME">continuousAnchorLocations</span><span class="PUNC">[</span><span class="NAME">endpoint.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchorPos</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchorPos</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3588</span> </span><span class="WHIT">				    </span><span class="NAME">continuousAnchorOrientations</span><span class="PUNC">[</span><span class="NAME">endpoint.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">orientation</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3589</span> </span><span class="WHIT">			    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3590</span> 
<span class='line'>3591</span> </span><span class="WHIT">			    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">anchors.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3592</span> </span><span class="WHIT">				    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchors</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">weAreSource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">elementId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">weAreTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">elementId</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3593</span> </span><span class="WHIT">				    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">weAreSource</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3594</span> </span><span class="WHIT">					    </span><span class="NAME">_setAnchorLocation</span><span class="PUNC">(</span><span class="NAME">c.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchors</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3595</span> </span><span class="WHIT">				    </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">weAreTarget</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3596</span> </span><span class="WHIT">					    </span><span class="NAME">_setAnchorLocation</span><span class="PUNC">(</span><span class="NAME">c.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchors</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3597</span> </span><span class="WHIT">			    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3598</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3599</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3600</span> 
<span class='line'>3601</span> </span><span class="WHIT">		</span><span class="NAME">placeSomeAnchors</span><span class="PUNC">(</span><span class="STRN">"bottom"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">sO.left</span><span class="PUNC">,</span><span class="NAME">sO.top</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_anchorLists.bottom</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3602</span> </span><span class="WHIT">		</span><span class="NAME">placeSomeAnchors</span><span class="PUNC">(</span><span class="STRN">"top"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">sO.left</span><span class="PUNC">,</span><span class="NAME">sO.top</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_anchorLists.top</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3603</span> </span><span class="WHIT">		</span><span class="NAME">placeSomeAnchors</span><span class="PUNC">(</span><span class="STRN">"left"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">sO.left</span><span class="PUNC">,</span><span class="NAME">sO.top</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_anchorLists.left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3604</span> </span><span class="WHIT">		</span><span class="NAME">placeSomeAnchors</span><span class="PUNC">(</span><span class="STRN">"right"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">sO.left</span><span class="PUNC">,</span><span class="NAME">sO.top</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_anchorLists.right</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3605</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3606</span> </span><span class="WHIT">    </span><span class="NAME">AnchorManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3607</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_amEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3608</span> </span><span class="WHIT">			</span><span class="NAME">connectionsByElementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3609</span> </span><span class="WHIT">			</span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3610</span> </span><span class="WHIT">            </span><span class="NAME">anchorLists</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3611</span> 
<span class='line'>3612</span> </span><span class="WHIT">        </span><span class="NAME">this.reset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3613</span> </span><span class="WHIT">        	</span><span class="NAME">_amEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3614</span> </span><span class="WHIT">        	</span><span class="NAME">connectionsByElementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3615</span> </span><span class="WHIT">            </span><span class="NAME">anchorLists</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3616</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3617</span> </span><span class="WHIT"> 		</span><span class="NAME">this.newConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">conn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3618</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conn.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conn.targetId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3619</span> </span><span class="WHIT">				</span><span class="NAME">ep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conn.endpoints</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3620</span> </span><span class="WHIT">                </span><span class="NAME">doRegisterTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3621</span> </span><span class="WHIT">			    </span><span class="NAME">registerConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">otherIndex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3622</span> 
<span class='line'>3623</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">otherAnchor.isContinuous</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3624</span> </span><span class="WHIT">                       </span><span class="COMM">// remove the target endpoint's canvas.  we dont need it.</span><span class="WHIT">
<span class='line'>3625</span> </span><span class="WHIT">                        </span><span class="NAME">jsPlumb.CurrentLibrary.removeElement</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">canvas</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3626</span> </span><span class="WHIT">                        </span><span class="NAME">doRegisterTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3627</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3628</span> </span><span class="WHIT">					</span><span class="NAME">_addToList</span><span class="PUNC">(</span><span class="NAME">connectionsByElementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherAnchor.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">DynamicAnchor</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3629</span> </span><span class="WHIT">			    </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3630</span> 
<span class='line'>3631</span> </span><span class="WHIT">			</span><span class="NAME">registerConnection</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3632</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">doRegisterTarget</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3633</span> </span><span class="WHIT">            	</span><span class="NAME">registerConnection</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3634</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3635</span> </span><span class="WHIT">		</span><span class="NAME">this.connectionDetached</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">connInfo</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3636</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">connection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connInfo.connection</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">connInfo</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3637</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connection.sourceId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3638</span> </span><span class="WHIT">                </span><span class="NAME">targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connection.targetId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3639</span> </span><span class="WHIT">				</span><span class="NAME">ep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connection.endpoints</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3640</span> </span><span class="WHIT">				</span><span class="NAME">removeConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">otherIndex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3641</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">otherAnchor.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">FloatingAnchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3642</span> </span><span class="WHIT">						</span><span class="COMM">// no-op</span><span class="WHIT">
<span class='line'>3643</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3644</span> </span><span class="WHIT">					</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3645</span> </span><span class="WHIT">						</span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">connectionsByElementId</span><span class="PUNC">[</span><span class="NAME">elId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3646</span> </span><span class="WHIT">							</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_c</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3647</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3648</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3649</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3650</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3651</span> </span><span class="WHIT">			</span><span class="NAME">removeConnection</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3652</span> </span><span class="WHIT">			</span><span class="NAME">removeConnection</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3653</span> 
<span class='line'>3654</span> </span><span class="WHIT">            </span><span class="COMM">// remove from anchorLists</span><span class="WHIT">
<span class='line'>3655</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sEl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connection.sourceId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3656</span> </span><span class="WHIT">                </span><span class="NAME">tEl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connection.targetId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3657</span> </span><span class="WHIT">                </span><span class="NAME">sE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">connection.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3658</span> </span><span class="WHIT">                </span><span class="NAME">tE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connection.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3659</span> </span><span class="WHIT">                </span><span class="NAME">_remove</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3660</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">  </span><span class="COMM">// transient anchors dont get entries in this list.</span><span class="WHIT">
<span class='line'>3661</span> </span><span class="WHIT">                        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">eId</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3662</span> </span><span class="WHIT">                        </span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">[</span><span class="STRN">"top"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3663</span> </span><span class="WHIT">                        </span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">[</span><span class="STRN">"left"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3664</span> </span><span class="WHIT">                        </span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">[</span><span class="STRN">"bottom"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3665</span> </span><span class="WHIT">                        </span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">list</span><span class="PUNC">[</span><span class="STRN">"right"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3666</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3667</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3668</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>3669</span> </span><span class="WHIT">            </span><span class="NAME">_remove</span><span class="PUNC">(</span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">sEl</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sE</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3670</span> </span><span class="WHIT">            </span><span class="NAME">_remove</span><span class="PUNC">(</span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">tEl</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tE</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3671</span> </span><span class="WHIT">            </span><span class="NAME">self.redraw</span><span class="PUNC">(</span><span class="NAME">sEl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3672</span> </span><span class="WHIT">            </span><span class="NAME">self.redraw</span><span class="PUNC">(</span><span class="NAME">tEl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3673</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3674</span> </span><span class="WHIT">		</span><span class="NAME">this.add</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3675</span> </span><span class="WHIT">			</span><span class="NAME">_addToList</span><span class="PUNC">(</span><span class="NAME">_amEndpoints</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3676</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3677</span> </span><span class="WHIT">		</span><span class="NAME">this.changeId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">oldId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3678</span> </span><span class="WHIT">			</span><span class="NAME">connectionsByElementId</span><span class="PUNC">[</span><span class="NAME">newId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectionsByElementId</span><span class="PUNC">[</span><span class="NAME">oldId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3679</span> </span><span class="WHIT">			</span><span class="NAME">_amEndpoints</span><span class="PUNC">[</span><span class="NAME">newId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_amEndpoints</span><span class="PUNC">[</span><span class="NAME">oldId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3680</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">connectionsByElementId</span><span class="PUNC">[</span><span class="NAME">oldId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3681</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_amEndpoints</span><span class="PUNC">[</span><span class="NAME">oldId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3682</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3683</span> </span><span class="WHIT">		</span><span class="NAME">this.getConnectionsFor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3684</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">connectionsByElementId</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3685</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3686</span> </span><span class="WHIT">		</span><span class="NAME">this.getEndpointsFor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3687</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_amEndpoints</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3688</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3689</span> </span><span class="WHIT">		</span><span class="NAME">this.deleteEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3690</span> </span><span class="WHIT">			</span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">_amEndpoints</span><span class="PUNC">[</span><span class="NAME">endpoint.elementId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3691</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">endpoint.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3692</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3693</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3694</span> </span><span class="WHIT">		</span><span class="NAME">this.clearFor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3695</span> </span><span class="WHIT">			</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_amEndpoints</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3696</span> </span><span class="WHIT">			</span><span class="NAME">_amEndpoints</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3697</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3698</span> </span><span class="WHIT">        </span><span class="COMM">// updates the given anchor list by either updating an existing anchor's info, or adding it. this function</span><span class="WHIT">
<span class='line'>3699</span> </span><span class="WHIT">        </span><span class="COMM">// also removes the anchor from its previous list, if the edge it is on has changed.</span><span class="WHIT">
<span class='line'>3700</span> </span><span class="WHIT">        </span><span class="COMM">// all connections found along the way (those that are connected to one of the faces this function</span><span class="WHIT">
<span class='line'>3701</span> </span><span class="WHIT">        </span><span class="COMM">// operates on) are added to the connsToPaint list, as are their endpoints. in this way we know to repaint</span><span class="WHIT">
<span class='line'>3702</span> </span><span class="WHIT">        </span><span class="COMM">// them wthout having to calculate anything else about them.</span><span class="WHIT">
<span class='line'>3703</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_updateAnchorList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">lists</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">theta</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">order</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aBoolean</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherElId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">reverse</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">edgeId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointsToPaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3704</span> </span><span class="WHIT">            </span><span class="COMM">// first try to find the exact match, but keep track of the first index of a matching element id along the way.s</span><span class="WHIT">
<span class='line'>3705</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">exactIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3706</span> </span><span class="WHIT">                </span><span class="NAME">firstMatchingElIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3707</span> </span><span class="WHIT">                </span><span class="NAME">endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conn.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3708</span> </span><span class="WHIT">                </span><span class="NAME">endpointId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpoint.id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3709</span> </span><span class="WHIT">                </span><span class="NAME">oIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3710</span> </span><span class="WHIT">                </span><span class="NAME">values</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">theta</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">order</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">aBoolean</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherElId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointId</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3711</span> </span><span class="WHIT">                </span><span class="NAME">listToAddTo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">lists</span><span class="PUNC">[</span><span class="NAME">edgeId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3712</span> </span><span class="WHIT">                </span><span class="NAME">listToRemoveFrom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpoint._continuousAnchorEdge</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">lists</span><span class="PUNC">[</span><span class="NAME">endpoint._continuousAnchorEdge</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3713</span> 
<span class='line'>3714</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">listToRemoveFrom</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3715</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_findWithFunction</span><span class="PUNC">(</span><span class="NAME">listToRemoveFrom</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">[</span><span class="NUMB">4</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">endpointId</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3716</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rIdx</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3717</span> </span><span class="WHIT">                    </span><span class="NAME">listToRemoveFrom.splice</span><span class="PUNC">(</span><span class="NAME">rIdx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3718</span> </span><span class="WHIT">                    </span><span class="COMM">// get all connections from this list</span><span class="WHIT">
<span class='line'>3719</span> </span><span class="WHIT">                    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">listToRemoveFrom.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3720</span> </span><span class="WHIT">                        </span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">connsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listToRemoveFrom</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">listToRemoveFrom</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3721</span> </span><span class="WHIT">                        </span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">endpointsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listToRemoveFrom</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">listToRemoveFrom</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3722</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3723</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3724</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3725</span> 
<span class='line'>3726</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">listToAddTo.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3727</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">listToAddTo</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">otherElId</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">firstMatchingElIdx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3728</span> </span><span class="WHIT">                    </span><span class="NAME">firstMatchingElIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3729</span> </span><span class="WHIT">                </span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">connsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listToAddTo</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">listToAddTo</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>3730</span> </span><span class="WHIT">                </span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">endpointsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listToAddTo</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">listToAddTo</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3731</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3732</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">exactIdx</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3733</span> </span><span class="WHIT">                </span><span class="NAME">listToAddTo</span><span class="PUNC">[</span><span class="NAME">exactIdx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">values</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3734</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3735</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3736</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">insertIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">reverse</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">firstMatchingElIdx</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">firstMatchingElIdx</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">listToAddTo.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// of course we will get this from having looked through the array shortly.</span><span class="WHIT">
<span class='line'>3737</span> </span><span class="WHIT">                </span><span class="NAME">listToAddTo.splice</span><span class="PUNC">(</span><span class="NAME">insertIdx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">values</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3738</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3739</span> 
<span class='line'>3740</span> </span><span class="WHIT">            </span><span class="COMM">// store this for next time.</span><span class="WHIT">
<span class='line'>3741</span> </span><span class="WHIT">            </span><span class="NAME">endpoint._continuousAnchorEdge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">edgeId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3742</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3743</span> </span><span class="WHIT">		</span><span class="NAME">this.redraw</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">offsetToUI</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3744</span> </span><span class="WHIT">			</span><span class="COMM">// get all the endpoints for this element</span><span class="WHIT">
<span class='line'>3745</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_amEndpoints</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3746</span> </span><span class="WHIT">				</span><span class="NAME">endpointConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectionsByElementId</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3747</span> </span><span class="WHIT">				</span><span class="NAME">connectionsToPaint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3748</span> </span><span class="WHIT">				</span><span class="NAME">endpointsToPaint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3749</span> </span><span class="WHIT">                </span><span class="NAME">anchorsToUpdate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3750</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>3751</span> </span><span class="WHIT">			</span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_timestamp</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3752</span> </span><span class="WHIT">			</span><span class="COMM">// offsetToUI are values that would have been calculated in the dragManager when registering</span><span class="WHIT">
<span class='line'>3753</span> </span><span class="WHIT">			</span><span class="COMM">// an endpoint for an element that had a parent (somewhere in the hierarchy) that had been</span><span class="WHIT">
<span class='line'>3754</span> </span><span class="WHIT">			</span><span class="COMM">// registered as draggable.</span><span class="WHIT">
<span class='line'>3755</span> </span><span class="WHIT">			</span><span class="NAME">offsetToUI</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsetToUI</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3756</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ui</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3757</span> </span><span class="WHIT">				</span><span class="NAME">ui</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3758</span> </span><span class="WHIT">					</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NAME">ui.left</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetToUI.left</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3759</span> </span><span class="WHIT">					</span><span class="NAME">top</span><span class="PUNC">:</span><span class="NAME">ui.top</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">offsetToUI.top</span><span class="WHIT">
<span class='line'>3760</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3761</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3762</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3763</span> </span><span class="WHIT">			</span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3764</span> </span><span class="WHIT">			</span><span class="COMM">// valid for one paint cycle.</span><span class="WHIT">
<span class='line'>3765</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3766</span> </span><span class="WHIT">                </span><span class="NAME">myWH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3767</span> </span><span class="WHIT">                </span><span class="NAME">orientationCache</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3768</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3769</span> </span><span class="WHIT">			</span><span class="COMM">// actually, first we should compute the orientation of this element to all other elements to which</span><span class="WHIT">
<span class='line'>3770</span> </span><span class="WHIT">			</span><span class="COMM">// this element is connected with a continuous anchor (whether both ends of the connection have</span><span class="WHIT">
<span class='line'>3771</span> </span><span class="WHIT">			</span><span class="COMM">// a continuous anchor or just one)</span><span class="WHIT">
<span class='line'>3772</span> </span><span class="WHIT">            </span><span class="COMM">//for (var i = 0; i &lt; continuousAnchorConnections.length; i++) {</span><span class="WHIT">
<span class='line'>3773</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpointConnections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3774</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">conn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3775</span> </span><span class="WHIT">					</span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conn.sourceId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3776</span> </span><span class="WHIT">                    </span><span class="NAME">targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conn.targetId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3777</span> </span><span class="WHIT">                    </span><span class="NAME">sourceContinuous</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conn.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor.isContinuous</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3778</span> </span><span class="WHIT">                    </span><span class="NAME">targetContinuous</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conn.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor.isContinuous</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3779</span> 
<span class='line'>3780</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceContinuous</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">targetContinuous</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3781</span> </span><span class="WHIT">	                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3782</span> </span><span class="WHIT">	                    </span><span class="NAME">oKey2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"_"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3783</span> </span><span class="WHIT">	                    </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">orientationCache</span><span class="PUNC">[</span><span class="NAME">oKey</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3784</span> </span><span class="WHIT">	                    </span><span class="NAME">oIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">conn.sourceId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3785</span> 
<span class='line'>3786</span> </span><span class="WHIT">	                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceContinuous</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">sourceId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">sourceId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">right</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bottom</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">left</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3787</span> </span><span class="WHIT">	                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetContinuous</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">targetId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">targetId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">right</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">bottom</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">left</span><span class="PUNC">:</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3788</span> 
<span class='line'>3789</span> </span><span class="WHIT">	                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elementId</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3790</span> </span><span class="WHIT">	                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elementId</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3791</span> 
<span class='line'>3792</span> </span><span class="WHIT">	                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">td</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getCachedData</span><span class="PUNC">(</span><span class="NAME">targetId</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3793</span> </span><span class="WHIT">						</span><span class="NAME">sd</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getCachedData</span><span class="PUNC">(</span><span class="NAME">sourceId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3794</span> 
<span class='line'>3795</span> </span><span class="WHIT">	                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceContinuous</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">targetContinuous</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3796</span> </span><span class="WHIT">	                    </span><span class="COMM">// here we may want to improve this by somehow determining the face we'd like</span><span class="WHIT">
<span class='line'>3797</span> </span><span class="WHIT">					    </span><span class="COMM">// to put the connector on.  ideally, when drawing, the face should be calculated</span><span class="WHIT">
<span class='line'>3798</span> </span><span class="WHIT">					    </span><span class="COMM">// by determining which face is closest to the point at which the mouse button</span><span class="WHIT">
<span class='line'>3799</span> </span><span class="WHIT">						</span><span class="COMM">// was released.  for now, we're putting it on the top face.</span><span class="WHIT">
<span class='line'>3800</span> </span><span class="WHIT">	                    </span><span class="NAME">_updateAnchorList</span><span class="PUNC">(</span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">sourceId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">Math.PI</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"top"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectionsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointsToPaint</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3801</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3802</span> </span><span class="WHIT">	                </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3803</span> </span><span class="WHIT">	                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">o</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3804</span> </span><span class="WHIT">	                        </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">calculateOrientation</span><span class="PUNC">(</span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sd.o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">td.o</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3805</span> </span><span class="WHIT">	                        </span><span class="NAME">orientationCache</span><span class="PUNC">[</span><span class="NAME">oKey</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3806</span> </span><span class="WHIT">	                        </span><span class="COMM">// this would be a performance enhancement, but the computed angles need to be clamped to</span><span class="WHIT">
<span class='line'>3807</span> </span><span class="WHIT">	                        </span><span class="COMM">//the (-PI/2 -> PI/2) range in order for the sorting to work properly.</span><span class="WHIT">
<span class='line'>3808</span> </span><span class="WHIT">	                    </span><span class="COMM">/*  orientationCache[oKey2] = {
<span class='line'>3809</span> 	                            orientation:o.orientation,
<span class='line'>3810</span> 	                            a:[o.a[1], o.a[0]],
<span class='line'>3811</span> 	                            theta:o.theta + Math.PI,
<span class='line'>3812</span> 	                            theta2:o.theta2 + Math.PI
<span class='line'>3813</span> 	                        };*/</span><span class="WHIT">
<span class='line'>3814</span> </span><span class="WHIT">	                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3815</span> </span><span class="WHIT">	                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceContinuous</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_updateAnchorList</span><span class="PUNC">(</span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">sourceId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o.theta</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o.a</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectionsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointsToPaint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3816</span> </span><span class="WHIT">	                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetContinuous</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_updateAnchorList</span><span class="PUNC">(</span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">targetId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o.theta2</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o.a</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectionsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointsToPaint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3817</span> </span><span class="WHIT">	                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3818</span> 
<span class='line'>3819</span> </span><span class="WHIT">	                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sourceContinuous</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">anchorsToUpdate</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">sourceId</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3820</span> </span><span class="WHIT">	                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetContinuous</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">anchorsToUpdate</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">targetId</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3821</span> </span><span class="WHIT">	                </span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">connectionsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">conn.id</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3822</span> </span><span class="WHIT">	                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">sourceContinuous</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">oIdx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">targetContinuous</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">oIdx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3823</span> </span><span class="WHIT">	                	</span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">endpointsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">conn.endpoints</span><span class="PUNC">[</span><span class="NAME">oIdx</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">conn.endpoints</span><span class="PUNC">[</span><span class="NAME">oIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3824</span> </span><span class="WHIT">	            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3825</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3826</span> 
<span class='line'>3827</span> </span><span class="WHIT">            </span><span class="COMM">// now place all the continuous anchors we need to;</span><span class="WHIT">
<span class='line'>3828</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">anchorsToUpdate.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3829</span> </span><span class="WHIT">				</span><span class="NAME">placeAnchors</span><span class="PUNC">(</span><span class="NAME">anchorsToUpdate</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchorLists</span><span class="PUNC">[</span><span class="NAME">anchorsToUpdate</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3830</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3831</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>3832</span> </span><span class="WHIT">			</span><span class="COMM">// now that continuous anchors have been placed, paint all the endpoints for this element</span><span class="WHIT">
<span class='line'>3833</span> </span><span class="WHIT">            </span><span class="COMM">// TODO performance: add the endpoint ids to a temp array, and then when iterating in the next</span><span class="WHIT">
<span class='line'>3834</span> </span><span class="WHIT">            </span><span class="COMM">// loop, check that we didn't just paint that endpoint. we can probably shave off a few more milliseconds this way.</span><span class="WHIT">
<span class='line'>3835</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">ep.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3836</span> </span><span class="WHIT">				</span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">paint</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myOffset</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myWH</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3837</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3838</span> </span><span class="WHIT">            </span><span class="COMM">// ... and any other endpoints we came across as a result of the continuous anchors.</span><span class="WHIT">
<span class='line'>3839</span> </span><span class="WHIT">            </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpointsToPaint.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3840</span> </span><span class="WHIT">				</span><span class="NAME">endpointsToPaint</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">paint</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myOffset</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dimensions</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myWH</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3841</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3842</span> 
<span class='line'>3843</span> </span><span class="WHIT">			</span><span class="COMM">// paint all the standard and "dynamic connections", which are connections whose other anchor is</span><span class="WHIT">
<span class='line'>3844</span> </span><span class="WHIT">			</span><span class="COMM">// static and therefore does need to be recomputed; we make sure that happens only one time.</span><span class="WHIT">
<span class='line'>3845</span> 
<span class='line'>3846</span> </span><span class="WHIT">			</span><span class="COMM">// TODO we could have compiled a list of these in the first pass through connections; might save some time.</span><span class="WHIT">
<span class='line'>3847</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">endpointConnections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3848</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">otherEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpointConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3849</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">otherEndpoint.anchor.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">DynamicAnchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			 							</span><span class="WHIT">
<span class='line'>3850</span> </span><span class="WHIT">					</span><span class="NAME">otherEndpoint.paint</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elementWithPrecedence</span><span class="PUNC">:</span><span class="NAME">elementId</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>3851</span> </span><span class="WHIT">                    </span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">connectionsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">endpointConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3852</span> </span><span class="WHIT">					</span><span class="COMM">// all the connections for the other endpoint now need to be repainted</span><span class="WHIT">
<span class='line'>3853</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">otherEndpoint.connections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">k</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3854</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">otherEndpoint.connections</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">endpointConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>3855</span> </span><span class="WHIT">                            </span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">connectionsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherEndpoint.connections</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">otherEndpoint.connections</span><span class="PUNC">[</span><span class="NAME">k</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3856</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3857</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">otherEndpoint.anchor.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">Anchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>3858</span> </span><span class="WHIT">                    </span><span class="NAME">_addWithFunction</span><span class="PUNC">(</span><span class="NAME">connectionsToPaint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">endpointConnections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3859</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3860</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3861</span> </span><span class="WHIT">			</span><span class="COMM">// paint current floating connection for this element, if there is one.</span><span class="WHIT">
<span class='line'>3862</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">floatingConnections</span><span class="PUNC">[</span><span class="NAME">elementId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3863</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3864</span> </span><span class="WHIT">				</span><span class="NAME">fc.paint</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="PUNC">:</span><span class="NAME">elementId</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3865</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3866</span> </span><span class="WHIT">			</span><span class="COMM">// paint all the connections</span><span class="WHIT">
<span class='line'>3867</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">connectionsToPaint.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3868</span> </span><span class="WHIT">				</span><span class="NAME">connectionsToPaint</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">paint</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">elId</span><span class="PUNC">:</span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3869</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3870</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3871</span> </span><span class="WHIT">		</span><span class="NAME">this.rehomeEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">currentId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3872</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">eps</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_amEndpoints</span><span class="PUNC">[</span><span class="NAME">currentId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//, </span><span class="WHIT">
<span class='line'>3873</span> </span><span class="WHIT">				</span><span class="NAME">elementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getId</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3874</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">eps.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3875</span> </span><span class="WHIT">				</span><span class="NAME">self.add</span><span class="PUNC">(</span><span class="NAME">eps</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3876</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3877</span> </span><span class="WHIT">			</span><span class="NAME">eps.splice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eps.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3878</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3879</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3880</span> </span><span class="WHIT">	</span><span class="NAME">_currentInstance.anchorManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">AnchorManager</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3881</span> </span><span class="WHIT">	</span><span class="NAME">_currentInstance.continuousAnchorFactory</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3882</span> </span><span class="WHIT">		</span><span class="NAME">get</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3883</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">existing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">continuousAnchors</span><span class="PUNC">[</span><span class="NAME">params.elementId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3884</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">existing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3885</span> </span><span class="WHIT">				</span><span class="NAME">existing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3886</span> </span><span class="WHIT">					</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">"Continuous"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3887</span> </span><span class="WHIT">					</span><span class="NAME">compute</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3888</span> </span><span class="WHIT">						</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">continuousAnchorLocations</span><span class="PUNC">[</span><span class="NAME">params.element.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3889</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3890</span> </span><span class="WHIT">					</span><span class="NAME">getCurrentLocation</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3891</span> </span><span class="WHIT">						</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">continuousAnchorLocations</span><span class="PUNC">[</span><span class="NAME">endpoint.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3892</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3893</span> </span><span class="WHIT">					</span><span class="NAME">getOrientation</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3894</span> </span><span class="WHIT">						</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">continuousAnchorOrientations</span><span class="PUNC">[</span><span class="NAME">endpoint.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3895</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3896</span> </span><span class="WHIT">					</span><span class="NAME">isDynamic</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3897</span> </span><span class="WHIT">					</span><span class="NAME">isContinuous</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="WHIT">
<span class='line'>3898</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3899</span> </span><span class="WHIT">				</span><span class="NAME">continuousAnchors</span><span class="PUNC">[</span><span class="NAME">params.elementId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">existing</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3900</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3901</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">existing</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3902</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3903</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3904</span> 
<span class='line'>3905</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>3906</span> 		Manages dragging for some instance of jsPlumb.  
<span class='line'>3907</span> 
<span class='line'>3908</span> 	*/</span><span class="WHIT">
<span class='line'>3909</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">DragManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3910</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3911</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_draggables</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_dlist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_delements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_elementsWithEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3912</span> 
<span class='line'>3913</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>3914</span> 			register some element as draggable.  right now the drag init stuff is done elsewhere, and it is
<span class='line'>3915</span> 			possible that will continue to be the case.
<span class='line'>3916</span> 		*/</span><span class="WHIT">
<span class='line'>3917</span> </span><span class="WHIT">		</span><span class="NAME">this.register</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3918</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jpcl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3919</span> </span><span class="WHIT">			</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3920</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3921</span> </span><span class="WHIT">				</span><span class="NAME">domEl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getDOMElement</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3922</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">_draggables</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3923</span> </span><span class="WHIT">				</span><span class="NAME">_draggables</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">el</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3924</span> </span><span class="WHIT">				</span><span class="NAME">_dlist.push</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3925</span> </span><span class="WHIT">				</span><span class="NAME">_delements</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3926</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3927</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>3928</span> </span><span class="WHIT">			</span><span class="COMM">// look for child elements that have endpoints and register them against this draggable.</span><span class="WHIT">
<span class='line'>3929</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_oneLevel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3930</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pEl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getElementObject</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3931</span> </span><span class="WHIT">					</span><span class="NAME">pOff</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getOffset</span><span class="PUNC">(</span><span class="NAME">pEl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3932</span> 
<span class='line'>3933</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">p.childNodes.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3934</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p.childNodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nodeType</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">3</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3935</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cEl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getElementObject</span><span class="PUNC">(</span><span class="NAME">p.childNodes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3936</span> </span><span class="WHIT">							</span><span class="NAME">cid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getId</span><span class="PUNC">(</span><span class="NAME">cEl</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3937</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cid</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_elementsWithEndpoints</span><span class="PUNC">[</span><span class="NAME">cid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">_elementsWithEndpoints</span><span class="PUNC">[</span><span class="NAME">cid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3938</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cOff</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getOffset</span><span class="PUNC">(</span><span class="NAME">cEl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3939</span> </span><span class="WHIT">							</span><span class="NAME">_delements</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">cid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3940</span> </span><span class="WHIT">								</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">cid</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3941</span> </span><span class="WHIT">								</span><span class="NAME">offset</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3942</span> </span><span class="WHIT">									</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NAME">cOff.left</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">pOff.left</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3943</span> </span><span class="WHIT">									</span><span class="NAME">top</span><span class="PUNC">:</span><span class="NAME">cOff.top</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">pOff.top</span><span class="WHIT">
<span class='line'>3944</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3945</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3946</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3947</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3948</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3949</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3950</span> 
<span class='line'>3951</span> </span><span class="WHIT">			</span><span class="NAME">_oneLevel</span><span class="PUNC">(</span><span class="NAME">domEl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3952</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3953</span> 
<span class='line'>3954</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>3955</span> 			notification that an endpoint was added to the given el.  we go up from that el's parent
<span class='line'>3956</span> 			node, looking for a parent that has been registered as a draggable. if we find one, we add this
<span class='line'>3957</span> 			el to that parent's list of elements to update on drag (if it is not there already)
<span class='line'>3958</span> 		*/</span><span class="WHIT">
<span class='line'>3959</span> </span><span class="WHIT">		</span><span class="NAME">this.endpointAdded</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3960</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jpcl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">b</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.body</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getDOMElement</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3961</span> </span><span class="WHIT">				</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c.parentNode</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">done</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3962</span> 
<span class='line'>3963</span> </span><span class="WHIT">			</span><span class="NAME">_elementsWithEndpoints</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_elementsWithEndpoints</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_elementsWithEndpoints</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3964</span> 
<span class='line'>3965</span> </span><span class="WHIT">			</span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3966</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.getId</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3967</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_draggables</span><span class="PUNC">[</span><span class="NAME">pid</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3968</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pEl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getElementObject</span><span class="PUNC">(</span><span class="NAME">p</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pLoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getOffset</span><span class="PUNC">(</span><span class="NAME">pEl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3969</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>3970</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_delements</span><span class="PUNC">[</span><span class="NAME">pid</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3971</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cLoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getOffset</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3972</span> </span><span class="WHIT">						</span><span class="NAME">_delements</span><span class="PUNC">[</span><span class="NAME">pid</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3973</span> </span><span class="WHIT">							</span><span class="NAME">id</span><span class="PUNC">:</span><span class="NAME">id</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3974</span> </span><span class="WHIT">							</span><span class="NAME">offset</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3975</span> </span><span class="WHIT">								</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NAME">cLoc.left</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">pLoc.left</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>3976</span> </span><span class="WHIT">								</span><span class="NAME">top</span><span class="PUNC">:</span><span class="NAME">cLoc.top</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">pLoc.top</span><span class="WHIT">
<span class='line'>3977</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3978</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3979</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3980</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3981</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3982</span> </span><span class="WHIT">				</span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">p.parentNode</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3983</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3984</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3985</span> 
<span class='line'>3986</span> </span><span class="WHIT">		</span><span class="NAME">this.endpointDeleted</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3987</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_elementsWithEndpoints</span><span class="PUNC">[</span><span class="NAME">endpoint.elementId</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3988</span> </span><span class="WHIT">				</span><span class="NAME">_elementsWithEndpoints</span><span class="PUNC">[</span><span class="NAME">endpoint.elementId</span><span class="PUNC">]</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3989</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_elementsWithEndpoints</span><span class="PUNC">[</span><span class="NAME">endpoint.elementId</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3990</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">_delements</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3991</span> </span><span class="WHIT">						</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">_delements</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">endpoint.elementId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3992</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3993</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3994</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>3995</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3996</span> 
<span class='line'>3997</span> </span><span class="WHIT">		</span><span class="NAME">this.getElementsForDraggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3998</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_delements</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3999</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4000</span> 
<span class='line'>4001</span> </span><span class="WHIT">		</span><span class="NAME">this.reset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4002</span> </span><span class="WHIT">			</span><span class="NAME">_draggables</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4003</span> </span><span class="WHIT">			</span><span class="NAME">_dlist</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4004</span> </span><span class="WHIT">			</span><span class="NAME">_delements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4005</span> </span><span class="WHIT">			</span><span class="NAME">_elementsWithEndpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4006</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4007</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>4008</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4009</span> </span><span class="WHIT">	</span><span class="NAME">_currentInstance.dragManager</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">DragManager</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4010</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>4011</span> 
<span class='line'>4012</span> 
<span class='line'>4013</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>4014</span> 		 * Class: Connection
<span class='line'>4015</span> 		 * The connecting line between two Endpoints.
<span class='line'>4016</span> 		 */</span><span class="WHIT">
<span class='line'>4017</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>4018</span> 		 * Function: Connection
<span class='line'>4019</span> 		 * Connection constructor. You should not ever create one of these directly.
<span class='line'>4020</span> 		 * 
<span class='line'>4021</span> 		 * Parameters:
<span class='line'>4022</span> 		 * 	source 	- either an element id, a selector for an element, or an Endpoint.
<span class='line'>4023</span> 		 * 	target	- either an element id, a selector for an element, or an Endpoint
<span class='line'>4024</span> 		 * 	scope	- scope descriptor for this connection. optional.
<span class='line'>4025</span> 		 *  container - optional id or selector instructing jsPlumb where to attach all the elements it creates for this connection.  you should read the documentation for a full discussion of this.
<span class='line'>4026</span> 		 *  detachable - optional, defaults to true. Defines whether or not the connection may be detached using the mouse.
<span class='line'>4027</span> 		 *  endpoint - Optional. Endpoint definition to use for both ends of the connection.
<span class='line'>4028</span> 		 *  endpoints - Optional. Array of two Endpoint definitions, one for each end of the Connection. This and 'endpoint' are mutually exclusive parameters.
<span class='line'>4029</span> 		 *  endpointStyle - Optional. Endpoint style definition to use for both ends of the Connection.
<span class='line'>4030</span> 		 *  endpointStyles - Optional. Array of two Endpoint style definitions, one for each end of the Connection. This and 'endpoint' are mutually exclusive parameters.
<span class='line'>4031</span> 		 *  paintStyle - Parameters defining the appearance of the Connection. Optional; jsPlumb will use the defaults if you supply nothing here.
<span class='line'>4032</span> 		 *  hoverPaintStyle - Parameters defining the appearance of the Connection when the mouse is hovering over it. Optional; jsPlumb will use the defaults if you supply nothing here (note that the default hoverPaintStyle is null).
<span class='line'>4033</span> 		 *  overlays - Optional array of Overlay definitions to appear on this Connection.
<span class='line'>4034</span> 		 *  drawEndpoints - if false, instructs jsPlumb to not draw the endpoints for this Connection.  Be careful with this: it only really works when you tell jsPlumb to attach elements to the document body. Read the documentation for a full discussion of this. 
<span class='line'>4035</span> 		 *  parameters - Optional JS object containing parameters to set on the Connection. These parameters are then available via the getParameter method.
<span class='line'>4036</span> 		 */</span><span class="WHIT">
<span class='line'>4037</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Connection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4038</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">visible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4039</span> </span><span class="WHIT">			</span><span class="NAME">self.idPrefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"_jsplumb_c_"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4040</span> </span><span class="WHIT">			</span><span class="NAME">self.defaultLabelLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4041</span> </span><span class="WHIT">			</span><span class="NAME">self.defaultOverlayKeys</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"Overlays"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"ConnectionOverlays"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4042</span> </span><span class="WHIT">			</span><span class="NAME">this.parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.parent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4043</span> </span><span class="WHIT">			</span><span class="NAME">overlayCapableJsPlumbUIComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4044</span> </span><span class="WHIT">			</span><span class="COMM">// ************** get the source and target and register the connection. *******************</span><span class="WHIT">
<span class='line'>4045</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4046</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>4047</span> 				Function:isVisible
<span class='line'>4048</span> 				Returns whether or not the Connection is currently visible.
<span class='line'>4049</span> 			*/</span><span class="WHIT">
<span class='line'>4050</span> </span><span class="WHIT">			</span><span class="NAME">this.isVisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">visible</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4051</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>4052</span> 				Function: setVisible
<span class='line'>4053</span> 				Sets whether or not the Connection should be visible.
<span class='line'>4054</span> 
<span class='line'>4055</span> 				Parameters:
<span class='line'>4056</span> 					visible - boolean indicating desired visible state.
<span class='line'>4057</span> 			*/</span><span class="WHIT">
<span class='line'>4058</span> </span><span class="WHIT">			</span><span class="NAME">this.setVisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4059</span> </span><span class="WHIT">				</span><span class="NAME">visible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4060</span> </span><span class="WHIT">				</span><span class="NAME">self</span><span class="PUNC">[</span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"showOverlays"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"hideOverlays"</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4061</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connector</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">self.connector.canvas</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.connector.canvas.style.display</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"block"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4062</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4063</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4064</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>4065</span> 				Property: source
<span class='line'>4066</span> 				The source element for this Connection.
<span class='line'>4067</span> 			*/</span><span class="WHIT">
<span class='line'>4068</span> </span><span class="WHIT">			</span><span class="NAME">this.source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">params.source</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4069</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>4070</span> 				Property:target
<span class='line'>4071</span> 				The target element for this Connection.
<span class='line'>4072</span> 			*/</span><span class="WHIT">
<span class='line'>4073</span> </span><span class="WHIT">			</span><span class="NAME">this.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">params.target</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4074</span> </span><span class="WHIT">			</span><span class="COMM">// sourceEndpoint and targetEndpoint override source/target, if they are present. but </span><span class="WHIT">
<span class='line'>4075</span> </span><span class="WHIT">			</span><span class="COMM">// source is not overridden if the Endpoint has declared it is not the final target of a connection;</span><span class="WHIT">
<span class='line'>4076</span> </span><span class="WHIT">			</span><span class="COMM">// instead we use the source that the Endpoint declares will be the final source element.</span><span class="WHIT">
<span class='line'>4077</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.sourceEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4078</span> </span><span class="WHIT">				</span><span class="NAME">this.source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.sourceEndpoint.endpointWillMoveTo</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">params.sourceEndpoint.getElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4079</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4080</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.targetEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.targetEndpoint.getElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4081</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4082</span> </span><span class="WHIT">			</span><span class="COMM">// if a new connection is the result of moving some existing connection, params.previousConnection</span><span class="WHIT">
<span class='line'>4083</span> </span><span class="WHIT">			</span><span class="COMM">// will have that Connection in it. listeners for the jsPlumbConnection event can look for that</span><span class="WHIT">
<span class='line'>4084</span> </span><span class="WHIT">			</span><span class="COMM">// member and take action if they need to.</span><span class="WHIT">
<span class='line'>4085</span> </span><span class="WHIT">			</span><span class="NAME">self.previousConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.previousConnection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4086</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4087</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_cost</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.cost</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4088</span> </span><span class="WHIT">			</span><span class="NAME">self.getCost</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_cost</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4089</span> </span><span class="WHIT">			</span><span class="NAME">self.setCost</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">_cost</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4090</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4091</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_bidirectional</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.bidirectional</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4092</span> </span><span class="WHIT">			</span><span class="NAME">self.isBidirectional</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_bidirectional</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4093</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4094</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4095</span> 			 * Property: sourceId
<span class='line'>4096</span> 			 * Id of the source element in the connection.
<span class='line'>4097</span> 			 */</span><span class="WHIT">
<span class='line'>4098</span> </span><span class="WHIT">			</span><span class="NAME">this.sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">this.source</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4099</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4100</span> 			 * Property: targetId
<span class='line'>4101</span> 			 * Id of the target element in the connection.
<span class='line'>4102</span> 			 */</span><span class="WHIT">
<span class='line'>4103</span> </span><span class="WHIT">			</span><span class="NAME">this.targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">this.target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4104</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4105</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>4106</span> 			 * implementation of abstract method in jsPlumbUtil.EventGenerator
<span class='line'>4107</span> 			 * @return list of attached elements. in our case, a list of Endpoints.
<span class='line'>4108</span> 			 */</span><span class="WHIT">
<span class='line'>4109</span> </span><span class="WHIT">			</span><span class="NAME">this.getAttachedElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4110</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self.endpoints</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4111</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4112</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4113</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4114</span> 			 * Property: scope
<span class='line'>4115</span> 			 * Optional scope descriptor for the connection.
<span class='line'>4116</span> 			 */</span><span class="WHIT">
<span class='line'>4117</span> </span><span class="WHIT">			</span><span class="NAME">this.scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.scope</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// scope may have been passed in to the connect call. if it wasn't, we will pull it from the source endpoint, after having initialised the endpoints. </span><span class="WHIT">
<span class='line'>4118</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4119</span> 			 * Property: endpoints
<span class='line'>4120</span> 			 * Array of [source, target] Endpoint objects.
<span class='line'>4121</span> 			 */</span><span class="WHIT">
<span class='line'>4122</span> </span><span class="WHIT">			</span><span class="NAME">this.endpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4123</span> </span><span class="WHIT">			</span><span class="NAME">this.endpointStyles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4124</span> </span><span class="WHIT">			</span><span class="COMM">// wrapped the main function to return null if no input given. this lets us cascade defaults properly.</span><span class="WHIT">
<span class='line'>4125</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_makeAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchorParams</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4126</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">anchorParams</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4127</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_currentInstance.makeAnchor</span><span class="PUNC">(</span><span class="NAME">anchorParams</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4128</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4129</span> </span><span class="WHIT">			</span><span class="NAME">prepareEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">existing</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectorPaintStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectorHoverPaintStyle</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4130</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">existing</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4131</span> </span><span class="WHIT">					</span><span class="NAME">self.endpoints</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">existing</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4132</span> </span><span class="WHIT">					</span><span class="NAME">existing.addConnection</span><span class="PUNC">(</span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4133</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4134</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">params.endpoints</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">params.endpoints</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4135</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.endpoints</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4136</span> </span><span class="WHIT">					        </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">params.endpoint</span><span class="WHIT">
<span class='line'>4137</span> </span><span class="WHIT">							</span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.Endpoints</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>4138</span> </span><span class="WHIT">							</span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.Endpoints</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT">
<span class='line'>4139</span> </span><span class="WHIT">							</span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.Endpoint</span><span class="WHIT">
<span class='line'>4140</span> </span><span class="WHIT">							</span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.Endpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4141</span> 
<span class='line'>4142</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">params.endpointStyles</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">params.endpointStyles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4143</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">params.endpointHoverStyles</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">params.endpointHoverStyles</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4144</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">es</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.endpointStyles</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">params.endpointStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.EndpointStyles</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.EndpointStyles</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.EndpointStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.EndpointStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4145</span> </span><span class="WHIT">					</span><span class="COMM">// Endpoints derive their fillStyle from the connector's strokeStyle, if no fillStyle was specified.</span><span class="WHIT">
<span class='line'>4146</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">es.fillStyle</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">connectorPaintStyle</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4147</span> </span><span class="WHIT">						</span><span class="NAME">es.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectorPaintStyle.strokeStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4148</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4149</span> </span><span class="WHIT">					</span><span class="COMM">// TODO: decide if the endpoint should derive the connection's outline width and color.  currently it does:</span><span class="WHIT">
<span class='line'>4150</span> </span><span class="WHIT">					</span><span class="COMM">//*</span><span class="WHIT">
<span class='line'>4151</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">es.outlineColor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">connectorPaintStyle</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4152</span> </span><span class="WHIT">						</span><span class="NAME">es.outlineColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectorPaintStyle.outlineColor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4153</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">es.outlineWidth</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">connectorPaintStyle</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4154</span> </span><span class="WHIT">						</span><span class="NAME">es.outlineWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectorPaintStyle.outlineWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4155</span> </span><span class="WHIT">					</span><span class="COMM">//*/</span><span class="WHIT">
<span class='line'>4156</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4157</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ehs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.endpointHoverStyles</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">params.endpointHoverStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.EndpointHoverStyles</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.EndpointHoverStyles</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.EndpointHoverStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.EndpointHoverStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4158</span> </span><span class="WHIT">					</span><span class="COMM">// endpoint hover fill style is derived from connector's hover stroke style.  TODO: do we want to do this by default? for sure?</span><span class="WHIT">
<span class='line'>4159</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">connectorHoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4160</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ehs</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">ehs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4161</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ehs.fillStyle</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4162</span> </span><span class="WHIT">							</span><span class="NAME">ehs.fillStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connectorHoverPaintStyle.strokeStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4163</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4164</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4165</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.anchors</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">params.anchors</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4166</span> </span><span class="WHIT">						</span><span class="NAME">params.anchor</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">params.anchor</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4167</span> </span><span class="WHIT">						</span><span class="NAME">_makeAnchor</span><span class="PUNC">(</span><span class="NAME">_currentInstance.Defaults.Anchors</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4168</span> </span><span class="WHIT">						</span><span class="NAME">_makeAnchor</span><span class="PUNC">(</span><span class="NAME">jsPlumb.Defaults.Anchors</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4169</span> </span><span class="WHIT">						</span><span class="NAME">_makeAnchor</span><span class="PUNC">(</span><span class="NAME">_currentInstance.Defaults.Anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4170</span> </span><span class="WHIT">						</span><span class="NAME">_makeAnchor</span><span class="PUNC">(</span><span class="NAME">jsPlumb.Defaults.Anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">elementId</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4171</span> </span><span class="WHIT">					</span><span class="NAME">u</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.uuids</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">params.uuids</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4172</span> </span><span class="WHIT">					</span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_newEndpoint</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4173</span> </span><span class="WHIT">						</span><span class="NAME">paintStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">es</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4174</span> </span><span class="WHIT">						</span><span class="NAME">hoverPaintStyle</span><span class="PUNC">:</span><span class="NAME">ehs</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4175</span> </span><span class="WHIT">						</span><span class="NAME">endpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4176</span> </span><span class="WHIT">						</span><span class="NAME">connections</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4177</span> </span><span class="WHIT">						</span><span class="NAME">uuid</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4178</span> </span><span class="WHIT">						</span><span class="NAME">anchor</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4179</span> </span><span class="WHIT">						</span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4180</span> </span><span class="WHIT">						</span><span class="NAME">scope</span><span class="WHIT">  </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">params.scope</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4181</span> </span><span class="WHIT">						</span><span class="NAME">container</span><span class="PUNC">:</span><span class="NAME">params.container</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4182</span> </span><span class="WHIT">						</span><span class="NAME">reattach</span><span class="PUNC">:</span><span class="NAME">params.reattach</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4183</span> </span><span class="WHIT">                        </span><span class="NAME">detachable</span><span class="PUNC">:</span><span class="NAME">params.detachable</span><span class="WHIT">
<span class='line'>4184</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4185</span> </span><span class="WHIT">					</span><span class="NAME">self.endpoints</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4186</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4187</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4188</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.drawEndpoints</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">e.setVisible</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4189</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4190</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4191</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4192</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4193</span> 
<span class='line'>4194</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">eS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prepareEndpoint</span><span class="PUNC">(</span><span class="NAME">params.sourceEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4195</span> </span><span class="WHIT">									 </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4196</span> </span><span class="WHIT">									 </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4197</span> </span><span class="WHIT">									 </span><span class="NAME">self.source</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4198</span> </span><span class="WHIT">									 </span><span class="NAME">self.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4199</span> </span><span class="WHIT">									 </span><span class="NAME">params.paintStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4200</span> </span><span class="WHIT">									 </span><span class="NAME">params.hoverPaintStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4201</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eS</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_addToList</span><span class="PUNC">(</span><span class="NAME">endpointsByElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eS</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4202</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4203</span> </span><span class="WHIT">			</span><span class="COMM">// if there were no endpoints supplied and the source element is the target element, we will reuse the source</span><span class="WHIT">
<span class='line'>4204</span> </span><span class="WHIT">			</span><span class="COMM">// endpoint that was just created.</span><span class="WHIT">
<span class='line'>4205</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">existingTargetEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">self.sourceId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">self.targetId</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">params.targetEndpoint</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">eS</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">params.targetEndpoint</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4206</span> </span><span class="WHIT">				</span><span class="NAME">eT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">prepareEndpoint</span><span class="PUNC">(</span><span class="NAME">existingTargetEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4207</span> </span><span class="WHIT">									 </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4208</span> </span><span class="WHIT">									 </span><span class="NAME">params</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4209</span> </span><span class="WHIT">									 </span><span class="NAME">self.target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4210</span> </span><span class="WHIT">									 </span><span class="NAME">self.targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4211</span> </span><span class="WHIT">									 </span><span class="NAME">params.paintStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4212</span> </span><span class="WHIT">									 </span><span class="NAME">params.hoverPaintStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4213</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">eT</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_addToList</span><span class="PUNC">(</span><span class="NAME">endpointsByElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eT</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4214</span> </span><span class="WHIT">			</span><span class="COMM">// if scope not set, set it to be the scope for the source endpoint.</span><span class="WHIT">
<span class='line'>4215</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.scope</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">scope</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>4216</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4217</span> </span><span class="WHIT">			</span><span class="COMM">// if delete endpoints on detach, keep a record of just exactly which endpoints they are.</span><span class="WHIT">
<span class='line'>4218</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.deleteEndpointsOnDetach</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4219</span> </span><span class="WHIT">				</span><span class="NAME">self.endpointsToDeleteOnDetach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">eS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eT</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4220</span> 
<span class='line'>4221</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_detachable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.ConnectionsDetachable</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4222</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.detachable</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_detachable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4223</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">self.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connectionsDetachable</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_detachable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4224</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">self.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connectionsDetachable</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_detachable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4225</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>4226</span> </span><span class="WHIT">            </span><span class="COMM">// inherit connectin cost if it was set on source endpoint</span><span class="WHIT">
<span class='line'>4227</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_cost</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_cost</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getConnectionCost</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4228</span> </span><span class="WHIT">            </span><span class="COMM">// inherit bidirectional flag if set no source endpoint</span><span class="WHIT">
<span class='line'>4229</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.bidirectional</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_bidirectional</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">areConnectionsBidirectional</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4230</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>4231</span> </span><span class="WHIT">            </span><span class="COMM">/*
<span class='line'>4232</span>                 Function: isDetachable
<span class='line'>4233</span>                 Returns whether or not this connection can be detached from its target/source endpoint.  by default this
<span class='line'>4234</span>                 is false; use it in conjunction with the 'reattach' parameter.
<span class='line'>4235</span>              */</span><span class="WHIT">
<span class='line'>4236</span> </span><span class="WHIT">            </span><span class="NAME">this.isDetachable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4237</span> </span><span class="WHIT">                </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_detachable</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4238</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4239</span> 
<span class='line'>4240</span> </span><span class="WHIT">            </span><span class="COMM">/*
<span class='line'>4241</span>                 Function: setDetachable
<span class='line'>4242</span>                 Sets whether or not this connection is detachable.
<span class='line'>4243</span>              */</span><span class="WHIT">
<span class='line'>4244</span> </span><span class="WHIT">            </span><span class="NAME">this.setDetachable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">detachable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4245</span> </span><span class="WHIT">              </span><span class="NAME">_detachable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">detachable</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4246</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4247</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4248</span> </span><span class="WHIT">			</span><span class="COMM">// merge all the parameters objects into the connection.  parameters set</span><span class="WHIT">
<span class='line'>4249</span> </span><span class="WHIT">			</span><span class="COMM">// on the connection take precedence; then target endpoint params, then</span><span class="WHIT">
<span class='line'>4250</span> </span><span class="WHIT">			</span><span class="COMM">// finally source endpoint params.</span><span class="WHIT">
<span class='line'>4251</span> </span><span class="WHIT">			</span><span class="COMM">// TODO jsPlumb.extend could be made to take more than two args, and it would</span><span class="WHIT">
<span class='line'>4252</span> </span><span class="WHIT">			</span><span class="COMM">// apply the second through nth args in order.</span><span class="WHIT">
<span class='line'>4253</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getParameters</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4254</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">_p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getParameters</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4255</span> </span><span class="WHIT">			</span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">_p</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.getParameters</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4256</span> </span><span class="WHIT">			</span><span class="NAME">self.setParameters</span><span class="PUNC">(</span><span class="NAME">_p</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4257</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4258</span> </span><span class="WHIT">			</span><span class="COMM">// override setHover to pass it down to the underlying connector</span><span class="WHIT">
<span class='line'>4259</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_sh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.setHover</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4260</span> 
<span class='line'>4261</span> </span><span class="WHIT">			</span><span class="NAME">self.setHover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4262</span> </span><span class="WHIT">				</span><span class="NAME">self.connector.setHover.apply</span><span class="PUNC">(</span><span class="NAME">self.connector</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4263</span> </span><span class="WHIT">				</span><span class="NAME">_sh.apply</span><span class="PUNC">(</span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4264</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4265</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4266</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_internalHover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4267</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_connectionBeingDragged</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4268</span> </span><span class="WHIT">					</span><span class="NAME">self.setHover</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4269</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4270</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>4271</span> 
<span class='line'>4272</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4273</span> 			 * Function: setConnector
<span class='line'>4274</span> 			 * Sets the Connection's connector (eg "Bezier", "Flowchart", etc).  You pass a Connector definition into this method - the same
<span class='line'>4275</span> 			 * thing that you would set as the 'connector' property on a jsPlumb.connect call.
<span class='line'>4276</span> 			 * 
<span class='line'>4277</span> 			 * Parameters:
<span class='line'>4278</span> 			 * 	connector		-	Connector definition
<span class='line'>4279</span> 			 */</span><span class="WHIT">
<span class='line'>4280</span> </span><span class="WHIT">			</span><span class="NAME">this.setConnector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">connector</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4281</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connector</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_removeElements</span><span class="PUNC">(</span><span class="NAME">self.connector.getDisplayElements</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4282</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">connectorArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4283</span> </span><span class="WHIT">					</span><span class="NAME">_jsPlumb</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4284</span> </span><span class="WHIT">					</span><span class="NAME">parent</span><span class="PUNC">:</span><span class="NAME">params.parent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4285</span> </span><span class="WHIT">					</span><span class="NAME">cssClass</span><span class="PUNC">:</span><span class="NAME">params.cssClass</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4286</span> </span><span class="WHIT">					</span><span class="NAME">container</span><span class="PUNC">:</span><span class="NAME">params.container</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4287</span> </span><span class="WHIT">					</span><span class="NAME">tooltip</span><span class="PUNC">:</span><span class="NAME">self.tooltip</span><span class="WHIT">
<span class='line'>4288</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4289</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isString</span><span class="PUNC">(</span><span class="NAME">connector</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4290</span> </span><span class="WHIT">					</span><span class="NAME">this.connector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Connectors</span><span class="PUNC">[</span><span class="NAME">renderMode</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">connector</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">connectorArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// lets you use a string as shorthand.</span><span class="WHIT">
<span class='line'>4291</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isArray</span><span class="PUNC">(</span><span class="NAME">connector</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4292</span> </span><span class="WHIT">					</span><span class="NAME">this.connector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Connectors</span><span class="PUNC">[</span><span class="NAME">renderMode</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">connector</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">connector</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectorArgs</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4293</span> </span><span class="WHIT">				</span><span class="NAME">self.canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.connector.canvas</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4294</span> </span><span class="WHIT">				</span><span class="COMM">// binds mouse listeners to the current connector.</span><span class="WHIT">
<span class='line'>4295</span> </span><span class="WHIT">				</span><span class="NAME">_bindListeners</span><span class="PUNC">(</span><span class="NAME">self.connector</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_internalHover</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4296</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">doNotRepaint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4297</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4298</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4299</span> 			 * Property: connector
<span class='line'>4300</span> 			 * The underlying Connector for this Connection (eg. a Bezier connector, straight line connector, flowchart connector etc)
<span class='line'>4301</span> 			 */</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4302</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>4303</span> </span><span class="WHIT">			</span><span class="NAME">self.setConnector</span><span class="PUNC">(</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connector</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4304</span> </span><span class="WHIT">							  </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connector</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4305</span> </span><span class="WHIT">							  </span><span class="NAME">params.connector</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4306</span> </span><span class="WHIT">							  </span><span class="NAME">_currentInstance.Defaults.Connector</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4307</span> </span><span class="WHIT">							  </span><span class="NAME">jsPlumb.Defaults.Connector</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">							  							  		</span><span class="WHIT">
<span class='line'>4308</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4309</span> </span><span class="WHIT">			</span><span class="NAME">this.setPaintStyle</span><span class="PUNC">(</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connectorStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4310</span> </span><span class="WHIT">							   </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connectorStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4311</span> </span><span class="WHIT">							   </span><span class="NAME">params.paintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4312</span> </span><span class="WHIT">							   </span><span class="NAME">_currentInstance.Defaults.PaintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4313</span> </span><span class="WHIT">							   </span><span class="NAME">jsPlumb.Defaults.PaintStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4314</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>4315</span> </span><span class="WHIT">			</span><span class="NAME">this.setHoverPaintStyle</span><span class="PUNC">(</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connectorHoverStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4316</span> </span><span class="WHIT">									</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connectorHoverStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4317</span> </span><span class="WHIT">									</span><span class="NAME">params.hoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4318</span> </span><span class="WHIT">									</span><span class="NAME">_currentInstance.Defaults.HoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4319</span> </span><span class="WHIT">									</span><span class="NAME">jsPlumb.Defaults.HoverPaintStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4320</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4321</span> </span><span class="WHIT">			</span><span class="NAME">this.paintStyleInUse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getPaintStyle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4322</span> </span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>4323</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4324</span> </span><span class="WHIT">			</span><span class="NAME">this.moveParent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">newParent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4325</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jpcl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curParent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getParent</span><span class="PUNC">(</span><span class="NAME">self.connector.canvas</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4326</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connector.bgCanvas</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4327</span> </span><span class="WHIT">				    </span><span class="NAME">jpcl.removeElement</span><span class="PUNC">(</span><span class="NAME">self.connector.bgCanvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curParent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4328</span> </span><span class="WHIT">				    </span><span class="NAME">jpcl.appendElement</span><span class="PUNC">(</span><span class="NAME">self.connector.bgCanvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newParent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4329</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4330</span> </span><span class="WHIT">				</span><span class="NAME">jpcl.removeElement</span><span class="PUNC">(</span><span class="NAME">self.connector.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curParent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4331</span> </span><span class="WHIT">				</span><span class="NAME">jpcl.appendElement</span><span class="PUNC">(</span><span class="NAME">self.connector.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newParent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">                </span><span class="WHIT">
<span class='line'>4332</span> </span><span class="WHIT">                </span><span class="COMM">// this only applies for DOMOverlays</span><span class="WHIT">
<span class='line'>4333</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.overlays.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4334</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isAppendedAtTopLevel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4335</span> </span><span class="WHIT">					    </span><span class="NAME">jpcl.removeElement</span><span class="PUNC">(</span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curParent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4336</span> </span><span class="WHIT">					    </span><span class="NAME">jpcl.appendElement</span><span class="PUNC">(</span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newParent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4337</span> </span><span class="WHIT">					    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">reattachListeners</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4338</span> </span><span class="WHIT">					    	</span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">reattachListeners</span><span class="PUNC">(</span><span class="NAME">self.connector</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4339</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4340</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4341</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connector.reattachListeners</span><span class="PUNC">)</span><span class="WHIT">		</span><span class="COMM">// this is for SVG/VML; change an element's parent and you have to reinit its listeners.</span><span class="WHIT">
<span class='line'>4342</span> </span><span class="WHIT">					</span><span class="NAME">self.connector.reattachListeners</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">     </span><span class="COMM">// the Canvas implementation doesn't have to care about this</span><span class="WHIT">
<span class='line'>4343</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4344</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4345</span> </span><span class="COMM">// ***************************** PLACEHOLDERS FOR NATURAL DOCS *************************************************</span><span class="WHIT">
<span class='line'>4346</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4347</span> 			 * Function: bind
<span class='line'>4348</span> 			 * Bind to an event on the Connection.  
<span class='line'>4349</span> 			 * 
<span class='line'>4350</span> 			 * Parameters:
<span class='line'>4351</span> 			 * 	event - the event to bind.  Available events on a Connection are:
<span class='line'>4352</span> 			 *         - *click*						:	notification that a Connection was clicked.  
<span class='line'>4353</span> 			 *         - *dblclick*						:	notification that a Connection was double clicked.
<span class='line'>4354</span> 			 *         - *mouseenter*					:	notification that the mouse is over a Connection. 
<span class='line'>4355</span> 			 *         - *mouseexit*					:	notification that the mouse exited a Connection.
<span class='line'>4356</span> 			 * 		   - *contextmenu*                  :   notification that the user right-clicked on the Connection.
<span class='line'>4357</span> 			 *         
<span class='line'>4358</span> 			 *  callback - function to callback. This function will be passed the Connection that caused the event, and also the original event.    
<span class='line'>4359</span> 			 */</span><span class="WHIT">
<span class='line'>4360</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4361</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4362</span> 		     * Function: setPaintStyle
<span class='line'>4363</span> 		     * Sets the Connection's paint style and then repaints the Connection.
<span class='line'>4364</span> 		     * 
<span class='line'>4365</span> 		     * Parameters:
<span class='line'>4366</span> 		     * 	style - Style to use.
<span class='line'>4367</span> 		     */</span><span class="WHIT">
<span class='line'>4368</span> 
<span class='line'>4369</span> </span><span class="WHIT">		     </span><span class="COMM">/*
<span class='line'>4370</span> 		     * Function: getPaintStyle
<span class='line'>4371</span> 		     * Gets the Connection's paint style. This is not necessarily the paint style in use at the time;
<span class='line'>4372</span> 		     * this is the paint style for the connection when the mouse it not hovering over it.
<span class='line'>4373</span> 		     */</span><span class="WHIT">
<span class='line'>4374</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4375</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4376</span> 		     * Function: setHoverPaintStyle
<span class='line'>4377</span> 		     * Sets the paint style to use when the mouse is hovering over the Connection. This is null by default.
<span class='line'>4378</span> 		     * The hover paint style is applied as extensions to the paintStyle; it does not entirely replace
<span class='line'>4379</span> 		     * it.  This is because people will most likely want to change just one thing when hovering, say the
<span class='line'>4380</span> 		     * color for example, but leave the rest of the appearance the same.
<span class='line'>4381</span> 		     * 
<span class='line'>4382</span> 		     * Parameters:
<span class='line'>4383</span> 		     * 	style - Style to use when the mouse is hovering.
<span class='line'>4384</span> 		     *  doNotRepaint - if true, the Connection will not be repainted.  useful when setting things up initially.
<span class='line'>4385</span> 		     */</span><span class="WHIT">
<span class='line'>4386</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4387</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4388</span> 		     * Function: setHover
<span class='line'>4389</span> 		     * Sets/unsets the hover state of this Connection.
<span class='line'>4390</span> 		     * 
<span class='line'>4391</span> 		     * Parameters:
<span class='line'>4392</span> 		     * 	hover - hover state boolean
<span class='line'>4393</span> 		     * 	ignoreAttachedElements - if true, does not notify any attached elements of the change in hover state.  used mostly to avoid infinite loops.
<span class='line'>4394</span> 		     */</span><span class="WHIT">
<span class='line'>4395</span> 
<span class='line'>4396</span> </span><span class="WHIT">		     </span><span class="COMM">/*
<span class='line'>4397</span> 		     * Function: getParameter
<span class='line'>4398</span> 		     * Gets the named parameter; returns null if no parameter with that name is set. Parameter values may have been supplied to a 'connect' or 'addEndpoint' call (connections made with the mouse get a copy of all parameters set on each of their Endpoints), or the parameter value may have been set with setParameter.
<span class='line'>4399</span> 		     *
<span class='line'>4400</span> 		     * Parameters:
<span class='line'>4401</span> 		     *   key - Parameter name.
<span class='line'>4402</span> 		     */</span><span class="WHIT">
<span class='line'>4403</span> 
<span class='line'>4404</span> </span><span class="WHIT">		     </span><span class="COMM">/*
<span class='line'>4405</span> 		     * Function: setParameter
<span class='line'>4406</span> 		     * Sets the named parameter to the given value.
<span class='line'>4407</span> 		     *
<span class='line'>4408</span> 		     * Parameters:
<span class='line'>4409</span> 		     *   key - Parameter name.
<span class='line'>4410</span> 		     *   value - Parameter value.
<span class='line'>4411</span> 		     */</span><span class="WHIT">
<span class='line'>4412</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4413</span> </span><span class="COMM">// ***************************** END OF PLACEHOLDERS FOR NATURAL DOCS *************************************************												</span><span class="WHIT">
<span class='line'>4414</span> 
<span class='line'>4415</span> </span><span class="WHIT">			</span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.sourceId</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4416</span> </span><span class="WHIT">			</span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.targetId</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4417</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4418</span> </span><span class="WHIT">			</span><span class="COMM">// paint the endpoints</span><span class="WHIT">
<span class='line'>4419</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">myOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">this.sourceId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myWH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">this.sourceId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4420</span> </span><span class="WHIT">				</span><span class="NAME">otherOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">this.targetId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4421</span> </span><span class="WHIT">				</span><span class="NAME">otherWH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">this.targetId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4422</span> </span><span class="WHIT">				</span><span class="NAME">initialTimestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_timestamp</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4423</span> </span><span class="WHIT">				</span><span class="NAME">anchorLoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor.compute</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4424</span> </span><span class="WHIT">					</span><span class="NAME">xy</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">myOffset.left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myOffset.top</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myWH</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4425</span> </span><span class="WHIT">					</span><span class="NAME">elementId</span><span class="PUNC">:</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4426</span> </span><span class="WHIT">					</span><span class="NAME">txy</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">otherOffset.left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherOffset.top</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">twh</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">otherWH</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tElement</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4427</span> </span><span class="WHIT">					</span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">initialTimestamp</span><span class="WHIT">
<span class='line'>4428</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4429</span> 
<span class='line'>4430</span> </span><span class="WHIT">			</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">paint</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">anchorLoc</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">anchorLoc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">initialTimestamp</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4431</span> 
<span class='line'>4432</span> </span><span class="WHIT">			</span><span class="NAME">anchorLoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor.compute</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4433</span> </span><span class="WHIT">				</span><span class="NAME">xy</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">otherOffset.left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">otherOffset.top</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">otherWH</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4434</span> </span><span class="WHIT">				</span><span class="NAME">elementId</span><span class="PUNC">:</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">elementId</span><span class="PUNC">,</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4435</span> </span><span class="WHIT">				</span><span class="NAME">txy</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">myOffset.left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">myOffset.top</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">twh</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">myWH</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tElement</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4436</span> </span><span class="WHIT">				</span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">initialTimestamp</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4437</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4438</span> </span><span class="WHIT">			</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">paint</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">anchorLoc</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">anchorLoc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">initialTimestamp</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">										    		  		    	    		  </span><span class="WHIT">
<span class='line'>4439</span> </span><span class="WHIT">		    </span><span class="WHIT">
<span class='line'>4440</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4441</span> 			 * Paints the Connection.  Not exposed for public usage. 
<span class='line'>4442</span> 			 * 
<span class='line'>4443</span> 			 * Parameters:
<span class='line'>4444</span> 			 * 	elId - Id of the element that is in motion.
<span class='line'>4445</span> 			 * 	ui - current library's event system ui object (present if we came from a drag to get here).
<span class='line'>4446</span> 			 *  recalc - whether or not to recalculate all anchors etc before painting. 
<span class='line'>4447</span> 			 *  timestamp - timestamp of this paint.  If the Connection was last painted with the same timestamp, it does not paint again.
<span class='line'>4448</span> 			 */</span><span class="WHIT">
<span class='line'>4449</span> </span><span class="WHIT">			</span><span class="NAME">this.paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4450</span> </span><span class="WHIT">				</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4451</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.elId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.ui</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.recalc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.timestamp</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4452</span> </span><span class="WHIT">				</span><span class="COMM">// if the moving object is not the source we must transpose the two references.</span><span class="WHIT">
<span class='line'>4453</span> </span><span class="WHIT">				</span><span class="NAME">swap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4454</span> </span><span class="WHIT">				</span><span class="NAME">tId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">swap</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.sourceId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">swap</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.targetId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.sourceId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4455</span> </span><span class="WHIT">				</span><span class="NAME">tIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">swap</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">swap</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4456</span> 
<span class='line'>4457</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sourceInfo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">ui</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4458</span> </span><span class="WHIT">					</span><span class="NAME">targetInfo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">tId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// update the target if this is a forced repaint. otherwise, only the source has been moved.</span><span class="WHIT">
<span class='line'>4459</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4460</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NAME">sIdx</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tE</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NAME">tIdx</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4461</span> </span><span class="WHIT">					</span><span class="NAME">sAnchorP</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sE.anchor.getCurrentLocation</span><span class="PUNC">(</span><span class="NAME">sE</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4462</span> </span><span class="WHIT">					</span><span class="NAME">tAnchorP</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">tE.anchor.getCurrentLocation</span><span class="PUNC">(</span><span class="NAME">tE</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4463</span> 
<span class='line'>4464</span> </span><span class="WHIT">				</span><span class="COMM">/* paint overlays*/</span><span class="WHIT">
<span class='line'>4465</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4466</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.overlays.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4467</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4468</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o.isVisible</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">maxSize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">maxSize</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">o.computeMaxSize</span><span class="PUNC">(</span><span class="NAME">self.connector</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4469</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4470</span> 
<span class='line'>4471</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.connector.compute</span><span class="PUNC">(</span><span class="NAME">sAnchorP</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">tAnchorP</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4472</span> </span><span class="WHIT">				</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NAME">sIdx</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NAME">tIdx</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4473</span> </span><span class="WHIT">				</span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NAME">sIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.endpoints</span><span class="PUNC">[</span><span class="NAME">tIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4474</span> </span><span class="WHIT">				</span><span class="NAME">self.paintStyleInUse.lineWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">maxSize</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4475</span> </span><span class="WHIT">				</span><span class="NAME">sourceInfo</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4476</span> </span><span class="WHIT">				</span><span class="NAME">targetInfo</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4477</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4478</span> </span><span class="WHIT">				</span><span class="NAME">self.connector.paint</span><span class="PUNC">(</span><span class="NAME">dim</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.paintStyleInUse</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4479</span> 
<span class='line'>4480</span> </span><span class="WHIT">				</span><span class="COMM">/* paint overlays*/</span><span class="WHIT">
<span class='line'>4481</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.overlays.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4482</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4483</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o.isVisible</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.overlayPlacements</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">o.draw</span><span class="PUNC">(</span><span class="NAME">self.connector</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.paintStyleInUse</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dim</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4484</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4485</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4486</span> 
<span class='line'>4487</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4488</span> 			 * Function: repaint
<span class='line'>4489</span> 			 * Repaints the Connection.
<span class='line'>4490</span> 			 */</span><span class="WHIT">
<span class='line'>4491</span> </span><span class="WHIT">			</span><span class="NAME">this.repaint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4492</span> </span><span class="WHIT">				</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4493</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">params.recalc</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4494</span> </span><span class="WHIT">				</span><span class="NAME">this.paint</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">params.timestamp</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4495</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4496</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4497</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4498</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>4499</span> </span><span class="COMM">// ENDPOINT HELPER FUNCTIONS</span><span class="WHIT">
<span class='line'>4500</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_makeConnectionDragHandler</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">placeholder</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4501</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">stopped</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4502</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4503</span> 
<span class='line'>4504</span> </span><span class="WHIT">				</span><span class="NAME">drag</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4505</span> </span><span class="WHIT">                	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">stopped</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4506</span> </span><span class="WHIT">                		</span><span class="NAME">stopped</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4507</span> </span><span class="WHIT">	                	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4508</span> </span><span class="WHIT">	                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4509</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_ui</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getUIPosition</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4510</span> </span><span class="WHIT">					</span><span class="NAME">el</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">placeholder.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4511</span> </span><span class="WHIT">                	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4512</span> </span><span class="WHIT">				    	</span><span class="NAME">jsPlumb.CurrentLibrary.setOffset</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_ui</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4513</span> </span><span class="WHIT">				    	</span><span class="NAME">_draw</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_ui</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4514</span> </span><span class="WHIT">                	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4515</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4516</span> </span><span class="WHIT">                </span><span class="NAME">stopDrag</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4517</span> </span><span class="WHIT">                    </span><span class="NAME">stopped</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4518</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4519</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4520</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>4521</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>4522</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_makeFloatingEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">paintStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceCanvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sourceElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4523</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">floatingAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">FloatingAnchor</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">reference</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">referenceAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">referenceCanvas</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">referenceCanvas</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4524</span> 
<span class='line'>4525</span> </span><span class="WHIT">            </span><span class="COMM">//setting the scope here should not be the way to fix that mootools issue.  it should be fixed by not</span><span class="WHIT">
<span class='line'>4526</span> </span><span class="WHIT">            </span><span class="COMM">// adding the floating endpoint as a droppable.  that makes more sense anyway!</span><span class="WHIT">
<span class='line'>4527</span> </span><span class="WHIT">            </span><span class="WHIT">
<span class='line'>4528</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_newEndpoint</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">paintStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">paintStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">endpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">anchor</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">floatingAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">sourceElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">:</span><span class="STRN">"__floating"</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4529</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4530</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>4531</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>4532</span> 		 * creates a placeholder div for dragging purposes, adds it to the DOM, and pre-computes its offset. then returns
<span class='line'>4533</span> 		 * both the element id and a selector for the element.
<span class='line'>4534</span> 		 */</span><span class="WHIT">
<span class='line'>4535</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_makeDraggablePlaceholder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">placeholder</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4536</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">n</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.createElement</span><span class="PUNC">(</span><span class="STRN">"div"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4537</span> </span><span class="WHIT">			</span><span class="NAME">n.style.position</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"absolute"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4538</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">placeholderDragElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4539</span> </span><span class="WHIT">			</span><span class="NAME">_appendElement</span><span class="PUNC">(</span><span class="NAME">n</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4540</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">placeholderDragElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4541</span> </span><span class="WHIT">			</span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4542</span> </span><span class="WHIT">			</span><span class="COMM">// create and assign an id, and initialize the offset.</span><span class="WHIT">
<span class='line'>4543</span> </span><span class="WHIT">			</span><span class="NAME">placeholder.id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4544</span> </span><span class="WHIT">			</span><span class="NAME">placeholder.element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">placeholderDragElement</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4545</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4546</span> 
<span class='line'>4547</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>4548</span> 		 * Class: Endpoint 
<span class='line'>4549</span> 		 * 
<span class='line'>4550</span> 		 * Models an endpoint. Can have 1 to 'maxConnections' Connections emanating from it (set maxConnections to -1 
<span class='line'>4551</span> 		 * to allow unlimited).  Typically, if you use 'jsPlumb.connect' to programmatically connect two elements, you won't
<span class='line'>4552</span> 		 * actually deal with the underlying Endpoint objects.  But if you wish to support drag and drop Connections, one of the ways you
<span class='line'>4553</span> 		 * do so is by creating and registering Endpoints using 'jsPlumb.addEndpoint', and marking these Endpoints as 'source' and/or
<span class='line'>4554</span> 		 * 'target' Endpoints for Connections.  
<span class='line'>4555</span> 		 * 
<span class='line'>4556</span> 		 * 
<span class='line'>4557</span> 		 */</span><span class="WHIT">
<span class='line'>4558</span> 
<span class='line'>4559</span> </span><span class="WHIT">		</span><span class="COMM">/*
<span class='line'>4560</span> 		 * Function: Endpoint 
<span class='line'>4561</span> 		 * 
<span class='line'>4562</span> 		 * Endpoint constructor.
<span class='line'>4563</span> 		 * 
<span class='line'>4564</span> 		 * Parameters: 
<span class='line'>4565</span> 		 * anchor - definition of the Anchor for the endpoint.  You can include one or more Anchor definitions here; if you include more than one, jsPlumb creates a 'dynamic' Anchor, ie. an Anchor which changes position relative to the other elements in a Connection.  Each Anchor definition can be either a string nominating one of the basic Anchors provided by jsPlumb (eg. "TopCenter"), or a four element array that designates the Anchor's location and orientation (eg, and this is equivalent to TopCenter, [ 0.5, 0, 0, -1 ]).  To provide more than one Anchor definition just put them all in an array. You can mix string definitions with array definitions.
<span class='line'>4566</span> 		 * endpoint - optional Endpoint definition. This takes the form of either a string nominating one of the basic Endpoints provided by jsPlumb (eg. "Rectangle"), or an array containing [name,params] for those cases where you don't wish to use the default values, eg. [ "Rectangle", { width:5, height:10 } ].
<span class='line'>4567</span> 		 * enabled - optional, defaults to true. Indicates whether or not the Endpoint should be enabled for mouse events (drag/drop).
<span class='line'>4568</span> 		 * paintStyle - endpoint style, a js object. may be null. 
<span class='line'>4569</span> 		 * hoverPaintStyle - style to use when the mouse is hovering over the Endpoint. A js object. may be null; defaults to null. 
<span class='line'>4570</span> 		 * source - element the Endpoint is attached to, of type String (an element id) or element selector. Required.
<span class='line'>4571</span> 		 * canvas - canvas element to use. may be, and most often is, null.
<span class='line'>4572</span> 		 * container - optional id or selector instructing jsPlumb where to attach the element it creates for this endpoint.  you should read the documentation for a full discussion of this.
<span class='line'>4573</span> 		 * connections - optional list of Connections to configure the Endpoint with. 
<span class='line'>4574</span> 		 * isSource - boolean. indicates the endpoint can act as a source of new connections. Optional; defaults to false.
<span class='line'>4575</span> 		 * maxConnections - integer; defaults to 1.  a value of -1 means no upper limit. 
<span class='line'>4576</span> 		 * dragOptions - if isSource is set to true, you can supply arguments for the underlying library's drag method. Optional; defaults to null. 
<span class='line'>4577</span> 		 * connectorStyle - if isSource is set to true, this is the paint style for Connections from this Endpoint. Optional; defaults to null.
<span class='line'>4578</span> 		 * connectorHoverStyle - if isSource is set to true, this is the hover paint style for Connections from this Endpoint. Optional; defaults to null.
<span class='line'>4579</span> 		 * connector - optional Connector type to use.  Like 'endpoint', this may be either a single string nominating a known Connector type (eg. "Bezier", "Straight"), or an array containing [name, params], eg. [ "Bezier", { curviness:160 } ].
<span class='line'>4580</span> 		 * connectorOverlays - optional array of Overlay definitions that will be applied to any Connection from this Endpoint. 
<span class='line'>4581</span> 		 * connectionsDetachable - optional, defaults to true. Sets whether connections to/from this Endpoint should be detachable or not.
<span class='line'>4582</span> 		 * isTarget - boolean. indicates the endpoint can act as a target of new connections. Optional; defaults to false.
<span class='line'>4583</span> 		 * dropOptions - if isTarget is set to true, you can supply arguments for the underlying library's drop method with this parameter. Optional; defaults to null. 
<span class='line'>4584</span> 		 * reattach - optional boolean that determines whether or not the Connections reattach after they have been dragged off an Endpoint and left floating. defaults to false: Connections dropped in this way will just be deleted.
<span class='line'>4585</span> 		 * parameters - Optional JS object containing parameters to set on the Endpoint. These parameters are then available via the getParameter method.  When a connection is made involving this Endpoint, the parameters from this Endpoint are copied into that Connection. Source Endpoint parameters override target Endpoint parameters if they both have a parameter with the same name.
<span class='line'>4586</span> 		 */</span><span class="WHIT">
<span class='line'>4587</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4588</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4589</span> </span><span class="WHIT">			</span><span class="NAME">self.idPrefix</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"_jsplumb_e_"</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4590</span> </span><span class="WHIT">			</span><span class="NAME">self.defaultLabelLocation</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4591</span> </span><span class="WHIT">			</span><span class="NAME">self.defaultOverlayKeys</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"Overlays"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"EndpointOverlays"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4592</span> </span><span class="WHIT">			</span><span class="NAME">this.parent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.parent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4593</span> </span><span class="WHIT">			</span><span class="NAME">overlayCapableJsPlumbUIComponent.apply</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4594</span> </span><span class="WHIT">			</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4595</span> 
<span class='line'>4596</span> </span><span class="COMM">// ***************************** PLACEHOLDERS FOR NATURAL DOCS *************************************************</span><span class="WHIT">
<span class='line'>4597</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4598</span> 			 * Function: bind
<span class='line'>4599</span> 			 * Bind to an event on the Endpoint.  
<span class='line'>4600</span> 			 * 
<span class='line'>4601</span> 			 * Parameters:
<span class='line'>4602</span> 			 * 	event - the event to bind.  Available events on an Endpoint are:
<span class='line'>4603</span> 			 *         - *click*						:	notification that a Endpoint was clicked.  
<span class='line'>4604</span> 			 *         - *dblclick*						:	notification that a Endpoint was double clicked.
<span class='line'>4605</span> 			 *         - *mouseenter*					:	notification that the mouse is over a Endpoint. 
<span class='line'>4606</span> 			 *         - *mouseexit*					:	notification that the mouse exited a Endpoint.
<span class='line'>4607</span> 			 * 		   - *contextmenu*                  :   notification that the user right-clicked on the Endpoint.
<span class='line'>4608</span> 			 *         
<span class='line'>4609</span> 			 *  callback - function to callback. This function will be passed the Endpoint that caused the event, and also the original event.    
<span class='line'>4610</span> 			 */</span><span class="WHIT">
<span class='line'>4611</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4612</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4613</span> 		     * Function: setPaintStyle
<span class='line'>4614</span> 		     * Sets the Endpoint's paint style and then repaints the Endpoint.
<span class='line'>4615</span> 		     * 
<span class='line'>4616</span> 		     * Parameters:
<span class='line'>4617</span> 		     * 	style - Style to use.
<span class='line'>4618</span> 		     */</span><span class="WHIT">
<span class='line'>4619</span> 
<span class='line'>4620</span> </span><span class="WHIT">		     </span><span class="COMM">/*
<span class='line'>4621</span> 		     * Function: getPaintStyle
<span class='line'>4622</span> 		     * Gets the Endpoint's paint style. This is not necessarily the paint style in use at the time;
<span class='line'>4623</span> 		     * this is the paint style for the Endpoint when the mouse it not hovering over it.
<span class='line'>4624</span> 		     */</span><span class="WHIT">
<span class='line'>4625</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4626</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4627</span> 		     * Function: setHoverPaintStyle
<span class='line'>4628</span> 		     * Sets the paint style to use when the mouse is hovering over the Endpoint. This is null by default.
<span class='line'>4629</span> 		     * The hover paint style is applied as extensions to the paintStyle; it does not entirely replace
<span class='line'>4630</span> 		     * it.  This is because people will most likely want to change just one thing when hovering, say the
<span class='line'>4631</span> 		     * color for example, but leave the rest of the appearance the same.
<span class='line'>4632</span> 		     * 
<span class='line'>4633</span> 		     * Parameters:
<span class='line'>4634</span> 		     * 	style - Style to use when the mouse is hovering.
<span class='line'>4635</span> 		     *  doNotRepaint - if true, the Endpoint will not be repainted.  useful when setting things up initially.
<span class='line'>4636</span> 		     */</span><span class="WHIT">
<span class='line'>4637</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4638</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4639</span> 		     * Function: setHover
<span class='line'>4640</span> 		     * Sets/unsets the hover state of this Endpoint.
<span class='line'>4641</span> 		     * 
<span class='line'>4642</span> 		     * Parameters:
<span class='line'>4643</span> 		     * 	hover - hover state boolean
<span class='line'>4644</span> 		     * 	ignoreAttachedElements - if true, does not notify any attached elements of the change in hover state.  used mostly to avoid infinite loops.
<span class='line'>4645</span> 		     */</span><span class="WHIT">
<span class='line'>4646</span> 
<span class='line'>4647</span> </span><span class="WHIT">		     </span><span class="COMM">/*
<span class='line'>4648</span> 		     * Function: getParameter
<span class='line'>4649</span> 		     * Gets the named parameter; returns null if no parameter with that name is set. Parameters may have been set on the Endpoint in the 'addEndpoint' call, or they may have been set with the setParameter function.
<span class='line'>4650</span> 		     *
<span class='line'>4651</span> 		     * Parameters:
<span class='line'>4652</span> 		     *   key - Parameter name.
<span class='line'>4653</span> 		     */</span><span class="WHIT">
<span class='line'>4654</span> 
<span class='line'>4655</span> </span><span class="WHIT">		     </span><span class="COMM">/*
<span class='line'>4656</span> 		     * Function: setParameter
<span class='line'>4657</span> 		     * Sets the named parameter to the given value.
<span class='line'>4658</span> 		     *
<span class='line'>4659</span> 		     * Parameters:
<span class='line'>4660</span> 		     *   key - Parameter name.
<span class='line'>4661</span> 		     *   value - Parameter value.
<span class='line'>4662</span> 		     */</span><span class="WHIT">
<span class='line'>4663</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4664</span> </span><span class="COMM">// ***************************** END OF PLACEHOLDERS FOR NATURAL DOCS *************************************************</span><span class="WHIT">
<span class='line'>4665</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4666</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">visible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">__enabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">params.enabled</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4667</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4668</span> 				Function: isVisible
<span class='line'>4669</span> 				Returns whether or not the Endpoint is currently visible.
<span class='line'>4670</span> 			*/</span><span class="WHIT">
<span class='line'>4671</span> </span><span class="WHIT">			</span><span class="NAME">this.isVisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">visible</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4672</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4673</span> 				Function: setVisible
<span class='line'>4674</span> 				Sets whether or not the Endpoint is currently visible.
<span class='line'>4675</span> 
<span class='line'>4676</span> 				Parameters:
<span class='line'>4677</span> 					visible - whether or not the Endpoint should be visible.
<span class='line'>4678</span> 					doNotChangeConnections - Instructs jsPlumb to not pass the visible state on to any attached Connections. defaults to false.
<span class='line'>4679</span> 					doNotNotifyOtherEndpoint - Instructs jsPlumb to not pass the visible state on to Endpoints at the other end of any attached Connections. defaults to false. 
<span class='line'>4680</span> 			*/</span><span class="WHIT">
<span class='line'>4681</span> </span><span class="WHIT">			</span><span class="NAME">this.setVisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotChangeConnections</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doNotNotifyOtherEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4682</span> </span><span class="WHIT">				</span><span class="NAME">visible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4683</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.canvas.style.display</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"block"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4684</span> </span><span class="WHIT">				</span><span class="NAME">self</span><span class="PUNC">[</span><span class="NAME">v</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"showOverlays"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"hideOverlays"</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4685</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">doNotChangeConnections</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4686</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.connections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4687</span> </span><span class="WHIT">						</span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setVisible</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4688</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">doNotNotifyOtherEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4689</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4690</span> </span><span class="WHIT">							</span><span class="COMM">// only change the other endpoint if this is its only connection.</span><span class="WHIT">
<span class='line'>4691</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">oIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">connections.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NAME">oIdx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setVisible</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4692</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4693</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4694</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4695</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4696</span> 
<span class='line'>4697</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4698</span> 				Function: isEnabled
<span class='line'>4699</span> 				Returns whether or not the Endpoint is enabled for drag/drop connections.
<span class='line'>4700</span> 			*/</span><span class="WHIT">
<span class='line'>4701</span> </span><span class="WHIT">			</span><span class="NAME">this.isEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">__enabled</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4702</span> 
<span class='line'>4703</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4704</span> 				Function: setEnabled
<span class='line'>4705</span> 				Sets whether or not the Endpoint is enabled for drag/drop connections.
<span class='line'>4706</span> 			*/</span><span class="WHIT">
<span class='line'>4707</span> </span><span class="WHIT">			</span><span class="NAME">this.setEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">__enabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4708</span> 
<span class='line'>4709</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.source</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NAME">_uuid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.uuid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">floatingEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="NAME">inPlaceCopy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4710</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_uuid</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">endpointsByUUID</span><span class="PUNC">[</span><span class="NAME">_uuid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4711</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">_element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"id"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4712</span> </span><span class="WHIT">			</span><span class="NAME">this.elementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4713</span> </span><span class="WHIT">			</span><span class="NAME">this.element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4714</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4715</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_connectionCost</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.connectionCost</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4716</span> </span><span class="WHIT">			</span><span class="NAME">this.getConnectionCost</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_connectionCost</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4717</span> </span><span class="WHIT">			</span><span class="NAME">this.setConnectionCost</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4718</span> </span><span class="WHIT">				</span><span class="NAME">_connectionCost</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4719</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4720</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4721</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_connectionsBidirectional</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.connectionsBidirectional</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4722</span> </span><span class="WHIT">			</span><span class="NAME">this.areConnectionsBidirectional</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_connectionsBidirectional</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4723</span> </span><span class="WHIT">			</span><span class="NAME">this.setConnectionsBidirectional</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">b</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">_connectionsBidirectional</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">b</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4724</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4725</span> </span><span class="WHIT">			</span><span class="NAME">self.anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.anchor</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_currentInstance.makeAnchor</span><span class="PUNC">(</span><span class="NAME">params.anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">params.anchors</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">_currentInstance.makeAnchor</span><span class="PUNC">(</span><span class="NAME">params.anchors</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_currentInstance.makeAnchor</span><span class="PUNC">(</span><span class="STRN">"TopCenter"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4726</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4727</span> </span><span class="WHIT">			</span><span class="COMM">// ANCHOR MANAGER</span><span class="WHIT">
<span class='line'>4728</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">params._transient</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// in place copies, for example, are transient.  they will never need to be retrieved during a paint cycle, because they dont move, and then they are deleted.</span><span class="WHIT">
<span class='line'>4729</span> </span><span class="WHIT">				</span><span class="NAME">_currentInstance.anchorManager.add</span><span class="PUNC">(</span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4730</span> 
<span class='line'>4731</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4732</span> </span><span class="WHIT">			</span><span class="NAME">this.setEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4733</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endpointArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4734</span> </span><span class="WHIT">	                </span><span class="NAME">_jsPlumb</span><span class="PUNC">:</span><span class="NAME">self._jsPlumb</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4735</span> </span><span class="WHIT">	                </span><span class="NAME">parent</span><span class="PUNC">:</span><span class="NAME">params.parent</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4736</span> </span><span class="WHIT">	                </span><span class="NAME">container</span><span class="PUNC">:</span><span class="NAME">params.container</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4737</span> </span><span class="WHIT">	                </span><span class="NAME">tooltip</span><span class="PUNC">:</span><span class="NAME">params.tooltip</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4738</span> </span><span class="WHIT">	                </span><span class="NAME">connectorTooltip</span><span class="PUNC">:</span><span class="NAME">params.connectorTooltip</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4739</span> </span><span class="WHIT">	                </span><span class="NAME">endpoint</span><span class="PUNC">:</span><span class="NAME">self</span><span class="WHIT">
<span class='line'>4740</span> </span><span class="WHIT">	            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4741</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isString</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4742</span> </span><span class="WHIT">					</span><span class="NAME">_endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Endpoints</span><span class="PUNC">[</span><span class="NAME">renderMode</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">ep</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">endpointArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4743</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_isArray</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4744</span> </span><span class="WHIT">					</span><span class="NAME">endpointArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4745</span> </span><span class="WHIT">					</span><span class="NAME">_endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Endpoints</span><span class="PUNC">[</span><span class="NAME">renderMode</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">ep</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">endpointArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4746</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4747</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4748</span> </span><span class="WHIT">					</span><span class="NAME">_endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ep.clone</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4749</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4750</span> 
<span class='line'>4751</span> </span><span class="WHIT">				</span><span class="COMM">// assign a clone function using a copy of endpointArgs. this is used when a drag starts: the endpoint that was dragged is cloned,</span><span class="WHIT">
<span class='line'>4752</span> </span><span class="WHIT">				</span><span class="COMM">// and the clone is left in its place while the original one goes off on a magical journey. </span><span class="WHIT">
<span class='line'>4753</span> </span><span class="WHIT">				</span><span class="COMM">// the copy is to get around a closure problem, in which endpointArgs ends up getting shared by</span><span class="WHIT">
<span class='line'>4754</span> </span><span class="WHIT">				</span><span class="COMM">// the whole world.</span><span class="WHIT">
<span class='line'>4755</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">argsForClone</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpointArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>4756</span> </span><span class="WHIT">				</span><span class="NAME">_endpoint.clone</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4757</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Object</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4758</span> </span><span class="WHIT">					</span><span class="NAME">_endpoint.constructor.apply</span><span class="PUNC">(</span><span class="NAME">o</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">argsForClone</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4759</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4760</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4761</span> 
<span class='line'>4762</span> </span><span class="WHIT">				</span><span class="NAME">self.endpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_endpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4763</span> </span><span class="WHIT">				</span><span class="NAME">self.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.endpoint.type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4764</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4765</span> </span><span class="WHIT">			 </span><span class="WHIT">
<span class='line'>4766</span> </span><span class="WHIT">			</span><span class="NAME">this.setEndpoint</span><span class="PUNC">(</span><span class="NAME">params.endpoint</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.Endpoint</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.Endpoint</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">"Dot"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>4767</span> </span><span class="WHIT">			</span><span class="NAME">originalEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_endpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4768</span> 
<span class='line'>4769</span> </span><span class="WHIT">			</span><span class="COMM">// override setHover to pass it down to the underlying endpoint</span><span class="WHIT">
<span class='line'>4770</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_sh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.setHover</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4771</span> </span><span class="WHIT">			</span><span class="NAME">self.setHover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4772</span> </span><span class="WHIT">				</span><span class="NAME">self.endpoint.setHover.apply</span><span class="PUNC">(</span><span class="NAME">self.endpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4773</span> </span><span class="WHIT">				</span><span class="NAME">_sh.apply</span><span class="PUNC">(</span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4774</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4775</span> </span><span class="WHIT">            </span><span class="COMM">// endpoint delegates to first connection for hover, if there is one.</span><span class="WHIT">
<span class='line'>4776</span> </span><span class="WHIT">            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">internalHover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4777</span> </span><span class="WHIT">              </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connections.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4778</span> </span><span class="WHIT">                </span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setHover</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4779</span> </span><span class="WHIT">              </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>4780</span> </span><span class="WHIT">                </span><span class="NAME">self.setHover</span><span class="PUNC">(</span><span class="NAME">state</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4781</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4782</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4783</span> </span><span class="WHIT">			</span><span class="COMM">// bind listeners from endpoint to self, with the internal hover function defined above.</span><span class="WHIT">
<span class='line'>4784</span> </span><span class="WHIT">            </span><span class="NAME">_bindListeners</span><span class="PUNC">(</span><span class="NAME">self.endpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">internalHover</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4785</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4786</span> </span><span class="WHIT">			</span><span class="NAME">this.setPaintStyle</span><span class="PUNC">(</span><span class="NAME">params.paintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4787</span> </span><span class="WHIT">							   </span><span class="NAME">params.style</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4788</span> </span><span class="WHIT">							   </span><span class="NAME">_currentInstance.Defaults.EndpointStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4789</span> </span><span class="WHIT">							   </span><span class="NAME">jsPlumb.Defaults.EndpointStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4790</span> </span><span class="WHIT">			</span><span class="NAME">this.setHoverPaintStyle</span><span class="PUNC">(</span><span class="NAME">params.hoverPaintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4791</span> </span><span class="WHIT">									</span><span class="NAME">_currentInstance.Defaults.EndpointHoverStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4792</span> </span><span class="WHIT">									</span><span class="NAME">jsPlumb.Defaults.EndpointHoverStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4793</span> </span><span class="WHIT">			</span><span class="NAME">this.paintStyleInUse</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getPaintStyle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4794</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">originalPaintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getPaintStyle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4795</span> </span><span class="WHIT">			</span><span class="NAME">this.connectorStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.connectorStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4796</span> </span><span class="WHIT">			</span><span class="NAME">this.connectorHoverStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.connectorHoverStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4797</span> </span><span class="WHIT">			</span><span class="NAME">this.connectorOverlays</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.connectorOverlays</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4798</span> </span><span class="WHIT">			</span><span class="NAME">this.connector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.connector</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4799</span> </span><span class="WHIT">			</span><span class="NAME">this.connectorTooltip</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.connectorTooltip</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4800</span> </span><span class="WHIT">			</span><span class="NAME">this.isSource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.isSource</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4801</span> </span><span class="WHIT">			</span><span class="NAME">this.isTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.isTarget</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4802</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4803</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_maxConnections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.maxConnections</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.MaxConnections</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// maximum number of connections this endpoint can be the source of.</span><span class="WHIT">
<span class='line'>4804</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>4805</span> </span><span class="WHIT">			</span><span class="NAME">this.getAttachedElements</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4806</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self.connections</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4807</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4808</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4809</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4810</span> 			 * Property: canvas
<span class='line'>4811</span> 			 * The Endpoint's Canvas.
<span class='line'>4812</span> 			 */</span><span class="WHIT">
<span class='line'>4813</span> </span><span class="WHIT">			</span><span class="NAME">this.canvas</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.endpoint.canvas</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4814</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4815</span> 			 * Property: connections
<span class='line'>4816</span> 			 * List of Connections this Endpoint is attached to.
<span class='line'>4817</span> 			 */</span><span class="WHIT">
<span class='line'>4818</span> </span><span class="WHIT">			</span><span class="NAME">this.connections</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.connections</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4819</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4820</span> 			 * Property: scope
<span class='line'>4821</span> 			 * Scope descriptor for this Endpoint.
<span class='line'>4822</span> 			 */</span><span class="WHIT">
<span class='line'>4823</span> </span><span class="WHIT">			</span><span class="NAME">this.scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.scope</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">DEFAULT_SCOPE</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4824</span> </span><span class="WHIT">			</span><span class="NAME">this.timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4825</span> </span><span class="WHIT">			</span><span class="NAME">self.isReattach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.reattach</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4826</span> </span><span class="WHIT">            </span><span class="NAME">self.connectionsDetachable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.ConnectionsDetachable</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4827</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.connectionsDetachable</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">params.detachable</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4828</span> </span><span class="WHIT">                </span><span class="NAME">self.connectionsDetachable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4829</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dragAllowedWhenFull</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.dragAllowedWhenFull</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4830</span> 
<span class='line'>4831</span> </span><span class="WHIT">			</span><span class="NAME">this.computeAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4832</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self.anchor.compute</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4833</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4834</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4835</span> 			 * Function: addConnection
<span class='line'>4836</span> 			 *   Adds a Connection to this Endpoint.
<span class='line'>4837</span> 			 *   
<span class='line'>4838</span> 			 * Parameters:
<span class='line'>4839</span> 			 *   connection - the Connection to add.
<span class='line'>4840</span> 			 */</span><span class="WHIT">
<span class='line'>4841</span> </span><span class="WHIT">			</span><span class="NAME">this.addConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4842</span> </span><span class="WHIT">				</span><span class="NAME">self.connections.push</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4843</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4844</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4845</span> 			 * Function: detach
<span class='line'>4846</span> 			 *   Detaches the given Connection from this Endpoint.
<span class='line'>4847</span> 			 *   
<span class='line'>4848</span> 			 * Parameters:
<span class='line'>4849</span> 			 *   connection - the Connection to detach.
<span class='line'>4850</span> 			 *   ignoreTarget - optional; tells the Endpoint to not notify the Connection target that the Connection was detached.  The default behaviour is to notify the target.
<span class='line'>4851</span> 			 */</span><span class="WHIT">
<span class='line'>4852</span> </span><span class="WHIT">			</span><span class="NAME">this.detach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ignoreTarget</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">forceDetach</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fireEvent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4853</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_findWithFunction</span><span class="PUNC">(</span><span class="NAME">self.connections</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">connection.id</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4854</span> </span><span class="WHIT">					</span><span class="NAME">actuallyDetached</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4855</span> </span><span class="WHIT">                </span><span class="NAME">fireEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fireEvent</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4856</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>4857</span> </span><span class="WHIT">					</span><span class="COMM">// 1. does the connection have a before detach (note this also checks jsPlumb's bound</span><span class="WHIT">
<span class='line'>4858</span> </span><span class="WHIT">					</span><span class="COMM">// detach handlers; but then Endpoint's check will, too, hmm.)</span><span class="WHIT">
<span class='line'>4859</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">forceDetach</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">connection._forceDetach</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">connection.isDetachable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">connection.isDetachAllowed</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4860</span> </span><span class="WHIT">						</span><span class="COMM">// get the target endpoint</span><span class="WHIT">
<span class='line'>4861</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connection.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">connection.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">connection.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4862</span> </span><span class="WHIT">						</span><span class="COMM">// it would be nice to check with both endpoints that it is ok to detach. but </span><span class="WHIT">
<span class='line'>4863</span> </span><span class="WHIT">						</span><span class="COMM">// for this we'll have to get a bit fancier: right now if you use the same beforeDetach</span><span class="WHIT">
<span class='line'>4864</span> </span><span class="WHIT">						</span><span class="COMM">// interceptor for two endpoints (which is kind of common, because it's part of the</span><span class="WHIT">
<span class='line'>4865</span> </span><span class="WHIT">						</span><span class="COMM">// endpoint definition), then it gets fired twice.  so in fact we need to loop through</span><span class="WHIT">
<span class='line'>4866</span> </span><span class="WHIT">						</span><span class="COMM">// each beforeDetach and see if it returns false, at which point we exit.  but if it</span><span class="WHIT">
<span class='line'>4867</span> </span><span class="WHIT">						</span><span class="COMM">// returns true, we have to check the next one.  however we need to track which ones</span><span class="WHIT">
<span class='line'>4868</span> </span><span class="WHIT">						</span><span class="COMM">// have already been run, and not run them again.</span><span class="WHIT">
<span class='line'>4869</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">forceDetach</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">connection._forceDetach</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.isDetachAllowed</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">/*&& t.isDetachAllowed(connection)*/</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4870</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4871</span> </span><span class="WHIT">							</span><span class="NAME">self.connections.splice</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">										</span><span class="WHIT">
<span class='line'>4872</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4873</span> </span><span class="WHIT">							</span><span class="COMM">// this avoids a circular loop</span><span class="WHIT">
<span class='line'>4874</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ignoreTarget</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4875</span> </span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>4876</span> </span><span class="WHIT">								</span><span class="NAME">t.detach</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">forceDetach</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4877</span> </span><span class="WHIT">								</span><span class="COMM">// check connection to see if we want to delete the endpoints associated with it.</span><span class="WHIT">
<span class='line'>4878</span> </span><span class="WHIT">								</span><span class="COMM">// we only detach those that have just this connection; this scenario is most</span><span class="WHIT">
<span class='line'>4879</span> </span><span class="WHIT">								</span><span class="COMM">// likely if we got to this bit of code because it is set by the methods that</span><span class="WHIT">
<span class='line'>4880</span> </span><span class="WHIT">								</span><span class="COMM">// create their own endpoints, like .connect or .makeTarget. the user is</span><span class="WHIT">
<span class='line'>4881</span> </span><span class="WHIT">								</span><span class="COMM">// not likely to have interacted with those endpoints.</span><span class="WHIT">
<span class='line'>4882</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">connection.endpointsToDeleteOnDetach</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4883</span> </span><span class="WHIT">									</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">connection.endpointsToDeleteOnDetach.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4884</span> </span><span class="WHIT">										</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cde</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">connection.endpointsToDeleteOnDetach</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4885</span> </span><span class="WHIT">										</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cde</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">cde.connections.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4886</span> </span><span class="WHIT">											</span><span class="NAME">_currentInstance.deleteEndpoint</span><span class="PUNC">(</span><span class="NAME">cde</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>4887</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4888</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4889</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4890</span> </span><span class="WHIT">							</span><span class="NAME">_removeElements</span><span class="PUNC">(</span><span class="NAME">connection.connector.getDisplayElements</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connection.parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4891</span> </span><span class="WHIT">							</span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">connectionsByScope</span><span class="PUNC">[</span><span class="NAME">connection.scope</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4892</span> </span><span class="WHIT">								</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">connection.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4893</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4894</span> </span><span class="WHIT">							</span><span class="NAME">actuallyDetached</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4895</span> </span><span class="WHIT">                            </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">doFireEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ignoreTarget</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">fireEvent</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4896</span> </span><span class="WHIT">							</span><span class="NAME">fireDetachEvent</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">doFireEvent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4897</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4898</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4899</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4900</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">actuallyDetached</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4901</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4902</span> 
<span class='line'>4903</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4904</span> 			 * Function: detachAll
<span class='line'>4905</span> 			 *   Detaches all Connections this Endpoint has.
<span class='line'>4906</span> 			 *
<span class='line'>4907</span> 			 * Parameters:
<span class='line'>4908</span> 			 *  fireEvent   -   whether or not to fire the detach event.  defaults to false.
<span class='line'>4909</span> 			 */</span><span class="WHIT">
<span class='line'>4910</span> </span><span class="WHIT">			</span><span class="NAME">this.detachAll</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">fireEvent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4911</span> </span><span class="WHIT">				</span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connections.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4912</span> </span><span class="WHIT">					</span><span class="NAME">self.detach</span><span class="PUNC">(</span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fireEvent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4913</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4914</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4915</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4916</span> 			 * Function: detachFrom
<span class='line'>4917</span> 			 *   Removes any connections from this Endpoint that are connected to the given target endpoint.
<span class='line'>4918</span> 			 *   
<span class='line'>4919</span> 			 * Parameters:
<span class='line'>4920</span> 			 *   targetEndpoint     - Endpoint from which to detach all Connections from this Endpoint.
<span class='line'>4921</span> 			 *   fireEvent          - whether or not to fire the detach event. defaults to false.
<span class='line'>4922</span> 			 */</span><span class="WHIT">
<span class='line'>4923</span> </span><span class="WHIT">			</span><span class="NAME">this.detachFrom</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">targetEndpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fireEvent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4924</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4925</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.connections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4926</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">targetEndpoint</span><span class="WHIT">
<span class='line'>4927</span> </span><span class="WHIT">							</span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">targetEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4928</span> </span><span class="WHIT">						</span><span class="NAME">c.push</span><span class="PUNC">(</span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4929</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4930</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4931</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">c.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4932</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.detach</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fireEvent</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4933</span> </span><span class="WHIT">						</span><span class="NAME">c</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setHover</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4934</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4935</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4936</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4937</span> 			 * Function: detachFromConnection
<span class='line'>4938</span> 			 *   Detach this Endpoint from the Connection, but leave the Connection alive. Used when dragging.
<span class='line'>4939</span> 			 *   
<span class='line'>4940</span> 			 * Parameters:
<span class='line'>4941</span> 			 *   connection - Connection to detach from.
<span class='line'>4942</span> 			 */</span><span class="WHIT">
<span class='line'>4943</span> </span><span class="WHIT">			</span><span class="NAME">this.detachFromConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">connection</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4944</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">  </span><span class="NAME">_findWithFunction</span><span class="PUNC">(</span><span class="NAME">self.connections</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">c.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">connection.id</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4945</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4946</span> </span><span class="WHIT">					</span><span class="NAME">self.connections.splice</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4947</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4948</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4949</span> 
<span class='line'>4950</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4951</span> 			 * Function: getElement
<span class='line'>4952</span> 			 *   Returns the DOM element this Endpoint is attached to.
<span class='line'>4953</span> 			 */</span><span class="WHIT">
<span class='line'>4954</span> </span><span class="WHIT">			</span><span class="NAME">this.getElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4955</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4956</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>4957</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4958</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4959</span> 			 * Function: setElement
<span class='line'>4960</span> 			 * Sets the DOM element this Endpoint is attached to.  
<span class='line'>4961</span> 			 */</span><span class="WHIT">
<span class='line'>4962</span> </span><span class="WHIT">			</span><span class="NAME">this.setElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">container</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4963</span> 
<span class='line'>4964</span> </span><span class="WHIT">				</span><span class="COMM">// TODO possibly have this object take charge of moving the UI components into the appropriate</span><span class="WHIT">
<span class='line'>4965</span> </span><span class="WHIT">				</span><span class="COMM">// parent.  this is used only by makeSource right now, and that function takes care of</span><span class="WHIT">
<span class='line'>4966</span> </span><span class="WHIT">				</span><span class="COMM">// moving the UI bits and pieces.  however it would s			</span><span class="WHIT">
<span class='line'>4967</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parentId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4968</span> </span><span class="WHIT">				</span><span class="COMM">// remove the endpoint from the list for the current endpoint's element</span><span class="WHIT">
<span class='line'>4969</span> </span><span class="WHIT">				</span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">self.elementId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4970</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">self.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4971</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4972</span> </span><span class="WHIT">				</span><span class="NAME">_element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">el</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4973</span> </span><span class="WHIT">				</span><span class="NAME">_elementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getId</span><span class="PUNC">(</span><span class="NAME">_element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4974</span> </span><span class="WHIT">				</span><span class="NAME">self.elementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4975</span> </span><span class="WHIT">				</span><span class="COMM">// need to get the new parent now</span><span class="WHIT">
<span class='line'>4976</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newParentElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getParentFromParams</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">source</span><span class="PUNC">:</span><span class="NAME">parentId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">container</span><span class="PUNC">:</span><span class="NAME">container</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>4977</span> </span><span class="WHIT">				</span><span class="NAME">curParent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getParent</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4978</span> </span><span class="WHIT">				</span><span class="NAME">jpcl.removeElement</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">curParent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4979</span> </span><span class="WHIT">				</span><span class="NAME">jpcl.appendElement</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newParentElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>4980</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>4981</span> </span><span class="WHIT">				</span><span class="COMM">// now move connection(s)...i would expect there to be only one but we will iterate.</span><span class="WHIT">
<span class='line'>4982</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.connections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4983</span> </span><span class="WHIT">					</span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">moveParent</span><span class="PUNC">(</span><span class="NAME">newParentElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4984</span> </span><span class="WHIT">					</span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4985</span> </span><span class="WHIT">					</span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_element</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>4986</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>4987</span> </span><span class="WHIT">				</span><span class="NAME">_addToList</span><span class="PUNC">(</span><span class="NAME">endpointsByElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">parentId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4988</span> </span><span class="WHIT">				</span><span class="COMM">//_currentInstance.repaint(parentId);			</span><span class="WHIT">
<span class='line'>4989</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>4990</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4991</span> 
<span class='line'>4992</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>4993</span> 			 * Function: getUuid
<span class='line'>4994</span> 			 *   Returns the UUID for this Endpoint, if there is one. Otherwise returns null.
<span class='line'>4995</span> 			 */</span><span class="WHIT">
<span class='line'>4996</span> </span><span class="WHIT">			</span><span class="NAME">this.getUuid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4997</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_uuid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4998</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4999</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>5000</span> 			 * private but must be exposed.
<span class='line'>5001</span> 			 */</span><span class="WHIT">
<span class='line'>5002</span> </span><span class="WHIT">			</span><span class="NAME">this.makeInPlaceCopy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5003</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">loc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.anchor.getCurrentLocation</span><span class="PUNC">(</span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5004</span> </span><span class="WHIT">					</span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.anchor.getOrientation</span><span class="PUNC">(</span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5005</span> </span><span class="WHIT">					</span><span class="NAME">inPlaceAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5006</span> </span><span class="WHIT">						</span><span class="NAME">compute</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">loc</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loc</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5007</span> </span><span class="WHIT">						</span><span class="NAME">getCurrentLocation</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">loc</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">loc</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5008</span> </span><span class="WHIT">						</span><span class="NAME">getOrientation</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">o</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5009</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5010</span> 
<span class='line'>5011</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">_newEndpoint</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5012</span> </span><span class="WHIT">					</span><span class="NAME">anchor</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">inPlaceAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5013</span> </span><span class="WHIT">					</span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5014</span> </span><span class="WHIT">					</span><span class="NAME">paintStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">this.getPaintStyle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5015</span> </span><span class="WHIT">					</span><span class="NAME">endpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_endpoint</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5016</span> </span><span class="WHIT">					</span><span class="NAME">_transient</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5017</span> </span><span class="WHIT">                    </span><span class="NAME">scope</span><span class="PUNC">:</span><span class="NAME">self.scope</span><span class="WHIT">
<span class='line'>5018</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5019</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5020</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5021</span> 			 * Function: isConnectedTo
<span class='line'>5022</span> 			 *   Returns whether or not this endpoint is connected to the given Endpoint.
<span class='line'>5023</span> 			 *   
<span class='line'>5024</span> 			 * Parameters:
<span class='line'>5025</span> 			 *   endpoint - Endpoint to test.
<span class='line'>5026</span> 			 */</span><span class="WHIT">
<span class='line'>5027</span> </span><span class="WHIT">			</span><span class="NAME">this.isConnectedTo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5028</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">found</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5029</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5030</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.connections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5031</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5032</span> </span><span class="WHIT">							</span><span class="NAME">found</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5033</span> </span><span class="WHIT">							</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5034</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5035</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5036</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5037</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">found</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5038</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5039</span> 
<span class='line'>5040</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>5041</span> 			 * private but needs to be exposed.
<span class='line'>5042</span> 			 */</span><span class="WHIT">
<span class='line'>5043</span> </span><span class="WHIT">			</span><span class="NAME">this.isFloating</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5044</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">floatingEndpoint</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5045</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5046</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5047</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>5048</span> 			 * returns a connection from the pool; used when dragging starts.  just gets the head of the array if it can.
<span class='line'>5049</span> 			 */</span><span class="WHIT">
<span class='line'>5050</span> </span><span class="WHIT">			</span><span class="NAME">this.connectorSelector</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5051</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">candidate</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5052</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.isTarget</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">candidate</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">candidate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5053</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5054</span> </span><span class="WHIT">					</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connections.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">_maxConnections</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_maxConnections</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">candidate</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5055</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5056</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5057</span> 
<span class='line'>5058</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5059</span> 			 * Function: isFull
<span class='line'>5060</span> 			 *   Returns whether or not the Endpoint can accept any more Connections.
<span class='line'>5061</span> 			 */</span><span class="WHIT">
<span class='line'>5062</span> </span><span class="WHIT">			</span><span class="NAME">this.isFull</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5063</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">self.isFloating</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_maxConnections</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.connections.length</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">_maxConnections</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>5064</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5065</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5066</span> 			 * Function: setDragAllowedWhenFull
<span class='line'>5067</span> 			 *   Sets whether or not connections can be dragged from this Endpoint once it is full. You would use this in a UI in 
<span class='line'>5068</span> 			 *   which you're going to provide some other way of breaking connections, if you need to break them at all. This property 
<span class='line'>5069</span> 			 *   is by default true; use it in conjunction with the 'reattach' option on a connect call.
<span class='line'>5070</span> 			 *   
<span class='line'>5071</span> 			 * Parameters:
<span class='line'>5072</span> 			 *   allowed - whether drag is allowed or not when the Endpoint is full.
<span class='line'>5073</span> 			 */</span><span class="WHIT">
<span class='line'>5074</span> </span><span class="WHIT">			</span><span class="NAME">this.setDragAllowedWhenFull</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">allowed</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5075</span> </span><span class="WHIT">				</span><span class="NAME">dragAllowedWhenFull</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">allowed</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5076</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5077</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5078</span> 			 * Function: setStyle
<span class='line'>5079</span> 			 *   Sets the paint style of the Endpoint.  This is a JS object of the same form you supply to a jsPlumb.addEndpoint or jsPlumb.connect call.
<span class='line'>5080</span> 			 *   TODO move setStyle into EventGenerator, remove it from here. is Connection's method currently setPaintStyle ? wire that one up to
<span class='line'>5081</span> 			 *   setStyle and deprecate it if so.
<span class='line'>5082</span> 			 *   
<span class='line'>5083</span> 			 * Parameters:
<span class='line'>5084</span> 			 *   style - Style object to set, for example {fillStyle:"blue"}.
<span class='line'>5085</span> 			 *   
<span class='line'>5086</span> 			 *  @deprecated use setPaintStyle instead.
<span class='line'>5087</span> 			 */</span><span class="WHIT">
<span class='line'>5088</span> </span><span class="WHIT">			</span><span class="NAME">this.setStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.setPaintStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5089</span> 
<span class='line'>5090</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>5091</span> 			 * a deep equals check. everything must match, including the anchor,
<span class='line'>5092</span> 			 * styles, everything. TODO: finish Endpoint.equals
<span class='line'>5093</span> 			 */</span><span class="WHIT">
<span class='line'>5094</span> </span><span class="WHIT">			</span><span class="NAME">this.equals</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5095</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.anchor.equals</span><span class="PUNC">(</span><span class="NAME">endpoint.anchor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5096</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5097</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5098</span> </span><span class="WHIT">			</span><span class="COMM">// a helper function that tries to find a connection to the given element, and returns it if so. if elementWithPrecedence is null,</span><span class="WHIT">
<span class='line'>5099</span> </span><span class="WHIT">			</span><span class="COMM">// or no connection to it is found, we return the first connection in our list.</span><span class="WHIT">
<span class='line'>5100</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">findConnectionToUseForDynamicAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">elementWithPrecedence</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5101</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5102</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">elementWithPrecedence</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5103</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.connections.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5104</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">elementWithPrecedence</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">targetId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">elementWithPrecedence</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5105</span> </span><span class="WHIT">							</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5106</span> </span><span class="WHIT">							</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5107</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5108</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5109</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5110</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>5111</span> </span><span class="WHIT">				</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self.connections</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5112</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5113</span> 
<span class='line'>5114</span> </span><span class="WHIT">			</span><span class="COMM">/*
<span class='line'>5115</span> 			 * Function: paint
<span class='line'>5116</span> 			 *   Paints the Endpoint, recalculating offset and anchor positions if necessary. This does NOT paint
<span class='line'>5117</span> 			 *   any of the Endpoint's connections.
<span class='line'>5118</span> 			 *   
<span class='line'>5119</span> 			 * Parameters:
<span class='line'>5120</span> 			 *   timestamp - optional timestamp advising the Endpoint of the current paint time; if it has painted already once for this timestamp, it will not paint again.
<span class='line'>5121</span> 			 *   canvas - optional Canvas to paint on.  Only used internally by jsPlumb in certain obscure situations.
<span class='line'>5122</span> 			 *   connectorPaintStyle - paint style of the Connector attached to this Endpoint. Used to get a fillStyle if nothing else was supplied.
<span class='line'>5123</span> 			 */</span><span class="WHIT">
<span class='line'>5124</span> </span><span class="WHIT">			</span><span class="NAME">this.paint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5125</span> </span><span class="WHIT">				</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5126</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.timestamp</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5127</span> </span><span class="WHIT">                    </span><span class="NAME">recalc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">params.recalc</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5128</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.timestamp</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5129</span> </span><span class="WHIT">					</span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="PUNC">:</span><span class="NAME">_elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">:</span><span class="NAME">timestamp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">recalc</span><span class="PUNC">:</span><span class="NAME">recalc</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5130</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.offset</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">_elementId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5131</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">xy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5132</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.anchorPoint</span><span class="PUNC">,</span><span class="NAME">connectorPaintStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.connectorPaintStyle</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5133</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ap</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5134</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.dimensions</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">_elementId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5135</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">xy</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5136</span> </span><span class="WHIT">								</span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5137</span> </span><span class="WHIT">								</span><span class="NAME">xy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">_elementId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5138</span> </span><span class="WHIT">								</span><span class="NAME">wh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">_elementId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5139</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5140</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">anchorParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">xy</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">xy.left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xy.top</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">wh</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5141</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">recalc</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">self.anchor.isDynamic</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">self.connections.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5142</span> </span><span class="WHIT">								</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">findConnectionToUseForDynamicAnchor</span><span class="PUNC">(</span><span class="NAME">params.elementWithPrecedence</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5143</span> </span><span class="WHIT">								</span><span class="NAME">oIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">self</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5144</span> </span><span class="WHIT">								</span><span class="NAME">oId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oIdx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">c.sourceId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">c.targetId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5145</span> </span><span class="WHIT">								</span><span class="NAME">oOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">offsets</span><span class="PUNC">[</span><span class="NAME">oId</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oWH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sizes</span><span class="PUNC">[</span><span class="NAME">oId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5146</span> </span><span class="WHIT">								</span><span class="NAME">anchorParams.txy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">oOffset.left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oOffset.top</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5147</span> </span><span class="WHIT">								</span><span class="NAME">anchorParams.twh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oWH</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5148</span> </span><span class="WHIT">								</span><span class="NAME">anchorParams.tElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">c.endpoints</span><span class="PUNC">[</span><span class="NAME">oIdx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5149</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5150</span> </span><span class="WHIT">							</span><span class="NAME">ap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.anchor.compute</span><span class="PUNC">(</span><span class="NAME">anchorParams</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5151</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5152</span> </span><span class="WHIT">											</span><span class="WHIT">
<span class='line'>5153</span> </span><span class="WHIT">						</span><span class="COMM">// switched _endpoint to self here; continuous anchors, for instance, look for the</span><span class="WHIT">
<span class='line'>5154</span> </span><span class="WHIT">						</span><span class="COMM">// endpoint's id, but here "_endpoint" is the renderer, not the actual endpoint.</span><span class="WHIT">
<span class='line'>5155</span> </span><span class="WHIT">						</span><span class="COMM">// TODO need to verify this does not break anything.</span><span class="WHIT">
<span class='line'>5156</span> </span><span class="WHIT">						</span><span class="COMM">//var d = _endpoint.compute(ap, self.anchor.getOrientation(_endpoint), self.paintStyleInUse, connectorPaintStyle || self.paintStyleInUse);</span><span class="WHIT">
<span class='line'>5157</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">d</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_endpoint.compute</span><span class="PUNC">(</span><span class="NAME">ap</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.anchor.getOrientation</span><span class="PUNC">(</span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.paintStyleInUse</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">connectorPaintStyle</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.paintStyleInUse</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5158</span> </span><span class="WHIT">						</span><span class="NAME">_endpoint.paint</span><span class="PUNC">(</span><span class="NAME">d</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.paintStyleInUse</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.anchor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>5159</span> </span><span class="WHIT">						</span><span class="NAME">self.timestamp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">timestamp</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5160</span> 
<span class='line'>5161</span> </span><span class="WHIT">						</span><span class="COMM">/* paint overlays*/</span><span class="WHIT">
<span class='line'>5162</span> </span><span class="WHIT">						</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="WHIT"> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">self.overlays.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5163</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">o</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.overlays</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5164</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">o.isVisible</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.overlayPlacements</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">o.draw</span><span class="PUNC">(</span><span class="NAME">self.endpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.paintStyleInUse</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">d</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5165</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5166</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5167</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5168</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5169</span> 
<span class='line'>5170</span> </span><span class="WHIT">            </span><span class="NAME">this.repaint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.paint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5171</span> 
<span class='line'>5172</span> </span><span class="WHIT">			</span><span class="COMM">/**
<span class='line'>5173</span> 			 * @deprecated
<span class='line'>5174</span> 			 */</span><span class="WHIT">
<span class='line'>5175</span> </span><span class="WHIT">			</span><span class="NAME">this.removeConnection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.detach</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// backwards compatibility</span><span class="WHIT">
<span class='line'>5176</span> 
<span class='line'>5177</span> </span><span class="WHIT">			</span><span class="COMM">// is this a connection source? we make it draggable and have the</span><span class="WHIT">
<span class='line'>5178</span> </span><span class="WHIT">			</span><span class="COMM">// drag listener maintain a connection with a floating endpoint.</span><span class="WHIT">
<span class='line'>5179</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jsPlumb.CurrentLibrary.isDragSupported</span><span class="PUNC">(</span><span class="NAME">_element</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5180</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">placeholderInfo</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">id</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">element</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5181</span> </span><span class="WHIT">                    </span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5182</span> </span><span class="WHIT">                    </span><span class="NAME">existingJpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5183</span> </span><span class="WHIT">                    </span><span class="NAME">existingJpcParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5184</span> </span><span class="WHIT">                    </span><span class="NAME">_dragHandler</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_makeConnectionDragHandler</span><span class="PUNC">(</span><span class="NAME">placeholderInfo</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5185</span> 
<span class='line'>5186</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>5187</span> </span><span class="WHIT">				</span><span class="COMM">// drag might have started on an endpoint that is not actually a source, but which has</span><span class="WHIT">
<span class='line'>5188</span> </span><span class="WHIT">				</span><span class="COMM">// one or more connections.</span><span class="WHIT">
<span class='line'>5189</span> </span><span class="WHIT">					</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.connectorSelector</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5190</span> </span><span class="WHIT">                    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_continue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5191</span> </span><span class="WHIT">                    </span><span class="COMM">// if not enabled, return</span><span class="WHIT">
<span class='line'>5192</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">self.isEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_continue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5193</span> </span><span class="WHIT">					</span><span class="COMM">// if no connection and we're not a source, return.</span><span class="WHIT">
<span class='line'>5194</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">params.isSource</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_continue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5195</span> </span><span class="WHIT">                    </span><span class="COMM">// otherwise if we're full and not allowed to drag, also return false.</span><span class="WHIT">
<span class='line'>5196</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.isSource</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">self.isFull</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">dragAllowedWhenFull</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_continue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5197</span> </span><span class="WHIT">                    </span><span class="COMM">// if the connection was setup as not detachable or one of its endpoints</span><span class="WHIT">
<span class='line'>5198</span> </span><span class="WHIT">                    </span><span class="COMM">// was setup as connectionsDetachable = false, or Defaults.ConnectionsDetachable</span><span class="WHIT">
<span class='line'>5199</span> </span><span class="WHIT">                    </span><span class="COMM">// is set to false...</span><span class="WHIT">
<span class='line'>5200</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">jpc.isDetachable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">_continue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5201</span> 
<span class='line'>5202</span> </span><span class="WHIT">                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_continue</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5203</span> </span><span class="WHIT">                        </span><span class="COMM">// this is for mootools and yui. returning false from this causes jquery to stop drag.</span><span class="WHIT">
<span class='line'>5204</span> </span><span class="WHIT">                        </span><span class="COMM">// the events are wrapped in both mootools and yui anyway, but i don't think returning</span><span class="WHIT">
<span class='line'>5205</span> </span><span class="WHIT">                        </span><span class="COMM">// false from the start callback would stop a drag.</span><span class="WHIT">
<span class='line'>5206</span> </span><span class="WHIT">                        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jsPlumb.CurrentLibrary.stopDrag</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.stopDrag</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5207</span> </span><span class="WHIT">                        </span><span class="NAME">_dragHandler.stopDrag</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5208</span> </span><span class="WHIT">                        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5209</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5210</span> 
<span class='line'>5211</span> </span><span class="WHIT">					</span><span class="COMM">// if we're not full but there was a connection, make it null. we'll create a new one.</span><span class="WHIT">
<span class='line'>5212</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">self.isFull</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">params.isSource</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5213</span> 
<span class='line'>5214</span> </span><span class="WHIT">					</span><span class="NAME">_updateOffset</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5215</span> </span><span class="WHIT">					</span><span class="NAME">inPlaceCopy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.makeInPlaceCopy</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5216</span> </span><span class="WHIT">					</span><span class="NAME">inPlaceCopy.paint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">																</span><span class="WHIT">
<span class='line'>5217</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>5218</span> </span><span class="WHIT">					</span><span class="NAME">_makeDraggablePlaceholder</span><span class="PUNC">(</span><span class="NAME">placeholderInfo</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5219</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>5220</span> </span><span class="WHIT">					</span><span class="COMM">// set the offset of this div to be where 'inPlaceCopy' is, to start with.</span><span class="WHIT">
<span class='line'>5221</span> </span><span class="WHIT">					</span><span class="COMM">// TODO merge this code with the code in both Anchor and FloatingAnchor, because it</span><span class="WHIT">
<span class='line'>5222</span> </span><span class="WHIT">					</span><span class="COMM">// does the same stuff.</span><span class="WHIT">
<span class='line'>5223</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ipcoel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">inPlaceCopy.canvas</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5224</span> </span><span class="WHIT">					    </span><span class="NAME">ipco</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getOffset</span><span class="PUNC">(</span><span class="NAME">ipcoel</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5225</span> </span><span class="WHIT">					    </span><span class="NAME">po</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">adjustForParentOffsetAndScroll</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="NAME">ipco.left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ipco.top</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">inPlaceCopy.canvas</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5226</span> </span><span class="WHIT">					</span><span class="NAME">jsPlumb.CurrentLibrary.setOffset</span><span class="PUNC">(</span><span class="NAME">placeholderInfo.element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">left</span><span class="PUNC">:</span><span class="NAME">po</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">top</span><span class="PUNC">:</span><span class="NAME">po</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">															</span><span class="WHIT">
<span class='line'>5227</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>5228</span> </span><span class="WHIT">					</span><span class="COMM">// when using makeSource and a parent, we first draw the source anchor on the source element, then</span><span class="WHIT">
<span class='line'>5229</span> </span><span class="WHIT">					</span><span class="COMM">// move it to the parent.  note that this happens after drawing the placeholder for the</span><span class="WHIT">
<span class='line'>5230</span> </span><span class="WHIT">					</span><span class="COMM">// first time.</span><span class="WHIT">
<span class='line'>5231</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.parentAnchor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">self.anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_currentInstance.makeAnchor</span><span class="PUNC">(</span><span class="NAME">self.parentAnchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_currentInstance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5232</span> 
<span class='line'>5233</span> </span><span class="WHIT">					</span><span class="COMM">// store the id of the dragging div and the source element. the drop function will pick these up.					</span><span class="WHIT">
<span class='line'>5234</span> </span><span class="WHIT">					</span><span class="NAME">_setAttribute</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"dragId"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">placeholderInfo.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5235</span> </span><span class="WHIT">					</span><span class="NAME">_setAttribute</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"elId"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_elementId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5236</span> 
<span class='line'>5237</span> </span><span class="WHIT">					</span><span class="COMM">// create a floating endpoint.</span><span class="WHIT">
<span class='line'>5238</span> </span><span class="WHIT">					</span><span class="COMM">// here we test to see if a dragProxy was specified in this endpoint's constructor params, and</span><span class="WHIT">
<span class='line'>5239</span> </span><span class="WHIT">					</span><span class="COMM">// if so, we create that endpoint instead of cloning ourselves.</span><span class="WHIT">
<span class='line'>5240</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.proxy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5241</span> </span><span class="WHIT">				</span><span class="COMM">/*		var floatingAnchor = new FloatingAnchor( { reference : self.anchor, referenceCanvas : self.canvas });
<span class='line'>5242</span> 
<span class='line'>5243</span> 						floatingEndpoint = _newEndpoint({ 
<span class='line'>5244</span> 							paintStyle : params.proxy.paintStyle,
<span class='line'>5245</span> 							endpoint : params.proxy.endpoint,
<span class='line'>5246</span> 							anchor : floatingAnchor, 
<span class='line'>5247</span> 							source : placeholderInfo.element, 
<span class='line'>5248</span> 							scope:"__floating" 
<span class='line'>5249</span> 						});		
<span class='line'>5250</span> 						
<span class='line'>5251</span> 						//$(self.canvas).hide();									
<span class='line'>5252</span> 						*/</span><span class="WHIT">
<span class='line'>5253</span> </span><span class="WHIT">						</span><span class="NAME">self.setPaintStyle</span><span class="PUNC">(</span><span class="NAME">params.proxy.paintStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5254</span> </span><span class="WHIT">						</span><span class="COMM">// if we do this, we have to cleanup the old one. like just remove its display parts												</span><span class="WHIT">
<span class='line'>5255</span> </span><span class="WHIT">						</span><span class="COMM">//self.setEndpoint(params.proxy.endpoint);</span><span class="WHIT">
<span class='line'>5256</span> 
<span class='line'>5257</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5258</span> </span><span class="WHIT">				</span><span class="COMM">//	else {</span><span class="WHIT">
<span class='line'>5259</span> </span><span class="WHIT">						</span><span class="NAME">floatingEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_makeFloatingEndpoint</span><span class="PUNC">(</span><span class="NAME">self.getPaintStyle</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_endpoint</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">placeholderInfo.element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5260</span> </span><span class="WHIT">				</span><span class="COMM">//	}</span><span class="WHIT">
<span class='line'>5261</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>5262</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">                                                                                                                                                         </span><span class="WHIT">
<span class='line'>5263</span> </span><span class="WHIT">						</span><span class="NAME">self.anchor.locked</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5264</span> </span><span class="WHIT">                        </span><span class="NAME">self.setHover</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5265</span> </span><span class="WHIT">                        </span><span class="COMM">// TODO the hover call above does not reset any target endpoint's hover</span><span class="WHIT">
<span class='line'>5266</span> </span><span class="WHIT">                        </span><span class="COMM">// states.</span><span class="WHIT">
<span class='line'>5267</span> </span><span class="WHIT">						</span><span class="COMM">// create a connection. one end is this endpoint, the other is a floating endpoint.</span><span class="WHIT">
<span class='line'>5268</span> </span><span class="WHIT">						</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_newConnection</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5269</span> </span><span class="WHIT">							</span><span class="NAME">sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5270</span> </span><span class="WHIT">							</span><span class="NAME">targetEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">floatingEndpoint</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5271</span> </span><span class="WHIT">							</span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">self.endpointWillMoveTo</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">_element</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">  </span><span class="COMM">// for makeSource with parent option.  ensure source element is represented correctly.</span><span class="WHIT">
<span class='line'>5272</span> </span><span class="WHIT">							</span><span class="NAME">target</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">placeholderInfo.element</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5273</span> </span><span class="WHIT">							</span><span class="NAME">anchors</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">self.anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">floatingEndpoint.anchor</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5274</span> </span><span class="WHIT">							</span><span class="NAME">paintStyle</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">params.connectorStyle</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// this can be null. Connection will use the default.</span><span class="WHIT">
<span class='line'>5275</span> </span><span class="WHIT">							</span><span class="NAME">hoverPaintStyle</span><span class="PUNC">:</span><span class="NAME">params.connectorHoverStyle</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5276</span> </span><span class="WHIT">							</span><span class="NAME">connector</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">params.connector</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">// this can also be null. Connection will use the default.</span><span class="WHIT">
<span class='line'>5277</span> </span><span class="WHIT">							</span><span class="NAME">overlays</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">params.connectorOverlays</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5278</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5279</span> 
<span class='line'>5280</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5281</span> </span><span class="WHIT">						</span><span class="NAME">existingJpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5282</span> </span><span class="WHIT">						</span><span class="NAME">jpc.connector.setHover</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5283</span> </span><span class="WHIT">						</span><span class="COMM">// if existing connection, allow to be dropped back on the source endpoint (issue 51).</span><span class="WHIT">
<span class='line'>5284</span> </span><span class="WHIT">						</span><span class="NAME">_initDropTarget</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">inPlaceCopy.canvas</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5285</span> </span><span class="WHIT">						</span><span class="COMM">// new anchor idx</span><span class="WHIT">
<span class='line'>5286</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">anchorIdx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">self.id</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5287</span> </span><span class="WHIT">						</span><span class="NAME">jpc.floatingAnchorIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">anchorIdx</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="COMM">// save our anchor index as the connection's floating index.						</span><span class="WHIT">
<span class='line'>5288</span> </span><span class="WHIT">						</span><span class="NAME">self.detachFromConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">							</span><span class="COMM">// detach from the connection while dragging is occurring.</span><span class="WHIT">
<span class='line'>5289</span> </span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>5290</span> </span><span class="WHIT">						</span><span class="COMM">// store the original scope (issue 57)</span><span class="WHIT">
<span class='line'>5291</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5292</span> </span><span class="WHIT">						    </span><span class="NAME">dragScope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getDragScope</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5293</span> </span><span class="WHIT">						</span><span class="NAME">_setAttribute</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"originalScope"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragScope</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5294</span> </span><span class="WHIT">						</span><span class="COMM">// now we want to get this endpoint's DROP scope, and set it for now: we can only be dropped on drop zones</span><span class="WHIT">
<span class='line'>5295</span> </span><span class="WHIT">						</span><span class="COMM">// that have our drop scope (issue 57).</span><span class="WHIT">
<span class='line'>5296</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dropScope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getDropScope</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5297</span> </span><span class="WHIT">						</span><span class="NAME">jsPlumb.CurrentLibrary.setDragScope</span><span class="PUNC">(</span><span class="NAME">c</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropScope</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5298</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>5299</span> </span><span class="WHIT">						</span><span class="COMM">// now we replace ourselves with the temporary div we created above:</span><span class="WHIT">
<span class='line'>5300</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">anchorIdx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5301</span> </span><span class="WHIT">							</span><span class="NAME">existingJpcParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">jpc.source</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragScope</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5302</span> </span><span class="WHIT">							</span><span class="NAME">jpc.source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">placeholderInfo.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5303</span> </span><span class="WHIT">							</span><span class="NAME">jpc.sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">placeholderInfo.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5304</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5305</span> </span><span class="WHIT">							</span><span class="NAME">existingJpcParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">jpc.target</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc.targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragScope</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5306</span> </span><span class="WHIT">							</span><span class="NAME">jpc.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">placeholderInfo.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5307</span> </span><span class="WHIT">							</span><span class="NAME">jpc.targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">placeholderInfo.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5308</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5309</span> 
<span class='line'>5310</span> </span><span class="WHIT">						</span><span class="COMM">// lock the other endpoint; if it is dynamic it will not move while the drag is occurring.</span><span class="WHIT">
<span class='line'>5311</span> </span><span class="WHIT">						</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">anchorIdx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor.locked</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5312</span> </span><span class="WHIT">						</span><span class="COMM">// store the original endpoint and assign the new floating endpoint for the drag.</span><span class="WHIT">
<span class='line'>5313</span> </span><span class="WHIT">						</span><span class="NAME">jpc.suspendedEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">anchorIdx</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5314</span> </span><span class="WHIT">                        </span><span class="NAME">jpc.suspendedEndpoint.setHover</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5315</span> </span><span class="WHIT">						</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">anchorIdx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">floatingEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5316</span> 
<span class='line'>5317</span> </span><span class="WHIT">						</span><span class="COMM">// fire an event that informs that a connection is being dragged</span><span class="WHIT">
<span class='line'>5318</span> </span><span class="WHIT">						</span><span class="NAME">fireConnectionDraggingEvent</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5319</span> 
<span class='line'>5320</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5321</span> </span><span class="WHIT">					</span><span class="COMM">// register it and register connection on it.</span><span class="WHIT">
<span class='line'>5322</span> </span><span class="WHIT">					</span><span class="NAME">floatingConnections</span><span class="PUNC">[</span><span class="NAME">placeholderInfo.id</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5323</span> </span><span class="WHIT">					</span><span class="NAME">floatingEndpoint.addConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5324</span> </span><span class="WHIT">					</span><span class="COMM">// only register for the target endpoint; we will not be dragging the source at any time</span><span class="WHIT">
<span class='line'>5325</span> </span><span class="WHIT">					</span><span class="COMM">// before this connection is either discarded or made into a permanent connection.</span><span class="WHIT">
<span class='line'>5326</span> </span><span class="WHIT">					</span><span class="NAME">_addToList</span><span class="PUNC">(</span><span class="NAME">endpointsByElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">placeholderInfo.id</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">floatingEndpoint</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5327</span> </span><span class="WHIT">					</span><span class="COMM">// tell jsplumb about it</span><span class="WHIT">
<span class='line'>5328</span> </span><span class="WHIT">					</span><span class="NAME">_currentInstance.currentlyDragging</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5329</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5330</span> 
<span class='line'>5331</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jpcl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5332</span> </span><span class="WHIT">				    </span><span class="NAME">dragOptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.dragOptions</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5333</span> </span><span class="WHIT">				    </span><span class="NAME">defaultOpts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpcl.defaultDragOptions</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5334</span> </span><span class="WHIT">				    </span><span class="NAME">startEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.dragEvents</span><span class="PUNC">[</span><span class="STRN">"start"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5335</span> </span><span class="WHIT">				    </span><span class="NAME">stopEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.dragEvents</span><span class="PUNC">[</span><span class="STRN">"stop"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5336</span> </span><span class="WHIT">				    </span><span class="NAME">dragEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.dragEvents</span><span class="PUNC">[</span><span class="STRN">"drag"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5337</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>5338</span> </span><span class="WHIT">				</span><span class="NAME">dragOptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="NAME">defaultOpts</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragOptions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5339</span> </span><span class="WHIT">				</span><span class="NAME">dragOptions.scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dragOptions.scope</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.scope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5340</span> </span><span class="WHIT">				</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="NAME">startEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="NAME">startEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">start</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5341</span> </span><span class="WHIT">				</span><span class="COMM">// extracted drag handler function so can be used by makeSource</span><span class="WHIT">
<span class='line'>5342</span> </span><span class="WHIT">				</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="NAME">dragEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="NAME">dragEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_dragHandler.drag</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5343</span> </span><span class="WHIT">				</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="NAME">stopEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">dragOptions</span><span class="PUNC">[</span><span class="NAME">stopEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5344</span> </span><span class="WHIT">					</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5345</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpcl.getDropEvent</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5346</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.currentlyDragging</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>5347</span> </span><span class="WHIT">						</span><span class="NAME">_removeWithFunction</span><span class="PUNC">(</span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">placeholderInfo.id</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5348</span> </span><span class="WHIT">							</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">e.id</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">floatingEndpoint.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5349</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5350</span> </span><span class="WHIT">						</span><span class="NAME">_removeElements</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">placeholderInfo.element</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">floatingEndpoint.canvas</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// TODO: clean up the connection canvas (if the user aborted)</span><span class="WHIT">
<span class='line'>5351</span> </span><span class="WHIT">						</span><span class="NAME">_removeElement</span><span class="PUNC">(</span><span class="NAME">inPlaceCopy.canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">_element</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5352</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.anchorManager.clearFor</span><span class="PUNC">(</span><span class="NAME">placeholderInfo.id</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>5353</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.floatingAnchorIndex</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.floatingAnchorIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5354</span> </span><span class="WHIT">						</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor.locked</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5355</span> </span><span class="WHIT">						</span><span class="NAME">self.setPaintStyle</span><span class="PUNC">(</span><span class="NAME">originalPaintStyle</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// reset to original; may have been changed by drag proxy.</span><span class="WHIT">
<span class='line'>5356</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">floatingEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5357</span> </span><span class="WHIT">							</span><span class="COMM">// if the connection was an existing one:</span><span class="WHIT">
<span class='line'>5358</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">existingJpc</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5359</span> </span><span class="WHIT">								</span><span class="COMM">// fix for issue35, thanks Sylvain Gizard: when firing the detach event make sure the</span><span class="WHIT">
<span class='line'>5360</span> </span><span class="WHIT">								</span><span class="COMM">// floating endpoint has been replaced.</span><span class="WHIT">
<span class='line'>5361</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5362</span> </span><span class="WHIT">									</span><span class="NAME">jpc.source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">existingJpcParams</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5363</span> </span><span class="WHIT">									</span><span class="NAME">jpc.sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">existingJpcParams</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5364</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5365</span> </span><span class="WHIT">									</span><span class="NAME">jpc.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">existingJpcParams</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5366</span> </span><span class="WHIT">									</span><span class="NAME">jpc.targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">existingJpcParams</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5367</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5368</span> </span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>5369</span> </span><span class="WHIT">								</span><span class="COMM">// restore the original scope (issue 57)</span><span class="WHIT">
<span class='line'>5370</span> </span><span class="WHIT">								</span><span class="NAME">jsPlumb.CurrentLibrary.setDragScope</span><span class="PUNC">(</span><span class="NAME">existingJpcParams</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">existingJpcParams</span><span class="PUNC">[</span><span class="NUMB">3</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5371</span> </span><span class="WHIT">								</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5372</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.isReattach</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jpc._forceDetach</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">detach</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">									</span><span class="WHIT">
<span class='line'>5373</span> </span><span class="WHIT">									</span><span class="NAME">jpc.setHover</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5374</span> </span><span class="WHIT">									</span><span class="NAME">jpc.floatingAnchorIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5375</span> </span><span class="WHIT">									</span><span class="NAME">jpc.suspendedEndpoint.addConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5376</span> </span><span class="WHIT">									</span><span class="NAME">_currentInstance.repaint</span><span class="PUNC">(</span><span class="NAME">existingJpcParams</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5377</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5378</span> </span><span class="WHIT">                                </span><span class="NAME">jpc._forceDetach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5379</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5380</span> </span><span class="WHIT">								</span><span class="COMM">// TODO this looks suspiciously kind of like an Endpoint.detach call too.</span><span class="WHIT">
<span class='line'>5381</span> </span><span class="WHIT">								</span><span class="COMM">// i wonder if this one should post an event though.  maybe this is good like this.</span><span class="WHIT">
<span class='line'>5382</span> </span><span class="WHIT">								</span><span class="NAME">_removeElements</span><span class="PUNC">(</span><span class="NAME">jpc.connector.getDisplayElements</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self.parent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5383</span> </span><span class="WHIT">								</span><span class="NAME">self.detachFromConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>5384</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">																</span><span class="WHIT">
<span class='line'>5385</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5386</span> </span><span class="WHIT">						</span><span class="NAME">self.anchor.locked</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">												</span><span class="WHIT">
<span class='line'>5387</span> </span><span class="WHIT">						</span><span class="NAME">self.paint</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">recalc</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5388</span> </span><span class="WHIT">						</span><span class="NAME">jpc.setHover</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5389</span> 
<span class='line'>5390</span> </span><span class="WHIT">						</span><span class="NAME">fireConnectionDragStopEvent</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5391</span> 
<span class='line'>5392</span> </span><span class="WHIT">						</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>5393</span> </span><span class="WHIT">						</span><span class="NAME">inPlaceCopy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>5394</span> </span><span class="WHIT">						</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">endpointsByElement</span><span class="PUNC">[</span><span class="NAME">floatingEndpoint.elementId</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5395</span> </span><span class="WHIT">						</span><span class="NAME">floatingEndpoint.anchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5396</span> </span><span class="WHIT">                        </span><span class="NAME">floatingEndpoint</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5397</span> </span><span class="WHIT">						</span><span class="NAME">_currentInstance.currentlyDragging</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5398</span> 
<span class='line'>5399</span> 
<span class='line'>5400</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5401</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>5402</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>5403</span> </span><span class="WHIT">				</span><span class="NAME">jsPlumb.CurrentLibrary.initDraggable</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragOptions</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5404</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5405</span> 
<span class='line'>5406</span> </span><span class="WHIT">			</span><span class="COMM">// pulled this out into a function so we can reuse it for the inPlaceCopy canvas; you can now drop detached connections</span><span class="WHIT">
<span class='line'>5407</span> </span><span class="WHIT">			</span><span class="COMM">// back onto the endpoint you detached it from.</span><span class="WHIT">
<span class='line'>5408</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_initDropTarget</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">forceInit</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isTransient</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5409</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">params.isTarget</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">forceInit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.isDropSupported</span><span class="PUNC">(</span><span class="NAME">_element</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5410</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dropOptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.dropOptions</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">_currentInstance.Defaults.DropOptions</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">jsPlumb.Defaults.DropOptions</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5411</span> </span><span class="WHIT">					</span><span class="NAME">dropOptions</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.extend</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropOptions</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5412</span> </span><span class="WHIT">					</span><span class="NAME">dropOptions.scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dropOptions.scope</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.scope</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5413</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dropEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.dragEvents</span><span class="PUNC">[</span><span class="STRN">'drop'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5414</span> </span><span class="WHIT">					    </span><span class="NAME">overEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.dragEvents</span><span class="PUNC">[</span><span class="STRN">'over'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5415</span> </span><span class="WHIT">					    </span><span class="NAME">outEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.dragEvents</span><span class="PUNC">[</span><span class="STRN">'out'</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5416</span> </span><span class="WHIT">					</span><span class="NAME">drop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5417</span> 
<span class='line'>5418</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getDropEvent</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5419</span> </span><span class="WHIT">							</span><span class="NAME">draggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">jsPlumb.CurrentLibrary.getDragObject</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5420</span> </span><span class="WHIT">							</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"dragId"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5421</span> </span><span class="WHIT">							</span><span class="NAME">elId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"elId"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>5422</span> </span><span class="WHIT">							</span><span class="NAME">scope</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"originalScope"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5423</span> </span><span class="WHIT">							</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">floatingConnections</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5424</span> 
<span class='line'>5425</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5426</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.floatingAnchorIndex</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.floatingAnchorIndex</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oidx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5427</span> </span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>5428</span> </span><span class="WHIT">							</span><span class="COMM">// restore the original scope if necessary (issue 57)						</span><span class="WHIT">
<span class='line'>5429</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">scope</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.setDragScope</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">scope</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>5430</span> </span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>5431</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endpointEnabled</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">endpoint</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">endpoint.isEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5432</span> 
<span class='line'>5433</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">self.isFull</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">self.isSource</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">self.isTarget</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">endpointEnabled</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5434</span> </span><span class="WHIT">							</span><span class="WHIT">
<span class='line'>5435</span> </span><span class="WHIT">								</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_doContinue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5436</span> 
<span class='line'>5437</span> </span><span class="WHIT">	                            </span><span class="COMM">// the second check here is for the case that the user is dropping it back</span><span class="WHIT">
<span class='line'>5438</span> </span><span class="WHIT">	                            </span><span class="COMM">// where it came from.</span><span class="WHIT">
<span class='line'>5439</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.suspendedEndpoint</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.id</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">self.id</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5440</span> </span><span class="WHIT">									</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5441</span> </span><span class="WHIT">										</span><span class="NAME">jpc.source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5442</span> </span><span class="WHIT">										</span><span class="NAME">jpc.sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5443</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5444</span> </span><span class="WHIT">										</span><span class="NAME">jpc.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5445</span> </span><span class="WHIT">										</span><span class="NAME">jpc.targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5446</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5447</span> 
<span class='line'>5448</span> </span><span class="WHIT">									</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">jpc.isDetachAllowed</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">isDetachAllowed</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">jpc.suspendedEndpoint.isDetachAllowed</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">_currentInstance.checkCondition</span><span class="PUNC">(</span><span class="STRN">"beforeDetach"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5449</span> </span><span class="WHIT">										</span><span class="NAME">_doContinue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">								</span><span class="WHIT">
<span class='line'>5450</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5451</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>5452</span> </span><span class="WHIT">								</span><span class="COMM">// these have to be set before testing for beforeDrop.</span><span class="WHIT">
<span class='line'>5453</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5454</span> </span><span class="WHIT">									</span><span class="NAME">jpc.source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5455</span> </span><span class="WHIT">									</span><span class="NAME">jpc.sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5456</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5457</span> </span><span class="WHIT">									</span><span class="NAME">jpc.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5458</span> </span><span class="WHIT">									</span><span class="NAME">jpc.targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5459</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5460</span> </span><span class="WHIT">																</span><span class="WHIT">
<span class='line'>5461</span> </span><span class="WHIT">								</span><span class="COMM">// now check beforeDrop.  this will be available only on Endpoints that are setup to</span><span class="WHIT">
<span class='line'>5462</span> </span><span class="WHIT">								</span><span class="COMM">// have a beforeDrop condition (although, secretly, under the hood all Endpoints and </span><span class="WHIT">
<span class='line'>5463</span> </span><span class="WHIT">								</span><span class="COMM">// the Connection have them, because they are on jsPlumbUIComponent.  shhh!), because</span><span class="WHIT">
<span class='line'>5464</span> </span><span class="WHIT">								</span><span class="COMM">// it only makes sense to have it on a target endpoint.</span><span class="WHIT">
<span class='line'>5465</span> </span><span class="WHIT">								</span><span class="NAME">_doContinue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_doContinue</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">self.isDropAllowed</span><span class="PUNC">(</span><span class="NAME">jpc.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc.targetId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc.scope</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5466</span> </span><span class="WHIT">														</span><span class="WHIT">
<span class='line'>5467</span> </span><span class="WHIT">								</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">_doContinue</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5468</span> </span><span class="WHIT">									</span><span class="COMM">// remove this jpc from the current endpoint</span><span class="WHIT">
<span class='line'>5469</span> </span><span class="WHIT">									</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">detachFromConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5470</span> </span><span class="WHIT">									</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.suspendedEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.detachFromConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5471</span> </span><span class="WHIT">									</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5472</span> </span><span class="WHIT">									</span><span class="NAME">self.addConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5473</span> </span><span class="WHIT">									</span><span class="WHIT">
<span class='line'>5474</span> </span><span class="WHIT">									</span><span class="COMM">// copy our parameters in to the connection:</span><span class="WHIT">
<span class='line'>5475</span> </span><span class="WHIT">									</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">self.getParameters</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5476</span> </span><span class="WHIT">									</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">aParam</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5477</span> </span><span class="WHIT">										</span><span class="NAME">jpc.setParameter</span><span class="PUNC">(</span><span class="NAME">aParam</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">[</span><span class="NAME">aParam</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5478</span> 
<span class='line'>5479</span> </span><span class="WHIT">									</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">jpc.suspendedEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">  </span><span class="WHIT">
<span class='line'>5480</span> </span><span class="WHIT">										</span><span class="COMM">//_initDraggableIfNecessary(self.element, params.draggable, {});</span><span class="WHIT">
<span class='line'>5481</span> </span><span class="WHIT">										</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.draggable</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5482</span> </span><span class="WHIT">											</span><span class="NAME">jsPlumb.CurrentLibrary.initDraggable</span><span class="PUNC">(</span><span class="NAME">self.element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dragOptions</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5483</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5484</span> </span><span class="WHIT">									</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5485</span> </span><span class="WHIT">										</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">suspendedElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.getElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">suspendedElementId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5486</span> </span><span class="WHIT">										</span><span class="COMM">// fire a detach event</span><span class="WHIT">
<span class='line'>5487</span> </span><span class="WHIT">										</span><span class="NAME">fireDetachEvent</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5488</span> </span><span class="WHIT">											</span><span class="NAME">source</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">suspendedElement</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.source</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5489</span> </span><span class="WHIT">											</span><span class="NAME">target</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">suspendedElement</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.target</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5490</span> </span><span class="WHIT">											</span><span class="NAME">sourceId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">suspendedElementId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.sourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5491</span> </span><span class="WHIT">											</span><span class="NAME">targetId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">suspendedElementId</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.targetId</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5492</span> </span><span class="WHIT">											</span><span class="NAME">sourceEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5493</span> </span><span class="WHIT">											</span><span class="NAME">targetEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5494</span> </span><span class="WHIT">											</span><span class="NAME">connection</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc</span><span class="WHIT">
<span class='line'>5495</span> </span><span class="WHIT">										</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5496</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5497</span> 
<span class='line'>5498</span> </span><span class="WHIT">	                                </span><span class="COMM">// finalise will inform the anchor manager and also add to</span><span class="WHIT">
<span class='line'>5499</span> </span><span class="WHIT">	                                </span><span class="COMM">// connectionsByScope if necessary.</span><span class="WHIT">
<span class='line'>5500</span> </span><span class="WHIT">	                                </span><span class="NAME">_finaliseConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">originalEvent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5501</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5502</span> </span><span class="WHIT">								</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5503</span> </span><span class="WHIT">	                                </span><span class="COMM">// otherwise just put it back on the endpoint it was on before the drag.</span><span class="WHIT">
<span class='line'>5504</span> </span><span class="WHIT">									</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc.suspendedEndpoint</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5505</span> </span><span class="WHIT">	                            </span><span class="COMM">//        self.detachFrom(jpc);</span><span class="WHIT">
<span class='line'>5506</span> </span><span class="WHIT">	                                    </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5507</span> </span><span class="WHIT">										</span><span class="NAME">jpc.setHover</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5508</span> </span><span class="WHIT">	                                    </span><span class="NAME">jpc._forceDetach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5509</span> </span><span class="WHIT">	                                    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5510</span> </span><span class="WHIT">									        </span><span class="NAME">jpc.source</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5511</span> </span><span class="WHIT">									        </span><span class="NAME">jpc.sourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.elementId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5512</span> </span><span class="WHIT">								        </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5513</span> </span><span class="WHIT">									        </span><span class="NAME">jpc.target</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5514</span> </span><span class="WHIT">									        </span><span class="NAME">jpc.targetId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.suspendedEndpoint.elementId</span><span class="PUNC">;</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5515</span> </span><span class="WHIT">								        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5516</span> </span><span class="WHIT">									    </span><span class="NAME">jpc.suspendedEndpoint.addConnection</span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5517</span> 
<span class='line'>5518</span> </span><span class="WHIT">	                                    </span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5519</span> </span><span class="WHIT">	                                    </span><span class="NAME">jpc.repaint</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5520</span> </span><span class="WHIT">										</span><span class="NAME">_currentInstance.repaint</span><span class="PUNC">(</span><span class="NAME">jpc.source.elementId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5521</span> </span><span class="WHIT">	                                    </span><span class="NAME">jpc._forceDetach</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5522</span> </span><span class="WHIT">									</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5523</span> </span><span class="WHIT">								</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5524</span> 
<span class='line'>5525</span> </span><span class="WHIT">	                            </span><span class="NAME">jpc.floatingAnchorIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5526</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5527</span> </span><span class="WHIT">							</span><span class="NAME">_currentInstance.currentlyDragging</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5528</span> </span><span class="WHIT">							</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">floatingConnections</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">						</span><span class="WHIT">
<span class='line'>5529</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5530</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5531</span> </span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>5532</span> </span><span class="WHIT">					</span><span class="NAME">dropOptions</span><span class="PUNC">[</span><span class="NAME">dropEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">dropOptions</span><span class="PUNC">[</span><span class="NAME">dropEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">drop</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5533</span> </span><span class="WHIT">					</span><span class="NAME">dropOptions</span><span class="PUNC">[</span><span class="NAME">overEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">dropOptions</span><span class="PUNC">[</span><span class="NAME">overEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5534</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.isTarget</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5535</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">draggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getDragObject</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5536</span> </span><span class="WHIT">								</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"dragId"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5537</span> </span><span class="WHIT">								</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">floatingConnections</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5538</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5539</span> </span><span class="WHIT">								</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.floatingAnchorIndex</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.floatingAnchorIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5540</span> </span><span class="WHIT">								</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor.over</span><span class="PUNC">(</span><span class="NAME">self.anchor</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5541</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5542</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5543</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>5544</span> </span><span class="WHIT">					</span><span class="NAME">dropOptions</span><span class="PUNC">[</span><span class="NAME">outEvent</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_wrap</span><span class="PUNC">(</span><span class="NAME">dropOptions</span><span class="PUNC">[</span><span class="NAME">outEvent</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5545</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">self.isTarget</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5546</span> </span><span class="WHIT">							</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">draggable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jsPlumb.CurrentLibrary.getDragObject</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5547</span> </span><span class="WHIT">								</span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_getAttribute</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">draggable</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"dragId"</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5548</span> </span><span class="WHIT">								</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">floatingConnections</span><span class="PUNC">[</span><span class="NAME">id</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5549</span> </span><span class="WHIT">							</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">jpc</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5550</span> </span><span class="WHIT">								</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">idx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">jpc.floatingAnchorIndex</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">jpc.floatingAnchorIndex</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5551</span> </span><span class="WHIT">								</span><span class="NAME">jpc.endpoints</span><span class="PUNC">[</span><span class="NAME">idx</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">anchor.out</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5552</span> </span><span class="WHIT">							</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5553</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5554</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5555</span> </span><span class="WHIT">					</span><span class="NAME">jsPlumb.CurrentLibrary.initDroppable</span><span class="PUNC">(</span><span class="NAME">canvas</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dropOptions</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">isTransient</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5556</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5557</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5558</span> </span><span class="WHIT">			</span><span class="WHIT">
<span class='line'>5559</span> </span><span class="WHIT">			</span><span class="COMM">// initialise the endpoint's canvas as a drop target.  this will be ignored if the endpoint is not a target or drag is not supported.</span><span class="WHIT">
<span class='line'>5560</span> </span><span class="WHIT">			</span><span class="NAME">_initDropTarget</span><span class="PUNC">(</span><span class="NAME">_getElementObject</span><span class="PUNC">(</span><span class="NAME">self.canvas</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="PUNC">(</span><span class="NAME">params._transient</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">self.anchor.isFloating</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5561</span> 
<span class='line'>5562</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">self</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5563</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">					</span><span class="WHIT">
<span class='line'>5564</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>5565</span> 
<span class='line'>5566</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">jsPlumb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.jsPlumb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">jsPlumbInstance</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5567</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.getInstance</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">_defaults</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5568</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">jsPlumbInstance</span><span class="PUNC">(</span><span class="NAME">_defaults</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5569</span> </span><span class="WHIT">		</span><span class="NAME">j.init</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5570</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5571</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>5572</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>5573</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ox</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fnInit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5574</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5575</span> </span><span class="WHIT">			</span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5576</span> </span><span class="WHIT">			</span><span class="COMM">//var a = jsPlumb.makeAnchor([ x, y, ox, oy, 0, 0 ], params.elementId, params.jsPlumbInstance);</span><span class="WHIT">
<span class='line'>5577</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.jsPlumbInstance.makeAnchor</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ox</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">oy</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.jsPlumbInstance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5578</span> </span><span class="WHIT">			</span><span class="NAME">a.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">type</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5579</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fnInit</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">fnInit</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5580</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5581</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5582</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5583</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"TopCenter"</span><span class="PUNC">]</span><span class="WHIT"> 		</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="PUNC">(</span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"TopCenter"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5584</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"BottomCenter"</span><span class="PUNC">]</span><span class="WHIT"> 	</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="PUNC">(</span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"BottomCenter"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5585</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"LeftMiddle"</span><span class="PUNC">]</span><span class="WHIT"> 		</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"LeftMiddle"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5586</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"RightMiddle"</span><span class="PUNC">]</span><span class="WHIT"> 		</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"RightMiddle"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5587</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"Center"</span><span class="PUNC">]</span><span class="WHIT"> 			</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="PUNC">(</span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0.5</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"Center"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5588</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"TopRight"</span><span class="PUNC">]</span><span class="WHIT"> 		</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"TopRight"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5589</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"BottomRight"</span><span class="PUNC">]</span><span class="WHIT"> 		</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"BottomRight"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5590</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"TopLeft"</span><span class="PUNC">]</span><span class="WHIT"> 			</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"TopLeft"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5591</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"BottomLeft"</span><span class="PUNC">]</span><span class="WHIT"> 		</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"BottomLeft"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5592</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>5593</span> </span><span class="WHIT">	</span><span class="COMM">// TODO test that this does not break with the current instance idea</span><span class="WHIT">
<span class='line'>5594</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Defaults.DynamicAnchors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5595</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">params.jsPlumbInstance.makeAnchors</span><span class="PUNC">(</span><span class="PUNC">[</span><span class="STRN">"TopCenter"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"RightMiddle"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"BottomCenter"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"LeftMiddle"</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.elementId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params.jsPlumbInstance</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5596</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5597</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"AutoDefault"</span><span class="PUNC">]</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5598</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">a</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.jsPlumbInstance.makeDynamicAnchor</span><span class="PUNC">(</span><span class="NAME">jsPlumb.Defaults.DynamicAnchors</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5599</span> </span><span class="WHIT">		</span><span class="NAME">a.type</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"AutoDefault"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5600</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5601</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5602</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>5603</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"Assign"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">_curryAnchor</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="STRN">"Assign"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">anchor</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5604</span> </span><span class="WHIT">		</span><span class="COMM">// find what to use as the "position finder". the user may have supplied a String which represents</span><span class="WHIT">
<span class='line'>5605</span> </span><span class="WHIT">		</span><span class="COMM">// the id of a position finder in jsPlumb.AnchorPositionFinders, or the user may have supplied the</span><span class="WHIT">
<span class='line'>5606</span> </span><span class="WHIT">		</span><span class="COMM">// position finder as a function.  we find out what to use and then set it on the anchor.</span><span class="WHIT">
<span class='line'>5607</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params.position</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">"Fixed"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5608</span> </span><span class="WHIT">		</span><span class="NAME">anchor.positionFinder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pf.constructor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">String</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">params.jsPlumbInstance.AnchorPositionFinders</span><span class="PUNC">[</span><span class="NAME">pf</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">pf</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5609</span> </span><span class="WHIT">		</span><span class="COMM">// always set the constructor params; the position finder might need them later (the Grid one does,</span><span class="WHIT">
<span class='line'>5610</span> </span><span class="WHIT">		</span><span class="COMM">// for example)</span><span class="WHIT">
<span class='line'>5611</span> </span><span class="WHIT">		</span><span class="NAME">anchor.constructorParams</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5612</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5613</span> 
<span class='line'>5614</span> </span><span class="WHIT">	</span><span class="COMM">// Continuous anchor is just curried through to the 'get' method of the continuous anchor</span><span class="WHIT">
<span class='line'>5615</span> </span><span class="WHIT">	</span><span class="COMM">// factory.</span><span class="WHIT">
<span class='line'>5616</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.Anchors</span><span class="PUNC">[</span><span class="STRN">"Continuous"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5617</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">params.jsPlumbInstance.continuousAnchorFactory.get</span><span class="PUNC">(</span><span class="NAME">params</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5618</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5619</span> 
<span class='line'>5620</span> </span><span class="WHIT">    </span><span class="COMM">// these are the default anchor positions finders, which are used by the makeTarget function.  supply</span><span class="WHIT">
<span class='line'>5621</span> </span><span class="WHIT">    </span><span class="COMM">// a position finder argument to that function allows you to specify where the resulting anchor will</span><span class="WHIT">
<span class='line'>5622</span> </span><span class="WHIT">    </span><span class="COMM">// be located</span><span class="WHIT">
<span class='line'>5623</span> </span><span class="WHIT">	</span><span class="NAME">jsPlumb.AnchorPositionFinders</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5624</span> </span><span class="WHIT">		</span><span class="STRN">"Fixed"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">es</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5625</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dp.left</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">ep.left</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">es</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dp.top</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">ep.top</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">es</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>5626</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5627</span> </span><span class="WHIT">		</span><span class="STRN">"Grid"</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ep</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">es</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5628</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dp.left</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">ep.left</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dp.top</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">ep.top</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5629</span> </span><span class="WHIT">				</span><span class="NAME">gx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">es</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.grid</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">gy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">es</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">params.grid</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5630</span> </span><span class="WHIT">				</span><span class="NAME">mx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">gx</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">my</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">dy</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">gy</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5631</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">mx</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">gx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gx</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">es</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">my</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">gy</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gy</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">2</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">es</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5632</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5633</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5634</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5635</span> </span></pre></body></html>